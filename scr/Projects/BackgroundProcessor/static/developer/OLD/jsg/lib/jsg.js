/*
 Copyright Tensegrity Software GmbH. Use and distribution currently only with the consent of Tensegrity Software GmbH! Please read and
 follow the license agreement provided with this distribution. If there are any questions regarding the software license, please contact us. 
*/
(function(a,b){function c(){if(!d.READY){d.event.determineEventTypes();for(var a in d.gestures)d.gestures.hasOwnProperty(a)&&d.detection.register(d.gestures[a]);d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect);d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect);d.READY=!0}}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};
d.HAS_POINTEREVENTS=a.navigator.pointerEnabled||a.navigator.msPointerEnabled;d.HAS_TOUCHEVENTS="ontouchstart"in a;d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i;d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&a.navigator.userAgent.match(d.MOBILE_REGEX);d.EVENT_TYPES={};d.DIRECTION_DOWN="down";d.DIRECTION_LEFT="left";d.DIRECTION_UP="up";d.DIRECTION_RIGHT="right";d.POINTER_MOUSE="mouse";d.POINTER_TOUCH="touch";d.POINTER_PEN="pen";d.EVENT_START="start";d.EVENT_MOVE="move";d.EVENT_END="end";d.DOCUMENT=
a.document;d.plugins={};d.READY=!1;d.Instance=function(a,b){var e=this;c();this.element=a;this.enabled=!0;this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{});this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior);d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)});return this};d.Instance.prototype={on:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.addEventListener(c[d],
b,!1);return this},off:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.removeEventListener(c[d],b,!1);return this},trigger:function(a,b){var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0);c.gesture=b;var e=this.element;d.utils.hasParent(b.target,e)&&(e=b.target);e.dispatchEvent(c);return this},enable:function(a){this.enabled=a;return this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){b=b.split(" ");for(var d=0;d<b.length;d++)a.addEventListener(b[d],c,!1)},onTouch:function(a,
b,c){var k=this;this.bindDom(a,d.EVENT_TYPES[b],function(n){var q=n.type.toLowerCase();if(!q.match(/mouse/)||!g){q.match(/touch/)||q.match(/pointerdown/)||q.match(/mouse/)&&1===n.which?f=!0:q.match(/mouse/)&&1!==n.which&&(f=!1);q.match(/touch|pointer/)&&(g=!0);var p=0;if(f){d.HAS_POINTEREVENTS&&b!=d.EVENT_END?p=d.PointerEvent.updatePointer(b,n):q.match(/touch/)?p=n.touches.length:g||(p=q.match(/up/)?0:1);0<p&&b==d.EVENT_END?b=d.EVENT_MOVE:p||(b=d.EVENT_END);if(p||null===e)e=n;c.call(d.detection,k.collectEventData(a,
b,k.getTouchList(e,b),n));d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(p=d.PointerEvent.updatePointer(b,n))}p||(e=null,g=f=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"];d.EVENT_TYPES[d.EVENT_START]=a[0];d.EVENT_TYPES[d.EVENT_MOVE]=a[1];d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){if(d.HAS_POINTEREVENTS)return d.PointerEvent.getTouchList();
if(a.touches)return a.touches;a.indentifier=1;return[a]},collectEventData:function(a,b,c,e){a=d.POINTER_TOUCH;if(e.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,e))a=d.POINTER_MOUSE;return{center:d.utils.getCenter(c),timeStamp:(new Date).getTime(),target:e.target,touches:c,eventType:b,pointerType:a,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation();this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},
stopDetect:function(){return d.detection.stopDetect()}}}};d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];Object.keys(a.pointers).sort().forEach(function(c){b.push(a.pointers[c])});return b},updatePointer:function(a,b){a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b);return Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c={};c[d.POINTER_MOUSE]=b.pointerType==b.MSPOINTER_TYPE_MOUSE||b.pointerType==
d.POINTER_MOUSE;c[d.POINTER_TOUCH]=b.pointerType==b.MSPOINTER_TYPE_TOUCH||b.pointerType==d.POINTER_TOUCH;c[d.POINTER_PEN]=b.pointerType==b.MSPOINTER_TYPE_PEN||b.pointerType==d.POINTER_PEN;return c[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}};d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},hasParent:function(a,b){for(;a;){if(a==b)return!0;
a=a.parentNode}return!1},getCenter:function(a){for(var b=[],c=[],d=0,e=a.length;d<e;d++)b.push(a[d].pageX),c.push(a[d].pageY);return{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){return 180*Math.atan2(b.pageY-a.pageY,b.pageX-a.pageX)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=
e?0<a.pageX-b.pageX?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:0<a.pageY-b.pageY?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return 2<=a.length&&2<=b.length?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return 2<=a.length&&2<=b.length?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,
b){var c,d="webkit khtml moz Moz ms o ".split(" ");if(b&&a.style){for(var e=0;e<d.length;e++)for(var f in b)b.hasOwnProperty(f)&&(c=f,d[e]&&(c=d[e]+c.substring(0,1).toUpperCase()+c.substring(1)),a.style[c]=b[f]);"none"==b.userSelect&&(a.onselectstart=function(){return!1})}}};d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&
!this.stopped){a=this.extendEventData(a);for(var b=this.current.inst.options,c=0,e=this.gestures.length;c<e;c++){var f=this.gestures[c];if(!this.stopped&&!1!==b[f.name]&&!1===f.handler.call(f,a,this.current.inst)){this.stopDetect();break}}this.current&&(this.current.lastEvent=a);a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect();return a}},stopDetect:function(){this.previous=d.utils.extend({},this.current);this.current=null;this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;
if(b&&(a.touches.length!=b.touches.length||a.touches===b.touches)){b.touches=[];for(var c=0,e=a.touches.length;c<e;c++)b.touches.push(d.utils.extend({},a.touches[c]))}var c=a.timeStamp-b.timeStamp,e=a.center.pageX-b.center.pageX,f=a.center.pageY-b.center.pageY,g=d.utils.getVelocity(c,e,f),p=d.utils.getCenter(b.touches),s=d.utils.getCenter(a.touches);d.utils.extend(a,{deltaTime:c,deltaX:e,deltaY:f,velocityX:g.x,velocityY:g.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,
a.center),direction:d.utils.getDirection(b.center,a.center),scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),move:d.utils.getDistance(p,s),startEvent:b});return a},register:function(a){var c=a.defaults||{};c[a.name]===b&&(c[a.name]=!0);d.utils.extend(d.defaults,c,!0);a.index=a.index||1E3;this.gestures.push(a);this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0});return this.gestures}};d.gestures=d.gestures||{};d.gestures.Hold=
{name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer);d.detection.current.name=this.name;this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}};d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,
tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END){var c=d.detection.previous,e=!1;a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance||(c&&("tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance)&&(b.trigger("doubletap",a),e=!0),e&&!b.options.tap_always)||(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}};
d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:0.7},handler:function(a,b){a.eventType!=d.EVENT_END||0<b.options.swipe_max_touches&&a.touches.length>b.options.swipe_max_touches||!(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)||(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}};d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,
drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)b.trigger(this.name+"end",a),this.triggered=!1;else if(!(0<b.options.drag_max_touches&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)break;if(d.detection.current.name!=this.name&&(d.detection.current.name=
this.name,b.options.correct_for_drag_min_distance)){var c=Math.abs(b.options.drag_min_distance/a.distance);d.detection.current.startEvent.center.pageX+=a.deltaX*c;d.detection.current.startEvent.center.pageY+=a.deltaY*c;a=d.detection.extendEventData(a)}if(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)a.drag_locked_to_axis=!0;c=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&c!==a.direction&&(d.utils.isVertical(c)?
a.direction=0>a.deltaY?d.DIRECTION_UP:d.DIRECTION_DOWN:a.direction=0>a.deltaX?d.DIRECTION_LEFT:d.DIRECTION_RIGHT);this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0);b.trigger(this.name,a);b.trigger(this.name+a.direction,a);(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}};d.gestures.Transform=
{name:"transform",index:45,defaults:{transform_min_move:30,transform_min_scale:0.01,transform_min_rotation:2,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)b.trigger(this.name+"end",a),this.triggered=!1;else if(!(2>a.touches.length))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation),f=Math.abs(a.move);
if(c<b.options.transform_min_scale&&f<b.options.transform_min_move&&e<b.options.transform_min_rotation)break;d.detection.current.name=this.name;this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0);e>b.options.transform_min_rotation&&b.trigger("rotate",a);c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(1>a.scale?"in":"out"),a));f>b.options.transform_min_move&&b.trigger(this.name,a);break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=
!1}}};d.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?a.stopDetect():(b.options.prevent_default&&a.preventDefault(),a.eventType==d.EVENT_START&&b.trigger(this.name,a))}};d.gestures.Release={name:"release",index:Infinity,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return d}):
"object"===typeof module&&"object"===typeof module.exports?module.exports=d:a.Hammer=d})(this);var JSG=JSG||{};JSG.version="1.0.1";JSG.builddate="2014-08-25";JSG.namespace=function(a,b){var c=JSG,d=a.split(b||"."),e;for(e="JSG"===d[0]?1:0;e<d.length;e+=1)"undefined"===typeof c[d[e]]&&(c[d[e]]={}),c=c[d[e]];return c};JSG.extend=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a._super=b.prototype;a.prototype.constructor=a};
JSG.createObjectFromString=function(a,b){var c=JSG.getFunctionFromString(a,b);return void 0!=c?new c:void 0};JSG.getFunctionFromString=function(a,b){if(void 0!=a){for(var c=a.split(b||"."),d=c.length-1,e=window,f=0;f<d&&void 0!=e;f++)e=e[c[f]];return void 0!=e?e[c[d]]:void 0}};JSG.arraycopy=function(a,b,c,d,e){for(var f=e,g=0;g<e&&d+g<c.length;g++)f--,c[d+g]=a[b+g];e=b+e;for(g=e-f;g<e&&g<a.length;g++)c.push(a[g])};
JSG.hasPropertyWithValue=function(a,b){var c=!1,d;for(d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&a[d]==b){c=!0;break}return c};Math.PI_2||(Math.PI_2=Math.PI/2);Math.PI_4||(Math.PI_4=Math.PI/4);Math.PI_8||(Math.PI_8=Math.PI/8);Array.prototype.move||(Array.prototype.move=function(a,b){var c,d;a=parseInt(a,10);b=parseInt(b,10);if(a!==b&&0<=a&&a<=this.length&&0<=b&&b<=this.length){d=this[a];if(a<b)for(c=a;c<b;c++)this[c]=this[c+1];else for(c=a;c>b;c--)this[c]=this[c-1];this[b]=d;return!0}return!1});
Array.prototype.addAll||(Array.prototype.addAll=function(a){this.push.apply(this,a)});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c=this.length,d=Number(b)||0,d=0>d?Math.ceil(d):Math.floor(d);for(0>d&&(d+=c);d<c;d++)if(d in this&&this[d]===a)return d;return-1});Array.prototype.remove||(Array.prototype.remove=function(a){a=this.indexOf(a);return-1<a?(this.splice(a,1),!0):!1});
Array.prototype.removeAt||(Array.prototype.removeAt=function(a){if(-1<a&&(a=this.splice(a,1),void 0!=a&&0<a.length))return a[0]});Array.prototype.removeAll||(Array.prototype.removeAll=function(){this.length=0});Array.prototype.contains||(Array.prototype.contains=function(a){return-1<this.indexOf(a)});Array.prototype.insert||(Array.prototype.insert=function(a,b){if(void 0==b||0>b||b>this.length)b=this.length;this.splice(b,0,a)});
Array.prototype.insertAt||(Array.prototype.insertAt=function(){if(1<arguments.length){var a=Array.prototype.shift.apply(arguments);if(0>a||a>this.length)a=this.length;var b=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),a=[a,0].concat(b);Array.prototype.splice.apply(this,a)}});Array.prototype.isEmpty||(Array.prototype.isEmpty=function(){return 0==this.length});Array.prototype.forEach||(Array.prototype.forEach=function(a){for(var b=0,c=this.length;b<c;b++)a(this[b])});
Array.prototype.every||(Array.prototype.every=function(a){for(var b=0,c=this.length;b<c&&a(this[b]);b++);});Array.prototype.filter||(Array.prototype.filter=function(a){var b=[];this.forEach(function(c){a(c)&&b.push(c)});return b});Array.prototype.last||(Array.prototype.last=function(){var a=this.length-1;return 0>a?void 0:this[a]});Array.prototype.keep||(Array.prototype.keep=function(a,b){for(var c=this.length;c<a;c++)this.push(b.call(this));this.length=0>a?0:a});
Array.isArray||(Array.isArray=function(a){return void 0!=a&&"[object Array]"===Object.prototype.toString.call(a)});Array.toArray||(Array.toArray=function(){if(1===arguments.length&&("[object Arguments]"===Object.prototype.toString.call(arguments[0])&&(arguments=arguments[0]),Array.isArray(arguments[0])))return arguments[0];var a=[];a.push.apply(a,arguments);return a});Number.isNumber||(Number.isNumber=function(a){return void 0!==a&&"[object Number]"===Object.prototype.toString.call(a)});
Number.canBeNumber||(Number.canBeNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)});Number.areBothEvenOrOdd||(Number.areBothEvenOrOdd=function(a,b){return void 0!==a&&void 0!==b?a.isEven()?b.isEven():!b.isEven():!1});Number.prototype.hasSameSignAs||(Number.prototype.hasSameSignAs=function(a){return 0>this==0>a});Number.prototype.isEqual||(Number.prototype.isEqual=function(a,b){return void 0==b?this==a:void 0!==a&&Math.abs(this-a)<b});
Number.prototype.isEven||(Number.prototype.isEven=function(){return 0===this%2});Number.prototype.format||(Number.prototype.format=function(a,b,c,d){var e=this;a=isNaN(a=Math.abs(a))?2:a;c=void 0==c?".":c;b=void 0==b?",":b;d=void 0==d?"$":d;var f=0>e?"-":"",g=parseInt(e=Math.abs(+e||0).toFixed(a))+"",l=3<(l=g.length)?l%3:0;return f+d+(l?g.substr(0,l)+b:"")+g.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+b)+(a?c+Math.abs(e-g).toFixed(a).slice(2):"")});
String.prototype.trim||(String.prototype.trim=function(){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});String.prototype.contains||(String.prototype.contains=function(a){return-1!=this.indexOf(a)});String.prototype.startsWith||(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a});String.prototype.endsWith||(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)});
String.prototype.insert||(String.prototype.insert=function(a,b){return 0<a?this.substring(0,a)+b+this.substring(a,this.length):b+this});String.prototype.remove||(String.prototype.remove=function(a,b){return this.substr(0,a)+this.substr(a+b)});String.isString||(String.isString=function(a){return"string"===typeof a||a instanceof String});String.isEmpty||(String.isEmpty=function(a){return void 0==a||""===a});
String.prototype.encode||(String.prototype.encode=function(){var a=this.replace(/%/g,"~25"),a=a.replace(/&/g,"~26"),a=a.replace(/"/g,"~22"),a=a.replace(/\\/g,"~5C"),a=a.replace(/</g,"~3C"),a=a.replace(/>/g,"~3E"),a=a.replace(/\n/g,"~0A"),a=a.replace(/'/g,"~27");return a=encodeURIComponent(a)});
String.prototype.decode||(String.prototype.decode=function(){var a=this.replace(/~26/gi,"\x26"),a=a.replace(/~22/gi,'"'),a=a.replace(/~5C/gi,"\\"),a=a.replace(/~3C/gi,"\x3c"),a=a.replace(/~3E/gi,"\x3e"),a=a.replace(/~0A/gi,"\n"),a=a.replace(/~27/gi,"'"),a=decodeURIComponent(a);return a.replace(/~25/gi,"%")});
String.prototype.encodeXML||(String.prototype.encodeXML=function(){return this.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26apos;")});String.prototype.decodeXML||(String.prototype.decodeXML=function(){return this.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,"\x3e").replace(/&lt;/g,"\x3c").replace(/&amp;/g,"\x26")});function StringBuffer(){this.buffer=[]}
StringBuffer.prototype.append=function(a){this.buffer.push(a);return this};StringBuffer.prototype.isEmpty=function(){return 0==this.buffer.length};StringBuffer.prototype.reset=function(){this.buffer.length=0;return this};StringBuffer.prototype.toString=function(){return this.buffer.join("")};StringBuffer.prototype._concat=function(a){for(var b=0,c=a.length,d="";b<c;d+=a[b],b++);return d};JSG.namespace("JSG.commons");JSG.commons.Map=function(){this._values={}};
JSG.commons.Map.prototype.clear=function(){this._values={}};JSG.commons.Map.prototype.copy=function(){copy=new JSG.commons.Map;copy.putAll(this);return copy};JSG.commons.Map.prototype.contains=function(a){return Object.prototype.hasOwnProperty.call(this._values,a)&&Object.prototype.propertyIsEnumerable.call(this._values,a)};JSG.commons.Map.prototype.isEmpty=function(){return 0==this.keys().length};JSG.commons.Map.prototype.get=function(a){return this._values[a]};
JSG.commons.Map.prototype.put=function(a,b){var c=this._values[a];this._values[a]=b;return c};JSG.commons.Map.prototype.putAll=function(a){var b=this;a.iterate(function(a,d){b.put(a,d)})};JSG.commons.Map.prototype.remove=function(a){var b=this._values[a];b&&delete this._values[a];return b};JSG.commons.Map.prototype.size=function(){return this.keys().length};JSG.commons.Map.prototype.keys=function(){var a=[];this._forAllPropertiesOf(this._values,function(b,c){a.push(b)});return a};
JSG.commons.Map.prototype.elements=function(){var a=[];this._forAllPropertiesOf(this._values,function(b,c){a.push(c)});return a};JSG.commons.Map.prototype.iterate=function(a){this._forAllPropertiesOf(this._values,a)};JSG.commons.Map.prototype._forAllPropertiesOf=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])};JSG.namespace("JSG.commons");JSG.commons.StableMap=function(){JSG.commons.StableMap._super.constructor.apply(this,arguments);this._orderedkeys=[]};
JSG.extend(JSG.commons.StableMap,JSG.commons.Map);JSG.commons.StableMap.prototype.clear=function(){JSG.commons.StableMap._super.clear.call(this);this._orderedkeys=[]};JSG.commons.StableMap.prototype.sort=function(a){void 0!=a&&this._orderedkeys.sort(a)};JSG.commons.StableMap.prototype.getFirst=function(){return 0<this._orderedkeys.length?this.get(this._orderedkeys[0]):void 0};
JSG.commons.StableMap.prototype.put=function(a,b){this.contains(a)||this._orderedkeys.push(a);JSG.commons.StableMap._super.put.call(this,a,b)};JSG.commons.StableMap.prototype.insertAt=function(a,b,c){this.contains(b)||this._orderedkeys.insertAt(a,b);JSG.commons.StableMap._super.put.call(this,b,c)};JSG.commons.StableMap.prototype.indexOf=function(a){return this._orderedkeys.indexOf(a)};
JSG.commons.StableMap.prototype.remove=function(a){var b=JSG.commons.StableMap._super.remove.call(this,a);void 0!=b&&this._orderedkeys.remove(a);return b};JSG.commons.StableMap.prototype.size=function(){return this._orderedkeys.length};JSG.commons.StableMap.prototype.keys=function(){var a=[];this._orderedkeys.forEach(function(b){a.push(b)});return a};JSG.commons.StableMap.prototype.elements=function(){var a=this,b=[];a._orderedkeys.forEach(function(c){c=a.get(c);void 0!=c&&b.push(c)});return b};
JSG.commons.StableMap.prototype.iterate=function(a){for(var b=0;b<this._orderedkeys.length;b++)this._callFunc(a,b)};JSG.commons.StableMap.prototype.iterateReverse=function(a){for(var b=this._orderedkeys.length-1;0<=b;b--)this._callFunc(a,b)};JSG.commons.StableMap.prototype._callFunc=function(a,b){var c=this._orderedkeys[b],d=this.get(c);void 0!=d&&a(c,d)};JSG.namespace("JSG.commons");
JSG.commons.ImagePool=function(){JSG.commons.ImagePool._super.constructor.apply(this,arguments);this._views=[];this._imagesToBeLoaded=0};JSG.extend(JSG.commons.ImagePool,JSG.commons.Map);JSG.commons.ImagePool.IMG_NOTAVAIL="notavailable";JSG.commons.ImagePool.IMG_EXPANDED="expanded";JSG.commons.ImagePool.IMG_COLLAPSED="collapsed";JSG.commons.ImagePool.prototype.add=function(a,b){var c=void 0!=b;b||(b=a);if(this.contains(b))return this.get(b);this.set(a,b,c)};
JSG.commons.ImagePool.prototype.set=function(a,b,c){var d=this,e=new Image;this._imagesToBeLoaded++;e._tryCD=!0;e.onerror=function(){try{e._tryCD&&(e.src=d.getCrossDomain(a))}catch(b){e.src=void 0}e._tryCD=!1;e.src||d._imagesToBeLoaded--};e.onload=function(){d._imagesToBeLoaded--;if(0==d._imagesToBeLoaded)for(var a=0;a<d._views.length;a++)d._views[a].invalidate()};e.src=a;this.put(b,e);return e};JSG.commons.ImagePool.prototype.validateURL=function(a){return a.match(/^\S+\.(gif|jpg|jpeg|png|JPG|JPEG|PNG|GIF)$/)};
JSG.commons.ImagePool.prototype.registerEditor=function(a){this._views.push(a)};JSG.commons.ImagePool.prototype.unregisterEditor=function(a){this._views.remove(a)};JSG.commons.ImagePool.prototype.getCrossDomain=function(a){var b=new XMLHttpRequest;b.open("post","php/crossDomainProxy.php",!1);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send("url\x3d"+encodeURIComponent(a));return b.response};JSG.namespace("JSG.commons");
JSG.commons.NamedImage=function(a,b){this.name=a;this.image=b};JSG.commons.NamedImage.prototype.copy=function(){return new JSG.commons.NamedImage(this.name,this.image)};JSG.commons.NamedImage.prototype.saveXML=function(a,b){b.writeStartElement(a);b.writeAttributeString("name",this.name);b.writeAttributeString("image",this.image);b.writeEndElement()};JSG.commons.NamedImage.prototype.readXML=function(a){this.name=a.getAttribute("name");this.image=a.getAttribute("image")};
function findElementByTagName(a,b){if(void 0!=a&&a.hasChildNodes())for(var c=0,d=a.childNodes.length;c<d;c++){var e=a.childNodes.item(c);if(e.nodeName==b)return e}}function findAllElementsByTagName(a,b){if(void 0!=a){var c=[];if(a.hasChildNodes())for(var d=0,e=a.childNodes.length;d<e;d++){var f=a.childNodes.item(d);f.nodeName==b&&c.push(f)}return c}}JSG.namespace("JSG.commons");
JSG.commons.XMLWriter=function(a,b){a="UTF-8";b="1.0";a&&(this._encoding=a);b&&(this._version=b);this._indentChar="\t";this._indentation=1;this._newLine="\n"};JSG.commons.XMLWriter.prototype.writeStartDocument=function(){this.close();this.tree=[]};JSG.commons.XMLWriter.prototype.writeEndDocument=function(){this.active=this.root;this.tree=[]};
JSG.commons.XMLWriter.prototype.writeStartElement=function(a){a={n:a,a:{},c:[]};this.active?(this.active.c.push(a),this.tree.push(this.active),this.parent=this.active):this.root=a;this.active=a};JSG.commons.XMLWriter.prototype.writeEndElement=function(a){var b=this.tree.pop()||this.root;(a=!0===a?!0:!1)&&b.c.remove(this.active);this.active=b;return!a};JSG.commons.XMLWriter.prototype.writeAttributeString=function(a,b){this.active&&(this.active.a[a]=String(b).encodeXML())};
JSG.commons.XMLWriter.prototype.writeAttributeNumber=function(a,b,c){b=Number(b);void 0!=c&&(c=Math.pow(10,c),b=Math.round(b*c)/c);this.active&&(this.active.a[a]=String(b))};JSG.commons.XMLWriter.prototype.writeString=function(a){this.active&&this.active.c.push(a)};JSG.commons.XMLWriter.prototype.writeElementString=function(a,b){this.writeStartElement(a);this.writeString(b);this.writeEndElement()};JSG.commons.XMLWriter.prototype.writeCDATA=function(a){this.writeString("\x3c![CDATA["+a+"]]\x3e")};
JSG.commons.XMLWriter.prototype.flush=function(){this.tree&&this.tree[0]&&this.writeEndDocument();for(var a="",b=this._indentation,c='\x3c?xml version\x3d"'+this._version+'" encoding\x3d"'+this._encoding+'"',c=[c+" ?\x3e"];b--;)a+=this._indentChar;this.root&&this.format(this.root,"",a,c);return c.join(this._newLine)};JSG.commons.XMLWriter.prototype.close=function(){this.root&&this.clean(this.root);this.active=this.root=this.tree=void 0};
JSG.commons.XMLWriter.prototype.getDocument=function(){return(new DOMParser).parseFromString(this.flush(),"text/xml")};JSG.commons.XMLWriter.prototype.clean=function(a){for(var b=a.c.length;b--;)"object"==typeof a.c[b]&&this.clean(a.c[b]);a.n=a.a=a.c=void 0};
JSG.commons.XMLWriter.prototype.format=function(a,b,c,d){var e=b+"\x3c"+a.n,f=a.c.length,g,l=0;for(g in a.a)e+=" "+g+'\x3d"'+a.a[g]+'"';d.push(e+(f?"\x3e":"/\x3e"));if(f){do if(e=a.c[l++],"string"==typeof e){if(1==f)return d.push(d.pop()+e+"\x3c/"+a.n+"\x3e");d.push(b+c+e)}else"object"==typeof e&&this.format(e,b+c,c,d);while(l<f);d.push(b+"\x3c/"+a.n+"\x3e")}};JSG.namespace("JSG.geometry");JSG.geometry.Point=function(a,b){this.x=a;this.y=b};
JSG.geometry.Point.Factory=function(){return new JSG.geometry.Point(0,0)};JSG.geometry.Point.prototype.set=function(a,b){this.x=a;this.y=b;return this};JSG.geometry.Point.prototype.setTo=function(a){this.x=a.x;this.y=a.y;return this};JSG.geometry.Point.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};JSG.geometry.Point.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};JSG.geometry.Point.prototype.rotate=function(a){JSG.geometry.Utils.rotatePoint(this,a);return this};
JSG.geometry.Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};JSG.geometry.Point.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y};JSG.geometry.Point.prototype.setLength=function(a){var b=this.length();return this.multiply(0==b?a:a/b)};JSG.geometry.Point.prototype.multiply=function(a){this.x*=a;this.y*=a;return this};JSG.geometry.Point.prototype.normalize=function(){var a=this.length();0!=a&&(this.x/=a,this.y/=a);return this};
JSG.geometry.Point.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y};JSG.geometry.Point.prototype.angle=function(){return Math.atan2(this.y,this.x)};JSG.geometry.Point.prototype.translate=function(a,b){this.x+=a;this.y+=b;return this};JSG.geometry.Point.prototype.swap=function(){var a=this.x;this.x=this.y;this.y=a;return this};JSG.geometry.Point.prototype.copy=function(){var a=new JSG.geometry.Point(0,0);a.setTo(this);return a};
JSG.geometry.Point.prototype.isEqualTo=function(a,b){return void 0!=a?void 0==b?this.x===a.x&&this.y===a.y:Math.abs(this.x-a.x)<b&&Math.abs(this.y-a.y)<b:!1};JSG.geometry.Point.prototype.isOrthogonalTo=function(a){a=this.dotProduct(a);return 0===a||0.01>Math.abs(a)};JSG.geometry.Point.prototype.isParallelTo=function(a){a=a.y*this.x-a.x*this.y;return 0===a||0.01>Math.abs(a)};JSG.geometry.Point.prototype.toString=function(){return"("+this.x.toFixed(2)+","+this.y.toFixed(2)+")"};
JSG.geometry.Point.prototype.saveXML=function(a,b){b.writeStartElement(a);b.writeAttributeNumber("x",this.x,2);b.writeAttributeNumber("y",this.y,2);b.writeEndElement()};JSG.geometry.Point.prototype.readXML=function(a){this.x=Number(a.getAttribute("x"));this.y=Number(a.getAttribute("y"))};JSG.geometry.PointCache=function(a,b){this.points=[];this.size=a;this.maxsize=b;for(var c=0;c<a;c++)this.points.push(new JSG.geometry.Point(0,0))};
JSG.geometry.PointCache.prototype.get=function(a,b,c){for(var d=0;d<this.size;d++){var e=this.points[d];if(!e.__used&&!e.__usedBulk)return c?e.__usedBulk=!0:e.__used=!0,void 0!==a&&void 0!==b&&e.set(a,b),e}e=new JSG.geometry.Point(0,0);this.size<this.maxsize&&(c?e.__usedBulk=!0:e.__used=!0,this.points.push(e),this.size=this.points.length);void 0!==a&&void 0!==b&&e.set(a,b);return e};
JSG.geometry.PointCache.prototype.releaseBulk=function(){for(var a=0;a<this.size;a++){var b=this.points[a];b.__usedBulk&&(b.__usedBulk=void 0)}};JSG.geometry.PointCache.prototype.release=function(){for(var a=arguments.length,b=0;b<a;b++){var c=arguments[b];c.__used&&(c.__used=void 0);c.__usedBulk&&(c.__usedBulk=void 0)}};JSG.geometry.PointCache.prototype.inUse=function(){for(var a=0,b=0;b<this.size;b++){var c=this.points[b];(c.__used||c.__usedBulk)&&a++}return a};
JSG.ptCache=new JSG.geometry.PointCache(20,50);JSG.namespace("JSG.geometry");JSG.geometry.Rectangle=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};JSG.geometry.Rectangle.Factory=function(){return new JSG.geometry.Rectangle(0,0,0,0)};JSG.geometry.Rectangle.prototype.reset=function(){this.set(0,0,0,0);return this};JSG.geometry.Rectangle.prototype.set=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d;return this};
JSG.geometry.Rectangle.prototype.setTo=function(a){return this.set(a.x,a.y,a.width,a.height)};JSG.geometry.Rectangle.prototype.setSize=function(a,b){this.width=a;this.height=b;return this};JSG.geometry.Rectangle.prototype.getLocation=function(a){a=void 0!=a?a:new JSG.geometry.Point(0,0);a.set(this.x,this.y);return a};JSG.geometry.Rectangle.prototype.setLocationTo=function(a){return this.setLocation(a.x,a.y)};JSG.geometry.Rectangle.prototype.setLocation=function(a,b){this.x=a;this.y=b;return this};
JSG.geometry.Rectangle.prototype.isEqualTo=function(a,b){return void 0!=a?void 0==b?this.x==a.x&&this.y==a.y&&this.width==a.width&&this.height==a.height:Math.abs(this.x-a.x)<b&&Math.abs(this.y-a.y)<b&&Math.abs(this.width-a.width)<b&&Math.abs(this.height-a.height)<b:!1};JSG.geometry.Rectangle.prototype.getRight=function(){return this.x+this.width};JSG.geometry.Rectangle.prototype.getBottom=function(){return this.y+this.height};
JSG.geometry.Rectangle.prototype.getCenter=function(a){a=a||new JSG.geometry.Point(0,0);a.set(this.x+this.width/2,this.y+this.height/2);return a};JSG.geometry.Rectangle.prototype.getCenterX=function(){return this.x+this.width/2};JSG.geometry.Rectangle.prototype.getCenterY=function(){return this.y+this.height/2};JSG.geometry.Rectangle.prototype.copy=function(){var a=new JSG.geometry.Rectangle(0,0,0,0);a.set(this.x,this.y,this.width,this.height);return a};
JSG.geometry.Rectangle.prototype.contains=function(a,b,c,d){var e=a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height;c&&(e=e&&a+c<=this.x+this.width);d&&(e=e&&b+d<=this.y+this.height);return e};JSG.geometry.Rectangle.prototype.containsPoint=function(a){return this.contains(a.x,a.y)};JSG.geometry.Rectangle.prototype.containsRect=function(a){return this.contains(a.x,a.y,a.width,a.height)};
JSG.geometry.Rectangle.prototype.intersect=function(a){return this.x<=a.getRight()&&a.x<=this.getRight()&&this.y<=a.getBottom()&&a.y<=this.getBottom()};JSG.geometry.Rectangle.prototype.containsBoundingBox=function(a){var b=this,c=!0;a.getPoints().every(function(a){return c=b.containsPoint(a)});return c};
JSG.geometry.Rectangle.prototype.union=function(a){var b=Math.max(this.getRight(),a.getRight()),c=Math.max(this.getBottom(),a.getBottom());this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=b-this.x;this.height=c-this.y;return this};
JSG.geometry.Rectangle.prototype.intersection=function(a,b){if(this.intersect(a)){var c=b||new JSG.geometry.Rectangle(0,0,0,0);c.x=Math.max(this.x,a.x);c.y=Math.max(this.y,a.y);c.width=Math.min(this.getRight(),a.getRight())-c.x;c.height=Math.min(this.getBottom(),a.getBottom())-c.y;return c}};JSG.geometry.Rectangle.prototype.unionX=function(a){var b=Math.max(this.x+this.width,a.x+a.width);this.x=Math.min(this.x,a.x);this.width=b-this.x;return this};
JSG.geometry.Rectangle.prototype.unionY=function(a){var b=Math.max(this.y+this.height,a.y+a.height);this.y=Math.min(this.y,a.y);this.height=b-this.y;return this};JSG.geometry.Rectangle.prototype.reduceBy=function(a){return this.expandBy(-a)};JSG.geometry.Rectangle.prototype.expandBy=function(a){this.x-=a;this.y-=a;this.width+=2*a;this.height+=2*a;return this};JSG.geometry.Rectangle.prototype.translate=function(a,b){this.x+=a;this.y+=b;return this};
JSG.geometry.Rectangle.prototype.swap=function(){var a=this.x;this.x=this.y;this.y=a;a=this.width;this.width=this.height;this.height=a;return this};JSG.geometry.Rectangle.prototype.sort=function(a){0>a.width?(this.x=a.x+a.width,this.width=Math.abs(a.width)):(this.x=a.x,this.width=a.width);0>a.height?(this.y=a.y+a.height,this.height=Math.abs(a.height)):(this.y=a.y,this.height=a.height);return this};
JSG.geometry.Rectangle.prototype.toString=function(){return"("+this.x+","+this.y+","+this.width+","+this.height+")"};JSG.geometry.Rectangle.prototype.toBoundingBox=function(){return JSG.geometry.BoundingBox.fromRectangle(this)};
JSG.geometry.Rectangle.prototype.getPoints=function(a){a=void 0!=a?a:[new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0)];a[0].set(this.x,this.y);a[1].set(this.x+this.width,this.y);a[2].set(this.x+this.width,this.y+this.height);a[3].set(this.x,this.y+this.height);return a};
JSG.geometry.Rectangle.prototype.readXML=function(a){this.x=Number(findElementByTagName(a,"x").textContent);this.y=Number(findElementByTagName(a,"y").textContent);this.width=Number(findElementByTagName(a,"width").textContent);this.height=Number(findElementByTagName(a,"height").textContent)};JSG.geometry.RectangleCache=function(a,b){this.rects=[];this.size=a;this.maxsize=b;for(var c=0;c<a;c++)this.rects.push(new JSG.geometry.Rectangle(0,0,0,0))};
JSG.geometry.RectangleCache.prototype.get=function(){for(var a=0;a<this.size;a++){var b=this.rects[a];if(!b.__used)return b.reset(),b.__used=!0,b}b=new JSG.geometry.Rectangle(0,0,0,0);this.size<this.maxsize&&(b.__used=!0,this.rects.push(b),this.size=this.rects.length);return b};JSG.geometry.RectangleCache.prototype.release=function(){for(var a=arguments.length,b=0;b<a;b++){var c=arguments[b];c.__used?c.__used=void 0:JSG.debug.log("try to release a non cached rectangle...",!0)}};
JSG.geometry.RectangleCache.prototype.inUse=function(){for(var a=0,b=0;b<this.size;b++)this.rects[b].__used&&a++;return a};JSG.rectCache=new JSG.geometry.RectangleCache(10,20);JSG.namespace("JSG.geometry");JSG.geometry.PointList=function(){this._points=[]};JSG.geometry.PointList.prototype.copy=function(){var a=new JSG.geometry.PointList;a.addPoints(this._points);return a};JSG.geometry.PointList.prototype.forEach=function(a){for(var b=0,c=this._points.length;b<c;b++)a(this._points[b],b)};
JSG.geometry.PointList.prototype.saveXML=function(a,b){b.writeStartElement(a);for(var c=0;c<this._points.length;c++)b.writeStartElement("point"),b.writeAttributeNumber("x",this._points[c].x,2),b.writeAttributeNumber("y",this._points[c].y,2),b.writeEndElement();b.writeEndElement()};JSG.geometry.PointList.prototype.clear=function(){this._points=[]};JSG.geometry.PointList.prototype.getPoints=function(){return this._points};JSG.geometry.PointList.prototype.length=function(){return this._points.length};
JSG.geometry.PointList.prototype.setPoints=function(a){this._points=a};JSG.geometry.PointList.prototype.setTo=function(a){if(void 0!==a){a=a._points;this.keepPoints(a.length);for(var b=0;b<a.length;b++)this._points[b].setTo(a[b])}};JSG.geometry.PointList.prototype.getPointAt=function(a){return 0<=a&&a<this._points.length?this._points[a]:void 0};JSG.geometry.PointList.prototype.isEmpty=function(){return this._points.isEmpty()};
JSG.geometry.PointList.prototype.setPointAtTo=function(a,b){this.setPointAt(a,b.x,b.y)};JSG.geometry.PointList.prototype.setPointAt=function(a,b,c){0<=a&&a<this._points.length&&this._points[a].set(b,c)};JSG.geometry.PointList.prototype.addPoint=function(a){this._points.push(a.copy())};JSG.geometry.PointList.prototype.addPointAt=function(a,b){0<=a&&(a<this._points.length?this._points.insert(b.copy(),a):this._points.push(b.copy()))};
JSG.geometry.PointList.prototype.addPoints=function(a){for(var b=0,c=a.length;b<c;b++)this._points.push(a[b].copy())};JSG.geometry.PointList.prototype.removePointAt=function(a){0<=a&&a<this._points.length&&this._points.removeAt(a)};JSG.geometry.PointList.prototype.keepPoints=function(a){for(var b=this._points.length;b<a;b++)this._points.push(new JSG.geometry.Point(0,0));this._points.length=a};
JSG.geometry.PointList.prototype.getCenter=function(a){var b=this.getBoundingRect(JSG.rectCache.get());a=b.getCenter(a);JSG.rectCache.release(b);return a};JSG.geometry.PointList.prototype.rotate=function(a,b){for(var c=0,d=this._points.length;c<d;c++)this._points[c]=JSG.geometry.Utils.getRotatedPoint(this._points[c],b,a)};JSG.geometry.PointList.prototype.scale=function(a,b){for(var c=0,d=this._points.length;c<d;c++)this._points[c].x*=a,this._points[c].y*=b};
JSG.geometry.PointList.prototype.translateTo=function(a){this.translate(a.x,a.y)};JSG.geometry.PointList.prototype.translate=function(a,b){for(var c=0,d=this._points.length;c<d;c++)this._points[c].x+=a,this._points[c].y+=b};JSG.geometry.PointList.prototype.movePointAt=function(a,b,c){0>a||a>=this._points.length||(this._points[a].x+=b,this._points[a].y+=c)};
JSG.geometry.PointList.prototype.getBoundingRect=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);if(this._points.isEmpty())a.set(0,0,0,0);else{for(var b=this._points[0].x,c=this._points[0].y,d=b,e=c,f=1,g=this._points.length;f<g;f++)b=Math.min(b,this._points[f].x),c=Math.min(c,this._points[f].y),d=Math.max(d,this._points[f].x),e=Math.max(e,this._points[f].y);a.set(b,c,Math.abs(d-b),Math.abs(e-c))}return a};
JSG.geometry.PointList.prototype.getBoundingBox=function(a){a=a||new JSG.geometry.BoundingBox(0,0);if(!this._points.isEmpty()){for(var b=this._points[0].x,c=this._points[0].y,d=b,e=c,f=1,g=this._points.length;f<g;f++)b=Math.min(b,this._points[f].x),c=Math.min(c,this._points[f].y),d=Math.max(d,this._points[f].x),e=Math.max(e,this._points[f].y);a.setTopLeft(b,c);a.setSize(Math.abs(d-b),Math.abs(e-c))}a.setAngle(0);return a};
JSG.geometry.PointList.prototype.contains=function(a){return JSG.geometry.Utils.isPointInPolygon(this._points,a)};JSG.geometry.PointList.prototype.distance=function(a,b){for(var c=void 0,d=JSG.geometry.Utils.getLinePointDistance,e=1,f=this._points.length;e<f;e++){var g=d(this._points[e-1],this._points[e],a);isNaN(g)||(c=void 0==c?g:Math.min(c,g))}b&&1<this._points.length&&(g=d(this._points[e-1],this._points[0],a),isNaN(g)||(c=Math.min(c,g)));return c};
JSG.geometry.PointList.prototype.getOffsetFromPoint=function(a,b,c,d){for(var e=JSG.geometry.Utils.getLineLength,f,g=0,l=this._points.length;g<l;g++){if(!d&&(f=e(a,this._points[g]),!isNaN(f)&&f<b))return new JSG.geometry.Point(a.x-this._points[g].x,a.y-this._points[g].y);if(d&&(g||c)){var h;g?h=new JSG.geometry.Point((this._points[g].x+this._points[g-1].x)/2,(this._points[g].y+this._points[g-1].y)/2):c&&(h=new JSG.geometry.Point((this._points[l-1].x+this._points[0].x)/2,(this._points[l-1].y+this._points[0].y)/
2));f=e(a,h);if(!isNaN(f)&&f<b)return new JSG.geometry.Point(a.x-h.x,a.y-h.y)}}};
JSG.geometry.PointList.prototype.getOffsetFromSegment=function(a,b,c,d){for(var e=void 0,f,g,l=JSG.geometry.Utils,h=1,m=this._points.length;h<m;h++){l.getLineLength(a,this._points[h]);var k=l.getLinePointDistance(this._points[h-1],this._points[h],a);isNaN(k)||(void 0==e?(e=k,f=h-1,g=h):e>k&&(e=k,f=h-1,g=h))}d&&this._points.length&&(k=l.getLinePointDistance(this._points[h-1],this._points[0],a),!isNaN(k)&&e>k&&(e=k,f=h-1,g=0));if(e<c&&void 0!=f&&void 0!=g)return l.getLinePointOffset(this._points[f],
this._points[g],b)};JSG.geometry.PointList.prototype.size=function(){return this._points.length};JSG.namespace("JSG.geometry");JSG.geometry.Matrix=function(){this._rotmatrix=[1,0,0,1];this._isRotated=!1};JSG.geometry.Matrix.fromString=function(a){var b=new JSG.geometry.Matrix;a=a.split(",");for(var c=0;4>c;c++)b._rotmatrix[c]=Number(a[c]);return b};JSG.geometry.Matrix.prototype.hasRotation=function(){return this._isRotated};
JSG.geometry.Matrix.prototype.isEqualTo=function(a,b){for(var c=0;4>c;c++)if(this._rotmatrix[c]!=a._rotmatrix[c])return!1;return!0};JSG.geometry.Matrix.prototype.copy=function(){var a=new JSG.geometry.Matrix;a.setTo(this);return a};JSG.geometry.Matrix.prototype.getAngle=function(){return this._isRotated?Math.atan2(this._rotmatrix[1],this._rotmatrix[0]):0};
JSG.geometry.Matrix.prototype.rotate=function(a){function b(a){c=a.x*f-a.y*e;d=a.x*e+a.y*f;a.set(c,d)}if(1!=this._rotmatrix[0]||0!=this._rotmatrix[1]||0!=this._rotmatrix[2]||1!=this._rotmatrix[3]||a){var c=0,d=0,e=Math.sin(a),f=Math.cos(a);a=JSG.ptCache.get(this._rotmatrix[0],this._rotmatrix[1]);b(a);this._rotmatrix[0]=a.x;this._rotmatrix[1]=a.y;var g=JSG.ptCache.get(this._rotmatrix[2],this._rotmatrix[3]);b(g);this._rotmatrix[2]=g.x;this._rotmatrix[3]=g.y;this._isRotated=!(1==this._rotmatrix[0]&&
0==this._rotmatrix[1]&&0==this._rotmatrix[2]&&1==this._rotmatrix[3]);JSG.ptCache.release(a,g)}};JSG.geometry.Matrix.prototype.rotatePoint=function(a){if(this._isRotated){var b=a.copy();a.x=this._rotmatrix[0]*b.x+this._rotmatrix[2]*b.y;a.y=this._rotmatrix[1]*b.x+this._rotmatrix[3]*b.y}return a};JSG.geometry.Matrix.prototype.rotatePointInverse=function(a){if(this._isRotated){var b=a.copy();a.x=this._rotmatrix[0]*b.x+this._rotmatrix[1]*b.y;a.y=this._rotmatrix[2]*b.x+this._rotmatrix[3]*b.y}return a};
JSG.geometry.Matrix.prototype.setAngle=function(a){this.setToIdentity();a&&this.rotate(a)};JSG.geometry.Matrix.prototype.setToIdentity=function(){this._rotmatrix[0]=1;this._rotmatrix[1]=0;this._rotmatrix[2]=0;this._rotmatrix[3]=1;this._isRotated=!1};JSG.geometry.Matrix.prototype.setTo=function(a){this._rotmatrix=a._rotmatrix.slice(0);this._isRotated=a._isRotated};JSG.geometry.Matrix.prototype.toString=function(){return this._rotmatrix.toString()};JSG.namespace("JSG.geometry");
JSG.geometry.BoundingBox=function(a,b){this._rotmatrix=new JSG.geometry.Matrix;this._topleft=new JSG.geometry.Point(0,0);this._bottomright=new JSG.geometry.Point(0,0);this.setSize(a,b)};JSG.geometry.BoundingBox.Factory=function(){return new JSG.geometry.BoundingBox(0,0)};
JSG.geometry.BoundingBox.fromRectangle=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);var b=new JSG.geometry.BoundingBox(a.width,a.height);b.translate(a.x,a.y);JSG.debug.log("bbox#fromRectangle: "+a.x+","+a.y+","+a.width+","+a.height);return b};JSG.geometry.BoundingBox.prototype._tmppoints=[new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0)];
JSG.geometry.BoundingBox.prototype.saveXML=function(a,b){b.writeStartElement(a);b.writeAttributeString("rotation",this._rotmatrix.toString());this._topleft.saveXML("tl",b);this._bottomright.saveXML("rb",b);b.writeEndElement()};
JSG.geometry.BoundingBox.prototype.readXML=function(a){if(void 0!=a.getAttribute("rotation")){var b=a.getAttribute("rotation");this._rotmatrix.setTo(JSG.geometry.Matrix.fromString(b))}b=findElementByTagName(a,"tl");void 0!=b&&this._topleft.readXML(b);b=findElementByTagName(a,"rb");void 0!=b&&this._bottomright.readXML(b)};JSG.geometry.BoundingBox.prototype.copy=function(){var a=new JSG.geometry.BoundingBox(0,0);a.setTo(this);return a};
JSG.geometry.BoundingBox.prototype.containsPoint=function(a){var b=this.getPoints(this._tmppoints);return JSG.geometry.Utils.isPointInPolygon(b,a)};JSG.geometry.BoundingBox.prototype.isEqualTo=function(a,b){return this._topleft.isEqualTo(a._topleft,b)&&this._bottomright.isEqualTo(a._bottomright,b)&&this._rotmatrix.isEqualTo(a._rotmatrix,b)?!0:!1};
JSG.geometry.BoundingBox.prototype.expandBy=function(a,b){void 0==b&&(b=a);var c=this.getWidth()+2*a,d=this.getHeight()+2*b,e=new JSG.geometry.Point(-a,-b);this.rotateLocalPoint(e);this._topleft.add(e);this.setSize(c,d)};JSG.geometry.BoundingBox.prototype.reduceBy=function(a){this.expandBy(-a)};JSG.geometry.BoundingBox.prototype.getCenter=function(a,b){var c=a||new JSG.geometry.Point(0,0);c.set(this.getWidth()/2,this.getHeight()/2);this.rotateLocalPoint(c);return!0===b?c.add(this._topleft):c};
JSG.geometry.BoundingBox.prototype.getTopLeft=function(a){a=a||new JSG.geometry.Point(0,0);a.setTo(this._topleft);return a};JSG.geometry.BoundingBox.prototype.getLeft=function(){return this._topleft.x};JSG.geometry.BoundingBox.prototype.getTop=function(){return this._topleft.y};JSG.geometry.BoundingBox.prototype.getBottomRight=function(a){a=a||new JSG.geometry.Point(0,0);a.setTo(this._bottomright);return this.rotatePoint(a)};
JSG.geometry.BoundingBox.prototype.getTopRight=function(a){a=a||new JSG.geometry.Point(0,0);a.set(this._bottomright.x,this._topleft.y);return this.rotatePoint(a)};JSG.geometry.BoundingBox.prototype.getBottomLeft=function(a){a=a||new JSG.geometry.Point(0,0);a.set(this._topleft.x,this._bottomright.y);return this.rotatePoint(a)};
JSG.geometry.BoundingBox.prototype.getCornerAt=function(a,b){var c=b||new JSG.geometry.Point(0,0);switch(a){case 0:c.setTo(this._topleft);break;case 1:c.set(this._bottomright.x,this._topleft.y);break;case 2:c.setTo(this._bottomright);break;case 3:c.set(this._topleft.x,this._bottomright.y)}return this.rotatePoint(c)};JSG.geometry.BoundingBox.prototype.getWidth=function(){return this._bottomright.x-this._topleft.x};JSG.geometry.BoundingBox.prototype.getHeight=function(){return this._bottomright.y-this._topleft.y};
JSG.geometry.BoundingBox.prototype.getSize=function(a){a=a||new JSG.geometry.Point(0,0);a.set(this.getWidth(),this.getHeight());return a};JSG.geometry.BoundingBox.prototype.reset=function(){this._topleft.set(0,0);this._bottomright.set(0,0);this._rotmatrix.setAngle(0)};JSG.geometry.BoundingBox.prototype.setTopLeftTo=function(a){this.setTopLeft(a.x,a.y)};
JSG.geometry.BoundingBox.prototype.setTopLeft=function(a,b){var c=this.getWidth(),d=this.getHeight();this._topleft.x=a;this._topleft.y=b;this._bottomright.x=a+c;this._bottomright.y=b+d};JSG.geometry.BoundingBox.prototype.setBottomRightTo=function(a){this.setBottomRight(a.x,a.y)};JSG.geometry.BoundingBox.prototype.setBottomRight=function(a,b){this._bottomright.x=a;this._bottomright.y=b;this.rotatePointInverse(this._bottomright)};
JSG.geometry.BoundingBox.prototype.setSizeTo=function(a){this.setSize(a.x,a.y)};JSG.geometry.BoundingBox.prototype.setSize=function(a,b){this.setWidth(a);this.setHeight(b)};JSG.geometry.BoundingBox.prototype.setWidth=function(a){this._bottomright.x=this._topleft.x+a};JSG.geometry.BoundingBox.prototype.setTop=function(a){var b=this.getHeight();this._topleft.y=a;this.setHeight(b)};JSG.geometry.BoundingBox.prototype.setLeft=function(a){var b=this.getWidth();this._topleft.x=a;this.setWidth(b)};
JSG.geometry.BoundingBox.prototype.setHeight=function(a){this._bottomright.y=this._topleft.y+a};JSG.geometry.BoundingBox.prototype.setTo=function(a){this._topleft.setTo(a._topleft);this._bottomright.setTo(a._bottomright);this._rotmatrix.setTo(a._rotmatrix);return this};JSG.geometry.BoundingBox.prototype.rotate=function(a){this._rotmatrix.rotate(a)};JSG.geometry.BoundingBox.prototype.rotateAroundPoint=function(a,b){this.setTopLeftTo(JSG.geometry.Utils.getRotatedPoint(this._topleft,a,b));this.rotate(b)};
JSG.geometry.BoundingBox.prototype.getAngle=function(){return this._rotmatrix.getAngle()};JSG.geometry.BoundingBox.prototype.setAngle=function(a){this._rotmatrix.setAngle(a)};JSG.geometry.BoundingBox.prototype.getRotationMatrix=function(){return this._rotmatrix};JSG.geometry.BoundingBox.prototype.setRotationMatrixTo=function(a){this._rotmatrix.setTo(a)};JSG.geometry.BoundingBox.prototype.translateTo=function(a){this.translate(a.x,a.y)};
JSG.geometry.BoundingBox.prototype.translate=function(a,b){this._topleft.translate(a,b);this._bottomright.translate(a,b)};JSG.geometry.BoundingBox.prototype.toRectangle=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);a.set(this._topleft.x,this._topleft.y,this.getWidth(),this.getHeight());return a};
JSG.geometry.BoundingBox.prototype.getBoundingRectangle=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);if(this._rotmatrix.hasRotation()){var b=0,c=0,d=this.getPoints(this._tmppoints);if(0==d.length)return a;a.x=b=d[0].x;a.y=c=d[0].y;for(var e=1,f=d.length;e<f;e++)a.x=Math.min(a.x,d[e].x),a.y=Math.min(a.y,d[e].y),b=Math.max(b,d[e].x),c=Math.max(c,d[e].y);a.width=b-a.x;a.height=c-a.y}else a.x=this._topleft.x,a.y=this._topleft.y,a.width=this.getWidth(),a.height=this.getHeight();return a};
JSG.geometry.BoundingBox.prototype.toString=function(){var a=this.getPoints(this._tmppoints);return"{("+a[0].x.toFixed(2)+","+a[0].y.toFixed(2)+"), ("+a[2].x.toFixed(2)+","+a[2].y.toFixed(2)+")}("+this.getWidth().toFixed(2)+","+this.getHeight().toFixed(2)+")"};JSG.geometry.BoundingBox.prototype.toPointsString=function(){var a=this.getPoints(this._tmppoints);return"("+a[0].toString()+","+a[1].toString()+","+a[2].toString()+","+a[3].toString()+")"};
JSG.geometry.BoundingBox.prototype.union=function(a){var b=this._topleft.x,c=this._topleft.y,d=this._bottomright.x,e=this._bottomright.y;a.rotateAroundPoint(this._topleft,-this.getAngle());a.getPoints(this._tmppoints).forEach(function(a){a.x<b?b=a.x:a.x>d&&(d=a.x);a.y<c?c=a.y:a.y>e&&(e=a.y)});a.rotateAroundPoint(this._topleft,this.getAngle());a=new JSG.geometry.Point(b,c);this.rotatePoint(a);this._topleft.setTo(a);this.setSize(d-b,e-c)};
JSG.geometry.BoundingBox.prototype.enclosePoints=function(a){function b(a){a.x<c?c=a.x:a.x>e&&(e=a.x);a.y<d?d=a.y:a.y>f&&(f=a.y)}for(var c=this._topleft.x,d=this._topleft.y,e=this._bottomright.x,f=this._bottomright.y,g=new JSG.geometry.Point(0,0),l=0;l<a.length;l++)g.setTo(a[l]),this.rotatePointInverse(g),b(g);(function(a,b,c,d,e){b=new JSG.geometry.Point(b,c);a.rotatePoint(b);a._topleft.setTo(b);a.setSize(d,e)})(this,c,d,e-c,f-d)};
JSG.geometry.BoundingBox.prototype.rotatePoint=function(a){if(!this._rotmatrix.hasRotation())return a;a.subtract(this._topleft);a=this._rotmatrix.rotatePoint(a);return a.add(this._topleft)};JSG.geometry.BoundingBox.prototype.rotatePointInverse=function(a){if(!this._rotmatrix.hasRotation())return a;a.subtract(this._topleft);a=this._rotmatrix.rotatePointInverse(a);return a.add(this._topleft)};JSG.geometry.BoundingBox.prototype.rotateLocalPoint=function(a){return this._rotmatrix.rotatePoint(a)};
JSG.geometry.BoundingBox.prototype.rotateLocalPointInverse=function(a){return this._rotmatrix.rotatePointInverse(a)};JSG.geometry.BoundingBox.prototype.getPoints=function(a){a=this.getPointsUnrotated(a);if(this._rotmatrix.hasRotation())for(var b=0;b<a.length;b++)this.rotatePoint(a[b]);return a};
JSG.geometry.BoundingBox.prototype.getPointsUnrotated=function(a){function b(a){a>=c.length&&c.push(new JSG.geometry.Point(0,0));return c[a]}var c=a?a:[];b(0).setTo(this._topleft);b(1).set(this._bottomright.x,this._topleft.y);b(2).setTo(this._bottomright);b(3).set(this._topleft.x,this._bottomright.y);return c};JSG.geometry.BoundingBox.prototype.transformPoint=function(a){a.subtract(this._topleft);this.rotateLocalPointInverse(a)};
JSG.geometry.BoundingBox.prototype.determineSiblingCornersToPoint=function(a,b,c){function d(a){a=JSG.geometry.Utils.toDegrees(JSG.geometry.Utils.getAngleBetweenPoints(g,a));return 0>a?360+a:a}function e(a){var c=d(h.getCornerAt(a,b));c<l&&c>k&&(k=c,m=a);-1==k&&c>maxangle&&(m=a,maxangle=c)}var f=this.getTopLeft(),g=this.getCenter().add(f),l=d(a),h=this,m=0,k=maxangle=-1;e(0);e(1);e(2);e(3);this.getCornerAt(m,b);this.getCornerAt((m+1)%4,c)};
JSG.geometry.BoundingBox.prototype.getIntersectionIndex=function(a,b,c){for(var d=JSG.ptCache.get(),e=JSG.ptCache.get(),f=JSG.ptCache.get(),g=-1,l=0;4>l;l++)if(this.getCornerAt(l,d),this.getCornerAt((l+1)%4,e),JSG.geometry.Utils.doLinesIntersect(a,b,d,e,f)&&JSG.geometry.Utils.isPointInDirectionOfLine(f,a,b)&&JSG.geometry.Utils.isPointOnLineSegment(f,d,e)){g=l;break}void 0!=c&&c.setTo(f);JSG.ptCache.release(d,e,f);return g};
JSG.geometry.BoundingBox.prototype.isIntersectedByLine=function(a,b){for(var c=!1,d=JSG.ptCache.get(),e=JSG.ptCache.get(),f=JSG.ptCache.get(),g=JSG.geometry.Utils,l=0;4>l;l++)if(this.getCornerAt(l,d),this.getCornerAt((l+1)%4,e),g.getIntersectionOfLines(a,b,d,e,f,!0)&&g.isPointOnLineSegment(f,d,e)){c=!0;break}JSG.ptCache.release(d,e,f);return c};
JSG.geometry.BoundingBox.prototype.doesIntersectWith=function(a){var b=!1;if(void 0!=a){var b=this.getCenter().add(this._topleft),c=a.getCenter().add(a._topleft),d=c.copy().subtract(b).length(),e=this._getIntersectionPoint(b,c,JSG.ptCache.get());a=a._getIntersectionPoint(c,b,JSG.ptCache.get());b=void 0!=e&&void 0!=a?e.subtract(b).length()+a.subtract(c).length()>d:!0}return b};
JSG.geometry.BoundingBox.prototype._getIntersectionPoint=function(a,b,c){var d=void 0,e=JSG.ptCache.get(),f=JSG.ptCache.get();c=c||new JSG.geometry.Point(0,0);for(var g=0;4>g;g++)if(this.getCornerAt(g,e),this.getCornerAt((g+1)%4,f),JSG.geometry.Utils.getIntersectionOfLines(a,b,e,f,c,!1)&&JSG.geometry.Utils.isPointInDirectionOfLine(c,a,b)){d=c;break}JSG.ptCache.release(e,f);return d};
JSG.geometry.BoundingBoxCache=function(a,b){this.boxes=[];this.size=a;this.maxsize=b;for(var c=0;c<a;c++)this.boxes.push(new JSG.geometry.BoundingBox(0,0))};JSG.geometry.BoundingBoxCache.prototype.get=function(){for(var a=0;a<this.size;a++){var b=this.boxes[a];if(!b.__used)return b.reset(),b.__used=!0,b}b=new JSG.geometry.BoundingBox(0,0);this.size<this.maxsize&&(b.__used=!0,this.boxes.push(b),this.size=this.boxes.length);return b};
JSG.geometry.BoundingBoxCache.prototype.release=function(){for(var a=arguments.length,b=0;b<a;b++){var c=arguments[b];c.__used&&(c.__used=void 0)}};JSG.geometry.BoundingBoxCache.prototype.inUse=function(){for(var a=0,b=0;b<this.size;b++)this.boxes[b].__used&&a++;return a};JSG.boxCache=new JSG.geometry.BoundingBoxCache(10,20);JSG.namespace("JSG.geometry");JSG.geometry.Utils=function(){};JSG.geometry.Utils.toRadians=function(a){return a/180*Math.PI};
JSG.geometry.Utils.toDegrees=function(a,b){var c=180*(a/Math.PI);return b?Math.round(c):c};JSG.geometry.Utils.round=function(a){return~~(a+(0<a?0.5:-0.5))};JSG.geometry.Utils.roundUp=function(a){return Math.ceil(a-0.5)};
JSG.geometry.Utils.getLinePointDistance=function(a,b,c){function d(a,b){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)}return Math.sqrt(function(a,b,c){var l=d(b,c);if(0==l)return d(a,b);l=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/l;return 0>l?d(a,b):1<l?d(a,c):d(a,{x:b.x+l*(c.x-b.x),y:b.y+l*(c.y-b.y)})}(c,a,b))};
JSG.geometry.Utils.getLinePointOffset=function(a,b,c,d){function e(a,b){var c=d||new JSG.geometry.Point(0,0);c.set(a.x-b.x,a.y-b.y);return c}return function(a,b,c){var d=(b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y);if(0==d)return e(a,b);d=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/d;return 0>d?e(a,b):1<d?e(a,c):e(a,{x:b.x+d*(c.x-b.x),y:b.y+d*(c.y-b.y)})}(c,a,b)};
JSG.geometry.Utils.getOrthogonalProjectionOfPoint=function(a,b,c){var d=a.copy().subtract(b);c=c.copy().subtract(b);d=d.x*c.x+d.y*c.y;0!==d&&(d/=c.x*c.x+c.y*c.y);var e=new JSG.geometry.Point(0,0);e.set(d*c.x,d*c.y).add(b);a.setTo(e);return a};JSG.geometry.Utils.areLinesOrthogonal=function(a,b,c,d){a=b.copy().subtract(a);c=d.copy().subtract(c);c=a.x*c.x+a.y*c.y;return 0===c||0.01>Math.abs(c)};
JSG.geometry.Utils.areLinesParallel=function(a,b,c,d){a=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);return 0===a||0.01>Math.abs(a)};JSG.geometry.Utils.areLinesOnTop=function(a,b,c,d){d=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x);a=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x);return 0===d||1E-4>Math.abs(d)&&0===a||1E-4>Math.abs(a)};JSG.geometry.Utils.arePointsParallel=function(a,b){var c=b.y*a.x-b.x*a.y;return 0===c||0.01>Math.abs(c)};
JSG.geometry.Utils.getOrthogonalPointTo=function(a,b,c){c=void 0!==c?c:new JSG.geometry.Point(0,0);a=c.setTo(b).subtract(a);b=-a.y;a.y=a.x;a.x=b;return c};JSG.geometry.Utils.getOrthogonalPointToPoint=function(a,b){var c=void 0!==b?b:new JSG.geometry.Point(0,0);c.x=-a.y;c.y=a.x;return c};JSG.geometry.Utils.getSquaredDistance=function(a,b){var c=b.copy().subtract(a);return c.x*c.x+c.y*c.y};JSG.geometry.Utils.getLineLength=function(a,b){return Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y))};
JSG.geometry.Utils.getAngleBetweenLines=function(a,b,c){var d=void 0!=c?c.x:0;c=void 0!=c?c.y:0;a=Math.atan2(c-a.y,d-a.x);return Math.atan2(c-b.y,d-b.x)-a};JSG.geometry.Utils.getAngleBetweenPoints=function(a,b){return angle=Math.atan2(b.y-a.y,b.x-a.x)};JSG.geometry.Utils.getRotatedPoint=function(a,b,c){c+=Math.atan2(a.y-b.y,a.x-b.x);a=this.getLineLength(a,b);return new JSG.geometry.Point(b.x+Math.cos(c)*a,b.y+Math.sin(c)*a)};
JSG.geometry.Utils.rotatePoint=function(a,b){if(0!=b){var c=Math.sin(b),d=Math.cos(b),e=a.x*c+a.y*d;a.x=a.x*d-a.y*c;a.y=e}return a};JSG.geometry.Utils.rotatePointAround=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);b.set(a.x+c*(b.x-a.x)-d*(b.y-a.y),a.y+d*(b.x-a.x)+c*(b.y-a.y));return b};
JSG.geometry.Utils.isPointInPolygon=function(a,b){for(var c,d=a[0],e=!1,f=1;f<=a.length;f++){c=a[f%a.length];if(this.isPointOnLineSegment(b,d,c)){e=!0;break}(d.y<b.y&&c.y>=b.y||c.y<b.y&&d.y>=b.y)&&d.x+(b.y-d.y)/(c.y-d.y)*(c.x-d.x)<b.x&&(e=!e);d=c}return e};
JSG.geometry.Utils.isPointOnLineSegment=function(a,b,c){function d(a,b,c){return(a.x-b)*(a.x-b)+(a.y-c)*(a.y-c)}return 0.1>function(a,b,c){var l=d(b,c.x,c.y);0==l?l=d(a,b.x,b.y):(l=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/l,l=0>l?d(a,b.x,b.y):1<l?d(a,c.x,c.y):d(a,b.x+l*(c.x-b.x),b.y+l*(c.y-b.y)));return l}(a,b,c)};
JSG.geometry.Utils.isPointInDirectionOfLine=function(a,b,c){var d=JSG.ptCache.get();d.setTo(c);d.subtract(b);c=JSG.ptCache.get();c.setTo(a);c.subtract(b);a=d.dotProduct(c);JSG.ptCache.release(d,c);return 0.1<a};
JSG.geometry.Utils.getIntersectionOfLines=function(a,b,c,d,e,f){var g=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0==g)return!1;d=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/g;c=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/g;return f||0<=d&&1>=d&&0<=c&&1>=c?(e.x=a.x+d*(b.x-a.x),e.y=a.y+d*(b.y-a.y),!0):!1};
JSG.geometry.Utils.doLinesIntersect=function(a,b,c,d,e){var f=a.x;a=a.y;var g=b.x;b=b.y;var l=c.x;c=c.y;var h=d.x;d=d.y;var m=(f-g)*(c-d)-(a-b)*(l-h);if(0==m)return!1;e.set(((f*b-a*g)*(l-h)-(f-g)*(l*d-c*h))/m,((f*b-a*g)*(c-d)-(a-b)*(l*d-c*h))/m);return!0};JSG.namespace("JSG.geometry");JSG.geometry.Constants=function(){};JSG.geometry.Constants.RAD_45=JSG.geometry.Utils.toRadians(45);JSG.geometry.Constants.RAD_135=JSG.geometry.Utils.toRadians(135);JSG.geometry.Constants.RAD_5=JSG.geometry.Utils.toRadians(5);
JSG.geometry.Constants.RAD_175=JSG.geometry.Utils.toRadians(175);JSG.namespace("JSG.anim");JSG.anim.Animation=function(a,b){this.type=a;this.context=b;this._timer};JSG.anim.Animation.prototype.isBusy=function(){};JSG.anim.Animation.prototype.start=function(a,b){var c=new Date,d=this;this._timer=setInterval(function(){var e=(new Date-c)/b;1<e&&(e=1,d.stop());e=d.type.progressFactor(e);a.call(d.context,e)},10)};JSG.anim.Animation.prototype.stop=function(){clearInterval(this._timer)};JSG.namespace("JSG.anim");
JSG.anim.AnimationType=function(){function a(a,b){this.str=a;this.factorFunc=b}var b=new JSG.commons.Map;b.put("linear",new a("linear",function(a){return a}));b.put("easeout",new a("easeout",function(a){a:{a=1-a;for(var b=0,e=1;;b+=e,e/=2)if(a>=(7-4*b)/11){a=-Math.pow((11-6*b-11*a)/4,2)+Math.pow(e,2);break a}a=void 0}return 1-a}));b.put("circ",new a("circ",function(a){return 1-Math.sin(Math.acos(a))}));a.prototype.toString=function(){return this.str};a.prototype.progressFactor=function(a){return this.factorFunc(a)};
return{LINEAR:b.get("linear"),EASE_OUT:b.get("easeout"),CIRC:b.get("circ")}}();JSG.namespace("JSG.ui.events");
JSG.ui.events.Event=function(a,b,c){this.type=c;this.event=b;this.doRepaint=this.isConsumed=!1;this.canvasRect=a.getBoundingClientRect();this.canvasId=a.id;this.canvasParent=a.parentElement;a=document.documentElement;b.clientX&&b.clientY?(this.location.set(b.clientX-this.canvasRect.left-a.scrollLeft,b.clientY-this.canvasRect.top-a.scrollTop),JSG.ui.events.currentClientX=b.clientX,JSG.ui.events.currentClientY=b.clientY):JSG.ui.events.currentClientX&&JSG.ui.events.currentClientY?this.location.set(JSG.ui.events.currentClientX-
this.canvasRect.left-a.scrollLeft,JSG.ui.events.currentClientY-this.canvasRect.top-a.scrollTop):this.location.set(0,0);this.windowLocation.set(b.pageX,b.pageY)};JSG.ui.events.Event.prototype.location=new JSG.geometry.Point(0,0);JSG.ui.events.Event.prototype.windowLocation=new JSG.geometry.Point(0,0);JSG.ui.events.Event.prototype.isInCanvas=function(){return JSG.debug.USE_DOC_DISPATCHER?"canvas"==this.event.target.tagName.toLowerCase()?this.event.target.id===this.canvasId:!1:"canvas"==this.event.target.tagName.toLowerCase()};
JSG.ui.events.Event.prototype.isInCanvasParent=function(){return this._isInCanvasParent(this.event.target)};JSG.ui.events.Event.prototype._isInCanvasParent=function(a){return a===this.canvasParent?!0:void 0==a||"html"==a.tagName.toLowerCase()?!1:this._isInCanvasParent(a.parentElement)};
JSG.ui.events.Event.prototype.consume=function(){this.isConsumed=!0;this.event.stopPropagation&&this.event.stopPropagation();this.event.stopImmediatePropagation&&this.event.stopImmediatePropagation();this.event.preventDefault();this.event.cancelBubble=!0};JSG.namespace("JSG.ui.events");JSG.ui.events.MouseEventType={DOWN:0,MOVE:1,UP:2,EXIT:4,DBLCLK:8,WHEEL:16};JSG.ui.events.ButtonType={LEFT:0,RIGHT:2};JSG.ui.events.KeyType={CTRL:1,ALT:2,SHIFT:4,META:8,ESC:27};
JSG.ui.events.MouseEvent=function(){JSG.ui.events.MouseEvent._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.events.MouseEvent,JSG.ui.events.Event);JSG.ui.events.MouseEvent.fromEvent=function(a,b,c){a=new JSG.ui.events.MouseEvent(a,b,c);a.key=JSG.ui.events.currentKey;return a};JSG.ui.events.MouseEvent.prototype.isClicked=function(a){return void 0!=this.event.button&&this.event.button==a};
JSG.ui.events.MouseEvent.prototype.isPressed=function(a){switch(a){case JSG.ui.events.KeyType.CTRL:return this.event.ctrlKey;case JSG.ui.events.KeyType.ALT:return this.event.altKey;case JSG.ui.events.KeyType.META:return this.event.metaKey;case JSG.ui.events.KeyType.SHIFT:return this.event.shiftKey;default:return a==JSG.ui.events.currentKey}};JSG.namespace("JSG.ui.events");
JSG.ui.events.GestureEventType={CANCEL:Math.pow(2,10),DRAGSTART:Math.pow(2,11),DRAG:Math.pow(2,12),DRAGEND:Math.pow(2,13),TRANSFORMSTART:Math.pow(2,14),TRANSFORM:Math.pow(2,15),TRANSFORMEND:Math.pow(2,16),TAPDOWN:Math.pow(2,17),TAPUP:Math.pow(2,18),DBLTAP:Math.pow(2,19),PINCHSTART:Math.pow(2,20),PINCH:Math.pow(2,21),PINCHEND:Math.pow(2,22),SWIPE:Math.pow(2,23),ROTATESTART:Math.pow(2,24),ROTATE:Math.pow(2,25),ROTATEEND:Math.pow(2,26),PANSTART:Math.pow(2,27),PAN:Math.pow(2,28),PANEND:Math.pow(2,29),
HOLD:Math.pow(2,30),TOUCH:Math.pow(2,31)};JSG.ui.events.GestureEvent=function(){JSG.ui.events.GestureEvent._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.events.GestureEvent,JSG.ui.events.Event);
JSG.ui.events.GestureEvent.fromEvent=function(a,b,c){var d=new JSG.ui.events.GestureEvent(a.canvas,b.srcEvent,c);JSG.debug._isActive&&JSG.ui.events.GestureEvent.eventType2string(c);switch(c){case JSG.ui.events.GestureEventType.DRAGSTART:case JSG.ui.events.GestureEventType.TAPDOWN:if(1<b.touches.length)return;d.type=JSG.ui.events.MouseEventType.DOWN;break;case JSG.ui.events.GestureEventType.DRAG:if(1<b.touches.length)return;d.type=JSG.ui.events.MouseEventType.MOVE;break;case JSG.ui.events.GestureEventType.DRAGEND:case JSG.ui.events.GestureEventType.TAPUP:if(1<
b.touches.length)return;d.type=JSG.ui.events.MouseEventType.UP;break;case JSG.ui.events.GestureEventType.DBLTAP:if(1<b.touches.length)return;d.type=JSG.ui.events.MouseEventType.DBLCLK;break;default:d.type=c}d.gesture=b;d.gestureType=c;d.key=JSG.ui.events.currentKey;d.cs=a.graphics.getCoordinateSystem();a=document.documentElement;d.gesture.touches.length?(d.location.set(d.gesture.touches[0].clientX-d.canvasRect.left-a.scrollLeft,d.gesture.touches[0].clientY-d.canvasRect.top-a.scrollTop),d.windowLocation.set(d.gesture.touches[0].pageX,
d.gesture.touches[0].pageY)):(d.location.set(d.event.changedTouches[0].clientX-d.canvasRect.left-a.scrollLeft,d.event.changedTouches[0].clientY-d.canvasRect.top-a.scrollTop),d.windowLocation.set(d.event.changedTouches[0].pageX,d.event.changedTouches[0].pageY));d.event.preventDefault();d.event.stopPropagation();d.gesture.preventDefault();d.gesture.stopPropagation();return d};
JSG.ui.events.GestureEvent.prototype.isPressed=function(a){switch(a){case JSG.ui.events.KeyType.CTRL:return this.event.ctrlKey;case JSG.ui.events.KeyType.ALT:return this.event.altKey;case JSG.ui.events.KeyType.META:return this.event.metaKey;case JSG.ui.events.KeyType.SHIFT:return this.event.shiftKey;default:return a==JSG.ui.events.currentKey}};
JSG.ui.events.GestureEvent.prototype.isInCanvas=function(){var a=this.gesture.touches[0].clientX,b=this.gesture.touches[0].clientY,c=this.canvasRect;return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};
JSG.ui.events.GestureEvent.eventType2string=function(a){var b=void 0;switch(a){case JSG.ui.events.GestureEventType.DRAGSTART:b="drag_start";break;case JSG.ui.events.GestureEventType.DRAG:b="drag";break;case JSG.ui.events.GestureEventType.DRAGEND:b="drag_end";break;case JSG.ui.events.GestureEventType.TAPDOWN:b="tapdown";break;case JSG.ui.events.GestureEventType.TAPUP:b="tapup";break;case JSG.ui.events.GestureEventType.DBLTAP:b="doubletap";break;case JSG.ui.events.GestureEventType.CANCEL:b="cancel";
break;case JSG.ui.events.GestureEventType.TRANSFORMSTART:b="transform_start";break;case JSG.ui.events.GestureEventType.TRANSFORM:b="transform";break;case JSG.ui.events.GestureEventType.TRANSFORMEND:b="transform_end";break;case JSG.ui.events.GestureEventType.PINCHSTART:b="pinch_start";break;case JSG.ui.events.GestureEventType.PINCH:b="pinch";break;case JSG.ui.events.GestureEventType.PINCHEND:b="pinch_end";break;case JSG.ui.events.GestureEventType.SWIPE:b="swipe";break;case JSG.ui.events.GestureEventType.ROTATESTART:b=
"rotate_start";break;case JSG.ui.events.GestureEventType.ROTATE:b="rotate";break;case JSG.ui.events.GestureEventType.ROTATEEND:b="rotate_end";break;case JSG.ui.events.GestureEventType.PANSTART:b="pan_start";break;case JSG.ui.events.GestureEventType.PAN:b="pan";break;case JSG.ui.events.GestureEventType.PANEND:b="pan_end";break;case JSG.ui.events.GestureEventType.HOLD:b="hold";break;default:b=a}return b};
JSG.ui.events.GestureEvent.prototype.isClicked=function(a){return void 0!=this.event.button&&this.event.button==a};JSG.namespace("JSG.ui.events");JSG.ui.events.DragEventType={DROP:0,ENTER:1,EXIT:2,LEAVE:4,OVER:8};JSG.ui.events.DragEvent=function(){JSG.ui.events.DragEvent._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.events.DragEvent,JSG.ui.events.Event);JSG.ui.events.DragEvent.fromEvent=function(a,b,c){a=new JSG.ui.events.DragEvent(a,b,c);a.event.preventDefault();return a};JSG.namespace("JSG.ui.events");
JSG.ui.events.KeyEventType={DOWN:0,UP:1};JSG.ui.events.KeyEvent=function(){JSG.ui.events.KeyEvent._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.events.KeyEvent,JSG.ui.events.Event);JSG.ui.events.currentKey=void 0;JSG.ui.events.KeyEvent.fromEvent=function(a,b,c){a=new JSG.ui.events.KeyEvent(a,b,c);a.key=b.keyCode;JSG.ui.events.currentKey=c==JSG.ui.events.KeyEventType.DOWN?b.keyCode:void 0;return a};
JSG.ui.events.KeyEvent.containsModifierKey=function(a){var b=!1;switch(a.key){case 16:case 17:case 18:b=!0}return b};JSG.ui.events.KeyEvent.prototype.isPressed=function(a){return(this.key&a)===a};JSG.namespace("JSG.ui");JSG.ui.Cursor=function(){};
JSG.ui.Cursor.Style={AUTO:"auto",CROSSHAIR:"crosshair",MOVE:"move",EXECUTE:"pointer",TEXT:"text",RESIZE_E:"e-resize",RESIZE_W:"w-resize",RESIZE_N:"n-resize",RESIZE_S:"s-resize",RESIZE_NE:"ne-resize",RESIZE_NW:"nw-resize",RESIZE_SE:"se-resize",RESIZE_SW:"sw-resize",CROSS:"crosshair",ROTATE:"move"};JSG.namespace("JSG.ui.graphics");
JSG.ui.graphics.DocumentEventDispatcher=function(){function a(a){var b=d.get(a);void 0==b&&(b=[],d.put(a,b));return b}function b(a,b){for(var c=void 0,d=0;d<b.length;d++)if(b[d].scope===a){c=b[d];break}return c}function c(b){return function(c){for(var d=a(b),l=0;l<d.length;l++){var h=d[l];h.func.call(h.scope,c)}}}var d=new JSG.commons.Map;return{addEventListener:function(d,f,g){if(void 0!=d&&void 0!=f&&void 0!=g){var l=a(d);void 0==b(f,l)&&l.push({scope:f,func:g});1==l.length&&(document[d]=c(d))}},
removeEventListener:function(c,d){if(void 0!=c&&void 0!=d){var g=a(c),l=b(d,g);g.remove(l);0==g.length&&(document[c]=void 0)}}}}();JSG.namespace("JSG.ui.graphics");JSG.ui.graphics.DisplayMode={ENDLESS:0,PAGE:1};JSG.ui.graphics.CoordinateSystem=function(){this._majorUnit=100;this._minorUnit=10;this._zoom=1;this._dpiX=JSG.dpi.x;this._dpiY=JSG.dpi.y};JSG.ui.graphics.CoordinateSystem.prototype.getZoom=function(){return this._zoom};
JSG.ui.graphics.CoordinateSystem.prototype.setZoom=function(a){this._zoom=a};JSG.ui.graphics.CoordinateSystem.prototype.logToDeviceX=function(a){return a*this._zoom};JSG.ui.graphics.CoordinateSystem.prototype.logToDeviceY=function(a){return a*this._zoom};JSG.ui.graphics.CoordinateSystem.prototype.deviceToLogX=function(a){return a/this._zoom};JSG.ui.graphics.CoordinateSystem.prototype.deviceToLogY=function(a){return a/this._zoom};JSG.ui.graphics.CoordinateSystem.prototype.deviceToLogXNoZoom=function(a){return a};
JSG.ui.graphics.CoordinateSystem.prototype.deviceToLogYNoZoom=function(a){return a};JSG.ui.graphics.CoordinateSystem.prototype.deviceToLogPoint=function(a,b){var c=void 0!=b?b:new JSG.geometry.Point(0,0);c.x=this.deviceToLogX(a.x);c.y=this.deviceToLogY(a.y);return c};JSG.ui.graphics.CoordinateSystem.prototype.metricToLogX=function(a){return a/2540*this._dpiX};JSG.ui.graphics.CoordinateSystem.prototype.metricToLogXNoZoom=function(a){return a/2540*this._dpiX/this._zoom};
JSG.ui.graphics.CoordinateSystem.prototype.metricToLogY=function(a){return a/2540*this._dpiY};JSG.ui.graphics.CoordinateSystem.prototype.metricToLogYNoZoom=function(a){return a/2540*this._dpiY/this._zoom};JSG.ui.graphics.CoordinateSystem.prototype.getMajorUnit=function(){return this._majorUnit};JSG.ui.graphics.CoordinateSystem.prototype.getMinorUnit=function(){return this._minorUnit};JSG.ui.graphics.CoordinateSystem.prototype.getMajorUnitString=function(a){return a};
JSG.ui.graphics.CoordinateSystem.prototype.getMinorUnitString=function(a){return a};JSG.ui.graphics.CoordinateSystem.prototype.toSVGUnit=function(a){return a};JSG.ui.graphics.CoordinateSystem.prototype.round=function(a){return a};JSG.ui.graphics.CoordinateSystem.prototype.roundToMiddle=function(a){return a};JSG.namespace("JSG.ui.graphics");
JSG.ui.graphics.MetricCoordinateSystem=function(){JSG.ui.graphics.MetricCoordinateSystem._super.constructor.apply(this,arguments);this._majorUnit=1E3;this._minorUnit=500};JSG.extend(JSG.ui.graphics.MetricCoordinateSystem,JSG.ui.graphics.CoordinateSystem);JSG.ui.graphics.MetricCoordinateSystem.prototype.logToDeviceX=function(a){return a/2540*this._dpiX*this._zoom};JSG.ui.graphics.MetricCoordinateSystem.prototype.logToDeviceY=function(a){return a/2540*this._dpiY*this._zoom};
JSG.ui.graphics.MetricCoordinateSystem.prototype.deviceToLogX=function(a){return 2540*a/this._dpiX/this._zoom};JSG.ui.graphics.MetricCoordinateSystem.prototype.deviceToLogY=function(a){return 2540*a/this._dpiY/this._zoom};JSG.ui.graphics.MetricCoordinateSystem.prototype.deviceToLogXNoZoom=function(a){return 2540*a/this._dpiX};JSG.ui.graphics.MetricCoordinateSystem.prototype.deviceToLogYNoZoom=function(a){return 2540*a/this._dpiY};JSG.ui.graphics.MetricCoordinateSystem.prototype.metricToLogX=function(a){return a};
JSG.ui.graphics.MetricCoordinateSystem.prototype.metricToDeviceX=function(a){return a/2540*this._dpiX};JSG.ui.graphics.MetricCoordinateSystem.prototype.metricToDeviceY=function(a){return a/2540*this._dpiY};JSG.ui.graphics.MetricCoordinateSystem.prototype.metricToLogY=function(a){return a};JSG.ui.graphics.MetricCoordinateSystem.prototype.metricToLogXNoZoom=function(a){return a/this._zoom};JSG.ui.graphics.MetricCoordinateSystem.prototype.metricToLogYNoZoom=function(a){return a/this._zoom};
JSG.ui.graphics.MetricCoordinateSystem.prototype.getMajorUnitString=function(a){return a/this._majorUnit};JSG.ui.graphics.MetricCoordinateSystem.prototype.getMinorUnitString=function(a){return a/this._minorUnit};JSG.ui.graphics.MetricCoordinateSystem.prototype.toSVGUnit=function(a){return Math.round(100*this.logToDeviceX(a))/100};JSG.namespace("JSG.ui.graphics");
JSG.ui.graphics.Graphics=function(a,b){this._context2D=a.getContext("2d");this._cs=b;this._lineWidth=JSG.graph.model.attributes.LineStyle.HAIRLINE;this._lineStyle=JSG.graph.model.attributes.LineStyle.SOLID;this._lineArrowEnd=this._lineArrowStart=JSG.graph.model.attributes.ArrowStyle.NONE;this._lineCorner=0;this._patternMap=new JSG.commons.Map;this._pattern=this._patternStyle=void 0;this._fillStyle=JSG.graph.model.attributes.FillStyle.SOLID;this._fillColor="#FFFFFF";this._fontName="Verdana";this._fontSize=
10;this._fontStyle=JSG.graph.attr.TextFormatAttributes.FontStyle.NORMAL;this._horizontalAlignment=JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER;this.translateStack=[];this.m=[1,0,0,1,0,0];this.antialias=!1};JSG.ui.graphics.Graphics.RECT_POINTS=[new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0)];JSG.ui.graphics.Graphics.prototype.isContextDefined=function(){return void 0==this._context2D?!1:!0};
JSG.ui.graphics.Graphics.prototype.getCoordinateSystem=function(){return this._cs};JSG.ui.graphics.Graphics.prototype.setCoordinateSystem=function(a){this._cs=a};JSG.ui.graphics.Graphics.prototype.save=function(){this._context2D.save();this.translateStack.push(this.m.slice())};JSG.ui.graphics.Graphics.prototype.restore=function(){this._context2D.restore();this.m=this.translateStack[this.translateStack.length-1];this.translateStack.pop()};JSG.ui.graphics.Graphics.prototype.getContext=function(){return this._context2D};
JSG.ui.graphics.Graphics.prototype.setTransparency=function(a){this._context2D.globalAlpha=a/100};JSG.ui.graphics.Graphics.prototype.translate=function(a,b){this.translateM(a,b)};JSG.ui.graphics.Graphics.prototype.scale=function(a,b){this.scaleM(a,b)};JSG.ui.graphics.Graphics.prototype.rotate=function(a){this.rotateM(a)};JSG.ui.graphics.Graphics.prototype.clip=function(){this._context2D.clip()};
JSG.ui.graphics.Graphics.prototype.setClip=function(a){var b=this._cs.deviceToLogX(1);a=a.copy();a.x-=b;a.y-=b;a.height+=b;a.width+=b;b=a.getPoints(JSG.ui.graphics.Graphics.RECT_POINTS);this.setClipArea(void 0,b,void 0)};JSG.ui.graphics.Graphics.prototype.setImageClip=function(a){this.beginPath();var b=this.transformPoint(a.x,a.y,JSG.ptCache.get());b.x-=0.5;b.y-=0.5;this._context2D.rect(b.x,b.y,JSG.geometry.Utils.round(a.width),JSG.geometry.Utils.round(a.height));this.closePath();this.clip();JSG.ptCache.release(b)};
JSG.ui.graphics.Graphics.prototype.setClipArea=function(a,b,c){if(0!=b.length){this.beginPath();this.moveTo(b[0].x,b[0].y);if(void 0!=c&&void 0!=a){for(var d=1,e=b.length;d<e;d++)this.bezierCurveTo(a[d-1].x,a[d-1].y,c[d].x,c[d].y,b[d].x,b[d].y);this.bezierCurveTo(a[b.length-1].x,a[b.length-1].y,c[0].x,c[0].y,b[0].x,b[0].y)}else for(d=1,e=b.length;d<e;d++)this.lineTo(b[d].x,b[d].y);this.closePath();this.clip()}};
JSG.ui.graphics.Graphics.prototype.setFillColor=function(a){this._context2D.fillStyle!=a&&(this._fillColor=this._context2D.fillStyle=a)};JSG.ui.graphics.Graphics.prototype.getFillColor=function(){return this._fillColor};JSG.ui.graphics.Graphics.prototype.setLineColor=function(a){this._context2D.strokeStyle!=a&&(this._context2D.strokeStyle=a)};JSG.ui.graphics.Graphics.prototype.setLineStyle=function(a){this._lineStyle=a};JSG.ui.graphics.Graphics.prototype.setFillStyle=function(a){this._fillStyle=a};
JSG.ui.graphics.Graphics.prototype.setTextAlign=function(a){this._horizontalAlignment=a};JSG.ui.graphics.Graphics.prototype.setTextBaseline=function(a){this._context2D.textBaseline=a};JSG.ui.graphics.Graphics.prototype.setFontName=function(a){this._fontName=a};JSG.ui.graphics.Graphics.prototype.setFontSize=function(a){this._fontSize=a};JSG.ui.graphics.Graphics.prototype.setFontStyle=function(a){this._fontStyle=a};
JSG.ui.graphics.Graphics.prototype.setFont=function(){var a="";this._fontStyle&JSG.graph.attr.TextFormatAttributes.FontStyle.BOLD&&(a+="bold ");this._fontStyle&JSG.graph.attr.TextFormatAttributes.FontStyle.ITALIC&&(a+="italic ");var b=this._fontSize*this._cs.getZoom(),a=a+(b+"pt "+this._fontName);a!=this._context2D.font&&(this._context2D.font=a);switch(this._horizontalAlignment){case JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT:this._context2D.textAlign="left";break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER:this._context2D.textAlign=
"center";break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.RIGHT:this._context2D.textAlign="right"}};
JSG.ui.graphics.Graphics.prototype.drawEllipse=function(a){if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.NONE&&0!=a.width&&0!=a.height){var b=0.5522848*(a.width/2),c=0.5522848*(a.height/2),d=a.x+a.width,e=a.y+a.height,f=a.x+a.width/2,g=a.y+a.height/2;this.beginPath();this.moveTo(a.x,g);this.bezierCurveTo(a.x,g-c,f-b,a.y,f,a.y);this.bezierCurveTo(f+b,a.y,d,g-c,d,g);this.bezierCurveTo(d,g+c,f+b,e,f,e);this.bezierCurveTo(f-b,e,a.x,g+c,a.x,g);this.closePath();this.stroke()}};
JSG.ui.graphics.Graphics.prototype.drawLine=function(a,b){if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.NONE){this.beginPath();if(this._lineStyle==JSG.graph.model.attributes.LineStyle.SOLID||this._context2D.setLineDash){if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.SOLID&&this._context2D.setLineDash){var c=Math.max(this._context2D.lineWidth,1),c=this.getDashPattern(c,5*c,3*c,2*c);this._context2D.setLineDash(c)}this.moveTo(a.x,a.y);this.lineTo(b.x,b.y)}else{var d=c=Math.max(this._lineWidth,
this._cs.deviceToLogX(1)),e=5*c,f=3*c,c=[2,2];switch(this._lineStyle){case JSG.graph.model.attributes.LineStyle.DASH:c=[e,f];break;case JSG.graph.model.attributes.LineStyle.DASHDOT:c=[e,f,d,f];break;case JSG.graph.model.attributes.LineStyle.DASHDOTDOT:c=[d,f,e,f,d,f];break;case JSG.graph.model.attributes.LineStyle.DOT:c=[d,f]}var e=function(a,b){return a<=b},f=function(a,b){return a>=b},g=function(a,b){return Math.min(a,b)},l=function(a,b){return Math.max(a,b)},d={thereYet:f,cap:g},f={thereYet:f,
cap:g},h=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},g=a.copy(),m=b.copy();if(isNaN(m.x)||isNaN(m.y)||isNaN(g.x)||isNaN(g.y)){JSG.debug.log("invalid parameters in Graphics#drawLine !!!");return}g.x=h(a.x,5);g.y=h(a.y,5);m.x=h(b.x,5);m.y=h(b.y,5);0<g.y-m.y&&(f.thereYet=e,f.cap=l);0<g.x-m.x&&(d.thereYet=e,d.cap=l);this.moveTo(g.x,g.y);for(var l=g.x,h=g.y,k=0,e=!0;!d.thereYet(l,m.x)||!f.thereYet(h,m.y);){d.thereYet(l,m.x);f.thereYet(h,m.y);var n=Math.atan2(m.y-g.y,m.x-g.x),q=c[k],l=
d.cap(m.x,l+Math.cos(n)*q),h=f.cap(m.y,h+Math.sin(n)*q);e?this.lineTo(l,h):this.moveTo(l,h);k=(k+1)%c.length;e=!e}}this.stroke();this._context2D.setLineDash&&this._context2D.setLineDash([])}};
JSG.ui.graphics.Graphics.prototype.drawArrow=function(a,b,c){if(c!=JSG.graph.model.attributes.ArrowStyle.NONE){var d=this.getArrowWidthByType(c),e=1.57;switch(c){case JSG.graph.model.attributes.ArrowStyle.DIAMONDLONG:e=0.785;break;case JSG.graph.model.attributes.ArrowStyle.ARROWFILLEDLONG:e=3.14/6;break;case JSG.graph.model.attributes.ArrowStyle.ARROWFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWHALFFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWHALFFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROW:case JSG.graph.model.attributes.ArrowStyle.ARROWSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWSINGLESIDE:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSEFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSEFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSE:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSESMALL:case JSG.graph.model.attributes.ArrowStyle.CIRCLE:case JSG.graph.model.attributes.ArrowStyle.CIRCLESMALL:case JSG.graph.model.attributes.ArrowStyle.CIRCLESMALLAROUND:case JSG.graph.model.attributes.ArrowStyle.CIRCLEDOUBLELINE:case JSG.graph.model.attributes.ArrowStyle.DOUBLELINE:case JSG.graph.model.attributes.ArrowStyle.SQUARE:case JSG.graph.model.attributes.ArrowStyle.SQUARESMALL:case JSG.graph.model.attributes.ArrowStyle.DIAGONALLINE:e=3.14/
3;break;case JSG.graph.model.attributes.ArrowStyle.DIAMOND:case JSG.graph.model.attributes.ArrowStyle.DIAMONDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWNNARROWFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWNARROWFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLEFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLEFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLE:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLESMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSENARROW:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSENARROWSMALL:case JSG.graph.model.attributes.ArrowStyle.LINEARROWREVERSE:case JSG.graph.model.attributes.ArrowStyle.CIRCLEARROWREVERSE:e=
1.57;break;case JSG.graph.model.attributes.ArrowStyle.DIAMONDNARROW:case JSG.graph.model.attributes.ArrowStyle.DIAMONDNARROWSMALL:e=3.14/1.5}a=Math.atan2(b.y-a.y,b.x-a.x);var f=e/2,e=d/2/Math.sin(e/2),g=!0;this.beginPath();switch(c){case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLE:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLESMALL:this.moveTo(b.x-e*Math.cos(a-f)-e*Math.cos(a),b.y-e*Math.sin(a-f)-e*Math.sin(a)),this.lineTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a)),this.lineTo(b.x-e*Math.cos(a+
f)-e*Math.cos(a),b.y-e*Math.sin(a+f)-e*Math.sin(a));case JSG.graph.model.attributes.ArrowStyle.ARROW:case JSG.graph.model.attributes.ArrowStyle.ARROWSMALL:this.moveTo(b.x-e*Math.cos(a-f),b.y-e*Math.sin(a-f));this.lineTo(b.x,b.y);this.lineTo(b.x-e*Math.cos(a+f),b.y-e*Math.sin(a+f));g=!1;break;case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLEFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLEFILLEDSMALL:this.moveTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a)),this.lineTo(b.x-e*Math.cos(a-f)-
e*Math.cos(a),b.y-e*Math.sin(a-f)-e*Math.sin(a)),this.lineTo(b.x-e*Math.cos(a+f)-e*Math.cos(a),b.y-e*Math.sin(a+f)-e*Math.sin(a)),this.lineTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a));case JSG.graph.model.attributes.ArrowStyle.ARROWFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWFILLEDLONG:case JSG.graph.model.attributes.ArrowStyle.ARROWNNARROWFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWNARROWFILLEDSMALL:this.moveTo(b.x,b.y);
this.lineTo(b.x-e*Math.cos(a-f),b.y-e*Math.sin(a-f));this.lineTo(b.x-e*Math.cos(a+f),b.y-e*Math.sin(a+f));this.closePath();break;case JSG.graph.model.attributes.ArrowStyle.ARROWHALFFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWHALFFILLEDSMALL:this.moveTo(b.x,b.y);this.lineTo(b.x-e*Math.cos(a-f),b.y-e*Math.sin(a-f));this.lineTo(b.x-e/3*Math.cos(a),b.y-e/3*Math.sin(a));this.lineTo(b.x-e*Math.cos(a+f),b.y-e*Math.sin(a+f));this.closePath();break;case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSE:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSESMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSENARROW:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSENARROWSMALL:g=
!1;this.moveTo(b.x-d/2*Math.sin(a),b.y+d/2*Math.cos(a));this.lineTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a));this.lineTo(b.x+d/2*Math.sin(a),b.y-d/2*Math.cos(a));break;case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSEFILLED:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSEFILLEDSMALL:this.moveTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a));this.lineTo(b.x-d/2*Math.sin(a),b.y+d/2*Math.cos(a));this.lineTo(b.x+d/2*Math.sin(a),b.y-d/2*Math.cos(a));this.closePath();break;case JSG.graph.model.attributes.ArrowStyle.ARROWSINGLESIDE:this.moveTo(b.x,
b.y);this.lineTo(b.x-e*Math.cos(a-f),b.y-e*Math.sin(a-f));this.lineTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a));this.closePath();break;case JSG.graph.model.attributes.ArrowStyle.LINEARROWREVERSE:g=!1;this.moveTo(b.x-d/2*Math.sin(a),b.y+d/2*Math.cos(a));this.lineTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a));this.lineTo(b.x+d/2*Math.sin(a),b.y-d/2*Math.cos(a));this.moveTo(b.x-1.2*e*Math.cos(a-f),b.y-1.2*e*Math.sin(a-f));this.lineTo(b.x-1.2*e*Math.cos(a+f),b.y-1.2*e*Math.sin(a+f));break;case JSG.graph.model.attributes.ArrowStyle.CIRCLEARROWREVERSE:this.moveTo(b.x-
d/2*Math.sin(a),b.y+d/2*Math.cos(a));this.lineTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a));this.lineTo(b.x+d/2*Math.sin(a),b.y-d/2*Math.cos(a));this.stroke();this.beginPath();this.circle(b.x-1.5*d*Math.cos(a),b.y-1.5*d*Math.sin(a),d/2);break;case JSG.graph.model.attributes.ArrowStyle.CIRCLE:case JSG.graph.model.attributes.ArrowStyle.CIRCLESMALL:this.circle(b.x-d/2*Math.cos(a),b.y-d/2*Math.sin(a),d/2);break;case JSG.graph.model.attributes.ArrowStyle.CIRCLESMALLAROUND:this.circle(b.x,b.y,d/2);break;case JSG.graph.model.attributes.ArrowStyle.DIAMOND:case JSG.graph.model.attributes.ArrowStyle.DIAMONDSMALL:this.moveTo(b.x,
b.y);this.lineTo(b.x-e*Math.cos(a-f),b.y-e*Math.sin(a-f));this.lineTo(b.x-1.5*e*Math.cos(a),b.y-1.5*e*Math.sin(a));this.lineTo(b.x-e*Math.cos(a+f),b.y-e*Math.sin(a+f));this.closePath();break;case JSG.graph.model.attributes.ArrowStyle.DIAMONDLONG:this.moveTo(b.x,b.y);this.lineTo(b.x-e*Math.cos(a-f),b.y-e*Math.sin(a-f));this.lineTo(b.x-2*e*Math.cos(a),b.y-2*e*Math.sin(a));this.lineTo(b.x-e*Math.cos(a+f),b.y-e*Math.sin(a+f));this.closePath();break;case JSG.graph.model.attributes.ArrowStyle.DIAMONDNARROW:case JSG.graph.model.attributes.ArrowStyle.DIAMONDNARROWSMALL:this.moveTo(b.x,
b.y);this.lineTo(b.x-e*Math.cos(a-f),b.y-e*Math.sin(a-f));this.lineTo(b.x-e*Math.cos(a),b.y-e*Math.sin(a));this.lineTo(b.x-e*Math.cos(a+f),b.y-e*Math.sin(a+f));this.closePath();break;case JSG.graph.model.attributes.ArrowStyle.CIRCLEDOUBLELINE:this.circle(b.x-1.6*d*Math.cos(a),b.y-1.6*d*Math.sin(a),d/2),this.fill(),g=!1;case JSG.graph.model.attributes.ArrowStyle.DOUBLELINE:this.moveTo(b.x-d/2*Math.cos(a)+d/2*Math.sin(a),b.y-d/2*Math.sin(a)-d/2*Math.cos(a));this.lineTo(b.x-d/2*Math.cos(a)-d/2*Math.sin(a),
b.y-d/2*Math.sin(a)+d/2*Math.cos(a));this.moveTo(b.x-d*Math.cos(a)+d/2*Math.sin(a),b.y-d*Math.sin(a)-d/2*Math.cos(a));this.lineTo(b.x-d*Math.cos(a)-d/2*Math.sin(a),b.y-d*Math.sin(a)+d/2*Math.cos(a));break;case JSG.graph.model.attributes.ArrowStyle.DIAGONALLINE:this.moveTo(b.x-2*d*Math.cos(a)+d/2*Math.sin(a),b.y-2*d*Math.sin(a)-d/2*Math.cos(a));this.lineTo(b.x-d*Math.cos(a)-d/2*Math.sin(a),b.y-d*Math.sin(a)+d/2*Math.cos(a));break;case JSG.graph.model.attributes.ArrowStyle.SQUARE:case JSG.graph.model.attributes.ArrowStyle.SQUARESMALL:this.moveTo(b.x-
d*Math.cos(a)+d/2*Math.sin(a),b.y-d*Math.sin(a)-d/2*Math.cos(a)),this.lineTo(b.x-d*Math.cos(a)-d/2*Math.sin(a),b.y-d*Math.sin(a)+d/2*Math.cos(a)),this.lineTo(b.x-d/2*Math.sin(a),b.y+d/2*Math.cos(a)),this.lineTo(b.x+d/2*Math.sin(a),b.y-d/2*Math.cos(a)),this.closePath()}g&&this._fillStyle!=JSG.graph.model.attributes.FillStyle.NONE&&this.fill();this.stroke();return d}};JSG.ui.graphics.Graphics.prototype.getArrowWidthByType=function(a){switch(a){case JSG.graph.model.attributes.ArrowStyle.ARROWFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWNARROWFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWHALFFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLEFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWDOUBLESMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSEFILLEDSMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSESMALL:case JSG.graph.model.attributes.ArrowStyle.ARROWREVERSENARROWSMALL:case JSG.graph.model.attributes.ArrowStyle.CIRCLESMALL:case JSG.graph.model.attributes.ArrowStyle.DIAMONDSMALL:case JSG.graph.model.attributes.ArrowStyle.DIAMONDNARROWSMALL:case JSG.graph.model.attributes.ArrowStyle.SQUARESMALL:return this._cs.metricToLogX(175)}return this._cs.metricToLogX(250)};
JSG.ui.graphics.Graphics.prototype.setLineWidth=function(a){var b=this._cs.metricToLogX(a);b!=this._context2D.lineWidth&&(this._context2D.lineWidth=b);this._lineWidth=a};JSG.ui.graphics.Graphics.prototype.setLineCorner=function(a){this._lineCorner=a};JSG.ui.graphics.Graphics.prototype.setLineArrowStart=function(a){this._lineArrowStart=a};JSG.ui.graphics.Graphics.prototype.setLineArrowEnd=function(a){this._lineArrowEnd=a};
JSG.ui.graphics.Graphics.prototype.setShadow=function(a,b,c,d,e){this._context2D.shadowColor=a;this._context2D.shadowOffsetX=this._cs.metricToLogX(b);this._context2D.shadowOffsetY=this._cs.metricToLogX(c);this._context2D.shadowBlur=d};JSG.ui.graphics.Graphics.prototype.resetShadow=function(){this._context2D.shadowOffsetX=0;this._context2D.shadowOffsetY=0;this._context2D.shadowBlur=0;this._context2D.shadowColor="#000000"};
JSG.ui.graphics.Graphics.prototype.setPattern=function(a,b,c){JSG.imagePool.add(b);this._pattern=b;this._bounds=a;this._patternStyle=c};JSG.ui.graphics.Graphics.prototype.setGradientLinear=function(a,b,c,d){if(this.isContextDefined()){a=this.evaluateLinearGradientVector(a,d);a=this.createLinearGradient(a[0].x,a[0].y,a[1].x,a[1].y);try{a.addColorStop(0,b),a.addColorStop(1,c),this._context2D.fillStyle=a}catch(e){this._context2D.fillStyle="#FFFFFF"}}};
JSG.ui.graphics.Graphics.prototype.evaluateLinearGradientVector=function(a,b){var c=a.getPoints(),d=[new JSG.geometry.Point(0,0),new JSG.geometry.Point(0,0)];b=Math.round(b);b%=360;if(90==b)d[0].set(c[0].x,c[0].y),d[1].set(c[3].x,c[3].y);else if(0==b)d[0].set(c[0].x,c[0].y),d[1].set(c[1].x,c[1].y);else if(180==b)d[0].set(c[1].x,c[1].y),d[1].set(c[0].x,c[0].y);else if(270==b)d[0].set(c[3].x,c[3].y),d[1].set(c[0].x,c[0].y);else{var e,f;0<=b&&90>b?(e=c[0],f=c[2]):90<b&&180>=b?(e=c[1],f=c[3]):180<b&&
270>=b?(e=c[2],f=c[0]):270<b&&(e=c[3],f=c[1]);var g=Math.tan(JSG.geometry.Utils.toRadians(b)),l=e,h=JSG.ptCache.get(e.x+200,0);h.y=g*h.x+(l.y-g*l.x);var m=Math.tan(JSG.geometry.Utils.toRadians(b+90)),g=f;f=JSG.ptCache.get(f.x+200,0);f.y=m*f.x+(g.y-m*g.x);m=JSG.ptCache.get(0,0);JSG.geometry.Utils.getIntersectionOfLines(l,h,g,f,m,!0)?(d[0].set(e.x,e.y),d[1].set(m.x,m.y)):(d[0].set(c[0].x,c[0].y),d[1].set(c[3].x,c[3].y));JSG.ptCache.release(h,f,m)}return d};
JSG.ui.graphics.Graphics.prototype.createLinearGradient=function(a,b,c,d){if(this.isContextDefined())return a=this.transformPoint(a,b,JSG.ptCache.get()),c=this.transformPoint(c,d,JSG.ptCache.get()),d=this._context2D.createLinearGradient(a.x,a.y,c.x,c.y),JSG.ptCache.release(a,c),d};
JSG.ui.graphics.Graphics.prototype.setGradientRadial=function(a,b,c,d,e){var f=d,g=e;50>d&&(f=100-d);50>e&&(g=100-e);d=0!=a.width?d/100*a.width:0;e=0!=a.height?e/100*a.height:0;a=this.createRadialGradient(a.x+d,a.y+e,0,a.x+d,a.y+e,Math.max(a.width*f/100,a.height*g/100));try{a.addColorStop(0,b),a.addColorStop(1,c),this._context2D.fillStyle=a}catch(l){this._context2D.fillStyle="#FFFFFF"}};
JSG.ui.graphics.Graphics.prototype.createRadialGradient=function(a,b,c,d,e,f){if(this.isContextDefined())return a=this.transformPoint(a,b,JSG.ptCache.get()),d=this.transformPoint(d,e,JSG.ptCache.get()),c=this._context2D.createRadialGradient(a.x,a.y,c,d.x,d.y,f),JSG.ptCache.release(a,d),c};
JSG.ui.graphics.Graphics.prototype.drawImage=function(a,b,c,d,e){if(this.isContextDefined()){if("undefined"!=typeof a.naturalWidth&&0==a.naturalWidth&&(a=JSG.imagePool.get(JSG.commons.ImagePool.IMG_NOTAVAIL),!a||0==a.naturalWidth))return;b=this.transformPoint(b,c,JSG.ptCache.get());b.x-=0.5;b.y-=0.5;(c=this.getRotation())&&d&&e?(this._context2D.translate(b.x,b.y),this._context2D.rotate(c),this._context2D.drawImage(a,0,0,d,e),this._context2D.rotate(-c),this._context2D.translate(-b.x,-b.y)):void 0==
d?this._context2D.drawImage(a,b.x,b.y):this._context2D.drawImage(a,b.x,b.y,d,e);JSG.ptCache.release(b)}};JSG.ui.graphics.Graphics.prototype.drawRect=function(a){this._lineStyle!=JSG.graph.model.attributes.LineStyle.NONE&&this.drawPolyline(a.getPoints(JSG.ui.graphics.Graphics.RECT_POINTS),!0)};JSG.ui.graphics.Graphics.prototype.fillRect=function(a){this.fillPolyline(a.getPoints(JSG.ui.graphics.Graphics.RECT_POINTS))};
JSG.ui.graphics.Graphics.prototype.fillText=function(a,b,c){if(this._fontStyle&JSG.graph.attr.TextFormatAttributes.FontStyle.UNDERLINE){var d=JSG.ptCache.get(0,0),e=JSG.ptCache.get(0,0),f=this.measureText(a).width;switch(this._horizontalAlignment){case JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT:d.x=b;e.x=b+f;break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER:d.x=b-f/2;e.x=b+f/2+1;break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.RIGHT:d.x=b-f,e.x=b}f=this._fontSize/
72*JSG.dpi.y*this._cs.getZoom();d.y=e.y=c+f/2+2;this.beginPath();d=this.transformPoint(d.x,d.y,d);this._context2D.moveTo(d.x,d.y);e=this.transformPoint(e.x,e.y,e);this._context2D.lineTo(e.x,e.y);this.stroke();JSG.ptCache.release(d,e)}b=this.transformPoint(b,c,JSG.ptCache.get());(c=this.getRotation())?(this._context2D.translate(b.x,b.y),this._context2D.rotate(c),this._context2D.fillText(a,0,0),this._context2D.rotate(-c),this._context2D.translate(-b.x,-b.y)):this._context2D.fillText(a,b.x,b.y);JSG.ptCache.release(b)};
JSG.ui.graphics.Graphics.prototype.drawText=function(a,b,c){b=this.transformPoint(b,c,JSG.ptCache.get());this._context2D.strokeText(a,b.x,b.y);JSG.ptCache.release(b)};JSG.ui.graphics.Graphics.prototype.measureText=function(a){return this._context2D.measureText(a)};
JSG.ui.graphics.Graphics.prototype.drawPolyline=function(a,b,c){if(!(this._lineStyle==JSG.graph.model.attributes.LineStyle.NONE||2>a.length)){var d=this._cs.metricToLogX(this._lineCorner);if(d){var e=[],f=[],g=[];this.getRoundedPolygonBezier(f,g,e,a,b,d);this.drawBezier(f,e,g,b,c);JSG.ptCache.releaseBulk()}else if(this._lineStyle==JSG.graph.model.attributes.LineStyle.SOLID||this._context2D.setLineDash){this._lineStyle!=JSG.graph.model.attributes.LineStyle.SOLID&&this._context2D.setLineDash&&(d=Math.max(this._context2D.lineWidth,
1),d=this.getDashPattern(d,5*d,3*d,2*d),this._context2D.setLineDash(d));this.beginPath();this.moveTo(a[0].x,a[0].y);d=1;for(e=a.length;d<e;d++)this.lineTo(a[d].x,a[d].y);b&&this.closePath();this.stroke();this._context2D.setLineDash&&this._context2D.setLineDash([])}else{d=1;for(e=a.length;d<e;d++)this.drawLine(a[d-1],a[d]);b&&this.drawLine(a[d-1],a[0])}b||(this._context2D.setLineDash&&this._context2D.setLineDash([]),b=this.drawArrow(a[1],a[0],this._lineArrowStart),d=this.drawArrow(a[a.length-2],a[a.length-
1],this._lineArrowEnd),this._updateRenderContextBBox(c,"startArrow",a[0],b),this._updateRenderContextBBox(c,"endArrow",a[a.length-1],d))}};JSG.ui.graphics.Graphics.prototype._updateRenderContextBBox=function(a,b,c,d){if(void 0!=a&&void 0!=d){var e=a[b],e=void 0!=e?e:new JSG.geometry.BoundingBox(0,0);e.reset();e.setSize(d,d);e.setTopLeft(c.x-d/2,c.y);a[b]=e}};
JSG.ui.graphics.Graphics.prototype.getRoundedPolygonBezier=function(a,b,c,d,e,f){e||(b.push(d[0]),c.push(d[0]));for(var g=1,l=e?d.length+1:d.length;g<l;g++)if(g<l-1||e){var h,m,k;g==d.length?(h=d[1],m=d[d.length-1],k=d[0]):(h=g==d.length-1?d[0]:d[g+1],m=d[g-1],k=d[g]);var n=JSG.geometry.Utils.getLineLength(k,m)/2,q=JSG.geometry.Utils.getLineLength(k,h)/2,n=Math.min(2*f,Math.min(n,q));m=Math.atan2(k.y-m.y,k.x-m.x);n=n/2/Math.sin(Math.PI/4);q=Math.sin(m)*n;m=Math.cos(m)*n;(!e||1<g)&&a.push(JSG.ptCache.get(k.x-
m,k.y-q,!0));c.length&&b.push(c[c.length-1]);c.push(JSG.ptCache.get(k.x-m,k.y-q,!0));a.push(JSG.ptCache.get(k.x-0.45*m,k.y-0.45*q,!0));m=Math.atan2(h.y-k.y,h.x-k.x);q=Math.sin(m)*n;m=Math.cos(m)*n;b.push(JSG.ptCache.get(k.x+0.45*m,k.y+0.45*q,!0));c.push(JSG.ptCache.get(k.x+m,k.y+q,!0));e&&g==l-1&&(b.insertAt(0,c[c.length-1]),a.push(c[0]))}else a.push(d[g]),b.push(c[c.length-1]),c.push(d[g]),a.push(d[g])};
JSG.ui.graphics.Graphics.prototype.fillPolyline=function(a){if(0!=a.length){var b=this._cs.metricToLogX(this._lineCorner);if(b){var c=[],d=[],e=[];this.getRoundedPolygonBezier(d,e,c,a,!0,b);this.fillBezier(d,c,e);JSG.ptCache.releaseBulk()}else{this.beginPath();this.moveTo(a[0].x,a[0].y);b=1;for(c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y);this.closePath();this.fill(void 0,a,void 0)}}};
JSG.ui.graphics.Graphics.prototype.fillWithPattern=function(a,b,c){function d(a,b,c){if(g._context2D.shadowOffsetX||g._context2D.shadowOffsetX)g._context2D.fillStyle=g._fillColor,g._context2D.fill(),g._context2D.shadowOffsetX=0,g._context2D.shadowOffsetY=0,g._context2D.shadowBlur=0;g.save();g.setClipArea(a,b,c);g.translate(l.x,l.y);g._patternStyle==JSG.graph.model.attributes.PatternStyle.STRETCH?g.drawImage(f,-g._bounds.width/2,-g._bounds.height/2,g._bounds.width,g._bounds.height):g._patternStyle==
JSG.graph.model.attributes.PatternStyle.STRETCHPROPORTIONAL?(a=1,b=0!=g._bounds.width?g._bounds.height/g._bounds.width:g._bounds.height,f.naturalWidth&&(a=f.naturalHeight/f.naturalWidth),g._bounds.width&&a>b?g.drawImage(f,-g._bounds.height/a/2,-g._bounds.height/2,g._bounds.height/a,g._bounds.height):g.drawImage(f,-g._bounds.width/2,-g._bounds.width*a/2,g._bounds.width,g._bounds.width*a)):g.drawImage(f,-g._cs.deviceToLogX(f.naturalWidth/2)*g._cs.getZoom(),-g._cs.deviceToLogY(f.naturalHeight/2)*g._cs.getZoom(),
g._cs.deviceToLogX(f.naturalWidth)*g._cs.getZoom(),g._cs.deviceToLogY(f.naturalHeight)*g._cs.getZoom());g.restore()}function e(a,b,c){a=g.transformPoint(0,0,JSG.ptCache.get());g._context2D.translate(a.x,a.y);h&&g._context2D.rotate(h);g._patternMap.contains(f.src)?pattern=g._patternMap.get(f.src):(1==g._cs.getZoom()?pattern=g._context2D.createPattern(f,"repeat"):(b=document.createElement("canvas"),b.width=f.naturalWidth*g._cs.getZoom(),b.height=f.naturalHeight*g._cs.getZoom(),b.getContext("2d").drawImage(f,
0,0,b.width,b.height),pattern=g._context2D.createPattern(b,"repeat")),g._patternMap.put(f.src,pattern));void 0!=pattern&&(g._context2D.fillStyle=pattern,g._context2D.fill());h&&g._context2D.rotate(-h);g._context2D.translate(-a.x,-a.y);JSG.ptCache.release(a)}if(b){var f=this.getImage(this._pattern);if(void 0!=f){var g=this,l=this._bounds.getCenter(JSG.ptCache.get()),h=this.getRotation();this._patternStyle==JSG.graph.model.attributes.PatternStyle.REPEAT?e(a,b,c):d(a,b,c);JSG.ptCache.release(l)}}};
JSG.ui.graphics.Graphics.prototype.getImage=function(a){a=JSG.imagePool.get(a);if(void 0==a||!1===a.complete)if(a=JSG.imagePool.get(JSG.commons.ImagePool.IMG_NOTAVAIL),!a)return;"undefined"!=typeof a.naturalWidth&&0==a.naturalWidth&&(a=JSG.imagePool.get(JSG.commons.ImagePool.IMG_NOTAVAIL));return a};
JSG.ui.graphics.Graphics.prototype.getRectFromPoints=function(a,b){return 4!=a.length||a[0].x!=a[3].x||a[1].x!=a[2].x||a[0].y!=a[1].y||a[2].y!=a[3].y?void 0:(b||new JSG.geometry.Rectangle).set(a[0].x,a[0].y,a[1].x-a[0].x,a[3].y-a[0].y)};
JSG.ui.graphics.Graphics.prototype.drawBezier=function(a,b,c,d,e){if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.NONE&&!(2>b.length)){this.beginPath();if(this._lineStyle==JSG.graph.model.attributes.LineStyle.SOLID||this._context2D.setLineDash){if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.SOLID&&this._context2D.setLineDash){var f=Math.max(this._context2D.lineWidth,1),f=this.getDashPattern(f,5*f,3*f,2*f);this._context2D.setLineDash(f)}this.moveTo(b[0].x,b[0].y);for(var g=1,l=b.length;g<
l;g++)this.bezierCurveTo(a[g-1].x,a[g-1].y,c[g].x,c[g].y,b[g].x,b[g].y);d&&(this.bezierCurveTo(a[b.length-1].x,a[b.length-1].y,c[0].x,c[0].y,b[0].x,b[0].y),this.closePath())}else{var f=Math.max(this._lineWidth,this._cs.deviceToLogX(1)),f=this.getDashPattern(f,5*f,3*f,2*f),h=function(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e},l=d?b.length:b.length-1,m=b[0].copy(),k=m.copy(),n=m.copy(),q=JSG.ptCache.get(0,0),p=!1,s=!1,u=0,t=f[u];this.moveTo(m.x,m.y);for(g=0;g<l;g++)for(var w=0;1>
w;w+=1/150){g==b.length-1?(q.x=h(w,b[g].x,a[g].x,c[0].x,b[0].x),q.y=h(w,b[g].y,a[g].y,c[0].y,b[0].y)):(q.x=h(w,b[g].x,a[g].x,c[g+1].x,b[g+1].x),q.y=h(w,b[g].y,a[g].y,c[g+1].y,b[g+1].y));var v=JSG.geometry.Utils.getLineLength(m,q);v>t/2&&!s&&(n=q.copy(),s=!0);v>t&&(p?(k.x=q.x,k.y=q.y,this.moveTo(q.x,q.y),p=!1):(this.bezierCurveTo(n.x,n.y,n.x,n.y,q.x,q.y),p=!0),s=!1,m.x=q.x,m.y=q.y,u=(u+1)%f.length,t=f[u])}JSG.ptCache.release(q)}this.stroke();d||(this._context2D.setLineDash&&this._context2D.setLineDash([]),
a=this.drawArrow(a[0],b[0],this._lineArrowStart),c=this.drawArrow(c[c.length-1],b[b.length-1],this._lineArrowEnd),this._updateRenderContextBBox(e,"startArrow",b[0],a),this._updateRenderContextBBox(e,"endArrow",b[b.length-1],c))}};
JSG.ui.graphics.Graphics.prototype.getDashPattern=function(a,b,c,d){var e=[b,c];switch(this._lineStyle){case JSG.graph.model.attributes.LineStyle.DASH:e=[b,c];break;case JSG.graph.model.attributes.LineStyle.DASHDOT:e=[b,c,a,c];break;case JSG.graph.model.attributes.LineStyle.DASHDOTDOT:e=[a,c,b,c,a,c];break;case JSG.graph.model.attributes.LineStyle.DOT:e=[a,d]}return e};
JSG.ui.graphics.Graphics.prototype.fillBezier=function(a,b,c){if(this._fillStyle!=JSG.graph.model.attributes.FillStyle.NONE&&!(2>b.length)){this.beginPath();this.moveTo(b[0].x,b[0].y);for(var d=1,e=b.length;d<e;d++)this.bezierCurveTo(a[d-1].x,a[d-1].y,c[d].x,c[d].y,b[d].x,b[d].y);this.bezierCurveTo(a[b.length-1].x,a[b.length-1].y,c[0].x,c[0].y,b[0].x,b[0].y);this.closePath();this.fill(a,b,c)}};
JSG.ui.graphics.Graphics.prototype.fillEllipse=function(a){if(0!=a.width&&0!=a.height){var b=0.5522848*(a.width/2),c=0.5522848*(a.height/2),d=a.x+a.width,e=a.y+a.height,f=a.x+a.width/2,g=a.y+a.height/2;this.beginPath();this.moveTo(a.x,g);this.bezierCurveTo(a.x,g-c,f-b,a.y,f,a.y);this.bezierCurveTo(f+b,a.y,d,g-c,d,g);this.bezierCurveTo(d,g+c,f+b,e,f,e);this.bezierCurveTo(f-b,e,a.x,g+c,a.x,g);this.closePath();this.fill()}};
JSG.ui.graphics.Graphics.prototype.moveTo=function(a,b){var c=this.transformPoint(a,b,JSG.ptCache.get());this._context2D.moveTo(c.x,c.y);JSG.ptCache.release(c)};JSG.ui.graphics.Graphics.prototype.lineTo=function(a,b){var c=this.transformPoint(a,b,JSG.ptCache.get());this._context2D.lineTo(c.x,c.y);JSG.ptCache.release(c)};
JSG.ui.graphics.Graphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){e=this.transformPoint(e,f,JSG.ptCache.get());a=this.transformPoint(a,b,JSG.ptCache.get());c=this.transformPoint(c,d,JSG.ptCache.get());this._context2D.bezierCurveTo(a.x,a.y,c.x,c.y,e.x,e.y);JSG.ptCache.release(e,a,c)};JSG.ui.graphics.Graphics.prototype.arc=function(a,b,c,d,e,f){a=this.transformPoint(a,b,JSG.ptCache.get());this._context2D.arc(a.x,a.y,c,d,e,f);JSG.ptCache.release(a)};
JSG.ui.graphics.Graphics.prototype.circle=function(a,b,c){this.arc(a,b,c,0,2*Math.PI,!0)};JSG.ui.graphics.Graphics.prototype.beginPath=function(){this._context2D.beginPath()};JSG.ui.graphics.Graphics.prototype.closePath=function(){this._context2D.closePath()};JSG.ui.graphics.Graphics.prototype.stroke=function(){this._context2D.stroke()};JSG.ui.graphics.Graphics.prototype.fill=function(a,b,c){b&&this._fillStyle==JSG.graph.model.attributes.FillStyle.PATTERN?this.fillWithPattern(a,b,c):this._context2D.fill()};
JSG.ui.graphics.Graphics.prototype.startGroup=function(){};JSG.ui.graphics.Graphics.prototype.endGroup=function(){};
JSG.ui.graphics.Graphics.prototype.drawMarker=function(a,b){if(JSG.touchDevice)if(b){var c=this._fillColor,c=this._lineWidth,d=a.copy();d.expandBy(this._cs.metricToLogXNoZoom(1E3));this.setTransparency(20);this.fillEllipse(d);d=a.copy();d.reduceBy(this._cs.metricToLogXNoZoom(50));this.setTransparency(100);this.fillEllipse(d);d=a.copy();d.expandBy(this._cs.metricToLogXNoZoom(950));this.setLineWidth(50);this.drawEllipse(d);this.setLineWidth(c)}else c=this._fillColor,d=a.copy(),this.setFillColor("#FFFFFF"),
this.fillEllipse(a),this.setFillColor(c),d.reduceBy(this._cs.metricToLogXNoZoom(50)),this.fillEllipse(d),this.drawEllipse(a);else this.fillEllipse(a),d=a.copy(),d.expandBy(this._cs.metricToLogXNoZoom(50)),this.drawEllipse(d)};
JSG.ui.graphics.Graphics.prototype.multiply=function(a){var b=this.m[1]*a.m[0]+this.m[3]*a.m[1],c=this.m[0]*a.m[2]+this.m[2]*a.m[3],d=this.m[1]*a.m[2]+this.m[3]*a.m[3],e=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],f=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=b;this.m[2]=c;this.m[3]=d;this.m[4]=e;this.m[5]=f};
JSG.ui.graphics.Graphics.prototype.invert=function(a){var b=[1,0,0,1,0,0],c=1/(a[0]*a[3]-a[1]*a[2]);b[0]=a[3]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[0]*c;b[4]=c*(a[2]*a[5]-a[3]*a[4]);b[5]=c*(a[1]*a[4]-a[0]*a[5]);return b};JSG.ui.graphics.Graphics.prototype.rotateM=function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.m[1]*b+this.m[3]*a,d=this.m[0]*-a+this.m[2]*b,e=this.m[1]*-a+this.m[3]*b;this.m[0]=this.m[0]*b+this.m[2]*a;this.m[1]=c;this.m[2]=d;this.m[3]=e};
JSG.ui.graphics.Graphics.prototype.translateM=function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b;this.m[5]+=this.m[1]*a+this.m[3]*b};JSG.ui.graphics.Graphics.prototype.scaleM=function(a,b){this.m[0]*=a;this.m[1]*=a;this.m[2]*=b;this.m[3]*=b};
JSG.ui.graphics.Graphics.prototype.transformPoint=function(a,b,c){c=c||new JSG.geometry.Point(0,0);var d=a*this.m[0]+b*this.m[2]+this.m[4];a=a*this.m[1]+b*this.m[3]+this.m[5];this.antialias?(c.x=d,c.y=a):(c.x=JSG.geometry.Utils.roundUp(d)+0.5,c.y=JSG.geometry.Utils.roundUp(a)+0.5);return c};JSG.ui.graphics.Graphics.prototype.getRotation=function(a,b){return Math.atan2(0*this.m[2]+1*this.m[3],0*this.m[0]-1*this.m[1])-Math.PI/2};JSG.namespace("JSG.ui.graphics");
JSG.ui.graphics.ScalableGraphics=function(a,b){JSG.ui.graphics.ScalableGraphics._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.graphics.ScalableGraphics,JSG.ui.graphics.Graphics);
JSG.ui.graphics.ScalableGraphics.prototype.drawImage=function(a,b,c,d,e){void 0==d?JSG.ui.graphics.ScalableGraphics._super.drawImage.call(this,a,this._cs.logToDeviceX(b),this._cs.logToDeviceY(c)):JSG.ui.graphics.ScalableGraphics._super.drawImage.call(this,a,this._cs.logToDeviceX(b),this._cs.logToDeviceY(c),this._cs.logToDeviceX(d),this._cs.logToDeviceY(e))};
JSG.ui.graphics.ScalableGraphics.prototype.fillText=function(a,b,c){JSG.ui.graphics.ScalableGraphics._super.fillText.call(this,a,this._cs.logToDeviceX(b),this._cs.logToDeviceY(c))};JSG.ui.graphics.ScalableGraphics.prototype.drawText=function(a,b,c){JSG.ui.graphics.ScalableGraphics._super.drawText.call(this,a,this._cs.logToDeviceX(b),this._cs.logToDeviceY(c))};
JSG.ui.graphics.ScalableGraphics.prototype.moveTo=function(a,b){JSG.ui.graphics.ScalableGraphics._super.moveTo.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceY(b))};JSG.ui.graphics.ScalableGraphics.prototype.lineTo=function(a,b){JSG.ui.graphics.ScalableGraphics._super.lineTo.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceY(b))};
JSG.ui.graphics.ScalableGraphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){JSG.ui.graphics.ScalableGraphics._super.bezierCurveTo.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceY(b),this._cs.logToDeviceX(c),this._cs.logToDeviceY(d),this._cs.logToDeviceX(e),this._cs.logToDeviceY(f))};JSG.ui.graphics.ScalableGraphics.prototype.arc=function(a,b,c,d,e,f){JSG.ui.graphics.ScalableGraphics._super.arc.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceY(b),this._cs.logToDeviceX(c),d,e,f)};
JSG.ui.graphics.ScalableGraphics.prototype.translate=function(a,b){JSG.ui.graphics.ScalableGraphics._super.translate.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceY(b))};JSG.ui.graphics.ScalableGraphics.prototype.scale=function(a,b){JSG.ui.graphics.ScalableGraphics._super.scale.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceX(b))};
JSG.ui.graphics.ScalableGraphics.prototype.setImageClip=function(a){var b=JSG.rectCache.get();b.set(this._cs.logToDeviceX(a.x),this._cs.logToDeviceY(a.y),this._cs.logToDeviceX(a.width),this._cs.logToDeviceY(a.height));JSG.ui.graphics.ScalableGraphics._super.setImageClip.call(this,b);JSG.rectCache.release(b)};
JSG.ui.graphics.ScalableGraphics.prototype.setShadow=function(a,b,c,d,e){this.isContextDefined()&&(this._context2D.shadowColor=a,this._context2D.shadowOffsetX=this._cs.logToDeviceX(b),this._context2D.shadowOffsetY=this._cs.logToDeviceY(c),this._context2D.shadowBlur=d)};
JSG.ui.graphics.ScalableGraphics.prototype.createLinearGradient=function(a,b,c,d){if(this.isContextDefined())return JSG.ui.graphics.ScalableGraphics._super.createLinearGradient.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceY(b),this._cs.logToDeviceX(c),this._cs.logToDeviceY(d))};
JSG.ui.graphics.ScalableGraphics.prototype.createRadialGradient=function(a,b,c,d,e,f){if(this.isContextDefined())return JSG.ui.graphics.ScalableGraphics._super.createRadialGradient.call(this,this._cs.logToDeviceX(a),this._cs.logToDeviceY(b),this._cs.logToDeviceX(c),this._cs.logToDeviceX(d),this._cs.logToDeviceY(e),this._cs.logToDeviceX(f))};
JSG.ui.graphics.ScalableGraphics.prototype.setLineWidth=function(a){if(this.isContextDefined()){var b;b=a==JSG.graph.model.attributes.LineStyle.HAIRLINE?JSG.touchDevice?1:1.01:Math.max(0.01,this._cs.logToDeviceX(a));b!=this._context2D.lineWidth&&(this._context2D.lineWidth=b)}this._lineWidth=a};JSG.namespace("JSG.ui.graphics");
JSG.ui.graphics.SVGraphics=function(a,b){this._cs=b;this._file=a;this._currentPath="";this._id=1;this._lineColor="#FFFFFF";this._lineWidth=1;this._patternFill=this._gradientFill="";this._clip=void 0;this._transparency=1;this._transform="";this._baseline="baseline"};JSG.extend(JSG.ui.graphics.SVGraphics,JSG.ui.graphics.ScalableGraphics);JSG.ui.graphics.SVGraphics.prototype.setTransparency=function(a){this._transparency=a/100};
JSG.ui.graphics.SVGraphics.prototype.setFillColor=function(a){this._fillColor=a};JSG.ui.graphics.SVGraphics.prototype.setLineColor=function(a){this._lineColor=a};JSG.ui.graphics.SVGraphics.prototype.setLineWidth=function(a){this._lineWidth=a==JSG.graph.model.attributes.LineStyle.HAIRLINE?1:Math.max(0.01,this._cs.toSVGUnit(a))};JSG.ui.graphics.SVGraphics.prototype.save=function(){};JSG.ui.graphics.SVGraphics.prototype.restore=function(){this._clip=void 0};
JSG.ui.graphics.SVGraphics.prototype.setShadow=function(a,b,c,d,e){if(0==b&&0==c)this._shadow=void 0;else{this._shadow="shadow"+this._id;this._file.writeStartElement("defs");this._file.writeStartElement("filter");this._file.writeAttributeString("id",this._shadow);this._file.writeAttributeString("filterUnits","userSpaceOnUse");this._file.writeAttributeString("x","-50");this._file.writeAttributeString("y","-50");this._file.writeAttributeString("width",this._cs.toSVGUnit(e.width)+100);this._file.writeAttributeString("height",
this._cs.toSVGUnit(e.height)+100);var f=a.replace(/^\s*#|\s*$/g,"");3==f.length&&(f=f.replace(/(.)/g,"$1$1"));a=parseInt(f.substr(0,2),16);e=parseInt(f.substr(2,2),16);f=parseInt(f.substr(4,2),16);this._file.writeStartElement("feColorMatrix");this._file.writeAttributeString("color-interpolation-filters","sRGB");this._file.writeAttributeString("type","matrix");this._file.writeAttributeString("result","colored");this._file.writeAttributeString("values","0 0 0 "+this.svgRound(a/255)+" 0 0 0 0 "+this.svgRound(e/
255)+" 0 0 0 0 "+this.svgRound(f/255)+" 0 0 0 0 1 0");this._file.writeEndElement();this._file.writeStartElement("feGaussianBlur");this._file.writeAttributeString("in","colored");this._file.writeAttributeString("result","blur");this._file.writeAttributeString("stdDeviation",Math.min(2.3,Math.ceil(d/3)));this._file.writeEndElement();this._file.writeStartElement("feOffset");this._file.writeAttributeString("in","blur");this._file.writeAttributeString("result","offsetBlur");this._file.writeAttributeString("dx",
Math.ceil(this._cs.toSVGUnit(b)));this._file.writeAttributeString("dy",Math.ceil(this._cs.toSVGUnit(c)));this._file.writeEndElement();this._file.writeStartElement("feMerge");this._file.writeStartElement("feMergeNode");this._file.writeAttributeString("in","offsetBlur");this._file.writeEndElement();this._file.writeStartElement("feMergeNode");this._file.writeAttributeString("in","SourceGraphic");this._file.writeEndElement();this._file.writeEndElement();this._file.writeEndElement();this._file.writeEndElement();
this._id++}};JSG.ui.graphics.SVGraphics.prototype.resetShadow=function(){this._shadow=void 0};
JSG.ui.graphics.SVGraphics.prototype.setGradientRadial=function(a,b,c,d,e){this._gradientFill="gradient"+this._id;var f=d,g=e;50>d&&(f=100-d);50>e&&(g=100-e);this._file.writeStartElement("defs");this._file.writeStartElement("radialGradient");this._file.writeAttributeString("id",this._gradientFill);this._file.writeAttributeString("gradientUnits","userSpaceOnUse");this._file.writeAttributeString("cx",this._cs.toSVGUnit(a.x+d/100*a.width));this._file.writeAttributeString("cy",this._cs.toSVGUnit(a.y+
e/100*a.height));this._file.writeAttributeString("r",this._cs.toSVGUnit(Math.max(a.width*f/100,a.height*g/100)));this._file.writeAttributeString("fx",this._cs.toSVGUnit(a.x+d/100*a.width));this._file.writeAttributeString("fy",this._cs.toSVGUnit(a.y+e/100*a.height));this._file.writeStartElement("stop");this._file.writeAttributeString("offset","0%");this._file.writeAttributeString("stop-color",b);this._file.writeEndElement();this._file.writeStartElement("stop");this._file.writeAttributeString("offset",
"100%");this._file.writeAttributeString("stop-color",c);this._file.writeEndElement();this._file.writeEndElement();this._file.writeEndElement();this._id++};
JSG.ui.graphics.SVGraphics.prototype.setGradientLinear=function(a,b,c,d){this._gradientFill="gradient"+this._id;a=this.evaluateLinearGradientVector(a,d);this._file.writeStartElement("defs");this._file.writeStartElement("linearGradient");this._file.writeAttributeString("id",this._gradientFill);this._file.writeAttributeString("gradientUnits","userSpaceOnUse");this._file.writeAttributeString("x1",this._cs.toSVGUnit(a[0].x));this._file.writeAttributeString("y1",this._cs.toSVGUnit(a[0].y));this._file.writeAttributeString("x2",
this._cs.toSVGUnit(a[1].x));this._file.writeAttributeString("y2",this._cs.toSVGUnit(a[1].y));this._file.writeStartElement("stop");this._file.writeAttributeString("offset","0%");this._file.writeAttributeString("stop-color",b);this._file.writeEndElement();this._file.writeStartElement("stop");this._file.writeAttributeString("offset","100%");this._file.writeAttributeString("stop-color",c);this._file.writeEndElement();this._file.writeEndElement();this._file.writeEndElement();this._id++};
JSG.ui.graphics.SVGraphics.prototype.setPattern=function(a,b,c){this._patternFill="pattern"+this._id;this._patternStyle=c;JSG.imagePool.add(b);var d=this.getImage(b);if(void 0!=d){this._file.writeStartElement("defs");this._file.writeStartElement("pattern");this._file.writeAttributeString("id",this._patternFill);this._file.writeAttributeString("patternUnits","userSpaceOnUse");switch(c){case JSG.graph.model.attributes.PatternStyle.REPEAT:this._file.writeAttributeString("x",this._cs.toSVGUnit(a.x));
this._file.writeAttributeString("y",this._cs.toSVGUnit(a.y));this._file.writeAttributeString("width",d.naturalWidth);this._file.writeAttributeString("height",d.naturalHeight);break;case JSG.graph.model.attributes.PatternStyle.CENTER:this._file.writeAttributeString("x",0);this._file.writeAttributeString("y",0);this._file.writeAttributeString("width",this._cs.toSVGUnit(a.width));this._file.writeAttributeString("height",this._cs.toSVGUnit(a.height));break;case JSG.graph.model.attributes.PatternStyle.STRETCH:this._file.writeAttributeString("x",
this._cs.toSVGUnit(a.x));this._file.writeAttributeString("y",this._cs.toSVGUnit(a.y));this._file.writeAttributeString("width",this._cs.toSVGUnit(a.width));this._file.writeAttributeString("height",this._cs.toSVGUnit(a.height));break;case JSG.graph.model.attributes.PatternStyle.STRETCHPROPORTIONAL:this._file.writeAttributeString("x",this._cs.toSVGUnit(a.x)),this._file.writeAttributeString("y",this._cs.toSVGUnit(a.y)),this._file.writeAttributeString("width",this._cs.toSVGUnit(a.width)),this._file.writeAttributeString("height",
this._cs.toSVGUnit(a.height))}this._file.writeStartElement("image");if(0==b.indexOf("http")){var e=b.replace(/&/g,"\x26amp;");this._file.writeAttributeString("xlink:href",e)}else this._file.writeAttributeString("xlink:href","../../../"+b);switch(c){case JSG.graph.model.attributes.PatternStyle.REPEAT:this._file.writeAttributeString("x",0);this._file.writeAttributeString("y",0);this._file.writeAttributeString("width",d.naturalWidth);this._file.writeAttributeString("height",d.naturalHeight);break;case JSG.graph.model.attributes.PatternStyle.STRETCH:this._file.writeAttributeString("x",
0);this._file.writeAttributeString("y",0);this._file.writeAttributeString("width",this._cs.toSVGUnit(a.width));this._file.writeAttributeString("height",this._cs.toSVGUnit(a.height));this._file.writeAttributeString("preserveAspectRatio","none");break;case JSG.graph.model.attributes.PatternStyle.STRETCHPROPORTIONAL:this._file.writeAttributeString("x",0);this._file.writeAttributeString("y",0);this._file.writeAttributeString("width",this._cs.toSVGUnit(a.width));this._file.writeAttributeString("height",
this._cs.toSVGUnit(a.height));this._file.writeAttributeString("preserveAspectRatio","xMidYMid");break;case JSG.graph.model.attributes.PatternStyle.CENTER:this._file.writeAttributeString("x",this._cs.toSVGUnit(a.x+a.width/2)-d.naturalWidth/2),this._file.writeAttributeString("y",this._cs.toSVGUnit(a.y+a.height/2)-d.naturalHeight/2),this._file.writeAttributeString("width",d.naturalWidth),this._file.writeAttributeString("height",d.naturalHeight)}this._file.writeEndElement();this._file.writeEndElement();
this._file.writeEndElement();this._id++;this._pattern=b;this._bounds=a;this._patternStyle=c}};JSG.ui.graphics.SVGraphics.prototype.getFillAttribute=function(){var a="";switch(this._fillStyle){case JSG.graph.model.attributes.FillStyle.NONE:a="fill:none";break;case JSG.graph.model.attributes.FillStyle.SOLID:a=this._fillColor;break;case JSG.graph.model.attributes.FillStyle.GRADIENT:a="url(#"+this._gradientFill+")";break;case JSG.graph.model.attributes.FillStyle.PATTERN:a="url(#"+this._patternFill+")"}return a};
JSG.ui.graphics.SVGraphics.prototype.fillRect=function(a){this._file.writeStartElement("rect");this._file.writeAttributeString("x",this._cs.toSVGUnit(a.x));this._file.writeAttributeString("y",this._cs.toSVGUnit(a.y));this._file.writeAttributeString("width",this._cs.toSVGUnit(a.width));this._file.writeAttributeString("height",this._cs.toSVGUnit(a.height));a=this.getFillAttribute();this._file.writeAttributeString("style","stroke:none;fill:"+a+";fill-opacity:"+this._transparency);this._file.writeEndElement()};
JSG.ui.graphics.SVGraphics.prototype.drawRect=function(a){this._lineStyle!=JSG.graph.model.attributes.LineStyle.NONE&&(this._file.writeStartElement("rect"),this._file.writeAttributeString("x",this._cs.toSVGUnit(a.x)),this._file.writeAttributeString("y",this._cs.toSVGUnit(a.y)),this._file.writeAttributeString("width",this._cs.toSVGUnit(a.width)),this._file.writeAttributeString("height",this._cs.toSVGUnit(a.height)),a=this.getStrokeDash(),void 0==a?this._file.writeAttributeString("style","stroke:"+
this._lineColor+";stroke-width:"+this._lineWidth+";fill:none"):this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";stroke-dasharray:"+a+";fill:none"),this._file.writeEndElement())};
JSG.ui.graphics.SVGraphics.prototype.fillPolyline=function(a){function b(a,b){c._file.writeStartElement("polygon");for(var d="",e=0,f=a.length;e<f;e++)d+=c._cs.toSVGUnit(a[e].x),d+=",",d+=c._cs.toSVGUnit(a[e].y),e<f-1&&(d+=",");c._file.writeAttributeString("points",d);c._file.writeAttributeString("style","stroke:none;fill:"+b+";fill-opacity:"+c._transparency);void 0!=c._shadow&&c._file.writeAttributeString("filter","url(#"+c._shadow+")");c._file.writeEndElement()}var c=this;if(0!=a.length){var d=
this._cs.metricToLogX(this._lineCorner),e=this.getFillAttribute();if(d){var e=[],f=[],g=[];this.getRoundedPolygonBezier(f,g,e,a,!0,d);this.fillBezier(f,e,g)}else this._fillStyle==JSG.graph.model.attributes.FillStyle.PATTERN&&(this._patternStyle==JSG.graph.model.attributes.PatternStyle.CENTER&&"#FFFFFF"!=this._fillColor)&&b(a,this._fillColor),b(a,e)}};
JSG.ui.graphics.SVGraphics.prototype.drawPolyline=function(a,b){if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.NONE&&0!=a.length){var c=this._cs.metricToLogX(this._lineCorner);if(c){var d=[],e=[],f=[];this.getRoundedPolygonBezier(e,f,d,a,b,c);this.drawBezier(e,d,f,b)}else{b?this._file.writeStartElement("polygon"):this._file.writeStartElement("polyline");c="";d=0;for(e=a.length;d<e;d++)c+=this._cs.toSVGUnit(a[d].x),c+=",",c+=this._cs.toSVGUnit(a[d].y),d<e-1&&(c+=",");d=this.getStrokeDash();
this._file.writeAttributeString("points",c);void 0==d?this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";fill:none"):this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";stroke-dasharray:"+d+";fill:none");this._file.writeEndElement()}b||(this._lineStyle=JSG.graph.model.attributes.LineStyle.SOLID,this.drawArrow(a[1],a[0],this._lineArrowStart),this.drawArrow(a[a.length-2],a[a.length-1],this._lineArrowEnd))}};
JSG.ui.graphics.SVGraphics.prototype.drawBezier=function(a,b,c,d){if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.NONE&&!(2>b.length)){this.beginPath();this.moveTo(b[0].x,b[0].y);for(var e=1,f=b.length;e<f;e++)this.bezierCurveTo(a[e-1].x,a[e-1].y,c[e].x,c[e].y,b[e].x,b[e].y);d&&(this.bezierCurveTo(a[b.length-1].x,a[b.length-1].y,c[0].x,c[0].y,b[0].x,b[0].y),this.closePath());this.stroke();d||(this._lineStyle=JSG.graph.model.attributes.LineStyle.SOLID,this.drawArrow(a[0],b[0],this._lineArrowStart),
this.drawArrow(c[c.length-1],b[b.length-1],this._lineArrowEnd))}};
JSG.ui.graphics.SVGraphics.prototype.getStrokeDash=function(){var a=void 0;if(this._lineStyle!=JSG.graph.model.attributes.LineStyle.SOLID){var b=this._lineWidth,c=5*this._lineWidth,d=3*this._lineWidth;switch(this._lineStyle){case JSG.graph.model.attributes.LineStyle.DASH:a=c+", "+d;break;case JSG.graph.model.attributes.LineStyle.DASHDOT:a=c+", "+d+", "+b+", "+d;break;case JSG.graph.model.attributes.LineStyle.DASHDOTDOT:a=b+", "+d+", "+c+", "+d+", "+b+", "+d;break;case JSG.graph.model.attributes.LineStyle.DOT:a=
b+", "+b}}return a};JSG.ui.graphics.SVGraphics.prototype.setFont=function(){};JSG.ui.graphics.SVGraphics.prototype.setTextBaseline=function(a){this._baseline=a};
JSG.ui.graphics.SVGraphics.prototype.fillText=function(a,b,c){this._file.writeStartElement("text");b=this._cs.toSVGUnit(b);c=this._cs.toSVGUnit(c);switch(this._baseline){case "top":c+=this._fontSize/72*JSG.dpi.y*this._cs.getZoom();break;case "middle":c+=this._fontSize/144*JSG.dpi.y*this._cs.getZoom()}this._file.writeAttributeString("x",b);this._file.writeAttributeString("y",c);switch(this._horizontalAlignment){case JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT:this._file.writeAttributeString("text-anchor",
"start");break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER:this._file.writeAttributeString("text-anchor","middle");break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.RIGHT:this._file.writeAttributeString("text-anchor","end")}this._file.writeAttributeString("font-family",this._fontName);this._file.writeAttributeString("font-size",Math.round(this._fontSize*this._cs.getZoom())+"pt");this._fontStyle&JSG.graph.attr.TextFormatAttributes.FontStyle.BOLD&&this._file.writeAttributeString("font-weight",
"bold");this._fontStyle&JSG.graph.attr.TextFormatAttributes.FontStyle.ITALIC&&this._file.writeAttributeString("font-style","italic");this._fontStyle&JSG.graph.attr.TextFormatAttributes.FontStyle.UNDERLINE&&this._file.writeAttributeString("text-decoration","underline");c=this.getFillAttribute();this._file.writeAttributeString("fill",c);a=a.replace(/&/g,"\x26amp;");a=a.replace(/</g,"\x26lt;");a=a.replace(/>/g,"\x26gt;");a=a.replace("\"'","\x26quot;");this._file.writeString(a);this._file.writeEndElement()};
JSG.ui.graphics.SVGraphics.prototype.drawText=function(a,b,c){};
JSG.ui.graphics.SVGraphics.prototype.drawLine=function(a,b){var c=this.getStrokeDash();this._file.writeStartElement("line");this._file.writeAttributeString("x1",this._cs.toSVGUnit(a.x));this._file.writeAttributeString("y1",this._cs.toSVGUnit(a.y));this._file.writeAttributeString("x2",this._cs.toSVGUnit(b.x));this._file.writeAttributeString("y2",this._cs.toSVGUnit(b.y));void 0==c?this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";fill:"+this._fillColor):
this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";stroke-dasharray:"+c+";fill:"+this._fillColor);this._file.writeEndElement()};JSG.ui.graphics.SVGraphics.prototype.beginPath=function(){this._currentPath=""};JSG.ui.graphics.SVGraphics.prototype.closePath=function(){this._currentPath+="Z"};JSG.ui.graphics.SVGraphics.prototype.moveTo=function(a,b){this._currentPath+="M"+this._cs.toSVGUnit(a)+","+this._cs.toSVGUnit(b)};
JSG.ui.graphics.SVGraphics.prototype.lineTo=function(a,b){this._currentPath+="L"+this._cs.toSVGUnit(a)+","+this._cs.toSVGUnit(b)};
JSG.ui.graphics.SVGraphics.prototype.circle=function(a,b,c){this._file.writeStartElement("circle");this._file.writeAttributeString("cx",this._cs.toSVGUnit(a));this._file.writeAttributeString("cy",this._cs.toSVGUnit(b));this._file.writeAttributeString("r",this._cs.toSVGUnit(c));a=this.getFillAttribute();this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";fill:"+a);this._file.writeEndElement()};
JSG.ui.graphics.SVGraphics.prototype.arc=function(a,b,c,d,e,f){this._currentPath+="M"+this._cs.toSVGUnit(a-c)+","+this._cs.toSVGUnit(b);this._currentPath+=" A"+this._cs.toSVGUnit(c)+","+this._cs.toSVGUnit(c)+" 0 1,1 "+this._cs.toSVGUnit(a-c)+","+this._cs.toSVGUnit(b)};JSG.ui.graphics.SVGraphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){this._currentPath+="C"+this._cs.toSVGUnit(a)+","+this._cs.toSVGUnit(b)+" "+this._cs.toSVGUnit(c)+","+this._cs.toSVGUnit(d)+" "+this._cs.toSVGUnit(e)+","+this._cs.toSVGUnit(f)};
JSG.ui.graphics.SVGraphics.prototype.stroke=function(){var a=this.getStrokeDash();this._file.writeStartElement("path");this._file.writeAttributeString("d",this._currentPath);void 0==a?this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";fill:none"):this._file.writeAttributeString("style","stroke:"+this._lineColor+";stroke-width:"+this._lineWidth+";stroke-dasharray:"+a+";fill:none");this._file.writeEndElement()};
JSG.ui.graphics.SVGraphics.prototype.fill=function(){this._patternStyle==JSG.graph.model.attributes.PatternStyle.CENTER&&"#FFFFFF"!=this._fillColor&&(this._file.writeStartElement("path"),this._file.writeAttributeString("d",this._currentPath),this._file.writeAttributeString("style","stroke:none;fill:"+this._fillColor),this._file.writeEndElement());var a=this.getFillAttribute();this._file.writeStartElement("path");this._file.writeAttributeString("d",this._currentPath);this._file.writeAttributeString("style",
"stroke:none;fill:"+a+";fill-opacity:"+this._transparency);void 0!=this._shadow&&this._file.writeAttributeString("filter","url(#"+this._shadow+")");this._file.writeEndElement()};JSG.ui.graphics.SVGraphics.prototype.translate=function(a,b){this._transform+="translate("+this._cs.toSVGUnit(a)+","+this._cs.toSVGUnit(b)+")";this._file.writeAttributeString("transform",this._transform)};
JSG.ui.graphics.SVGraphics.prototype.rotate=function(a){this._transform+=" rotate("+JSG.geometry.Utils.toDegrees(a)+")";this._file.writeAttributeString("transform",this._transform)};JSG.ui.graphics.SVGraphics.prototype.scale=function(a,b){};JSG.ui.graphics.SVGraphics.prototype.startGroup=function(){void 0!=this._clip&&(this._file.writeStartElement("g"),this._file.writeAttributeString("clip-path","url(#"+this._clip+")"));this._file.writeStartElement("g");this._transform=""};
JSG.ui.graphics.SVGraphics.prototype.endGroup=function(){this._file.writeEndElement();void 0!=this._clip&&this._file.writeEndElement()};JSG.ui.graphics.SVGraphics.prototype.getTransform=function(){};JSG.ui.graphics.SVGraphics.prototype.clip=function(){};JSG.ui.graphics.SVGraphics.prototype.setClip=function(a){a=a.getPoints();this.setClipArea(void 0,a,void 0)};
JSG.ui.graphics.SVGraphics.prototype.setClipArea=function(a,b,c){this._clip="clip"+this._id;this._file.writeStartElement("clipPath");this._file.writeAttributeString("id",this._clip);this.beginPath();this.moveTo(b[0].x,b[0].y);if(a&&c){for(var d=1,e=b.length;d<e;d++)this.bezierCurveTo(a[d-1].x,a[d-1].y,c[d].x,c[d].y,b[d].x,b[d].y);closed&&this.bezierCurveTo(a[b.length-1].x,a[b.length-1].y,c[0].x,c[0].y,b[0].x,b[0].y)}else for(d=1,e=b.length;d<e;d++)this.lineTo(b[d].x,b[d].y);this.closePath();this._file.writeStartElement("path");
this._file.writeAttributeString("d",this._currentPath);this._file.writeEndElement();this._file.writeEndElement();this._id++};JSG.ui.graphics.SVGraphics.prototype.svgRound=function(a){return Math.round(100*a)/100};JSG.namespace("JSG.ui.graphics");
JSG.ui.graphics.GraphicSystem=function(a,b){function c(a){a.preventDefault()}function d(a){"mousedown"!=a.gesture.srcEvent.type&&(JSG.debug.log("Touch"),r.currentEvent=JSG.ui.events.GestureEventType.TOUCH,(a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.DRAGSTART))&&E(a),r.paint())}function e(a){"mousedown"!=a.gesture.srcEvent.type&&(JSG.debug.log("Hold"),t(a))}function f(a){0==r.currentEvent&&(JSG.debug.log("DragStart"),r.currentEvent=JSG.ui.events.GestureEventType.DRAG,
(a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.DRAGSTART))&&E(a),r.paint())}function g(a){"move"!=a.gesture.srcEvent.type&&(r.currentEvent==JSG.ui.events.GestureEventType.TOUCH?(r.currentEvent=JSG.ui.events.GestureEventType.DRAG,JSG.debug.log("Drag"),(a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.DRAG))&&E(a),r.paint()):r.currentEvent==JSG.ui.events.GestureEventType.DRAG&&(JSG.debug.log("Drag"),(a=JSG.ui.events.GestureEvent.fromEvent(r,
a.gesture,JSG.ui.events.GestureEventType.DRAG))&&E(a),r.paint()))}function l(a){"mouseup"!=a.gesture.srcEvent.type&&r.currentEvent==JSG.ui.events.GestureEventType.DRAG&&(JSG.debug.log("DragEnd"),(a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.DRAGEND))&&E(a),r.paint(),r.currentEvent=0)}function h(a){"mouseup"!=a.gesture.srcEvent.type&&r.currentEvent!=JSG.ui.events.GestureEventType.DBLTAP&&(JSG.debug.log("Tap"),(a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,
JSG.ui.events.GestureEventType.TAPUP))&&E(a),r.paint(),r.currentEvent=0)}function m(a){if("mouseup"!=a.gesture.srcEvent.type){JSG.debug.log("DoubleTap");if(r.currentEvent==JSG.ui.events.GestureEventType.TOUCH){JSG.debug.log("DragEnd");var b=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.DRAGEND);b&&E(b)}(b=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.DBLTAP))&&E(b);r.paint();r.currentEvent=JSG.ui.events.GestureEventType.DBLTAP}}function k(a){r.currentEvent==
JSG.ui.events.GestureEventType.DRAG?t(a):(r.currentEvent==JSG.ui.events.GestureEventType.TOUCH&&t(a),r.currentEvent=JSG.ui.events.GestureEventType.TRANSFORMSTART)}function n(a){r.currentEvent==JSG.ui.events.GestureEventType.PAN?(JSG.debug.log("Pan"),a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.PAN),E(a),r.paint()):r.currentEvent==JSG.ui.events.GestureEventType.TRANSFORMSTART&&(JSG.debug.log("PanStart"),r.currentEvent=JSG.ui.events.GestureEventType.PAN,a=JSG.ui.events.GestureEvent.fromEvent(r,
a.gesture,JSG.ui.events.GestureEventType.PANSTART),E(a),r.paint())}function q(a){r.currentEvent==JSG.ui.events.GestureEventType.ROTATE?(JSG.debug.log("Rotate"),a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.ROTATE),E(a),r.paint()):r.currentEvent==JSG.ui.events.GestureEventType.TRANSFORMSTART&&(JSG.debug.log("RotateStart"),r.currentEvent=JSG.ui.events.GestureEventType.ROTATE,a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.ROTATESTART),
E(a),r.paint())}function p(a){r.currentEvent==JSG.ui.events.GestureEventType.PINCH?(JSG.debug.log("Pinch"),a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.PINCH),E(a),r.paint()):r.currentEvent==JSG.ui.events.GestureEventType.TRANSFORMSTART&&(JSG.debug.log("PinchStart"),r.currentEvent=JSG.ui.events.GestureEventType.PINCH,a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.PINCHSTART),E(a),r.paint())}function s(a){}function u(a){r.currentEvent==
JSG.ui.events.GestureEventType.ROTATE?(JSG.debug.log("RotateEnd"),a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.ROTATEEND),E(a),r.paint()):r.currentEvent==JSG.ui.events.GestureEventType.PINCH?(JSG.debug.log("PinchEnd"),a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.PINCHEND),E(a),r.paint()):r.currentEvent==JSG.ui.events.GestureEventType.PAN&&(JSG.debug.log("PanEnd"),a=JSG.ui.events.GestureEvent.fromEvent(r,a.gesture,JSG.ui.events.GestureEventType.PANEND),
E(a),r.paint());r.currentEvent=0}function t(a){a=JSG.ui.events.GestureEvent.fromEvent(r,event.gesture,JSG.ui.events.GestureEventType.CANCEL);E(a);r.paint();r.currentEvent=0}function w(a){a=JSG.ui.events.DragEvent.fromEvent(r.canvas,a,JSG.ui.events.DragEventType.ENTER);a.cs=r.graphics.getCoordinateSystem();H(a)}function v(a){a.preventDefault&&a.preventDefault();a=JSG.ui.events.DragEvent.fromEvent(r.canvas,a,JSG.ui.events.DragEventType.OVER);a.cs=r.graphics.getCoordinateSystem();H(a)}function A(a){a=
JSG.ui.events.DragEvent.fromEvent(r.canvas,a,JSG.ui.events.DragEventType.LEAVE);a.cs=r.graphics.getCoordinateSystem();H(a)}function D(a){a=JSG.ui.events.DragEvent.fromEvent(r.canvas,a,JSG.ui.events.DragEventType.EXIT);a.cs=r.graphics.getCoordinateSystem();H(a)}function z(a){var b=JSG.ui.events.DragEvent.fromEvent(r.canvas,a,JSG.ui.events.DragEventType.DROP);b.cs=r.graphics.getCoordinateSystem();H(b);a.preventDefault&&a.preventDefault();r.paint();return!1}function F(){JSG.keepFocus||(document.onmousemove=
B,document.onmouseup=I)}function x(a){var b=(new Date).getTime();r._dblClk=300>b-r._lastClick;r._lastClick=b;r._dblClk||(r.currentEvent=JSG.ui.events.GestureEventType.DRAG,a=JSG.ui.events.MouseEvent.fromEvent(r.canvas,a,JSG.ui.events.MouseEventType.DOWN),a.cs=r.graphics.getCoordinateSystem(),a.isClicked(JSG.ui.events.ButtonType.RIGHT)||(G(a),r.paint()),r.canvas.focus())}function B(a){a=JSG.ui.events.MouseEvent.fromEvent(r.canvas,a,JSG.ui.events.MouseEventType.MOVE);a.cs=r.graphics.getCoordinateSystem();
if(a.isInCanvas()||void 0!=r.interactionHandler&&r.interactionHandler.isDragging)G(a),a.doRepaint&&r.paint()}function I(a){r._dblClk?r._dblClk=!1:(a=JSG.ui.events.MouseEvent.fromEvent(r.canvas,a,JSG.ui.events.MouseEventType.UP),a.cs=r.graphics.getCoordinateSystem(),!a.isClicked(JSG.ui.events.ButtonType.RIGHT)&&(a.isInCanvas()||void 0!=r.interactionHandler&&r.interactionHandler.isDragging)&&(G(a),r.paint()))}function J(a){a=JSG.ui.events.MouseEvent.fromEvent(r.canvas,a,JSG.ui.events.MouseEventType.DBLCLK);
a.cs=r.graphics.getCoordinateSystem();G(a);r.paint()}function K(a){a=JSG.ui.events.MouseEvent.fromEvent(r.canvas,a,JSG.ui.events.MouseEventType.DOWN);a.cs=r.graphics.getCoordinateSystem();G(a);return!1}function L(a){JSG.ui.events.MouseEvent.fromEvent(r.canvas,a,JSG.ui.events.MouseEventType.WHEEL).cs=r.graphics.getCoordinateSystem();G(JSG.ui.events.MouseEvent.fromEvent(r.canvas,a,JSG.ui.events.MouseEventType.WHEEL));r.paint()}function M(a){r.onKeyEvent(a,JSG.ui.events.KeyEventType.DOWN)}function N(a){return r.onKeyEvent(a,
JSG.ui.events.KeyEventType.UP)}function G(a){!0!==O&&(a.location.x=r.graphics.getCoordinateSystem().deviceToLogX(a.location.x),a.location.y=r.graphics.getCoordinateSystem().deviceToLogY(a.location.y),a.event.preventDefault(),r.interactionHandler?r.interactionHandler.handleMouseEvent(a):r.root.handleMouseEvent(a))}function E(a){a.location.x=r.graphics.getCoordinateSystem().deviceToLogX(a.location.x);a.location.y=r.graphics.getCoordinateSystem().deviceToLogY(a.location.y);if(r.interactionHandler)switch(a.type){case JSG.ui.events.MouseEventType.DOWN:case JSG.ui.events.MouseEventType.MOVE:case JSG.ui.events.MouseEventType.UP:case JSG.ui.events.MouseEventType.DBLCLK:r.interactionHandler.handleMouseEvent(a);
break;default:r.interactionHandler.handleGestureEvent(a)}}function H(a){r.interactionHandler?r.interactionHandler.handleDragEvent(a):r.root.handleDragEvent(a)}var r=this;this.canvas="string"===typeof a||a instanceof String?document.getElementById(a):a;this.graphics=new JSG.ui.graphics.ScalableGraphics(this.canvas,b);this.root=new JSG.ui.View;this._requestRepaint=this._isPainting=!1;this.canvas.addEventListener("mousedown",x,!1);JSG.debug.USE_DOC_DISPATCHER?(JSG.ui.graphics.DocumentEventDispatcher.addEventListener("onmouseup",
this,I),JSG.ui.graphics.DocumentEventDispatcher.addEventListener("onmousemove",this,B)):this.canvas.addEventListener("mousemove",F,!1);if(JSG.touchDevice){this.canvas.addEventListener("touchstart",c,!0);this.canvas.addEventListener("touchmove",c,!0);this.canvas.addEventListener("touchend",c,!0);this.canvas.addEventListener("touchcancel",t,!0);var C=Hammer(this.canvas,{transform_min_rotation:5,transform_min_scale:0.1,tap_max_touchtime:2500,hold_timeout:2500});C.on("dragstart",f);C.on("drag",g);C.on("dragend",
l);C.on("tap",h);C.on("doubletap",m);C.on("hold",e);C.on("rotate",q);C.on("pinch",p);C.on("swipe",s);C.on("touch",d);C.on("transformstart",k);C.on("transform",n);C.on("transformend",u)}this.canvas.addEventListener("contextmenu",K,!1);this.canvas.addEventListener(JSG.isFF?"DOMMouseScroll":"mousewheel",L,!1);this.canvas.addEventListener("dblclick",J,!1);this.canvas.addEventListener("dragenter",w,!1);this.canvas.addEventListener("dragover",v,!1);this.canvas.addEventListener("dragleave",A,!1);this.canvas.addEventListener("dragexit",
D,!1);this.canvas.addEventListener("drop",z,!1);this.canvas.addEventListener("keyup",N,!1);this.canvas.addEventListener("keydown",M,!1);this.currentEvent=0;this._lastClick=(new Date).getTime();this._dblClk=!1;this.removeEventListeners=function(){var a=r.canvas;a.removeEventListener("mousedown",x,!1);a.removeEventListener("mousemove",F,!1);JSG.touchDevice&&(a.removeEventListener("touchstart",c,!1),a.removeEventListener("touchmove",c,!1),a.removeEventListener("touchcancel",t,!1),a.removeEventListener("touchend",
c,!1),C.off("dragstart",f),C.off("drag",g),C.off("dragend",l),C.off("tap",h),C.off("doubletap",m),C.off("hold",e),C.off("rotate",q),C.off("pinch",p),C.off("swipe",s),C.off("transformstart",k),C.off("transform",n),C.off("transformend",u));a.removeEventListener("contextmenu",K,!1);a.removeEventListener(JSG.isFF?"DOMMouseScroll":"mousewheel",L,!1);a.removeEventListener("dblclick",J,!1);a.removeEventListener("dragenter",w,!1);a.removeEventListener("dragover",v,!1);a.removeEventListener("dragleave",A,
!1);a.removeEventListener("dragexit",D,!1);a.removeEventListener("drop",z,!1);a.removeEventListener("keyup",N,!1);a.removeEventListener("keydown",M,!1);JSG.debug.USE_DOC_DISPATCHER?(JSG.ui.graphics.DocumentEventDispatcher.removeEventListener("onmouseup",this),JSG.ui.graphics.DocumentEventDispatcher.removeEventListener("onmousemove",this)):(document.onmouseup=void 0,document.onmousemove=void 0)};var O=!!("ontouchstart"in window)||!!("msmaxtouchpoints"in window.navigator)};
JSG.ui.graphics.GraphicSystem.prototype={setCoordinateSystem:function(a){this.graphics.setCoordinateSystem(a)},getGraphics:function(){return this.graphics},getGraphicsContext:function(){return this.graphics.getContext()},getCanvas:function(){return this.canvas},getSize:function(a){return(void 0!=a?a:new JSG.geometry.Point(0,0)).set(this.canvas.width,this.canvas.height)},resize:function(a,b){this.interactionHandler&&this.interactionHandler.handleResizeCanvas(a,b);this.canvas.width=a;this.canvas.height=
b;this.paint()},setContent:function(a){this.root=a;this.paint()},getCursor:function(){return this.canvas.style.cursor},setCursor:function(a){this.canvas.style.cursor=a},paint:function(a){if(!JSG.drawingDisabled||a)this.graphics._context2D.setTransform(1,0,0,1,0,0),this.graphics._context2D.clearRect(0,0,this.canvas.width,this.canvas.height),this.root.draw(this.graphics);JSG.debug.DUMP_CACHE_SIZE&&(JSG.debug.log("size of caches after paint:",!0),JSG.debug.log("\tbox cache: "+JSG.boxCache.boxes.length+
" -\x3e in use: "+JSG.boxCache.inUse(),!0),JSG.debug.log("\trect cache: "+JSG.rectCache.rects.length+" -\x3e in use: "+JSG.rectCache.inUse(),!0),JSG.debug.log("\tpoint cache: "+JSG.ptCache.points.length+" -\x3e in use: "+JSG.ptCache.inUse(),!0))},_paint2:function(a){!1===this._isPainting?(this._isPainting=!0,this._requestRepaint=!1,JSG.drawingDisabled&&!a||this.root.draw(this.graphics),this._isPainting=!1):this._requestRepaint=!0;!1===this._isPainting&&!0===this._requestRepaint&&this.paint()},setInteractionHandler:function(a){this.interactionHandler&&
this.interactionHandler.unregisterGraphicSystem();(this.interactionHandler=a)&&this.interactionHandler.registerGraphicSystem(this)},onKeyEvent:function(a,b){var c=JSG.ui.events.KeyEvent.fromEvent(this.canvas,a,b);c.cs=this.graphics.getCoordinateSystem();this._notifyKeyEvent(c);c.doRepaint&&this.paint();c.doPreventDefault&&a.preventDefault&&a.preventDefault();return c},_notifyKeyEvent:function(a){a.location.x=this.graphics.getCoordinateSystem().deviceToLogX(a.location.x);a.location.y=this.graphics.getCoordinateSystem().deviceToLogY(a.location.y);
this.interactionHandler?this.interactionHandler.handleKeyEvent(a):this.root.handleKeyEvent(a)},destroy:function(){this.removeEventListeners();this.setInteractionHandler(void 0);this.graphics=this.root=void 0}};JSG.namespace("JSG.ui");JSG.ui.View=function(){this._subviews=[];this._parent=void 0;this._isVisible=!0;this._resizeListeners=[];this._valid=!0};
JSG.ui.View.prototype.copy=function(){for(var a=newInstance(),b=0,c=this._subviews.length;b<c;b++){var d=this._subviews[b].copy();a.addView(d)}a._parent=ths._parent;a._isVisible=this._isVisible;return a};JSG.ui.View.prototype.newInstance=function(){return new JSG.ui.View};JSG.ui.View.prototype.getParent=function(){return this._parent};JSG.ui.View.prototype.addView=function(a,b){void 0==b?this._subviews.push(a):this._subviews.insert(a,b);a._parent=this;return a};JSG.ui.View.prototype.removeView=function(a){return this._subviews.remove(a)};
JSG.ui.View.prototype.removeAllViews=function(){this._subviews=[]};JSG.ui.View.prototype.hasSubviews=function(){return 0<this._subviews.length};JSG.ui.View.prototype.getSubviews=function(){return this._subviews};JSG.ui.View.prototype.getSubviewAt=function(a){return this._subviews[a]};JSG.ui.View.prototype.invalidate=function(){this._valid=!1;for(var a=0,b=this._subviews.length;a<b;a++)this._subviews[a].layout();this.layout()};
JSG.ui.View.prototype.revalidate=function(){this.invalidate();void 0!=this._parent&&this._parent.revalidate()};JSG.ui.View.prototype.validate=function(){if(!this.isValid()){this._valid=!0;this.relayout();for(var a=0,b=this._subviews.length;a<b;a++)this._subviews[a].validate()}};JSG.ui.View.prototype.relayout=function(){};JSG.ui.View.prototype.setValid=function(a){this._valid=!0===a};JSG.ui.View.prototype.isValid=function(){return this._valid};JSG.ui.View.prototype.isVisible=function(){return this._isVisible};
JSG.ui.View.prototype.setVisible=function(a){this._isVisible=a};JSG.ui.View.prototype.getBoundingBox=function(){};JSG.ui.View.prototype.getAngle=function(){return 0};JSG.ui.View.prototype.containsPoint=function(a,b){return!1};JSG.ui.View.prototype.layout=function(){};JSG.ui.View.prototype.draw=function(a){};JSG.ui.View.prototype.drawSubViews=function(a){for(var b=0,c=this._subviews.length;b<c;b++)this._subviews[b].draw(a)};JSG.ui.View.prototype.translateFromParent=function(a){return a};
JSG.ui.View.prototype.translateToParent=function(a){return a};JSG.ui.View.prototype.handleMouseEvent=function(a){for(var b=0,c=this._subviews.length;b<c;b++)this._subviews[b].handleMouseEvent(a)};JSG.ui.View.prototype.handleDragEvent=function(a){for(var b=!1,c=0,d=this._subviews.length;c<d&&!b;c++)b|=this._subviews[c].handleDragEvent(a);return b};JSG.ui.View.prototype.handleKeyEvent=function(a){for(var b=!1,c=0,d=this._subviews.length;c<d&&!b;c++)b|=this._subviews[c].handleKeyEvent(a);return b};
JSG.ui.View.prototype.addResizeListener=function(a){this._resizeListeners.push(a)};JSG.ui.View.prototype.removeResizeListener=function(a){this._resizeListeners.remove(a)};JSG.ui.View.prototype._fireOnResize=function(){var a=this;this._resizeListeners.forEach(function(b,c,d){b.onResize(a)})};JSG.ui.View.prototype.getIndex=function(){return this._parent?index=this._parent._subviews.indexOf(this):void 0};
JSG.ui.View.prototype.moveToIndex=function(a){var b=this._parent._subviews.indexOf(this);this._parent._subviews.move(b,a)};JSG.ui.View.prototype.moveToTop=function(){var a=this._parent._subviews.indexOf(this);this._parent._subviews.move(a,this._parent._subviews.length-1)};JSG.ui.View.prototype.moveUp=function(){var a=this._parent._subviews.indexOf(this);a<this._parent._subviews.length-1&&this._parent._subviews.move(a,a+1)};
JSG.ui.View.prototype.moveToBottom=function(){var a=this._parent._subviews.indexOf(this);this._parent._subviews.move(a,0)};JSG.ui.View.prototype.moveDown=function(){var a=this._parent._subviews.indexOf(this);0<a&&this._parent._subviews.move(a,a-1)};JSG.namespace("JSG.graph.expr");JSG.graph.expr.Operand=function(a,b){this.type=b;this.value=a};JSG.graph.expr.Operand.NUMBER=1;JSG.graph.expr.Operand.STRING=2;JSG.graph.expr.Operand.REFERENCE=4;
JSG.graph.expr.Operand.fromString=function(a,b,c){b=JSG.graph.expr.Reference.fromString(a,b,c);if(void 0!=b)return new JSG.graph.expr.Operand(b,JSG.graph.expr.Operand.REFERENCE);if(0<a.length)return isNaN(a)?new JSG.graph.expr.Operand(a,JSG.graph.expr.Operand.STRING):new JSG.graph.expr.Operand(Number(a),JSG.graph.expr.Operand.NUMBER)};
JSG.graph.expr.Operand.prototype.copy=function(){var a=new JSG.graph.expr.Operand(this.value,this.type);this.type==JSG.graph.expr.Operand.REFERENCE&&(a.value=this.value.copy());return a};JSG.graph.expr.Operand.prototype.isEqualTo=function(a){return void 0!=a&&this.type===a.type&&this.value===a.value};JSG.graph.expr.Operand.prototype.setTo=function(a){this.set(a.value,a.type)};JSG.graph.expr.Operand.prototype.set=function(a,b){this.type=b;this.value=b==JSG.graph.expr.Operand.REFERENCE?a.copy():a};
JSG.graph.expr.Operand.prototype.isOperand=function(){return!0};JSG.graph.expr.Operand.prototype.getValue=function(){return this.type==JSG.graph.expr.Operand.REFERENCE?this.value.getValue():this.value};JSG.graph.expr.Operand.prototype.toString=function(a){return this.type==JSG.graph.expr.Operand.REFERENCE?this.value.toString(a):this.value.toString()};JSG.graph.expr.StringConstant=function(a){JSG.graph.expr.StringConstant._super.constructor.call(this,a,JSG.graph.expr.Operand.STRING)};
JSG.extend(JSG.graph.expr.StringConstant,JSG.graph.expr.Operand);JSG.graph.expr.StringConstant.ENCODING="%22";JSG.graph.expr.StringConstant.ENCODE_REGEX=/"/g;JSG.graph.expr.StringConstant.DECODE_REGEX=RegExp(JSG.graph.expr.StringConstant.ENCODING,"gi");JSG.graph.expr.StringConstant.isStringConstant=function(a){return String.isString(a)?a.startsWith('"')&&a.endsWith('"')||a.startsWith(JSG.graph.expr.StringConstant.ENCODING)&&a.endsWith(JSG.graph.expr.StringConstant.ENCODING):!1};
JSG.graph.expr.StringConstant.encode=function(a){return a.encode()};JSG.graph.expr.StringConstant.decode=function(a){return a.decode()};JSG.graph.expr.StringConstant.prototype.copy=function(){return new JSG.graph.expr.StringConstant(this.value)};JSG.graph.expr.StringConstant.prototype.setTo=function(a){a instanceof JSG.graph.expr.StringConstant&&this.set(a.value)};JSG.graph.expr.StringConstant.prototype.set=function(a){String.isString(a)&&(this.value=a)};
JSG.graph.expr.StringConstant.prototype.toString=function(a){return JSG.graph.expr.StringConstant.ENCODING+this.value.toString()+JSG.graph.expr.StringConstant.ENCODING};JSG.namespace("JSG.graph.expr.Operator");JSG.graph.expr.Operator=function(a,b){this.priority=b;this.asString=a};JSG.graph.expr.Operator.prototype.isOperand=function(){return!1};
JSG.graph.expr.Operators=function(){function a(a){b.put(a.asString,a)}var b=new JSG.commons.Map;a(new JSG.graph.expr.Operator("+",2));a(new JSG.graph.expr.Operator("-",2));a(new JSG.graph.expr.Operator("*",4));a(new JSG.graph.expr.Operator("/",4));a(new JSG.graph.expr.Operator("(",0));a(new JSG.graph.expr.Operator(")",0));return{isOperator:function(a){return b.contains(a)},fromString:function(a){return b.get(a)}}}();JSG.namespace("JSG.graph.expr");
JSG.graph.expr.Reference=function(a,b,c){this._item=a;this._property=b;this._propertyObject=c};JSG.graph.expr.Reference.ID_KEY="#";JSG.graph.expr.Reference.fromString=function(a,b,c){var d=c;if(a.startsWith("Item.")&&void 0!=b){var e=a.indexOf("!");c=a.substring(5,e);d=b.getItemById(c);a=a.substring(e+1)}else a.startsWith("Parent")&&(e=a.indexOf("!"),void 0!=c&&(d=c.getParent(),a=a.substring(e+1)));b=d;if(void 0!=b)return a=a.toUpperCase(),this.getReference(b,a)};
JSG.graph.expr.Reference.getReference=function(a,b){var c=JSG.graph.properties.PropertiesProvider.getProperties(a);if(void 0!=c&&(c=c.getProperty(b),void 0!=c))return new JSG.graph.expr.Reference(a,c,a);c=JSG.graph.properties.PropertiesProvider.getFormatProperties();if(void 0!=c&&(c=c.getProperty(b),void 0!=c))return new JSG.graph.expr.Reference(a,c,a.getFormat());c=JSG.graph.properties.PropertiesProvider.getTextFormatProperties();if(void 0!=c&&(c=c.getProperty(b),void 0!=c))return new JSG.graph.expr.Reference(a,
c,a._getTextFormat());c=JSG.graph.properties.PropertiesProvider.getItemAttributesProperties();if(void 0!=c&&(c=c.getProperty(b),void 0!=c))return new JSG.graph.expr.Reference(a,c,a.getAttributes());c=JSG.graph.properties.PropertiesProvider.getReshapeProperties(a);if(void 0!=c&&(c=c.getProperty(b),void 0!=c))return new JSG.graph.expr.Reference(a,c,a);c=a.getAttributeAtPath(b);if(void 0!=c)return new JSG.graph.expr.AttributeReference(a,c)};
JSG.graph.expr.Reference.prototype.copy=function(){return new JSG.graph.expr.Reference(this._item,this._property,this._propertyObject)};JSG.graph.expr.Reference.prototype.getValue=function(){var a=this._property.getValue(this._propertyObject);return a&&a.getValue?a.getValue():a};JSG.graph.expr.Reference.prototype.toString=function(a){var b=this._getPropertyString();return void 0==a?"Item."+this._item.getId()+"!"+b:a==this._item?b:a._parent==this._item?"Parent!"+b:"Item."+this._item.getId()+"!"+b};
JSG.graph.expr.Reference.prototype._getPropertyString=function(){return this._property.id};JSG.namespace("JSG.graph.expr");JSG.graph.expr.AttributeReference=function(a,b){JSG.graph.expr.AttributeReference._super.constructor.call(this,a);this._item=a;this._attribute=b};JSG.extend(JSG.graph.expr.AttributeReference,JSG.graph.expr.Reference);JSG.graph.expr.AttributeReference.prototype.copy=function(){return new JSG.graph.expr.AttributeReference(this._item,this._attribute)};
JSG.graph.expr.AttributeReference.prototype.getAttributeOwner=function(){return this._item};JSG.graph.expr.AttributeReference.prototype.getAttribute=function(){return this._attribute};JSG.graph.expr.AttributeReference.prototype.getValue=function(){return void 0!=this._attribute?this._attribute.getValue():JSG.graph.expr.AttributeReference._super.getValue.call(this)};JSG.graph.expr.AttributeReference.prototype._getPropertyString=function(){return void 0!=this._attribute?this._attribute.getPath():""};
JSG.namespace("JSG.graph.expr");JSG.graph.expr.Term=function(a,b,c){this.type="term";this._operand=a;this.setLeft(b);this.setRight(c);this._constraint=void 0};JSG.graph.expr.Term.fromNumber=function(a){return new JSG.graph.expr.Term(new JSG.graph.expr.Operand(a,JSG.graph.expr.Operand.NUMBER))};JSG.graph.expr.Term.fromString=function(a){return new JSG.graph.expr.Term(new JSG.graph.expr.Operand(a,JSG.graph.expr.Operand.STRING))};
JSG.graph.expr.Term.fromReference=function(a){return new JSG.graph.expr.Term(new JSG.graph.expr.Operand(a,JSG.graph.expr.Operand.REFERENCE))};JSG.graph.expr.Term.prototype.newInstance=function(){return new JSG.graph.expr.Term};JSG.graph.expr.Term.prototype.copy=function(){var a=this.newInstance();a.setTo(this);a.setConstraint(void 0!=this._constraint?this._constraint.copy():void 0);return a};
JSG.graph.expr.Term.prototype.isEqualTo=function(a){if(void 0!=a){var b=void 0!=this._left?this._left.isEqualTo(a._left):void 0==a._left;return(b=b&&(void 0!=this._right?this._right.isEqualTo(a._right):void 0==a._right))&&(void 0!=this._operand?this._operand.isEqualTo(a._operand):void 0==a._operand)}return!1};JSG.graph.expr.Term.prototype.setConstraint=function(a){this._constraint=a};
JSG.graph.expr.Term.prototype.setTo=function(a){void 0!=a&&(this.setLeft(a._left),this.setRight(a._right),this._operand=void 0,void 0!=a._operand&&(this._operand=a._operand.copy()))};JSG.graph.expr.Term.prototype.setLeft=function(a){this._setTerm("_left",a)};JSG.graph.expr.Term.prototype.setRight=function(a){this._setTerm("_right",a)};JSG.graph.expr.Term.prototype._setTerm=function(a,b){this[a]=void 0;void 0!=b&&(this[a]=b.copy())};JSG.graph.expr.Term.prototype.getTerm=function(a){return this[a]};
JSG.graph.expr.Term.prototype.getLeft=function(){return this.getTerm("_left")};JSG.graph.expr.Term.prototype.getRight=function(){return this.getTerm("_right")};JSG.graph.expr.Term.prototype.getOperand=function(){return this._operand};JSG.graph.expr.Term.prototype.getValue=function(){return this._getValue(this._constraint)};JSG.graph.expr.Term.prototype._getValue=function(a){var b=void 0!=this._operand?this._operand.getValue():0;return void 0!=a?a.getValue(b):b};
JSG.graph.expr.Term.prototype.toString=function(a){return void 0!=this._operand?this._operand.toString(a):"undefined"};JSG.graph.expr.Term.prototype.toStringWithBrackets=function(a){a=this.toString(a);void 0==this._operand&&(a="("+a+")");return a};JSG.graph.expr.Term.Add=function(a,b){JSG.graph.expr.Term.Add._super.constructor.call(this,void 0,a,b);this.type="add"};JSG.extend(JSG.graph.expr.Term.Add,JSG.graph.expr.Term);JSG.graph.expr.Term.Add.prototype.newInstance=function(){return new JSG.graph.expr.Term.Add};
JSG.graph.expr.Term.Add.prototype._getValue=function(a){var b=this._left.getValue(),c=this._right.getValue();return void 0!=a?a.add(b,c):b+c};JSG.graph.expr.Term.Add.prototype.toString=function(a){return this._left.toStringWithBrackets(a)+" + "+this._right.toStringWithBrackets(a)};JSG.graph.expr.Term.Sub=function(a,b){JSG.graph.expr.Term.Sub._super.constructor.call(this,void 0,a,b);this.type="sub"};JSG.extend(JSG.graph.expr.Term.Sub,JSG.graph.expr.Term);
JSG.graph.expr.Term.Sub.prototype.newInstance=function(){return new JSG.graph.expr.Term.Sub};JSG.graph.expr.Term.Sub.prototype._getValue=function(a){var b=this._left.getValue(),c=this._right.getValue();return void 0!=a?a.sub(b,c):b-c};JSG.graph.expr.Term.Sub.prototype.toString=function(a){return this._left.toStringWithBrackets(a)+" - "+this._right.toStringWithBrackets(a)};JSG.graph.expr.Term.Mul=function(a,b){JSG.graph.expr.Term.Mul._super.constructor.call(this,void 0,a,b);this.type="mul"};
JSG.extend(JSG.graph.expr.Term.Mul,JSG.graph.expr.Term);JSG.graph.expr.Term.Mul.prototype.newInstance=function(){return new JSG.graph.expr.Term.Mul};JSG.graph.expr.Term.Mul.prototype._getValue=function(a){var b=this._left.getValue(),c=this._right.getValue();return void 0!=a?a.mul(b,c):b*c};JSG.graph.expr.Term.Mul.prototype.toString=function(a){return this._left.toStringWithBrackets(a)+" * "+this._right.toStringWithBrackets(a)};
JSG.graph.expr.Term.Div=function(a,b){JSG.graph.expr.Term.Div._super.constructor.call(this,void 0,a,b);this.type="div"};JSG.extend(JSG.graph.expr.Term.Div,JSG.graph.expr.Term);JSG.graph.expr.Term.Div.prototype.newInstance=function(){return new JSG.graph.expr.Term.Div};JSG.graph.expr.Term.Div.prototype._getValue=function(a){if(void 0==this._left||void 0==this._right)return 0;var b=this._left.getValue(),c=this._right.getValue();return void 0!=a?a.div(b,c):0!=c?b/c:0};
JSG.graph.expr.Term.Div.prototype.toString=function(a){return this._left.toStringWithBrackets(a)+" / "+this._right.toStringWithBrackets(a)};JSG.graph.expr.Term.Bool=function(a,b){JSG.graph.expr.Term.Bool._super.constructor.call(this,void 0,a,b);this.type="bool"};JSG.extend(JSG.graph.expr.Term.Bool,JSG.graph.expr.Term);
JSG.graph.expr.Term.Bool.createFrom=function(a,b,c){b=new JSG.graph.expr.Term.Bool(b,c);b._getBoolValue=JSG.graph.expr.Term.Bool._createBoolFuncFrom(a)||b._getBoolValue;b._operator=a;return b};
JSG.graph.expr.Term.Bool._createBoolFuncFrom=function(a){var b=void 0,c=JSG.graph.expr.Term.Bool;switch(a){case "!":b=c._not;break;case "!\x3d":b=c._notEqual;break;case "\x3d\x3d":b=c._equal;break;case "\x3e":b=c._greater;break;case "\x3e\x3d":b=c._greaterEqual;break;case "\x3c":b=c._less;break;case "\x3c\x3d":b=c._lessEqual;break;case "\x26":b=c._and;break;case "|":b=c._or}return b};
JSG.graph.expr.Term.Bool.prototype.newInstance=function(){var a=new JSG.graph.expr.Term.Bool;a._getBoolValue=this._getBoolValue;a._operator=this._operator;return a};JSG.graph.expr.Term.Bool._not=function(a,b,c){return void 0!=c?c.not(a):!a};JSG.graph.expr.Term.Bool._equal=function(a,b,c){return void 0!=c?c.equal(a,b):a==b};JSG.graph.expr.Term.Bool._notEqual=function(a,b,c){return void 0!=c?c.notEqual(a,b):a!=b};JSG.graph.expr.Term.Bool._greater=function(a,b,c){return void 0!=c?c.greater(a,b):a>b};
JSG.graph.expr.Term.Bool._greaterEqual=function(a,b,c){return void 0!=c?c.greaterEqual(a,b):a>=b};JSG.graph.expr.Term.Bool._less=function(a,b,c){return void 0!=c?c.less(a,b):a<b};JSG.graph.expr.Term.Bool._lessEqual=function(a,b,c){return void 0!=c?c.lessEqual(a,b):a<=b};JSG.graph.expr.Term.Bool._and=function(a,b,c){return void 0!=c?c.and(a,b):a&&b};JSG.graph.expr.Term.Bool._or=function(a,b,c){return void 0!=c?c.or(a,b):a||b};
JSG.graph.expr.Term.Bool.prototype._getValue=function(a){var b=void 0!=this._left?this._left.getValue():void 0,c=void 0!=this._right?this._right.getValue():void 0;return this._getBoolValue(b,c,a)};JSG.graph.expr.Term.Bool.prototype._getBoolValue=function(a,b,c){return!0};JSG.graph.expr.Term.Bool.prototype.toString=function(a){return this._left.toStringWithBrackets(a)+this._operator+this._right.toStringWithBrackets(a)};
JSG.graph.expr.Term.Cond=function(a,b,c){JSG.graph.expr.Term.Cond._super.constructor.call(this,void 0,b,c);this.type="cond";this._condition=a};JSG.extend(JSG.graph.expr.Term.Cond,JSG.graph.expr.Term);JSG.graph.expr.Term.Cond.prototype.newInstance=function(){var a=new JSG.graph.expr.Term.Cond;a._setTerm("_condition",this._condition);return a};JSG.graph.expr.Term.Cond.prototype.getValue=function(){return this._condition.getValue()?this._left.getValue():this._right.getValue()};
JSG.graph.expr.Term.Cond.prototype.isEqualTo=function(a){return JSG.graph.expr.Term.Cond._super.isEqualTo.call(this,a)&&(void 0!=this._condition?this._condition.isEqualTo(a._condition):void 0==a._condition)};JSG.graph.expr.Term.Cond.prototype.setCondition=function(a){this._setTerm("_condition",a)};JSG.graph.expr.Term.Cond.prototype.getCondition=function(){return this.getTerm("_condition")};
JSG.graph.expr.Term.Cond.prototype.setTo=function(a){JSG.graph.expr.Term.Cond._super.setTo.call(this,a);this._setTerm("_condition",a._condition)};JSG.graph.expr.Term.Cond.prototype.toString=function(a){return"?("+this._condition.toStringWithBrackets(a)+" , "+this._left.toStringWithBrackets(a)+" , "+this._right.toStringWithBrackets(a)+")"};JSG.namespace("JSG.graph.expr");
JSG.graph.expr.Expression=function(a,b,c){this._isLocked=!1;this._constraint=new JSG.graph.expr.ExpressionConstraint;this._formula=this._value=this._term=void 0;this.set(a,b,c);this._isDirty=!1;this._ctxtPath=void 0};JSG.graph.expr.Expression.prototype.newInstance=function(){return new JSG.graph.expr.Expression};
JSG.graph.expr.Expression.prototype.copy=function(){var a=this.newInstance(),b=void 0!=this._formula?this._formula:void 0!=this._term?this._term.toString():void 0;a.set(this.getValue(),b);a._constraint=void 0!=this._constraint?this._constraint.copy():void 0;return a};JSG.graph.expr.Expression.prototype.isEqualTo=function(a){return void 0!=a?this._formula===a._formula&&this.isValueEqualTo(a._value):!1};
JSG.graph.expr.Expression.prototype.isEqualToExpressionOrValue=function(a){return a instanceof JSG.graph.expr.Expression?this.isEqualTo(a):void 0==this._formula?this.isValueEqualTo(a):!1};JSG.graph.expr.Expression.prototype.isValueEqualTo=function(a){return this._value===a};JSG.graph.expr.Expression.prototype.getPureValue=function(){return this.getValue()};
JSG.graph.expr.Expression.prototype.getValue=function(){if(void 0!=this._term){var a=this._term.getValue();void 0==a?this._term=void 0:this._value=a}return this._value};JSG.graph.expr.Expression.prototype.getFormula=function(){return this._formula};JSG.graph.expr.Expression.prototype.getTerm=function(){return this._term};JSG.graph.expr.Expression.prototype.getConstraint=function(){return this._constraint};JSG.graph.expr.Expression.prototype.isLocked=function(){return this._isLocked};
JSG.graph.expr.Expression.prototype.setLocked=function(a){return this._isLocked!==a?(this._isLocked=a,!0):!1};JSG.graph.expr.Expression.prototype.hasFormula=function(){return void 0!=this._formula};JSG.graph.expr.Expression.prototype.hasTerm=function(){return void 0!=this._term};JSG.graph.expr.Expression.prototype.setConstraint=function(a){return void 0!=a&&this._constraint!==a?(this._constraint=a,void 0!=this._term&&this._term.setConstraint(this._constraint),!0):!1};
JSG.graph.expr.Expression.prototype.setValue=function(a){return this._isLocked||this.isValueEqualTo(a)?!1:(this._value=a,!0)};JSG.graph.expr.Expression.prototype.setFormula=function(a){return this._isLocked||this._formula==a?!1:(this._formula=a,this._isDirty=!0)};
JSG.graph.expr.Expression.prototype.setTerm=function(a){return this._isLocked||(void 0!=this._term?this._term.isEqualTo(a):void 0==a)?!1:(this._isDirty=void 0!=this._formula,void 0!=a&&a?(this._term=a.copy(),this._term.setConstraint(this._constraint)):this._term=void 0,!0)};JSG.graph.expr.Expression.prototype.setTo=function(a){var b=!1;void 0!=a&&(this._isLocked=!1,b=this.set(a.getValue(),a.getFormula(),a.getTerm()),this._isLocked=a._isLocked);return b};
JSG.graph.expr.Expression.prototype.set=function(a,b,c){var d=!1,d=this.setValue(a)||d,d=this.setTerm(c)||d;return d=this.setFormula(b)||d};JSG.graph.expr.Expression.prototype.setExpressionOrValue=function(a){return a instanceof JSG.graph.expr.Expression?this.setTo(a):this.set(a)};
JSG.graph.expr.Expression.prototype.evaluate=function(a){if(void 0==this._formula)this._ctxtPath=void 0;else if(this._isDirty||!this._isContextEqualTo(a)){var b=void 0!=a?a.getGraph():void 0,c=this._isLocked;this._isLocked=!1;this.setTerm(JSG.graph.expr.FormulaParser.parse(this._formula,b,a));this._isDirty=!1;this._isLocked=c}};
JSG.graph.expr.Expression.prototype._isContextEqualTo=function(a){a=void 0!=a?a.createPath():void 0;if(void 0!=a){a=a.toString();var b=this._ctxtPath==a;this._ctxtPath=a;return b}this._ctxtPath=void 0;return!1};JSG.graph.expr.Expression.prototype.resolveParentReference=function(a,b){if(void 0!=this._formula&&-1!=this._formula.toLowerCase().indexOf("parent"))if(b)this.setFormula(void 0);else if(void 0!=a){var c="Item."+this.getParent().getId();this.setFormula(this._formula.replace("Parent",c))}};
JSG.graph.expr.Expression.prototype.toString=function(a){if(void 0!=this._formula)return this._formula;if(void 0!=this._term)return this._term.toString(a);a=this.getValue();return void 0!=a?a.toString():""};JSG.graph.expr.Expression.prototype._setTerm=function(a){var b=this._isLocked;this._isLocked=!1;this.setTerm(a);this._isLocked=b};
JSG.graph.expr.Expression.prototype.saveXML=function(a,b,c){b.writeStartElement(a);void 0!=this._formula?this._writeFormulaAttribute(b):void 0!=this._term&&this._writeTermAttribute(b);this._writeValueAttribute(b,c);a=typeof this._value;"n"!=a[0]&&b.writeAttributeString("t",a[0]);this._isLocked&&b.writeAttributeString("locked","true");b.writeEndElement()};JSG.graph.expr.Expression.prototype._writeFormulaAttribute=function(a,b){b=b||this._formula;a.writeAttributeString("f",b.encode())};
JSG.graph.expr.Expression.prototype._writeTermAttribute=function(a){a.writeAttributeString("f",this._term.toString().encode())};JSG.graph.expr.Expression.prototype._writeValueAttribute=function(a,b){void 0!=this._value&&a.writeAttributeString("v",this._value.toString().encode())};JSG.graph.expr.Expression.prototype.readXML=function(a){var b=this._readValueAttribute(a),c=this._readFormulaAttribute(a);this._isLocked=!1;this.set(b,c);void 0!=a.getAttribute("locked")&&(this._isLocked=!0)};
JSG.graph.expr.Expression.prototype._readFormulaAttribute=function(a){a=a.getAttribute("f");void 0!=a&&(a=a.decode(),void 0!=JSG.connectionRestorer&&-1!=a.indexOf("Item.",0)&&JSG.connectionRestorer.expressions.push(this));return a};JSG.graph.expr.Expression.prototype._readValueAttribute=function(a){var b=a.getAttribute("t");a=a.getAttribute("v");void 0==b&&(b="number");return a=void 0!=a?"number"==b||"n"==b?Number(a):"boolean"==b||"b"==b?"true"==a?!0:!1:a.decode():Number(a)};JSG.namespace("JSG.graph.expr");
JSG.graph.expr.ExpressionProxy=function(a){this._expression=a;var b=a.getTerm(),b=void 0!=b?b.copy():void 0;JSG.graph.expr.ExpressionProxy._super.constructor.call(this,a.getValue(),a.getFormula(),b)};JSG.extend(JSG.graph.expr.ExpressionProxy,JSG.graph.expr.Expression);JSG.graph.expr.ExpressionProxy.prototype.getExpression=function(){return this._expression};JSG.graph.expr.ExpressionProxy.prototype.copy=function(){return new JSG.graph.expr.ExpressionProxy(this._expression)};
JSG.graph.expr.ExpressionProxy.prototype.isEqualTo=function(a){return this._expression.isEqualTo(a)};JSG.graph.expr.ExpressionProxy.prototype.getFormula=function(){return this._expression.getFormula()};JSG.graph.expr.ExpressionProxy.prototype.getTerm=function(){return this._expression.getTerm()};JSG.graph.expr.ExpressionProxy.prototype.getValue=function(){return this._expression.getValue()};JSG.graph.expr.ExpressionProxy.prototype.hasFormula=function(){return this._expression.hasFormula()};
JSG.graph.expr.ExpressionProxy.prototype.isLocked=function(){return this._expression.isLocked()};JSG.graph.expr.ExpressionProxy.prototype.setLocked=function(a){this._expression.setLocked(a)};JSG.graph.expr.ExpressionProxy.prototype.setConstraint=function(a){this._expression.setConstraint(a)};JSG.graph.expr.ExpressionProxy.prototype.setFormula=function(a){this._expression.setFormula(a)};JSG.graph.expr.ExpressionProxy.prototype.setTerm=function(a){this._expression.setTerm(a)};
JSG.graph.expr.ExpressionProxy.prototype.setValue=function(a){this._expression.setValue(a)};JSG.graph.expr.ExpressionProxy.prototype.evaluate=function(a){this._expression.evaluate(a)};JSG.graph.expr.ExpressionProxy.prototype.toString=function(a){return this._expression.toString(a)};JSG.graph.expr.ExpressionProxy.prototype._setTerm=function(a){this._expression._setTerm(a)};JSG.graph.expr.ExpressionProxy.prototype.saveXML=function(a,b){this._expression.saveXML(a,b)};
JSG.graph.expr.ExpressionProxy.prototype.readXML=function(a){this._expression.readXML(a)};JSG.namespace("JSG.graph.expr");JSG.graph.expr.ExpressionConstraint=function(){};JSG.graph.expr.ExpressionConstraint.prototype.copy=function(){return new JSG.graph.expr.ExpressionConstraint};JSG.graph.expr.ExpressionConstraint.prototype.isValid=function(a){return String.isString(a)||Number.isNumber(a)};
JSG.graph.expr.ExpressionConstraint.prototype.getValue=function(a){return!Number.isNumber(a)&&Number.canBeNumber(a)?Number(a):a};JSG.graph.expr.ExpressionConstraint.prototype.add=function(a,b){return a+b};JSG.graph.expr.ExpressionConstraint.prototype.sub=function(a,b){return String.isString(a)||String.isString(b)?a+"-"+b:a-b};JSG.graph.expr.ExpressionConstraint.prototype.mul=function(a,b){return String.isString(a)||String.isString(b)?this.add(a,b):a*b};
JSG.graph.expr.ExpressionConstraint.prototype.div=function(a,b){return String.isString(a)||String.isString(b)?this.sub(a,b):0!=b?a/b:0};JSG.graph.expr.ExpressionConstraint.prototype.not=function(a){return!a};JSG.graph.expr.ExpressionConstraint.prototype.equal=function(a,b){return a===b};JSG.graph.expr.ExpressionConstraint.prototype.notEqual=function(a,b){return a!=b};JSG.graph.expr.ExpressionConstraint.prototype.greater=function(a,b){return a>b};
JSG.graph.expr.ExpressionConstraint.prototype.greaterEqual=function(a,b){return a>=b};JSG.graph.expr.ExpressionConstraint.prototype.less=function(a,b){return a<b};JSG.graph.expr.ExpressionConstraint.prototype.lessEqual=function(a,b){return a<=b};JSG.graph.expr.ExpressionConstraint.prototype.and=function(a,b){return a&&b};JSG.graph.expr.ExpressionConstraint.prototype.or=function(a,b){return a||b};JSG.namespace("JSG.graph.expr");
JSG.graph.expr.BooleanExpression=function(a,b,c){JSG.graph.expr.BooleanExpression._super.constructor.call(this,a,b,c);this._constraint=new JSG.graph.expr.BooleanExpressionConstraint};JSG.extend(JSG.graph.expr.BooleanExpression,JSG.graph.expr.Expression);JSG.graph.expr.BooleanExpression.prototype.newInstance=function(){return new JSG.graph.expr.BooleanExpression};JSG.graph.expr.BooleanExpressionConstraint=function(){JSG.graph.expr.BooleanExpressionConstraint._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.expr.BooleanExpressionConstraint,JSG.graph.expr.ExpressionConstraint);JSG.graph.expr.BooleanExpressionConstraint.prototype.copy=function(){return new JSG.graph.expr.BooleanExpressionConstraint};JSG.graph.expr.BooleanExpressionConstraint.prototype.isValid=function(a){return!0==a||!1==a};JSG.graph.expr.BooleanExpressionConstraint.prototype.getValue=function(a){return!0===a||!1===a?a:Number.isNumber(a)?0===a?!1:!0:String.isString(a)?""===a?!1:!0:!1};
JSG.graph.expr.BooleanExpressionConstraint.prototype.getNumericValue=function(a){return this.getValue()?1:0};JSG.graph.expr.BooleanExpressionConstraint.prototype.add=function(a,b){return this.getNumericValue(a)+this.getNumericValue(b)};JSG.graph.expr.BooleanExpressionConstraint.prototype.sub=function(a,b){return this.getNumericValue(a)-this.getNumericValue(b)};JSG.graph.expr.BooleanExpressionConstraint.prototype.mul=function(a,b){return this.getNumericValue(a)*this.getNumericValue(b)};
JSG.graph.expr.BooleanExpressionConstraint.prototype.div=function(a,b){return 0!=this.getNumericValue(b)?this.getNumericValue(a)/this.getNumericValue(b):0};JSG.namespace("JSG.graph.expr");JSG.graph.expr.NumberExpression=function(a,b,c){JSG.graph.expr.NumberExpression._super.constructor.call(this,a,b,c);this._constraint=new JSG.graph.expr.NumberExpressionConstraint};JSG.extend(JSG.graph.expr.NumberExpression,JSG.graph.expr.Expression);JSG.graph.expr.NumberExpression.prototype.newInstance=function(){return new JSG.graph.expr.NumberExpression};
JSG.graph.expr.NumberExpression.prototype.isValueEqualTo=function(a){return void 0==this._value?void 0==a:this._value.isEqual(a,1E-6)};JSG.graph.expr.NumberExpression.prototype.setValue=function(a){Number.isNumber(a)||(a=Number.canBeNumber(a)?Number(a):!1===a?0:!0===a?1:void 0);return JSG.graph.expr.NumberExpression._super.setValue.call(this,a)};
JSG.graph.expr.NumberExpression.prototype._writeValueAttribute=function(a,b){a.writeAttributeString("v",this._value.toFixed(void 0==b?this._constraint.decimals:b))};JSG.graph.expr.NumberExpressionConstraint=function(){JSG.graph.expr.NumberExpressionConstraint._super.constructor.apply(this,arguments);this.decimals=0};JSG.extend(JSG.graph.expr.NumberExpressionConstraint,JSG.graph.expr.ExpressionConstraint);
JSG.graph.expr.NumberExpressionConstraint.prototype.copy=function(){var a=new JSG.graph.expr.NumberExpressionConstraint;a.decimals=this.decimals;return a};JSG.graph.expr.NumberExpressionConstraint.prototype.isValid=function(a){return Number.isNumber(a)};JSG.graph.expr.NumberExpressionConstraint.prototype.getValue=function(a){return Number.isNumber(a)?a:Number.canBeNumber(a)?Number(a):0};JSG.graph.expr.NumberExpressionConstraint.prototype.add=function(a,b){return a+b};
JSG.graph.expr.NumberExpressionConstraint.prototype.sub=function(a,b){return a-b};JSG.graph.expr.NumberExpressionConstraint.prototype.mul=function(a,b){return a*b};JSG.graph.expr.NumberExpressionConstraint.prototype.div=function(a,b){return 0!=b?a/b:0};JSG.namespace("JSG.graph.expr");JSG.graph.expr.StringExpression=function(a,b,c){JSG.graph.expr.StringExpression._super.constructor.call(this,a,b,c);this._constraint=new JSG.graph.expr.StringExpressionConstraint};
JSG.extend(JSG.graph.expr.StringExpression,JSG.graph.expr.Expression);JSG.graph.expr.StringExpression.prototype.newInstance=function(){return new JSG.graph.expr.StringExpression};JSG.graph.expr.StringExpressionConstraint=function(){JSG.graph.expr.StringExpressionConstraint._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.expr.StringExpressionConstraint,JSG.graph.expr.ExpressionConstraint);JSG.graph.expr.StringExpressionConstraint.prototype.copy=function(){return new JSG.graph.expr.StringExpressionConstraint};
JSG.graph.expr.StringExpressionConstraint.prototype.isValid=function(a){return String.isString(a)};JSG.graph.expr.StringExpressionConstraint.prototype.getValue=function(a){return String.isString(a)?a:""};JSG.graph.expr.StringExpressionConstraint.prototype.add=function(a,b){return a+b};JSG.graph.expr.StringExpressionConstraint.prototype.sub=function(a,b){return a};JSG.graph.expr.StringExpressionConstraint.prototype.mul=function(a,b){return this.add(a,b)};
JSG.graph.expr.StringExpressionConstraint.prototype.div=function(a,b){return this.sub(a,b)};JSG.namespace("JSG.graph.expr");JSG.graph.expr.ObjectExpression=function(a){JSG.graph.expr.ObjectExpression._super.constructor.call(this,a)};JSG.extend(JSG.graph.expr.ObjectExpression,JSG.graph.expr.Expression);JSG.graph.expr.ObjectExpression.prototype.newInstance=function(){var a=this._value&&this._value.copy?this._value.copy():this.value;return new JSG.graph.expr.ObjectExpression(a)};
JSG.graph.expr.ObjectExpression.prototype.copy=function(){return this.newInstance()};JSG.graph.expr.ObjectExpression.prototype.isEqualTo=function(a){return a?this.isValueEqualTo(a._value):!1};JSG.graph.expr.ObjectExpression.prototype.isEqualToExpressionOrValue=function(a){return a instanceof JSG.graph.expr.ObjectExpression?this.isEqualTo(a):this.isValueEqualTo(a)};JSG.graph.expr.ObjectExpression.prototype.getValue=function(){return this._value};
JSG.graph.expr.ObjectExpression.prototype.setFormula=function(a){return!1};JSG.graph.expr.ObjectExpression.prototype.setTerm=function(a){return!1};JSG.graph.expr.ObjectExpression.prototype.set=function(a,b,c){return this.setValue(a)};JSG.graph.expr.ObjectExpression.prototype.evaluate=function(a){};JSG.graph.expr.ObjectExpression.prototype.resolveParentReference=function(a,b){};
JSG.graph.expr.ObjectExpression.prototype.toString=function(a){return this._value&&this._value.toString?this._value.toString():"n.d."};JSG.graph.expr.ObjectExpression.prototype.saveXML=function(a,b){b.writeStartElement(a);this._writeValue(b);b.writeEndElement()};JSG.graph.expr.ObjectExpression.prototype._writeValue=function(a){void 0!=this._value&&(this._value.saveXML&&this._value.getClassName)&&(a.writeAttributeString("cl",this._value.getClassName()),this._value.saveXML(a))};
JSG.graph.expr.ObjectExpression.prototype.readXML=function(a){this._isLocked=!1;this.set(this._readValue(a));void 0!=a.getAttribute("locked")&&(this._isLocked=!0)};JSG.graph.expr.ObjectExpression.prototype._readValue=function(a){var b=a.getAttribute("cl");(b=JSG.createObjectFromString(b))&&b.readXML&&b.readXML(a);return b};JSG.namespace("JSG.graph.expr");JSG.graph.expr.MapExpression=function(a,b,c){JSG.graph.expr.MapExpression._super.constructor.call(this);this._value=new JSG.commons.Map};
JSG.extend(JSG.graph.expr.MapExpression,JSG.graph.expr.Expression);JSG.graph.expr.MapExpression.prototype.putElement=function(a,b){return this._value.put(a,b)};JSG.graph.expr.MapExpression.prototype.getElement=function(a){return this._value.get(a)};JSG.graph.expr.MapExpression.prototype.removeElement=function(a){return this._value.remove(a)};JSG.graph.expr.MapExpression.prototype.newInstance=function(){return new JSG.graph.expr.MapExpression};
JSG.graph.expr.MapExpression.prototype.copy=function(){var a=this.newInstance();this._value.iterate(function(b,c){var d=void 0!=c.copy?c.copy():c;a.putElement(b,d)});return a};JSG.graph.expr.MapExpression.prototype.isValueEqualTo=function(a){return this._value===a};JSG.graph.expr.MapExpression.prototype.getValue=function(){return this._value.elements()};JSG.graph.expr.MapExpression.prototype.iterate=function(a){this._value.iterate(a)};JSG.graph.expr.MapExpression.prototype.setConstraint=function(a){return!1};
JSG.graph.expr.MapExpression.prototype.setValue=function(a){return!1};JSG.graph.expr.MapExpression.prototype.setFormula=function(a){return!1};JSG.graph.expr.MapExpression.prototype.setTerm=function(a){return!1};JSG.graph.expr.MapExpression.prototype.setTo=function(a){return!1};JSG.graph.expr.MapExpression.prototype.set=function(a,b,c){return!1};JSG.namespace("JSG.graph.expr");JSG.graph.expr.AttributeExpression=function(a){JSG.graph.expr.AttributeExpression._super.constructor.call(this,"",a)};
JSG.extend(JSG.graph.expr.AttributeExpression,JSG.graph.expr.Expression);JSG.graph.expr.AttributeExpression.prototype.newInstance=function(){return new JSG.graph.expr.AttributeExpression};JSG.graph.expr.AttributeExpression.prototype.getAttribute=function(){var a=this._getAttributeReference();return void 0!=a?a.getAttribute():void 0};JSG.graph.expr.AttributeExpression.prototype.getAttributeOwner=function(){var a=this._getAttributeReference();return void 0!=a?a.getAttributeOwner():void 0};
JSG.graph.expr.AttributeExpression.prototype._getAttributeReference=function(){if(void 0!=this._term){var a=this._term.getOperand();if(void 0!=a&&a.value instanceof JSG.graph.expr.AttributeReference)return a.value}};JSG.graph.expr.AttributeExpression.prototype.getValue=function(){void 0!=this._term&&(this._value=this._term.getValue());return this._value};
JSG.graph.expr.AttributeExpression.prototype.saveXML=function(a,b,c){b.writeStartElement(a);void 0!=this._formula&&(a=c?this.resolveFormula(c):this._formula,this._writeFormulaAttribute(b,a));this._isLocked&&b.writeAttributeString("locked","true");b.writeEndElement()};JSG.graph.expr.AttributeExpression.prototype.resolveFormula=function(a){a="Item."+a.getParent().getId();return this._formula.replace("Parent",a)};
JSG.graph.expr.AttributeExpression.prototype.readXML=function(a){this._isLocked=!1;this.setFormula(this._readFormulaAttribute(a));void 0!=a.getAttribute("locked")&&(this._isLocked=!0)};JSG.namespace("JSG.graph.expr");JSG.graph.expr.FormulaParser=function(){};JSG.graph.expr.FormulaParser.parse=function(a,b,c){if(JSG.debug.USE_NEW_FORMULA_PARSER)return void 0!=a?JSG.graph.expr.FormulaParser2.parse(a,b,c):void 0;if(void 0!=a)return a=JSG.graph.expr.FormulaParser._toPostfix(a,b,c),JSG.graph.expr.FormulaParser._createTerm(a)};
JSG.graph.expr.FormulaParser._toPostfix=function(a,b,c){function d(a,c){var d=JSG.graph.expr.Operand.fromString(a.trim(),b,c);return d?(g.push(d),!0):!1}function e(a){if(a=JSG.graph.expr.Operators.fromString(a.trim())){h=a;if(!l.isEmpty())for(;!l.isEmpty();){var b=l.pop();if("("===b.asString){l.push(b);break}else if(b.priority<a.priority){l.push(b);break}else g.push(b)}l.push(a)}}function f(a){for(h=JSG.graph.expr.Operators.fromString(a.trim());!l.isEmpty();){a=l.pop();if("("===a.asString)break;g.push(a)}}
var g=[],l=[],h=void 0,m,k=!1,n=new StringBuffer;a=a.trim();for(var q=0,p=a.length;q<p;q++)if(m=a.charAt(q),k)'"'===m?(readString=!1,g.push(new JSG.graph.expr.StringConstant(n.toString())),n.reset()):n.append(m);else if(" "!==m)if('"'===m)k=!0;else if(JSG.graph.expr.Operators.isOperator(m))if("("===m)l.push(new JSG.graph.expr.Operators.fromString(m));else if(")"===m)d(n.toString(),c),f(m),n.reset();else{var s;if(s="-"===m)s=n.isEmpty()?g.isEmpty()&&l.isEmpty()?!0:")"!==h.asString:!1;s?n.append(m):
(d(n.toString(),c),e(m),n.reset())}else n.append(m);d(n.toString(),c);for(n.reset();!l.isEmpty();)g.push(l.pop());return g};
JSG.graph.expr.FormulaParser._createTerm=function(a){function b(a){var d=a.pop();if(void 0!=d){if(d.isOperand())a=new JSG.graph.expr.Term(d);else{var e=void 0;switch(d.asString){case "+":e=new JSG.graph.expr.Term.Add;break;case "-":e=new JSG.graph.expr.Term.Sub;break;case "*":e=new JSG.graph.expr.Term.Mul;break;case "/":e=new JSG.graph.expr.Term.Div}e.setRight(b(a));e.setLeft(b(a));a=e}return a}}return b(a)};JSG.namespace("JSG.graph.expr");
JSG.graph.expr.FormulaParser2=function(){function a(b,c,d){var e=void 0;if("unaryop"===b.type)if("-"===b.operator)var f=a(b.arg,c,d),h=new JSG.graph.expr.Term(JSG.graph.expr.Operand.fromString("-1")),e=new JSG.graph.expr.Term.Mul(h,f);else e=JSG.graph.expr.Term.Bool.createFrom(b.operator,h,f);else if("binaryop"===b.type)switch(h=a(b.left,c,d),f=a(b.right,c,d),b.operator){case "+":e=new JSG.graph.expr.Term.Add(h,f);break;case "-":e=new JSG.graph.expr.Term.Sub(h,f);break;case "*":e=new JSG.graph.expr.Term.Mul(h,
f);break;case "/":e=new JSG.graph.expr.Term.Div(h,f);break;default:e=JSG.graph.expr.Term.Bool.createFrom(b.operator,h,f)}else"condition"===b.type?(e=a(b.condition,c,d),f=a(b.onTrue,c,d),b=a(b.onFalse,c,d),e=new JSG.graph.expr.Term.Cond(e,f,b)):(b=JSG.graph.expr.Operand.fromString(b.value,c,d),e=new JSG.graph.expr.Term(b));return e}function b(a){if("unaryop"===a.type)return"!"===a.operator?!a.arg.value:"-"===a.operator?-a.arg.value:a.arg.value;if("binaryop"===a.type){var c=b(a.left),d=b(a.right);switch(a.operator){case "+":return c+
d;case "-":return c-d;case "*":return c*d;case "/":return c/d;case "\x3e":return c>d;case "\x3e\x3d":return c>=d;case "\x3c":return c<d;case "\x3c\x3d":return c<=d;case "\x3d\x3d":return c==d;case "!\x3d":return c!=d;case "|":return c||d;case "\x26":return c&&d}}else if("condition"===a.type)return b(a.condition)?b(a.onTrue):b(a.onFalse);return a.value}function c(){var a,b,c,f,h,k;g();f=e();k=d();if(void 0!=k){(h=e())||l("Missing expression after "+k,z);for(a=[f,k,h];b=d();){c=A.hasOwnProperty(b)?
A[b]:D.hasOwnProperty(b)?D[b]:0;if(0===c)break;for(;2<a.length&&c<=(A.hasOwnProperty(a[a.length-2])?A[a[a.length-2]]:D.hasOwnProperty(a[a.length-2])?D[a[a.length-2]]:0);)h=a.pop(),k=a.pop(),f=a.pop(),f={type:"binaryop",operator:k,left:f,right:h},a.push(f);(h=e())||l("Missing expression after "+k,z);a.push(b,h)}f=a[a.length-1];for(b=a.length-1;1<b;b-=2)f={type:"binaryop",operator:a[b-1],left:a[b-2],right:f}}return f}function d(){g();var a=0,b=String.fromCharCode(x);B.charCodeAt(z)==p&&(b+="\x3d",a=
1);if(A.hasOwnProperty(b)||D.hasOwnProperty(b))return z+=a,x=B.charCodeAt(z++),b}function e(){g();if(48<=x&&57>=x||x===q){for(var a="";48<=x&&57>=x;)a+=String.fromCharCode(x),x=B.charCodeAt(z++);if(x===q)for(a+=String.fromCharCode(x),x=B.charCodeAt(z++);48<=x&&57>=x;)a+=String.fromCharCode(x),x=B.charCodeAt(z++);return{type:"number",value:a}}if(x===s){var b,d;x=B.charCodeAt(z++);g();x===m?(x=B.charCodeAt(z++),a=f(!0),b=f(!0),d=f(),x!==k&&l("Expecting ')'",z),x=B.charCodeAt(z++)):l("Expecting '('",
z);return{type:"condition",condition:a,onTrue:b,onFalse:d}}if(x===h){for(a="";z<F;)if(x=B.charCodeAt(z++),x===h){x=B.charCodeAt(z++);break}else a+=String.fromCharCode(x),x===w&&(a+=B.charAt(z++));return{type:"string",value:a}}if(x===m)return x=B.charCodeAt(z++),a=c(),g(),x!==k&&l("Missing )",z),x=B.charCodeAt(z++),a;a=String.fromCharCode(x);if(v.hasOwnProperty(a))return a=String.fromCharCode(x),x=B.charCodeAt(z++),{type:"unaryop",operator:a,arg:e()};for(a=String.fromCharCode(x);z<F;){x=B.charCodeAt(z++);
b=!0;switch(x){case h:case m:case k:case n:case p:case s:case u:case t:case w:b=!1}(b=!b)||(b=B.charCodeAt(z),d=String.fromCharCode(x),b==p&&(d+="\x3d"),b=A.hasOwnProperty(d)||D.hasOwnProperty(d));if(b)break;a+=String.fromCharCode(x)}return{type:"identifier",value:a}}function f(a){var b=c();b||l("Expecting expression",z);a&&(g(),x===n?x=B.charCodeAt(z++):l("Expecting ','",z));return b}function g(){for(;z<F&&(void 0==x||x===t||x===u);)x=B.charCodeAt(z++)}function l(a,b){JSG.throwException("FormularParser Error",
a+" at index "+b)}var h=34,m=40,k=41,n=44,q=46,p=61,s=63,u=32,t=9,w=220,v={"-":12,"+":12,"!":12},A={"*":10,"/":10,"+":8,"-":8},D={"\x3e":6,"\x3e\x3d":6,"\x3c":6,"\x3c\x3d":6,"\x3d\x3d":4,"!\x3d":4,"|":2,"\x26":2},z=0,F,x,B;return{parse:function(b,d,e){B=b;x=void 0;z=0;F=b.length;b=c();return a(b,d,e)},resultOf:function(a){return b(a)}}}();JSG.namespace("JSG.graph");JSG.graph.Pin=function(a){this._item=a;this._pin=new JSG.graph.Coordinate;this._localpin=new JSG.graph.Coordinate};
JSG.graph.Pin.EventID={PIN:"pin",PINX:"pinx",PINY:"piny",LOCAL:"local",LOCALX:"localx",LOCALY:"localy"};JSG.graph.Pin.prototype.copy=function(){var a=new JSG.graph.Pin;a.setTo(this);return a};
JSG.graph.Pin.prototype.saveXML=function(a,b,c){b.writeStartElement(a);!0===c?(a=this._pin.copy(),c=this._pin.toPoint(JSG.ptCache.get()),c=this._item.getTranslatedPoint(c,this._item.getGraph()),a.getX().setValue(c.x),a.getY().setValue(c.y),a.saveXML("p",b),JSG.ptCache.release(c)):this._pin.saveXML("p",b);this._localpin.saveXML("lp",b);b.writeEndElement()};
JSG.graph.Pin.prototype.readXML=function(a){if(a){var b=findElementByTagName(a,"p"),b=b||a;void 0!=b&&this._pin.readXML(b);b=findElementByTagName(a,"lp");void 0!=b&&this._localpin.readXML(b)}};JSG.graph.Pin.prototype.evaluate=function(){this._pin.evaluate(this._item);this._localpin.evaluate(this._item)};JSG.graph.Pin.prototype.resolveParentReference=function(a){this._pin.resolveParentReference(this._item,a);this._localpin.resolveParentReference(this._item,a)};JSG.graph.Pin.prototype.lockPin=function(a){this._pin.lock(a)};
JSG.graph.Pin.prototype.lockLocalPin=function(a){this._localpin.lock(a)};JSG.graph.Pin.prototype.getX=function(){return this._pin.getX()};JSG.graph.Pin.prototype.getY=function(){return this._pin.getY()};JSG.graph.Pin.prototype.getLocalX=function(){return this._localpin.getX()};JSG.graph.Pin.prototype.getLocalY=function(){return this._localpin.getY()};JSG.graph.Pin.prototype.getPoint=function(a){a=a?a:new JSG.geometry.Point(0,0);return this._pin.toPoint(a)};
JSG.graph.Pin.prototype.getLocalPoint=function(a){a=a?a:new JSG.geometry.Point(0,0);return this._localpin.toPoint(a)};JSG.graph.Pin.prototype.getCoordinate=function(a){a=a?a:new JSG.graph.Coordinate;a.setTo(this._pin);return a};JSG.graph.Pin.prototype.getLocalCoordinate=function(a){a=a?a:new JSG.graph.Coordinate;a.setTo(this._localpin);return a};
JSG.graph.Pin.prototype.setX=function(a){this._pin.getX().isEqualToExpressionOrValue(a)||this._setInternal(JSG.graph.Pin.EventID.PINX,this._pin,this._pin.setX,a)};JSG.graph.Pin.prototype.setY=function(a){this._pin.getY().isEqualToExpressionOrValue(a)||this._setInternal(JSG.graph.Pin.EventID.PINY,this._pin,this._pin.setY,a)};
JSG.graph.Pin.prototype.setPointTo=function(a){this._pin.getX().isEqualToExpressionOrValue(a.x)&&this._pin.getY().isEqualToExpressionOrValue(a.y)||this._setInternal(JSG.graph.Pin.EventID.PIN,this._pin,this._pin.setToPoint,a)};JSG.graph.Pin.prototype.setPoint=function(a,b){this.setPointTo(new JSG.geometry.Point(a,b))};JSG.graph.Pin.prototype.setLocalX=function(a){this._localpin.getX().isEqualToExpressionOrValue(a)||this._setInternal(JSG.graph.Pin.EventID.LOCALX,this._localpin,this._localpin.setX,a)};
JSG.graph.Pin.prototype.setLocalY=function(a){this._localpin.getY().isEqualToExpressionOrValue(a)||this._setInternal(JSG.graph.Pin.EventID.LOCALY,this._localpin,this._localpin.setY,a)};JSG.graph.Pin.prototype.setLocalPointTo=function(a){this._localpin.getX().isEqualToExpressionOrValue(a.x)&&this._localpin.getY().isEqualToExpressionOrValue(a.y)||this._setInternal(JSG.graph.Pin.EventID.LOCAL,this._localpin,this._localpin.setToPoint,a)};
JSG.graph.Pin.prototype.setLocalPoint=function(a,b){this.setLocalPointTo(new JSG.geometry.Point(a,b))};JSG.graph.Pin.prototype.setCoordinateTo=function(a){this._pin.getX().isEqualTo(a.getX())&&this._pin.getY().isEqualTo(a.getY())||this._setInternal(JSG.graph.Pin.EventID.PIN,this._pin,this._pin.setTo,a)};JSG.graph.Pin.prototype.setCoordinate=function(a,b){this.setCoordinateTo(new JSG.graph.Coordinate(a,b))};
JSG.graph.Pin.prototype.setLocalCoordinateTo=function(a){this._setInternal(JSG.graph.Pin.EventID.LOCAL,this._localpin,this._localpin.setTo,a)};JSG.graph.Pin.prototype.setLocalCoordinate=function(a,b){this.setLocalCoordinateTo(new JSG.graph.Coordinate(a,b))};JSG.graph.Pin.prototype.setTo=function(a){this.setCoordinateTo(a._pin);this.setLocalCoordinateTo(a._localpin)};JSG.graph.Pin.prototype.translate=function(a,b){var c=this._pin.toPoint();c.x+=a;c.y+=b;this.setPoint(c.x,c.y)};
JSG.graph.Pin.prototype.rotate=function(a,b){if(0!=a){var c=this._pin.toPoint(),c=void 0!=b?JSG.geometry.Utils.rotatePointAround(b,c,a):JSG.geometry.Utils.rotatePoint(c,a);this.setPoint(c.x,c.y)}};
JSG.graph.Pin.prototype._setInternal=function(a,b,c,d){function e(a,b){void 0!=a&&void 0!=b&&a.sendPostEvent(b)}a=function(a,b,c){var d=void 0;void 0!=a&&(d=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.PIN,c),d.detailId=b,d.source=a,a.sendPreEvent(d));return d}(this._item,a,d);!0===(void 0!=a?a.doIt:!0)&&(c.call(b,d),e(this._item,a))};JSG.namespace("JSG.graph");
JSG.graph.Size=function(a,b){this._wExpr=new JSG.graph.expr.NumberExpression(0);this._hExpr=new JSG.graph.expr.NumberExpression(0);a&&this._wExpr.setExpressionOrValue(a);b&&this._hExpr.setExpressionOrValue(b)};JSG.graph.Size.prototype.isEqualTo=function(a){return 2===arguments.length?this._wExpr.isEqualToExpressionOrValue(arguments[0])&&this._hExpr.isEqualToExpressionOrValue(arguments[1]):void 0!=a&&this._wExpr.isEqualTo(a._wExpr)&&this._hExpr.isEqualTo(a._hExpr)};
JSG.graph.Size.prototype.copy=function(){return new JSG.graph.Size(this._wExpr.copy(),this._hExpr.copy())};JSG.graph.Size.prototype.evaluate=function(a){this._wExpr.evaluate(a);this._hExpr.evaluate(a)};JSG.graph.Size.prototype.resolveParentReference=function(a,b){this._wExpr.resolveParentReference(a,b);this._hExpr.resolveParentReference(a,b)};JSG.graph.Size.prototype.getWidth=function(){return this._wExpr};JSG.graph.Size.prototype.getHeight=function(){return this._hExpr};
JSG.graph.Size.prototype.setTo=function(a){this.set(a._wExpr,a._hExpr)};JSG.graph.Size.prototype.set=function(a,b){this.setWidth(a);this.setHeight(b)};JSG.graph.Size.prototype.setWidth=function(a){this._wExpr.setExpressionOrValue(a)};JSG.graph.Size.prototype.setHeight=function(a){this._hExpr.setExpressionOrValue(a)};JSG.graph.Size.prototype.toPoint=function(a){a=void 0!=a?a:new JSG.geometry.Point(0,0);a.x=this.getWidth().getValue();a.y=this.getHeight().getValue();return a};
JSG.graph.Size.prototype.toRectangle=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);a.width=this.getWidth().getValue();a.height=this.getHeight().getValue();return a};JSG.graph.Size.prototype.toString=function(){return"("+this.getWidth().getValue().toFixed(2)+","+this.getHeight().getValue().toFixed(2)+")"};JSG.graph.Size.prototype.saveXML=function(a,b){b.writeStartElement(a);this._wExpr.saveXML("w",b);this._hExpr.saveXML("h",b);b.writeEndElement()};
JSG.graph.Size.prototype.readXML=function(a){var b=findElementByTagName(a,"width");void 0==b&&(b=findElementByTagName(a,"w"));void 0!=b&&this._wExpr.readXML(b);b=findElementByTagName(a,"height");void 0==b&&(b=findElementByTagName(a,"h"));void 0!=b&&this._hExpr.readXML(b)};JSG.namespace("JSG.graph");JSG.graph.Coordinate=function(a,b){this._xExpression=a?a:new JSG.graph.expr.NumberExpression(0);this._yExpression=b?b:new JSG.graph.expr.NumberExpression(0)};
JSG.graph.Coordinate.fromPoint=function(a){return new JSG.graph.Coordinate.fromXY(a.x,a.y)};JSG.graph.Coordinate.fromXY=function(a,b){return new JSG.graph.Coordinate(new JSG.graph.expr.NumberExpression(a),new JSG.graph.expr.NumberExpression(b))};JSG.graph.Coordinate.fromRelativeXY=function(a,b){return new JSG.graph.Coordinate(new JSG.graph.expr.Expression(0,a+" * WIDTH"),new JSG.graph.expr.Expression(0,b+" * HEIGHT"))};
JSG.graph.Coordinate.Factory=function(){return new JSG.graph.Coordinate.fromXY(0,0)};JSG.graph.Coordinate.prototype.saveXML=function(a,b){b.writeStartElement(a);this._xExpression.saveXML("x",b);this._yExpression.saveXML("y",b);b.writeEndElement()};JSG.graph.Coordinate.prototype.readXML=function(a){var b=findElementByTagName(a,"x");void 0!=b&&this._xExpression.readXML(b);b=findElementByTagName(a,"y");void 0!=b&&this._yExpression.readXML(b)};
JSG.graph.Coordinate.prototype.isEqualTo=function(a){return 2===arguments.length?this._xExpression.isEqualToExpressionOrValue(arguments[0])&&this._yExpression.isEqualToExpressionOrValue(arguments[1]):void 0!=a&&this._xExpression.isEqualTo(a._xExpression)&&this._yExpression.isEqualTo(a._yExpression)};JSG.graph.Coordinate.prototype.copy=function(){var a=new JSG.graph.Coordinate;a.set(this._xExpression.copy(),this._yExpression.copy());return a};
JSG.graph.Coordinate.prototype.evaluate=function(a){this._xExpression.evaluate(a);this._yExpression.evaluate(a)};JSG.graph.Coordinate.prototype.resolveParentReference=function(a,b){this._xExpression.resolveParentReference(a,b);this._yExpression.resolveParentReference(a,b)};JSG.graph.Coordinate.prototype.lock=function(a){this.lockX(a);this.lockY(a)};JSG.graph.Coordinate.prototype.lockX=function(a){this._xExpression.setLocked(void 0!=a?a:!1)};
JSG.graph.Coordinate.prototype.lockY=function(a){this._yExpression.setLocked(void 0!=a?a:!1)};JSG.graph.Coordinate.prototype.getX=function(){return this._xExpression};JSG.graph.Coordinate.prototype.getY=function(){return this._yExpression};JSG.graph.Coordinate.prototype.setTo=function(a){return void 0!=a?this.set(a._xExpression,a._yExpression):!1};JSG.graph.Coordinate.prototype.setToPoint=function(a){return this.set(a.x,a.y)};
JSG.graph.Coordinate.prototype.set=function(a,b){var c=!1,c=this.setX(a)||c;return c=this.setY(b)||c};JSG.graph.Coordinate.prototype.setX=function(a){return this._xExpression.setExpressionOrValue(a)};JSG.graph.Coordinate.prototype.setY=function(a){return this._yExpression.setExpressionOrValue(a)};JSG.graph.Coordinate.prototype.translate=function(a,b){this._xExpression.set(this._xExpression.getValue()+a);this._yExpression.set(this._yExpression.getValue()+b)};
JSG.graph.Coordinate.prototype.toPoint=function(a){a=a?a:new JSG.geometry.Point(0,0);a.set(this._xExpression.getValue(),this._yExpression.getValue());return a};JSG.graph.Coordinate.prototype.toString=function(){return"("+this._xExpression.toString()+", "+this._yExpression.toString()+")"};JSG.namespace("JSG.graph");JSG.graph.CoordinateProxy=function(a){JSG.graph.CoordinateProxy._super.constructor.call(this);this._coordinate=a};JSG.extend(JSG.graph.CoordinateProxy,JSG.graph.Coordinate);
JSG.graph.CoordinateProxy.prototype.getCoordinate=function(){return this._coordinate};JSG.graph.CoordinateProxy.prototype.saveXML=function(a,b){var c=this.toPoint(JSG.ptCache.get());this._coordinate.getX().setValue(c.x);this._coordinate.getY().setValue(c.y);this._coordinate.saveXML(a,b);JSG.ptCache.release(c)};JSG.graph.CoordinateProxy.prototype.readXML=function(a){this._coordinate.readXML(a)};JSG.graph.CoordinateProxy.prototype.copy=function(){return new JSG.graph.CoordinateProxy(this._coordinate)};
JSG.graph.CoordinateProxy.prototype.evaluate=function(a){this._coordinate.evaluate(a)};JSG.graph.CoordinateProxy.prototype.lockX=function(a){this._coordinate.lockX(a)};JSG.graph.CoordinateProxy.prototype.lockY=function(a){this._coordinate.lockY(a)};JSG.graph.CoordinateProxy.prototype.getX=function(){return this._coordinate.getX()};JSG.graph.CoordinateProxy.prototype.getY=function(){return this._coordinate.getY()};JSG.graph.CoordinateProxy.prototype.setX=function(a){this._coordinate.setX(a)};
JSG.graph.CoordinateProxy.prototype.setY=function(a){this._coordinate.setY(a)};JSG.graph.CoordinateProxy.prototype.translate=function(a,b){this._coordinate.translate(a,b)};JSG.graph.CoordinateProxy.prototype.toPoint=function(a){return this._coordinate.toPoint(a)};JSG.namespace("JSG.graph");
JSG.graph.ReshapeType={XRELATIVETOWIDTH:0,XRELATIVETOHEIGHT:1,YRELATIVETOHEIGHT:2,YRELATIVETOWIDTH:3,XRELATIVETOWIDTHFROMRIGHT:4,XRELATIVETOHEIGHTFROMRIGHT:5,YRELATIVETOHEIGHTFROMBOTTOM:6,YRELATIVETOWIDTHFROMBOTTOM:7,XABSOLUTEWIDTH:8,YABSOLUTEHEIGHT:9,XABSOLUTEWIDTHFROMRIGHT:10,YABSOLUTEHEIGHTFROMBOTTOM:11};
JSG.graph.ReshapeCoordinate=function(a,b,c,d,e,f,g,l,h){JSG.graph.ReshapeCoordinate._super.constructor.apply(this,arguments);this._name=g;this._type=l;this._xMin=c;this._xMax=d;this._yMin=e;this._yMax=f;this._vertical=h};JSG.extend(JSG.graph.ReshapeCoordinate,JSG.graph.Coordinate);JSG.graph.ReshapeCoordinate.prototype.copy=function(){var a=new JSG.graph.ReshapeCoordinate;a.setTo(this);return a};
JSG.graph.ReshapeCoordinate.prototype.saveXML=function(a,b){b.writeStartElement(a);b.writeAttributeString("name",this._name);b.writeAttributeString("direction",this._vertical);b.writeAttributeString("type",this._type);this._xMin&&b.writeAttributeNumber("xMin",this._xMin,2);this._xMax&&b.writeAttributeNumber("xMax",this._xMax,2);this._yMin&&b.writeAttributeNumber("yMin",this._yMin,2);this._yMax&&b.writeAttributeNumber("yMax",this._yMax,2);this._xExpression.saveXML("x",b,2);this._yExpression.saveXML("y",
b,2);b.writeEndElement()};
JSG.graph.ReshapeCoordinate.prototype.readXML=function(a){var b=a.getAttribute("name");void 0!=b&&(this._name=b);void 0!=a.getAttribute("direction")&&(this._vertical="true"==a.getAttribute("direction")?!0:!1);b=a.getAttribute("type");void 0!=b&&(this._type=Number(b));b=a.getAttribute("xMin");this._xMin=void 0!=b?Number(b):0;b=a.getAttribute("xMax");this._xMax=void 0!=b?Number(b):0;b=a.getAttribute("yMin");this._yMin=void 0!=b?Number(b):0;b=a.getAttribute("yMax");this._yMax=void 0!=b?Number(b):0;b=
findElementByTagName(a,"x");void 0!=b&&this._xExpression.readXML(b);b=findElementByTagName(a,"y");void 0!=b&&this._yExpression.readXML(b)};JSG.graph.ReshapeCoordinate.prototype.setTo=function(a){void 0!=a&&(this.set(a._xExpression,a._yExpression),this._name=a._name,this._type=a._type,this._xMin=a._xMin,this._xMax=a._xMax,this._yMin=a._yMin,this._yMax=a._yMax,this._vertical=a._vertical)};JSG.graph.ReshapeCoordinate.prototype.getXMin=function(){return this._xMin};
JSG.graph.ReshapeCoordinate.prototype.getXMax=function(){return this._xMax};JSG.graph.ReshapeCoordinate.prototype.getYMin=function(){return this._yMin};JSG.graph.ReshapeCoordinate.prototype.getYMax=function(){return this._yMax};JSG.graph.ReshapeCoordinate.prototype.getName=function(){return this._name};JSG.graph.ReshapeCoordinate.prototype.getVertical=function(){return this._vertical};JSG.graph.ReshapeCoordinate.prototype.getType=function(){return this._type};JSG.namespace("JSG.graph");
JSG.graph.Utils=function(){};JSG.graph.Utils.traverseUp=function(a,b,c){if(a&&a!==b)for(var d=!0;d&&a&&a!==b;)d=c(a),a=a.getParent(),d=void 0!=d?d:!0};JSG.graph.Utils.traverseDown=function(a,b,c){if(a&&b&&a!==b){for(var d=[];b&&b!=a;)d.push(b),b=b._parent;a=!0;for(b=d.length-1;a&&0<=b;b--)a=c(d[b]),a=void 0!=a?a:!0}};JSG.graph.Utils.traverseItemUp=function(a,b,c){for(var d=!0;d&&a!==b&&void 0!=a;)d=c(a),a=a.getParent(),d=void 0!=d?d:!0};
JSG.graph.Utils.traverseItemDown=function(a,b,c){for(var d=[];void 0!=b&&b!==a;)d.push(b),b=b._parent;a=!0;for(b=d.length-1;a&&0<=b;b--)a=c(d[b]),a=void 0!=a?a:!0};JSG.graph.Utils.traverseItem=function(a,b,c){if(a){b.call(c||b,a);for(var d=0,e=a.getItemCount();d<e;d++)JSG.graph.Utils.traverseItem(a.getItemAt(d),b,c)}};JSG.graph.Utils.translatePointUp=function(a,b,c){JSG.graph.Utils.traverseItemUp(b,c,function(b){b.translateToParent(a)});return a};
JSG.graph.Utils.translatePointDown=function(a,b,c){JSG.graph.Utils.traverseItemDown(b,c,function(b){b.translateFromParent(a)});return a};JSG.graph.Utils.translateBoundingBoxUp=function(a,b,c){JSG.graph.Utils.traverseItemUp(b,c,function(b){b.translateBoundingBoxToParent(a)});return a};JSG.graph.Utils.translateBoundingBoxDown=function(a,b,c){JSG.graph.Utils.traverseItemDown(b,c,function(b){b.translateBoundingBoxFromParent(a)});return a};
JSG.graph.Utils.getGraph=function(a){for(a=a.getParent();void 0!=a&&!(a instanceof JSG.graph.model.Graph);)a=a.getParent();return a};JSG.graph.Utils.findCommonParent=function(a,b,c){a=void 0!=a?a.createPath():void 0;b=void 0!=b?b.createPath():void 0;b=JSG.graph.model.Path.getCommonPrefix(a,b);return c.findItemByPath(b)};
JSG.graph.Utils.getFontMetrics=function(a){a=a.getFontSize().getValue()+"pt "+a.getFontName().getValue();if(JSG.fontMetricsCache.contains(a)){var b=JSG.fontMetricsCache.get(a);if(void 0!=b)return b}var c=new JSG.ui.graphics.MetricCoordinateSystem,d=document.createElement("span");d.style.font=a;d.textContent="XXX";document.body.appendChild(d);b=d.offsetHeight;b=c.deviceToLogYNoZoom(b);document.body.removeChild(d);var d=document.createElement("div"),e=document.body;d.style.position="absolute";d.style.whiteSpace=
"nowrap";d.style.font=a;e.appendChild(d);d.innerHTML="m";e=document.createElement("span");e.style.display="inline-block";e.style.overflow="hidden";e.style.width="1px";e.style.height="1px";d.appendChild(e);c=c.deviceToLogYNoZoom(e.offsetTop+e.offsetHeight);document.body.removeChild(d);b={height:b,baseline:c};JSG.fontMetricsCache.put(a,b);return b};JSG.graph.Utils.colorFromRGB=function(a,b,c){return"#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1,7)};
JSG.graph.Utils.createDummyPortFrom=function(a,b){return{getParent:function(){return a},getConnectionPoint:function(a,d){a=void 0!=a?a:this.getParent();return JSG.graph.Utils.translatePointUp(b.copy(),this.getParent(),a)}}};JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.Event=function(a,b){this.id=a;this.doIt=!0;this.value=b;this.source=this.data=void 0};JSG.graph.model.events.Event.prototype.getId=function(){return this.id};JSG.graph.model.events.Event.ALL="event.all";
JSG.graph.model.events.Event.ATTRIBUTE="event.attribute";JSG.graph.model.events.Event.LAYOUTATTRIBUTES="event.layoutattributes";JSG.graph.model.events.Event.FORMAT="event.format";JSG.graph.model.events.Event.PAGE="event.page";JSG.graph.model.events.Event.TEXTFORMAT="event.textformat";JSG.graph.model.events.Event.ANGLE="event.angle";JSG.graph.model.events.Event.BBOX="event.bbox";JSG.graph.model.events.Event.INDEX="event.index";JSG.graph.model.events.Event.ITEMADD="event.itemadd";
JSG.graph.model.events.Event.ITEMREMOVE="event.itemremove";JSG.graph.model.events.Event.LAYER="event.layer";JSG.graph.model.events.Event.LINK="event.link";JSG.graph.model.events.Event.NAME="event.name";JSG.graph.model.events.Event.PARENT="event.parent";JSG.graph.model.events.Event.PIN="event.pin";JSG.graph.model.events.Event.SHAPE="event.shape";JSG.graph.model.events.Event.SHAPEPOINTS="event.shapepoints";JSG.graph.model.events.Event.SIZE="event.size";JSG.graph.model.events.Event.COLLAPSEDSIZE="event.collapsedsize";
JSG.graph.model.events.Event.TYPE="event.type";JSG.graph.model.events.Event.TEXT="event.text";JSG.graph.model.events.Event.PATH="event.path";JSG.graph.model.events.Event.NODE="event.node";JSG.graph.model.events.Event.PORTADD="event.portadd";JSG.graph.model.events.Event.PORTREMOVE="event.portremove";JSG.graph.model.events.Event.PORTSREMOVEBULK="event.portsremovebulk";JSG.graph.model.events.Event.EDGEATTACHED="event.edgeattached";JSG.graph.model.events.Event.EDGEDETACHED="event.edgedetached";
JSG.graph.model.events.Event.RESHAPE="reshape";JSG.graph.model.events.Event.GRAPH="graph";JSG.graph.model.events.Event.GRAPHSETTINGS="graphsettings";JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.ShapeEvent=function(a,b){JSG.graph.model.events.ShapeEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.SHAPE;this.detailId=a;this.value=b;this.count=this.index=void 0};JSG.extend(JSG.graph.model.events.ShapeEvent,JSG.graph.model.events.Event);
JSG.graph.model.events.ShapeEvent.INSERTPOINTS="insertpoints";JSG.graph.model.events.ShapeEvent.REPLACEPOINTS="replacepoint";JSG.graph.model.events.ShapeEvent.SETPOINTSAT="setpointat";JSG.graph.model.events.ShapeEvent.REMOVEPOINTS="removepoints";JSG.graph.model.events.ShapeEvent.COORD_ADD="coordinateadd";JSG.graph.model.events.ShapeEvent.COORDS_INSERT_AT="coordinatesinsert";JSG.graph.model.events.ShapeEvent.COORDS_REMOVE_AT="coordnatesremove";JSG.graph.model.events.ShapeEvent.COORDS_REPLACE_AT="coordinatesreplace";
JSG.graph.model.events.ShapeEvent.COORDS_REPLACE_ALL="coordinatesreplaceall";JSG.graph.model.events.ShapeEvent.COORD_CP="coordinatescp";JSG.graph.model.events.ShapeEvent.COORD_ADD_CPTO="coordinateaddcpto";JSG.graph.model.events.ShapeEvent.COORD_ADD_CPFROM="coordinateaddcpfrom";JSG.graph.model.events.ShapeEvent.COORDS_SET_CPTO="coordinatessetcpto";JSG.graph.model.events.ShapeEvent.COORDS_SET_CPFROM="coordinatessetcpfrom";JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.NodeEvent=function(a,b){JSG.graph.model.events.NodeEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.NODE;this.detailId=a;this.value=b};JSG.extend(JSG.graph.model.events.NodeEvent,JSG.graph.model.events.Event);JSG.graph.model.events.NodeEvent.PORTADD="portadd";JSG.graph.model.events.NodeEvent.PORTREMOVE="portremove";JSG.graph.model.events.NodeEvent.PORTREMOVEALL="portremoveall";JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.EventListener=function(){};JSG.graph.model.events.EventListener.prototype.handlePreEvent=function(a){};JSG.graph.model.events.EventListener.prototype.handlePostEvent=function(a){};JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.EventDispatcher=function(){this._events=[];this._listeners=[];this._eventsEnabled=!0};JSG.graph.model.events.EventDispatcher.prototype.areEventsEnabled=function(){return this._eventsEnabled};
JSG.graph.model.events.EventDispatcher.prototype.enableEvents=function(){this._eventsEnabled=!0};JSG.graph.model.events.EventDispatcher.prototype.disableEvents=function(){this._eventsEnabled=!1};JSG.graph.model.events.EventDispatcher.prototype.registerListener=function(a,b){this._events.push(a);this._listeners.push(b)};
JSG.graph.model.events.EventDispatcher.prototype.unregisterListener=function(a,b){for(var c=0;c<this._events.length;c++)if(this._events[c]===a&&this._listeners[c]===b){this._events.removeAt(c);this._listeners.removeAt(c);break}};JSG.graph.model.events.EventDispatcher.prototype.sendPreEvent=function(a){if(!0===this._eventsEnabled)for(var b=a.id,c=JSG.graph.model.events.Event.ALL,d=0;d<this._events.length;d++)this._events[d]!==b&&this._events[d]!==c||void 0==this._listeners[d]||this._listeners[d].handlePreEvent(a)};
JSG.graph.model.events.EventDispatcher.prototype.sendPostEvent=function(a){if(!0===this._eventsEnabled)for(var b=a.id,c=JSG.graph.model.events.Event.ALL,d=0;d<this._events.length;d++)this._events[d]!==b&&this._events[d]!==c||void 0==this._listeners[d]||this._listeners[d].handlePostEvent(a)};JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.AttributeEvent=function(a,b){JSG.graph.model.events.AttributeEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.ATTRIBUTE;this.detailId=a;this.value=b};JSG.extend(JSG.graph.model.events.AttributeEvent,JSG.graph.model.events.Event);JSG.graph.model.events.AttributeEvent.prototype.getAttributeId=function(){return this.detailId};JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.AttributeChangeEvent=function(a,b,c){JSG.graph.model.events.AttributeChangeEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.ATTRIBUTE;this.detailId=a;this._attribute=b;this._newValue=c;this._oldValue=void 0==b||b instanceof JSG.graph.attr.AttributeList?void 0:b.getExpression().copy()};JSG.extend(JSG.graph.model.events.AttributeChangeEvent,JSG.graph.model.events.Event);JSG.graph.model.events.AttributeChangeEvent.ADD="attribute.add";
JSG.graph.model.events.AttributeChangeEvent.REMOVE="attribute.remove";JSG.graph.model.events.AttributeChangeEvent.CHANGE="attribute.change";JSG.graph.model.events.AttributeChangeEvent.VALUE="attribute.value";JSG.graph.model.events.AttributeChangeEvent.BULK="attribute.bulk";JSG.graph.model.events.AttributeChangeEvent.prototype.isCategory=function(a){var b=this._attribute.getAttributeList();return(b?b.getName():void 0)===a};
JSG.graph.model.events.AttributeChangeEvent.prototype.hasAttribute=function(a){for(var b=!1,c=this._attribute.getName(),d=Array.toArray(arguments),e=0;e<d.length;e++)if(d[e]===c){b=!0;break}return b};JSG.graph.model.events.AttributeChangeEvent.prototype.getAttribute=function(){return this._attribute};JSG.graph.model.events.AttributeChangeEvent.prototype.getNewValue=function(){return this._newValue};JSG.graph.model.events.AttributeChangeEvent.prototype.getOldValue=function(){return this._oldValue};
JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.LayoutAttributeEvent=function(a,b){JSG.graph.model.events.LayoutAttributeEvent._super.constructor.call(this);this._id=JSG.graph.model.events.Event.LAYOUTATTRIBUTES;this.detailId=a;this.value=b};JSG.extend(JSG.graph.model.events.LayoutAttributeEvent,JSG.graph.model.events.AttributeEvent);JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.AttributeListener=function(){JSG.graph.model.events.AttributeListener._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.model.events.AttributeListener,JSG.graph.model.events.EventListener);JSG.graph.model.events.AttributeListener.prototype.handlePreEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.ATTRIBUTE:this.attributeWillChange(a);break;case b.LAYOUTATTRIBUTES:this.layoutAttributeWillChange(a)}};
JSG.graph.model.events.AttributeListener.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.ATTRIBUTE:this.attributeDidChange(a);break;case b.LAYOUTATTRIBUTES:this.layoutAttributeDidChange(a)}};JSG.graph.model.events.AttributeListener.prototype.attributeWillChange=function(a){};JSG.graph.model.events.AttributeListener.prototype.layoutAttributeWillChange=function(a){};JSG.graph.model.events.AttributeListener.prototype.attributeDidChange=function(a){};
JSG.graph.model.events.AttributeListener.prototype.layoutAttributeDidChange=function(a){};JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.FormatEvent=function(a,b){JSG.graph.model.events.FormatEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.FORMAT;this.detailId=a;this.value=b};JSG.extend(JSG.graph.model.events.FormatEvent,JSG.graph.model.events.Event);JSG.graph.model.events.FormatEvent.prototype.getFormatId=function(){return this.detailId};JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.PageEvent=function(a,b){JSG.graph.model.events.PageEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.PAGE;this.detailId=a;this.value=b};JSG.extend(JSG.graph.model.events.PageEvent,JSG.graph.model.events.Event);JSG.graph.model.events.PageEvent.prototype.getPageId=function(){return this.detailId};JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.TextFormatEvent=function(a,b){JSG.graph.model.events.TextFormatEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.TEXTFORMAT;this.detailId=a;this.value=b};JSG.extend(JSG.graph.model.events.TextFormatEvent,JSG.graph.model.events.FormatEvent);JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.FormatListener=function(){JSG.graph.model.events.FormatListener._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.model.events.FormatListener,JSG.graph.model.events.EventListener);JSG.graph.model.events.FormatListener.prototype.handlePreEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.FORMAT:this.formatWillChange(a);break;case b.TEXTFORMAT:this.textFormatWillChange(a)}};JSG.graph.model.events.FormatListener.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.FORMAT:this.formatDidChange(a);break;case b.TEXTFORMAT:this.textFormatDidChange(a)}};
JSG.graph.model.events.FormatListener.prototype.formatWillChange=function(a){};JSG.graph.model.events.FormatListener.prototype.textFormatWillChange=function(a){};JSG.graph.model.events.FormatListener.prototype.formatDidChange=function(a){};JSG.graph.model.events.FormatListener.prototype.textFormatDidChange=function(a){};JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.GraphItemListener=function(){JSG.graph.model.events.GraphItemListener._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.model.events.GraphItemListener,JSG.graph.model.events.EventListener);
JSG.graph.model.events.GraphItemListener.prototype.handlePreEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.ANGLE:this.angleWillChange(a);break;case b.BBOX:this.boundingBoxWillChange(a);break;case b.INDEX:this.indexWillChange(a);break;case b.ITEMADD:this.itemWillBeAdded(a);break;case b.ITEMREMOVE:this.itemWillBeRemoved(a);break;case b.PARENT:this.parentWillChange(a);break;case b.PIN:this.pinWillChange(a);break;case b.SIZE:this.sizeWillChange(a)}};
JSG.graph.model.events.GraphItemListener.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.ANGLE:this.angleDidChange(a);break;case b.BBOX:this.boundingBoxDidChange(a);break;case b.INDEX:this.indexDidChange(a);break;case b.ITEMADD:this.itemWasAdded(a);break;case b.ITEMREMOVE:this.itemWasRemoved(a);break;case b.PARENT:this.parentDidChange(a);break;case b.PIN:this.pinDidChange(a);break;case b.SIZE:this.sizeDidChange(a);break;case b.PATH:this.pathDidChange(a)}};
JSG.graph.model.events.GraphItemListener.prototype.angleWillChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.angleDidChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.boundingBoxWillChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.boundingBoxDidChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.sizeWillChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.sizeDidChange=function(a){};
JSG.graph.model.events.GraphItemListener.prototype.pinWillChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.pinDidChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.parentWillChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.parentDidChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.pathDidChange=function(){};JSG.graph.model.events.GraphItemListener.prototype.indexWillChange=function(a){};
JSG.graph.model.events.GraphItemListener.prototype.indexDidChange=function(a){};JSG.graph.model.events.GraphItemListener.prototype.itemWillBeAdded=function(a){};JSG.graph.model.events.GraphItemListener.prototype.itemWasAdded=function(a){};JSG.graph.model.events.GraphItemListener.prototype.itemWillBeRemoved=function(a){};JSG.graph.model.events.GraphItemListener.prototype.itemWasRemoved=function(a){};JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.ShapeListener=function(){JSG.graph.model.events.ShapeListener._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.model.events.ShapeListener,JSG.graph.model.events.EventListener);JSG.graph.model.events.ShapeListener.prototype.handlePreEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.SHAPE:this.shapeWillChange(a);break;case b.SHAPEPOINTS:this.shapePointsWillChange(a)}};
JSG.graph.model.events.ShapeListener.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.SHAPE:this.shapeDidChange(a);break;case b.SHAPEPOINTS:this.shapePointsDidChange(a)}};JSG.graph.model.events.ShapeListener.prototype.shapeWillChange=function(a){};JSG.graph.model.events.ShapeListener.prototype.shapePointsWillChange=function(a){};JSG.graph.model.events.ShapeListener.prototype.shapeDidChange=function(a){};
JSG.graph.model.events.ShapeListener.prototype.shapePointsDidChange=function(a){};JSG.namespace("JSG.graph.model.events");JSG.graph.model.events.PortListener=function(){JSG.graph.model.events.PortListener._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.model.events.PortListener,JSG.graph.model.events.EventListener);JSG.graph.model.events.Event.PORTADD="event.portadd";JSG.graph.model.events.Event.PORTREMOVE="event.portremove";
JSG.graph.model.events.PortListener.prototype.handlePreEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.PORTADD:this.portWillBeAdded(a);break;case b.PORTREMOVE:this.portWillBeRemoved(a);break;case b.PORTSREMOVEBULK:this.portsWillBeRemovedBulk(a)}};JSG.graph.model.events.PortListener.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.PORTADD:this.portWasAdded(a);break;case b.PORTREMOVE:this.portWasRemoved(a);break;case b.PORTSREMOVEBULK:this.portsWereRemovedBulk(a)}};
JSG.graph.model.events.PortListener.prototype.portWillBeAdded=function(a){};JSG.graph.model.events.PortListener.prototype.portWasAdded=function(a){};JSG.graph.model.events.PortListener.prototype.portWillBeRemoved=function(a){};JSG.graph.model.events.PortListener.prototype.portWasRemoved=function(a){};JSG.graph.model.events.PortListener.prototype.portsWillBeRemovedBulk=function(a){};JSG.graph.model.events.PortListener.prototype.portsWereRemovedBulk=function(a){};JSG.namespace("JSG.graph.model.events");
JSG.graph.model.events.EdgeListener=function(){JSG.graph.model.events.EdgeListener._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.model.events.EdgeListener,JSG.graph.model.events.EventListener);JSG.graph.model.events.EdgeListener.prototype.handlePreEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.EDGEATTACHED:this.edgeWillBeAttached(a);break;case b.EDGEDETACHED:this.edgeWillBeDetached(a)}};
JSG.graph.model.events.EdgeListener.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.EDGEATTACHED:this.edgeWasAttached(a);break;case b.EDGEDETACHED:this.edgeWasDetached(a)}};JSG.graph.model.events.EdgeListener.prototype.edgeWillBeAttached=function(a){};JSG.graph.model.events.EdgeListener.prototype.edgeWasAttached=function(a){};JSG.graph.model.events.EdgeListener.prototype.edgeWillBeDetached=function(a){};
JSG.graph.model.events.EdgeListener.prototype.edgeWasDetached=function(a){};JSG.namespace("JSG.graph.attr");JSG.graph.attr.Attribute=function(a,b){this._name=void 0;this._value=b;this._parent=this._dplname=void 0;this._transient=!1;this._validator=void 0;this._setName(a)};JSG.graph.attr.Attribute.PATH_DELIMITER=":";JSG.graph.attr.Attribute.CLASSNAME="JSG.graph.attr.Attribute";JSG.graph.attr.Attribute.prototype.getClassString=function(){return JSG.graph.attr.Attribute.CLASSNAME};
JSG.graph.attr.Attribute.prototype.getPath=function(){var a=void 0!=this._parent?this._parent.getPath():"";0<a.length&&(a+=JSG.graph.attr.Attribute.PATH_DELIMITER);return a+this.getName()};JSG.graph.attr.Attribute.prototype.getName=function(){return this._name};JSG.graph.attr.Attribute.prototype._setName=function(a){void 0!=a&&(this._name=a.replace(JSG.graph.attr.Attribute.PATH_DELIMITER,""))};JSG.graph.attr.Attribute.prototype.getDisplayName=function(){return this._dplname};
JSG.graph.attr.Attribute.prototype.setDisplayName=function(a){this._dplname=a};JSG.graph.attr.Attribute.prototype.isTransient=function(){return this._transient};JSG.graph.attr.Attribute.prototype.setTransient=function(a){this._transient=!0===a?!0:!1};JSG.graph.attr.Attribute.prototype.newInstance=function(){return new JSG.graph.attr.Attribute(this.getName())};
JSG.graph.attr.Attribute.prototype.copy=function(){var a=this.newInstance();a._parent=this._parent;a._value=this._value.copy();a._setName(this.getName());a.setTransient(this.isTransient());a.setDisplayName(this.getDisplayName());a.setValidator(this._validator);return a};JSG.graph.attr.Attribute.prototype.getAttributeList=function(){return this._parent};JSG.graph.attr.Attribute.prototype.getExpression=function(){void 0==this._value&&(this._value=new JSG.graph.expr.Expression);return this._value};
JSG.graph.attr.Attribute.prototype.getValue=function(){return this._value.getValue()};JSG.graph.attr.Attribute.prototype.getValidator=function(){void 0==this._validator&&this.setValidator(this.createValidator());return this._validator};JSG.graph.attr.Attribute.prototype.createValidator=function(){return new JSG.graph.attr.AttributeValidator};JSG.graph.attr.Attribute.prototype.setValidator=function(a){this._validator=a};
JSG.graph.attr.Attribute.prototype.setExpressionOrValue=function(a){return this.getValidator().isValidValueOrExpression(a,this)&&!this._value.isEqualToExpressionOrValue(a)?(this._value.setExpressionOrValue(a),!0):!1};JSG.graph.attr.Attribute.prototype.hasDifferentValue=function(a){return this.getValidator().isValidValueOrExpression(a,this)&&!this._value.isEqualToExpressionOrValue(a)};
JSG.graph.attr.Attribute.prototype.replaceValueExpression=function(a){var b=void 0!=a&&!this._value.isEqualTo(a);!0===b&&(this._value=a);return b};JSG.graph.attr.Attribute.prototype.reset=function(){this._value.setExpressionOrValue(this.getValidator().getDefaultValue(this))};JSG.graph.attr.Attribute.prototype.evaluate=function(a){this._value.evaluate(a)};JSG.graph.attr.Attribute.prototype.resolveParentReference=function(a,b){this._value.resolveParentReference(a,b)};
JSG.graph.attr.Attribute.prototype.saveXML=function(a){return this._saveXML("at",a)};JSG.graph.attr.Attribute.prototype._saveXML=function(a,b){return!1===this._transient?(b.writeStartElement(a),this._writeAttribute("n",this.getName(),b),this._saveTagAttributes(b),b.writeEndElement(!this._saveValue(b))):!1};
JSG.graph.attr.Attribute.prototype._saveTagAttributes=function(a){this._writeAttribute("dn",this.doSaveDisplayName()?this.getDisplayName():void 0,a);this._writeAttribute("cl",this.doSaveClassName()?this.getClassString():void 0,a);this._writeAttribute("vd",this.doSaveValidator()?this.getValidator().getClassString():void 0,a)};JSG.graph.attr.Attribute.prototype._writeAttribute=function(a,b,c){void 0!=b&&c.writeAttributeString(a,b)};
JSG.graph.attr.Attribute.prototype.doSaveDisplayName=function(){return this.getValidator().getDefaultDisplayName(this)!=this.getDisplayName()};JSG.graph.attr.Attribute.prototype.doSaveClassName=function(){return this.getClassString()!=JSG.graph.attr.Attribute.CLASSNAME};JSG.graph.attr.Attribute.prototype.doSaveValidator=function(){return this.getValidator().getClassString()!=JSG.graph.attr.AttributeValidator.CLASSNAME};
JSG.graph.attr.Attribute.prototype._saveValue=function(a){this._value.saveXML("vl",a);return!0};JSG.graph.attr.Attribute.prototype.readXML=function(a){this._setName(a.getAttribute("n"));this._readTagAttributes(a);this._readValue(a)};JSG.graph.attr.Attribute.prototype._readTagAttributes=function(a){this.setDisplayName(a.getAttribute("dn"));a=JSG.createObjectFromString(a.getAttribute("vd"));void 0!=a&&this.setValidator(a)};
JSG.graph.attr.Attribute.prototype._readValue=function(a){a=findElementByTagName(a,"vl");void 0!=a&&this.getExpression().readXML(a)};JSG.namespace("JSG.graph.attr");JSG.graph.attr.AttributeProxy=function(a){JSG.graph.attr.AttributeProxy._super.constructor.call(this,a.getName(),a.getValue());this._attribute=a};JSG.extend(JSG.graph.attr.AttributeProxy,JSG.graph.attr.Attribute);JSG.graph.attr.AttributeProxy.CLASSNAME="JSG.graph.attr.AttributeProxy";JSG.graph.attr.AttributeProxy.prototype.attribute=function(){return this._attribute};
JSG.graph.attr.AttributeProxy.prototype.getClassString=function(){return JSG.graph.attr.AttributeProxy.CLASSNAME};JSG.graph.attr.AttributeProxy.prototype.getName=function(){return this._attribute.getName()};JSG.graph.attr.AttributeProxy.prototype.getDisplayName=function(){return this._attribute.getDislayName()};JSG.graph.attr.AttributeProxy.prototype.setDisplayName=function(a){this._attribute.setDisplayName(a)};JSG.graph.attr.AttributeProxy.prototype.isTransient=function(){return this._attribute.isTransient()};
JSG.graph.attr.AttributeProxy.prototype.setTransient=function(a){this._attribute.setTransient(a)};JSG.graph.attr.AttributeProxy.prototype.copy=function(){return this.newInstance()};JSG.graph.attr.AttributeProxy.prototype.newInstance=function(){return new JSG.graph.attr.AttributeProxy(this._attribute.copy())};JSG.graph.attr.AttributeProxy.prototype.getExpression=function(){return this._attribute.getExpression()};JSG.graph.attr.AttributeProxy.prototype.getValue=function(){return this._attribute.getValue()};
JSG.graph.attr.AttributeProxy.prototype.getValidator=function(){return this._attribute.getValidator()};JSG.graph.attr.AttributeProxy.prototype.createValidator=function(){return this._attribute.createValidator()};JSG.graph.attr.AttributeProxy.prototype.setValidator=function(a){this._attribute.setValidator(a)};JSG.graph.attr.AttributeProxy.prototype.setExpressionOrValue=function(a){return this._attribute.setExpressionOrValue(a)};JSG.graph.attr.AttributeProxy.prototype.hasDifferentValue=function(a){return this._attribute.hasDifferentValue(a)};
JSG.graph.attr.AttributeProxy.prototype.replaceValueExpression=function(a){return this._attribute.replaceValueExpression(a)};JSG.graph.attr.AttributeProxy.prototype.reset=function(){this._attribute.reset()};JSG.graph.attr.AttributeProxy.prototype.evaluate=function(a){this._attribute.evaluate(a)};JSG.graph.attr.AttributeProxy.prototype.resolveParentReference=function(a,b){this._attribute.resolveParentReference(a,b)};JSG.graph.attr.AttributeProxy.prototype.saveXML=function(a){return this._attribute.saveXML(a)};
JSG.graph.attr.AttributeProxy.prototype.readXML=function(a){this._attribute.readXML(a)};JSG.namespace("JSG.graph.attr.consts");JSG.graph.attr.consts.PortMode={NONE:0,SHAPE:2,CENTER:4,SIDESCENTER:8,SIDESQUARTER:16,CENTERSTARTATSIDE:32,CORNERS:64,POINTS:128,LINESCENTER:256,DEFAULT:384,ALL:510};JSG.graph.attr.consts.SelectionMode={NONE:0,BORDER:1,AREA:2,DEFAULT:4,SELECTPARENT:8};JSG.graph.attr.consts.Moveable={LIMITTOCONTAINER:4};JSG.graph.attr.consts.Direction={NONE:0,VERTICAL:1,HORIZONTAL:2,BOTH:3};
JSG.graph.attr.consts.ButtonPosition={TOPLEFT:0,TOPRIGHT:1,TOPCENTER:2,BOTTOMCENTER:3};JSG.graph.attr.consts.EditMask={NONE:0,COORDINATES:1,LABEL:2};JSG.namespace("JSG.graph.attr");JSG.graph.attr.BooleanAttribute=function(a,b){JSG.graph.attr.BooleanAttribute._super.constructor.call(this,a,new JSG.graph.expr.BooleanExpression(!0));void 0!=b&&this._value.setExpressionOrValue(b)};JSG.extend(JSG.graph.attr.BooleanAttribute,JSG.graph.attr.Attribute);
JSG.graph.attr.BooleanAttribute.prototype.getClassString=function(){return"JSG.graph.attr.BooleanAttribute"};JSG.graph.attr.BooleanAttribute.prototype.newInstance=function(){return new JSG.graph.attr.BooleanAttribute(this.getName())};JSG.namespace("JSG.graph.attr");JSG.graph.attr.NumberAttribute=function(a,b){JSG.graph.attr.NumberAttribute._super.constructor.call(this,a,new JSG.graph.expr.NumberExpression(0));void 0!=b&&this._value.setExpressionOrValue(b)};
JSG.extend(JSG.graph.attr.NumberAttribute,JSG.graph.attr.Attribute);JSG.graph.attr.NumberAttribute.prototype.getClassString=function(){return"JSG.graph.attr.NumberAttribute"};JSG.graph.attr.NumberAttribute.prototype.newInstance=function(){return new JSG.graph.attr.NumberAttribute(this.getName())};JSG.namespace("JSG.graph.attr");JSG.graph.attr.StringAttribute=function(a,b){JSG.graph.attr.StringAttribute._super.constructor.call(this,a,new JSG.graph.expr.StringExpression(""));void 0!=b&&this._value.setExpressionOrValue(b)};
JSG.extend(JSG.graph.attr.StringAttribute,JSG.graph.attr.Attribute);JSG.graph.attr.StringAttribute.prototype.getClassString=function(){return"JSG.graph.attr.StringAttribute"};JSG.graph.attr.StringAttribute.prototype.newInstance=function(){return new JSG.graph.attr.StringAttribute(this.getName())};JSG.namespace("JSG.graph.attr");JSG.graph.attr.ObjectAttribute=function(a,b){JSG.graph.attr.ObjectAttribute._super.constructor.call(this,a,new JSG.graph.expr.ObjectExpression(void 0));void 0!=b&&this._value.setExpressionOrValue(b)};
JSG.extend(JSG.graph.attr.ObjectAttribute,JSG.graph.attr.Attribute);JSG.graph.attr.ObjectAttribute.prototype.getClassString=function(){return"JSG.graph.attr.ObjectAttribute"};JSG.graph.attr.ObjectAttribute.prototype.newInstance=function(){return new JSG.graph.attr.ObjectAttribute(this.getName())};JSG.graph.attr.ObjectAttribute.prototype.doSaveValidator=function(){return!1};JSG.namespace("JSG.graph.attr");
JSG.graph.attr.ConditionalAttribute=function(a){JSG.graph.attr.ConditionalAttribute._super.constructor.call(this,a);this.conditions=[]};JSG.extend(JSG.graph.attr.ConditionalAttribute,JSG.graph.attr.AttributeProxy);JSG.graph.attr.ConditionalAttribute.prototype.copy=function(){return this._attribute.copy()};JSG.graph.attr.ConditionalAttribute.prototype.addCondition=function(a,b){0<=b&&b<this.conditions.length?this.conditions.insertAt(b,a):this.conditions.push(a)};
JSG.graph.attr.ConditionalAttribute.prototype.hasConditions=function(){return 0<this.conditions.length};JSG.graph.attr.ConditionalAttribute.prototype.sortConditions=function(){this.conditions.sort(function(a,b){return a.prio-b.prio})};JSG.graph.attr.ConditionalAttribute.prototype.removeCondition=function(a){this.conditions.remove(a)};JSG.graph.attr.ConditionalAttribute.prototype.moveConditionTo=function(a,b){var c=this.conditions.indexOf(a);-1<c&&this.moveConditionsAtTo(c,b)};
JSG.graph.attr.ConditionalAttribute.prototype.moveConditionAtTo=function(a,b){this.conditions.move(a,b)};JSG.graph.attr.ConditionalAttribute.prototype.evaluate=function(a){this._attribute.evaluate(a);for(var b=0;b<this.conditions.length;b++)this.conditions[b].expression.evaluate(a)};
JSG.graph.attr.ConditionalAttribute.prototype.getValue=function(){for(var a=void 0,b=0;b<this.conditions.length;b++){var c=this.conditions[b];if(c.isActive)c.isTrue()&&(a=c.expression.getValue());else break}return void 0!=a?a:this.attribute().getValue()};JSG.namespace("JSG.graph.attr");
JSG.graph.attr.AttributeList=function(a,b){var c=void 0!=b?b:new JSG.graph.attr.AttributeList.MapExpression;JSG.graph.attr.AttributeList._super.constructor.call(this,a,c);for(var c=c.getValue(),d=0;d<c.length;d++)c[d]._parent=this};JSG.extend(JSG.graph.attr.AttributeList,JSG.graph.attr.Attribute);JSG.graph.attr.AttributeList.CLASSNAME="JSG.graph.attr.AttributeList";JSG.graph.attr.AttributeList.prototype.newInstance=function(a){return new JSG.graph.attr.AttributeList(this.getName(),a)};
JSG.graph.attr.AttributeList.prototype.copy=function(){return this.newInstance(this._value.copy())};JSG.graph.attr.AttributeList.prototype.getClassString=function(){return"JSG.graph.attr.AttributeList"};JSG.graph.attr.AttributeList.prototype.reset=function(){this._value.iterate(function(a,b){b.reset()})};JSG.graph.attr.AttributeList.prototype.addAttribute=function(a){var b=this._value.putElement(a.getName(),a);void 0!=b&&b!=a&&(b._parent=void 0);a._parent=this;return a};
JSG.graph.attr.AttributeList.prototype.addAttributeAtPath=function(a,b){var c=JSG.graph.attr.AttributeUtils.findAttributeAt(a);return c instanceof JSG.graph.attr.AttributeList?c.addAttribute(b):void 0};JSG.graph.attr.AttributeList.prototype.getAttribute=function(a){return this._value.getElement(a)};JSG.graph.attr.AttributeList.prototype.setAttribute=function(a,b,c){a=this._value.getElement(a);return void 0!=a?void 0!=c?c.setAttribute(a,b):a.setExpressionOrValue(b):!1};
JSG.graph.attr.AttributeList.prototype.getAttributeAtPath=function(a){return JSG.graph.attr.AttributeUtils.findAttributeByPath(a,this)};JSG.graph.attr.AttributeList.prototype.setAttributeAtPath=function(a,b,c){a=JSG.graph.attr.AttributeUtils.findAttributeByPath(a,this);return void 0!=a?void 0!=c?c.setAttribute(a,b):a.setExpressionOrValue(b):!1};JSG.graph.attr.AttributeList.prototype.removeAttribute=function(a){a=this._value.removeElement(a.getName());void 0!=a&&(a._parent=void 0);return a};
JSG.graph.attr.AttributeList.prototype.removeAttributes=function(a){for(var b=0;b<a.length;b++)this.removeAttribute(a[b])};JSG.graph.attr.AttributeList.prototype.removeAttributeAtPath=function(a){return JSG.graph.attr.AttributeUtils.removeAttributeAtPath(a,this)};
JSG.graph.attr.AttributeList.prototype.retainAll=function(a,b){function c(a,b){return!0}for(var d=!1,e=void 0!=b?b:c,f=this._value.getValue(),g=0;g<f.length;g++){var l=f[g],h=a.getAttribute(l.getName());void 0!=h&&e(l,h)||(this.removeAttribute(l),d=!0)}return d};JSG.graph.attr.AttributeList.prototype.doSaveClassName=function(){return this.getClassString()!=JSG.graph.attr.AttributeList.CLASSNAME};JSG.graph.attr.AttributeList.prototype.saveXML=function(a){return this._saveXML("al",a)};
JSG.graph.attr.AttributeList.prototype._saveValue=function(a){for(var b=this.getValidator(),c=this._value.getValue(),d=!1,e=0;e<c.length;e++){var f=c[e];f instanceof JSG.graph.attr.AttributeList?d=this._saveAttributeList(f,a)||d:b.isAttributeSetToDefault(f)||(d=this._saveAttribute(f,a)||d)}return d};JSG.graph.attr.AttributeList.prototype._saveAttribute=function(a,b){return this.getValidator().isAttributeSetToDefault(a)?!1:a.saveXML(b)};
JSG.graph.attr.AttributeList.prototype._saveAttributeList=function(a,b){return a.saveXML(b)};JSG.graph.attr.AttributeList.prototype._readValue=function(a){if(a.hasChildNodes()){a=a.childNodes;for(var b=0;b<a.length;b++){var c=a.item(b);if("at"==c.nodeName||"al"==c.nodeName){var d=this._createAttributeFrom(c);void 0!=d&&(d.readXML(c),this.addAttribute(d))}}}};
JSG.graph.attr.AttributeList.prototype._createAttributeFrom=function(a){var b=a.getAttribute("cl");void 0==b&&("at"==a.nodeName?b=JSG.graph.attr.Attribute.CLASSNAME:"al"==a.nodeName&&(b=JSG.graph.attr.AttributeList.CLASSNAME));return JSG.createObjectFromString(b)};JSG.graph.attr.AttributeList.MapExpression=function(){JSG.graph.attr.AttributeList.MapExpression._super.constructor.call(this)};JSG.extend(JSG.graph.attr.AttributeList.MapExpression,JSG.graph.expr.MapExpression);
JSG.graph.attr.AttributeList.MapExpression.prototype.newInstance=function(){return new JSG.graph.attr.AttributeList.MapExpression};JSG.graph.attr.AttributeList.MapExpression.prototype.putElement=function(a,b){return JSG.graph.attr.AttributeList.MapExpression._super.putElement.call(this,a.toUpperCase(),b)};JSG.graph.attr.AttributeList.MapExpression.prototype.getElement=function(a){return JSG.graph.attr.AttributeList.MapExpression._super.getElement.call(this,a.toUpperCase())};
JSG.graph.attr.AttributeList.MapExpression.prototype.removeElement=function(a){return JSG.graph.attr.AttributeList.MapExpression._super.removeElement.call(this,a.toUpperCase())};JSG.graph.attr.AttributeList.MapExpression.prototype.evaluate=function(a){this._value.iterate(function(b,c){c.evaluate(a)})};JSG.graph.attr.AttributeList.MapExpression.prototype.resolveParentReference=function(a,b){this._value.iterate(function(c,d){d.resolveParentReference(a,b)})};JSG.namespace("JSG.graph.attr");
JSG.graph.attr.AttributeValidator=function(){};JSG.graph.attr.AttributeValidator.CLASSNAME="JSG.graph.attr.AttributeValidator";JSG.graph.attr.AttributeValidator.prototype.copy=function(){return new JSG.graph.attr.AttributeValidator};JSG.graph.attr.AttributeValidator.prototype.isValidValueOrExpression=function(a,b){return void 0==this.validateValueOrExpression(a,b)};JSG.graph.attr.AttributeValidator.prototype.validateValueOrExpression=function(a,b){};
JSG.graph.attr.AttributeValidator.prototype.getDefaultDisplayName=function(a){};JSG.graph.attr.AttributeValidator.prototype.getDefaultValue=function(a){};JSG.graph.attr.AttributeValidator.prototype.isAttributeSetToDefault=function(a){var b=a.getValue();a=this.getDefaultValue(a);return b===a};JSG.graph.attr.AttributeValidator.prototype.getValidValues=function(a){};JSG.graph.attr.AttributeValidator.prototype.getClassString=function(){return JSG.graph.attr.AttributeValidator.CLASSNAME};JSG.namespace("JSG.graph.attr");
JSG.graph.attr.AttributeUtils=function(){};JSG.graph.attr.AttributeUtils.createItemAttributePath=function(a){return JSG.graph.attr.ItemAttributes.NAME+JSG.graph.attr.Attribute.PATH_DELIMITER+a};JSG.graph.attr.AttributeUtils.createTextAttributePath=function(a){return JSG.graph.attr.TextFormatAttributes.NAME+JSG.graph.attr.Attribute.PATH_DELIMITER+a};
JSG.graph.attr.AttributeUtils.createPath=function(){if(1<arguments.length){for(var a="",b=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),c=b.length-1,d=0;d<c;d++)a=a+b[d]+JSG.graph.attr.Attribute.PATH_DELIMITER;return a+=b[c]}};JSG.graph.attr.AttributeUtils.findAttributeByPath=function(a,b){var c=a?a.split(JSG.graph.attr.Attribute.PATH_DELIMITER):[];return 0<c.length?this._lookUpAttribute(c,b):void 0};
JSG.graph.attr.AttributeUtils._lookUpAttribute=function(a,b){if(a.isEmpty()||void 0==b)return b;var c=a.shift(),c=this._same(c,b.getName())?b:b instanceof JSG.graph.attr.AttributeList?b.getAttribute(c):void 0;return this._lookUpAttribute(a,c)};JSG.graph.attr.AttributeUtils._same=function(a,b){return a===b||a.toUpperCase()===b.toUpperCase()};
JSG.graph.attr.AttributeUtils.addAttributeAtPath=function(a,b,c){a=this.findAttributeByPath(this._getParentPath(a,b),c);if(a instanceof JSG.graph.attr.AttributeList)return a.addAttribute(b),b};JSG.graph.attr.AttributeUtils._getParentPath=function(a,b){var c=b.getName(),c=a.indexOf(c,a.length-c.length);-1!=c&&(a=a.substring(0,c-1));return a};JSG.graph.attr.AttributeUtils.removeAttributeAtPath=function(a,b){var c=this.findAttributeByPath(a,b);return this.removeAttribute(c)};
JSG.graph.attr.AttributeUtils.removeAttribute=function(a){var b=void 0!=a?a._parent:void 0;return void 0!=b?b.removeAttribute(a):void 0};JSG.namespace("JSG.graph.attr");JSG.graph.attr.AbstractAttributeList=function(a,b){JSG.graph.attr.AbstractAttributeList._super.constructor.call(this,a,b);this.fillList()};JSG.extend(JSG.graph.attr.AbstractAttributeList,JSG.graph.attr.AttributeList);JSG.graph.attr.AbstractAttributeList.CLASSNAME="JSG.graph.attr.AbstractAttributeList";
JSG.graph.attr.AbstractAttributeList.prototype.newInstance=function(a){return new JSG.graph.attr.AbstractAttributeList(this.getName(),a)};JSG.graph.attr.AbstractAttributeList.prototype.getClassString=function(){return"JSG.graph.attr.AbstractAttributeList"};JSG.graph.attr.AbstractAttributeList.prototype.addAttribute=function(a){JSG.graph.attr.AbstractAttributeList._super.addAttribute.call(this,a);a.setValidator(this.getValidator());return a};
JSG.graph.attr.AbstractAttributeList.prototype.setValidator=function(a){JSG.graph.attr.AbstractAttributeList._super.setValidator.call(this,a);this._value.iterate(function(b,c){c.setValidator(a)})};JSG.graph.attr.AbstractAttributeList.prototype.fillList=function(){};JSG.graph.attr.AbstractAttributeList.prototype.doSaveDisplayName=function(){return!1};JSG.graph.attr.AbstractAttributeList.prototype.isPredefinedAttribute=function(a){return!1};
JSG.graph.attr.AbstractAttributeList.prototype.toMap=function(){var a=new JSG.commons.Map;this._value.iterate(function(b,c){a.put(c.getName(),c.getExpression().copy())});return a};JSG.graph.attr.AbstractAttributeList.prototype.applyAttributesMap=function(a,b){function c(a,b){e=d.setAttribute(a,b)||e}var d=this,e=!1,f=this._sendPreEvent(a,b);if(void 0==f||f&&f.doIt)a.iterate(c),void 0!=b&&b.sendPostEvent(f);return e};
JSG.graph.attr.AbstractAttributeList.prototype._sendPreEvent=function(a,b){if(void 0!=b){var c=new JSG.graph.model.events.AttributeChangeEvent(JSG.graph.model.events.AttributeChangeEvent.BULK,this,a);b.sendPreEvent(c);return c}};JSG.graph.attr.AbstractAttributeList.prototype._saveAttribute=function(a,b){this.isPredefinedAttribute(a)&&(a._saveTagAttributes=this._saveTag);return a.saveXML(b)};
JSG.graph.attr.AbstractAttributeList.prototype._saveTag=function(a){this._writeAttribute("dn",this.doSaveDisplayName()?this.getDisplayName():void 0,a)};JSG.graph.attr.AbstractAttributeList.prototype._readTagAttributes=function(a){JSG.graph.attr.AbstractAttributeList._super._readTagAttributes.call(this,a);void 0!=a.getAttribute("vd")&&this.reset()};
JSG.graph.attr.AbstractAttributeList.prototype._createAttributeFrom=function(a){var b=a.getAttribute("n"),b=this.getAttribute(b);return void 0!=b?b:JSG.graph.attr.AbstractAttributeList._super._createAttributeFrom.call(this,a)};JSG.namespace("JSG.graph.attr");JSG.graph.attr.AbstractAttributeValidator=function(){JSG.graph.attr.AbstractAttributeValidator._super.constructor.call(this);this._defaultValues=new JSG.commons.Map;this.fillDefaultValues()};
JSG.extend(JSG.graph.attr.AbstractAttributeValidator,JSG.graph.attr.AttributeValidator);JSG.graph.attr.AbstractAttributeValidator.CLASSNAME="JSG.graph.attr.AbstractAttributeValidator";JSG.graph.attr.AbstractAttributeValidator.prototype.getClassString=function(){return JSG.graph.attr.AbstractAttributeValidator.CLASSNAME};JSG.graph.attr.AbstractAttributeValidator.prototype.copy=function(){var a=new JSG.graph.attr.AbstractAttributeValidator;a._defaultValues.putAll(this._defaultValues);return a};
JSG.graph.attr.AbstractAttributeValidator.prototype.getDefaultValue=function(a){return this._defaultValues.get(a.getName())};JSG.graph.attr.AbstractAttributeValidator.prototype.fillDefaultValues=function(){};JSG.graph.attr.AbstractAttributeValidator.prototype.setDefaultValue=function(a,b){var c=this._nameOf(a);this._defaultValues.put(c,b)};JSG.graph.attr.AbstractAttributeValidator.prototype.hasDefaultValue=function(a){a=this._nameOf(a);return this._defaultValues.contains(a)};
JSG.graph.attr.AbstractAttributeValidator.prototype._nameOf=function(a){return String.isString(a)?a:a.getName()};JSG.namespace("JSG.graph.attr");JSG.graph.attr.ItemAttributes=function(a){JSG.graph.attr.ItemAttributes._super.constructor.call(this,JSG.graph.attr.ItemAttributes.NAME,a)};JSG.extend(JSG.graph.attr.ItemAttributes,JSG.graph.attr.AbstractAttributeList);JSG.graph.attr.ItemAttributes.NAME="graphitem";JSG.graph.attr.ItemAttributes.CLIPCHILDREN="clipchildren";
JSG.graph.attr.ItemAttributes.CLOSED="closed";JSG.graph.attr.ItemAttributes.COLLAPSABLE="collapsable";JSG.graph.attr.ItemAttributes.COLLAPSED="collapsed";JSG.graph.attr.ItemAttributes.COLLAPSEDBUTTON="collapsedbutton";JSG.graph.attr.ItemAttributes.COMBINED="combined";JSG.graph.attr.ItemAttributes.CONTAINER="container";JSG.graph.attr.ItemAttributes.DELETEABLE="deleteable";JSG.graph.attr.ItemAttributes.MOVEABLE="moveable";JSG.graph.attr.ItemAttributes.PORTMODE="portmode";
JSG.graph.attr.ItemAttributes.ROTATABLE="rotatable";JSG.graph.attr.ItemAttributes.SELECTIONMODE="selectionmode";JSG.graph.attr.ItemAttributes.SELECTED="selected";JSG.graph.attr.ItemAttributes.SIZEABLE="sizeable";JSG.graph.attr.ItemAttributes.SNAPTO="snapto";JSG.graph.attr.ItemAttributes.VISIBLE="visible";JSG.graph.attr.ItemAttributes.ALWAYSVISIBLE="alwaysvisible";JSG.graph.attr.ItemAttributes.MARGINTOP="margintop";JSG.graph.attr.ItemAttributes.MARGINLEFT="marginleft";
JSG.graph.attr.ItemAttributes.MARGINRIGHT="marginright";JSG.graph.attr.ItemAttributes.MARGINBOTTOM="marginbottom";JSG.graph.attr.ItemAttributes.ITEMPART="itempart";JSG.graph.attr.ItemAttributes.EDITMASK="editmask";JSG.graph.attr.ItemAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.ItemAttributes(a)};JSG.graph.attr.ItemAttributes.prototype.getClassString=function(){return"JSG.graph.attr.ItemAttributes"};JSG.graph.attr.ItemAttributes.prototype.createValidator=function(){return new JSG.graph.attr.ItemAttributesValidator};
JSG.graph.attr.ItemAttributes.prototype.doSaveValidator=function(){return this.getValidator().getClassString()!=JSG.graph.attr.ItemAttributesValidator.CLASSNAME};
JSG.graph.attr.ItemAttributes.prototype.fillList=function(){function a(a){void 0==b.getAttribute(a.getName())&&(b.addAttribute(a),a.setExpressionOrValue(c.getDefaultValue(a)))}var b=this,c=this.getValidator(),d=JSG.graph.attr.ItemAttributes;a(new JSG.graph.attr.BooleanAttribute(d.CLIPCHILDREN));a(new JSG.graph.attr.BooleanAttribute(d.CLOSED));a(new JSG.graph.attr.NumberAttribute(d.COLLAPSABLE));a(new JSG.graph.attr.BooleanAttribute(d.COLLAPSED));a(new JSG.graph.attr.NumberAttribute(d.COLLAPSEDBUTTON));
a(new JSG.graph.attr.BooleanAttribute(d.COMBINED));a(new JSG.graph.attr.BooleanAttribute(d.CONTAINER));a(new JSG.graph.attr.BooleanAttribute(d.DELETEABLE));a(new JSG.graph.attr.NumberAttribute(d.MOVEABLE));a(new JSG.graph.attr.NumberAttribute(d.PORTMODE));a(new JSG.graph.attr.BooleanAttribute(d.ROTATABLE));a(new JSG.graph.attr.NumberAttribute(d.SELECTIONMODE));var e=new JSG.graph.attr.BooleanAttribute(d.SELECTED);e.setTransient(!0);a(e);a(new JSG.graph.attr.BooleanAttribute(d.SIZEABLE));a(new JSG.graph.attr.BooleanAttribute(d.SNAPTO));
a(new JSG.graph.attr.BooleanAttribute(d.VISIBLE));a(new JSG.graph.attr.NumberAttribute(d.ALWAYSVISIBLE));a(new JSG.graph.attr.NumberAttribute(d.MARGINLEFT));a(new JSG.graph.attr.NumberAttribute(d.MARGINRIGHT));a(new JSG.graph.attr.NumberAttribute(d.MARGINTOP));a(new JSG.graph.attr.NumberAttribute(d.MARGINBOTTOM));a(new JSG.graph.attr.BooleanAttribute(d.ITEMPART));a(new JSG.graph.attr.NumberAttribute(d.EDITMASK))};
JSG.graph.attr.ItemAttributes.prototype.isPredefinedAttribute=function(a){a=a.getName();return JSG.hasPropertyWithValue(JSG.graph.attr.ItemAttributes,a)};JSG.graph.attr.ItemAttributes.prototype.setAlwaysVisible=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.ALWAYSVISIBLE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getAlwaysVisible=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.ALWAYSVISIBLE)};
JSG.graph.attr.ItemAttributes.prototype.setClipChildren=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.CLIPCHILDREN,a,b)};JSG.graph.attr.ItemAttributes.prototype.getClipChildren=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.CLIPCHILDREN)};JSG.graph.attr.ItemAttributes.prototype.setClosed=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.CLOSED,a,b)};JSG.graph.attr.ItemAttributes.prototype.getClosed=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.CLOSED)};
JSG.graph.attr.ItemAttributes.prototype.setCollapsable=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.COLLAPSABLE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getCollapsable=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.COLLAPSABLE)};JSG.graph.attr.ItemAttributes.prototype.setCollapsed=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.COLLAPSED,a,b)};JSG.graph.attr.ItemAttributes.prototype.getCollapsed=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.COLLAPSED)};
JSG.graph.attr.ItemAttributes.prototype.setCollapsedButton=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.COLLAPSEDBUTTON,a,b)};JSG.graph.attr.ItemAttributes.prototype.getCollapsedButton=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.COLLAPSEDBUTTON)};JSG.graph.attr.ItemAttributes.prototype.setCombined=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.COMBINED,a,b)};JSG.graph.attr.ItemAttributes.prototype.getCombined=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.COMBINED)};
JSG.graph.attr.ItemAttributes.prototype.setContainer=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.CONTAINER,a,b)};JSG.graph.attr.ItemAttributes.prototype.getContainer=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.CONTAINER)};JSG.graph.attr.ItemAttributes.prototype.setDeleteable=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.DELETEABLE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getDeleteable=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.DELETEABLE)};
JSG.graph.attr.ItemAttributes.prototype.setMoveable=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.MOVEABLE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getMoveable=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.MOVEABLE)};JSG.graph.attr.ItemAttributes.prototype.setPortMode=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.PORTMODE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getPortMode=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.PORTMODE)};
JSG.graph.attr.ItemAttributes.prototype.setRotatable=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.ROTATABLE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getRotatable=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.ROTATABLE)};JSG.graph.attr.ItemAttributes.prototype.setSelectionMode=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.SELECTIONMODE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getSelectionMode=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.SELECTIONMODE)};
JSG.graph.attr.ItemAttributes.prototype.setSelectParentFirst=function(a,b){var c=this.getSelectionMode().getValue(),c=a?c|JSG.graph.attr.consts.SelectionMode.SELECTPARENT:c&~JSG.graph.attr.consts.SelectionMode.SELECTPARENT;this.setSelectionMode(c)};JSG.graph.attr.ItemAttributes.prototype.setSelected=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.SELECTED,a,b)};JSG.graph.attr.ItemAttributes.prototype.getSelected=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.SELECTED)};
JSG.graph.attr.ItemAttributes.prototype.setSizeable=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.SIZEABLE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getSizeable=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.SIZEABLE)};JSG.graph.attr.ItemAttributes.prototype.setSnapTo=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.SNAPTO,a,b)};JSG.graph.attr.ItemAttributes.prototype.getSnapTo=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.SNAPTO)};
JSG.graph.attr.ItemAttributes.prototype.setVisible=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,a,b)};JSG.graph.attr.ItemAttributes.prototype.getVisible=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.VISIBLE)};JSG.graph.attr.ItemAttributes.prototype.setLeftMargin=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.MARGINLEFT,a,b)};JSG.graph.attr.ItemAttributes.prototype.getLeftMargin=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.MARGINLEFT)};
JSG.graph.attr.ItemAttributes.prototype.setRightMargin=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.MARGINRIGHT,a,b)};JSG.graph.attr.ItemAttributes.prototype.getRightMargin=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.MARGINRIGHT)};JSG.graph.attr.ItemAttributes.prototype.setTopMargin=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.MARGINTOP,a,b)};JSG.graph.attr.ItemAttributes.prototype.getTopMargin=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.MARGINTOP)};
JSG.graph.attr.ItemAttributes.prototype.setBottomMargin=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.MARGINBOTTOM,a,b)};JSG.graph.attr.ItemAttributes.prototype.getBottomMargin=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.MARGINBOTTOM)};JSG.graph.attr.ItemAttributes.prototype.setItemPart=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.ITEMPART,a,b)};JSG.graph.attr.ItemAttributes.prototype.getItemPart=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.ITEMPART)};
JSG.graph.attr.ItemAttributes.prototype.setEditMask=function(a,b){this.setAttribute(JSG.graph.attr.ItemAttributes.EDITMASK,a,b)};JSG.graph.attr.ItemAttributes.prototype.getEditMask=function(){return this.getAttribute(JSG.graph.attr.ItemAttributes.EDITMASK)};JSG.graph.attr.ItemAttributes.prototype.hasEditMask=function(a){return(this.getAttribute(JSG.graph.attr.ItemAttributes.EDITMASK).getValue()&a)==a};
JSG.graph.attr.ItemAttributes.prototype.applyLegacyAttributes=function(a){function b(a,b){b instanceof JSG.graph.attr.Attribute&&(b=b.getExpression());c.setAttribute(a,b)}var c=this,d=JSG.graph.attr.ItemAttributes;b(d.CLIPCHILDREN,a.getClipChildren());b(d.CLOSED,a.getClosed());b(d.COLLAPSABLE,a.getCollapsable());b(d.COLLAPSED,a.getCollapsed());b(d.COLLAPSEDBUTTON,a.getCollapsedButton());b(d.COMBINED,a.getCombined());b(d.CONTAINER,a.getContainer());b(d.DELETEABLE,a.getDeleteable());b(d.MOVEABLE,a.getMoveable());
b(d.PORTMODE,a.getPortMode());b(d.ROTATABLE,a.getRotatable());b(d.SELECTIONMODE,a.getSelectionMode());b(d.SELECTED,a.getSelected());b(d.SIZEABLE,a.getSizeable());b(d.SNAPTO,a.getSnapTo());b(d.VISIBLE,a.getVisible());b(d.ALWAYSVISIBLE,a.getAlwaysVisible());b(d.MARGINLEFT,a.getLeftMargin());b(d.MARGINRIGHT,a.getRightMargin());b(d.MARGINTOP,a.getTopMargin());b(d.MARGINBOTTOM,a.getBottomMargin())};
JSG.graph.attr.ItemAttributes.prototype.readXML=function(a){JSG.graph.attr.ItemAttributes._super.readXML.call(this,a);a=this.getPortMode().getValue();a&1&&this.setPortMode(a&-2&JSG.graph.attr.consts.PortMode.DEFAULT)};JSG.namespace("JSG.graph.attr");JSG.graph.attr.ItemAttributesValidator=function(){JSG.graph.attr.ItemAttributesValidator._super.constructor.call(this)};JSG.extend(JSG.graph.attr.ItemAttributesValidator,JSG.graph.attr.AttributeValidator);
JSG.graph.attr.ItemAttributesValidator.CLASSNAME="JSG.graph.attr.ItemAttributesValidator";JSG.graph.attr.ItemAttributesValidator.prototype.getClassString=function(){return JSG.graph.attr.ItemAttributesValidator.CLASSNAME};
JSG.graph.attr.ItemAttributesValidator.prototype.getValidValues=function(a){var b=void 0,c=JSG.graph.attr.ItemAttributes,d=JSG.graph.attr.consts;switch(a.getName()){case c.MOVEABLE:case c.COLLAPSABLE:case c.ALWAYSVISIBLE:b=d.Direction;break;case c.EDITMASK:b=d.EditMask;break;case c.PORTMODE:b=d.PortMode;break;case c.SELECTIONMODE:b=d.SelectionMode;break;case c.COLLAPSEDBUTTON:b=d.ButtonPosition;break;case c.CLIPCHILDREN:case c.CLOSED:case c.COLLAPSED:case c.COMBINED:case c.CONTAINER:case c.DELETEABLE:case c.ROTATABLE:case c.SELECTED:case c.SIZEABLE:case c.SNAPTO:case c.ITEMPART:case c.VISIBLE:b=
[!0,!1]}return b};
JSG.graph.attr.ItemAttributesValidator.prototype.getDefaultValue=function(a){var b=void 0,c=JSG.graph.attr.consts,d=JSG.graph.attr.ItemAttributes;switch(a.getName()){case d.CLIPCHILDREN:b=!1;break;case d.CLOSED:b=!0;break;case d.COLLAPSABLE:b=c.Direction.NONE;break;case d.COLLAPSED:b=!1;break;case d.COLLAPSEDBUTTON:b=c.ButtonPosition.TOPRIGHT;break;case d.COMBINED:b=!1;break;case d.CONTAINER:b=!0;break;case d.DELETEABLE:b=!0;break;case d.MOVEABLE:b=c.Direction.BOTH;break;case d.PORTMODE:b=c.PortMode.DEFAULT|
c.PortMode.CENTER;break;case d.ROTATABLE:b=!0;break;case d.SELECTIONMODE:b=c.SelectionMode.DEFAULT;break;case d.SELECTED:b=!1;break;case d.SIZEABLE:b=!0;break;case d.SNAPTO:b=!0;break;case d.VISIBLE:b=!0;break;case d.ALWAYSVISIBLE:b=c.Direction.NONE;break;case d.LAYER:b="";break;case d.LINK:b="";break;case d.TYPE:b="";break;case d.MARGINLEFT:b=0;break;case d.MARGINRIGHT:b=0;break;case d.MARGINTOP:b=0;break;case d.MARGINBOTTOM:b=0;break;case d.ITEMPART:b=!1;break;case d.EDITMASK:b=c.EditMask.NONE}return b};
JSG.namespace("JSG.graph.attr");JSG.graph.attr.EdgeAttributes=function(a){JSG.graph.attr.EdgeAttributes._super.constructor.call(this,a)};JSG.extend(JSG.graph.attr.EdgeAttributes,JSG.graph.attr.ItemAttributes);JSG.graph.attr.EdgeAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.EdgeAttributes(a)};JSG.graph.attr.EdgeAttributes.prototype.getClassString=function(){return"JSG.graph.attr.EdgeAttributes"};JSG.graph.attr.EdgeAttributes.prototype.createValidator=function(){return new JSG.graph.attr.EdgeAttributesValidator};
JSG.graph.attr.EdgeAttributes.prototype.doSaveValidator=function(){return this.getValidator().getClassString()!=JSG.graph.attr.EdgeAttributesValidator.CLASSNAME};JSG.graph.attr.EdgeAttributesValidator=function(){JSG.graph.attr.EdgeAttributesValidator._super.constructor.call(this)};JSG.extend(JSG.graph.attr.EdgeAttributesValidator,JSG.graph.attr.ItemAttributesValidator);JSG.graph.attr.EdgeAttributesValidator.CLASSNAME="JSG.graph.attr.EdgeAttributesValidator";
JSG.graph.attr.EdgeAttributesValidator.prototype.getClassString=function(){return JSG.graph.attr.EdgeAttributesValidator.CLASSNAME};JSG.graph.attr.EdgeAttributesValidator.prototype.getDefaultValue=function(a){var b=JSG.graph.attr.ItemAttributes,c=void 0;switch(a.getName()){case b.CLOSED:case b.SNAPTO:case b.CONTAINER:c=!1;break;default:c=JSG.graph.attr.EdgeAttributesValidator._super.getDefaultValue.call(this,a)}return c};JSG.namespace("JSG.graph.attr");
JSG.graph.attr.TextNodeAttributes=function(a){JSG.graph.attr.TextNodeAttributes._super.constructor.call(this,a)};JSG.extend(JSG.graph.attr.TextNodeAttributes,JSG.graph.attr.ItemAttributes);JSG.graph.attr.TextNodeAttributes.SIZEMODE="sizemode";JSG.graph.attr.TextNodeAttributes.SizeMode={TEXT:1,WIDTH:2};JSG.graph.attr.TextNodeAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.TextNodeAttributes(a)};JSG.graph.attr.TextNodeAttributes.prototype.getClassString=function(){return"JSG.graph.attr.TextNodeAttributes"};
JSG.graph.attr.TextNodeAttributes.prototype.createValidator=function(){return new JSG.graph.attr.TextNodeAttributesValidator};JSG.graph.attr.TextNodeAttributes.prototype.doSaveValidator=function(){return this.getValidator().getClassString()!=JSG.graph.attr.TextNodeAttributesValidator.CLASSNAME};
JSG.graph.attr.TextNodeAttributes.prototype.isPredefinedAttribute=function(a){var b=a.getName();return JSG.hasPropertyWithValue(JSG.graph.attr.TextNodeAttributes,b)||JSG.graph.attr.TextNodeAttributes._super.isPredefinedAttribute.call(this,a)};
JSG.graph.attr.TextNodeAttributes.prototype.fillList=function(){JSG.graph.attr.TextNodeAttributes._super.fillList.call(this);var a=JSG.graph.attr.TextNodeAttributes.SIZEMODE;if(void 0==this.getAttribute(a)){var b=this.getValidator(),a=this.addAttribute(new JSG.graph.attr.NumberAttribute(a,JSG.graph.attr.TextNodeAttributes.SizeMode.TEXT));a.setExpressionOrValue(b.getDefaultValue(a))}};JSG.graph.attr.TextNodeAttributes.prototype.getSizeMode=function(){return this.getAttribute(JSG.graph.attr.TextNodeAttributes.SIZEMODE)};
JSG.graph.attr.TextNodeAttributes.prototype.setSizeMode=function(a,b){this.setAttribute(JSG.graph.attr.TextNodeAttributes.SIZEMODE,a,b)};JSG.graph.attr.TextNodeAttributesValidator=function(){JSG.graph.attr.TextNodeAttributesValidator._super.constructor.call(this)};JSG.extend(JSG.graph.attr.TextNodeAttributesValidator,JSG.graph.attr.ItemAttributesValidator);JSG.graph.attr.TextNodeAttributesValidator.CLASSNAME="JSG.graph.attr.TextNodeAttributesValidator";
JSG.graph.attr.TextNodeAttributesValidator.prototype.getClassString=function(){return JSG.graph.attr.TextNodeAttributesValidator.CLASSNAME};JSG.graph.attr.TextNodeAttributesValidator.prototype.getValidValues=function(a){return a.getName()==JSG.graph.attr.TextNodeAttributes.SIZEMODE?JSG.graph.attr.TextNodeAttributes.SizeMode:JSG.graph.attr.TextNodeAttributesValidator._super.getValidValues.call(this,a)};
JSG.graph.attr.TextNodeAttributesValidator.prototype.getDefaultValue=function(a){var b=void 0,b=JSG.graph.attr.ItemAttributes;switch(a.getName()){case b.CONTAINER:b=!1;break;case b.PORTMODE:b=JSG.graph.attr.consts.PortMode.NONE;break;case b.SNAPTO:b=!1;break;case b.MARGINLEFT:b=150;break;case b.MARGINRIGHT:b=150;break;case b.MARGINTOP:b=150;break;case b.MARGINBOTTOM:b=150;break;case JSG.graph.attr.TextNodeAttributes.SIZEMODE:b=JSG.graph.attr.TextNodeAttributes.SizeMode.TEXT;break;default:b=JSG.graph.attr.TextNodeAttributesValidator._super.getDefaultValue.call(this,
a)}return b};JSG.graph.attr.TextNodeAttributesValidator.prototype.isValidValueOrExpression=function(a,b){return b.getName()==JSG.graph.attr.ItemAttributes.MARGINBOTTOM?150==a:!0};JSG.namespace("JSG.graph.attr");JSG.graph.attr.LayoutAttributes=function(a){JSG.graph.attr.LayoutAttributes._super.constructor.call(this,JSG.graph.attr.LayoutAttributes.NAME,a);this._constraints=this._layouter=void 0};JSG.extend(JSG.graph.attr.LayoutAttributes,JSG.graph.attr.AbstractAttributeList);
JSG.graph.attr.LayoutAttributes.NAME="layoutattributes";JSG.graph.attr.LayoutAttributes.LAYOUT="layout";JSG.graph.attr.LayoutAttributes.LAYOUTABLE="layoutable";JSG.graph.attr.LayoutAttributes.LAYOUTSIZE="layoutsize";JSG.graph.attr.LayoutAttributes.AUTOLAYOUT="autolayout";JSG.graph.attr.LayoutAttributes.AUTOREZISE="autoresize";JSG.graph.attr.LayoutAttributes.AUTOREZISELEVEL="autoresizelevel";JSG.graph.attr.LayoutAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.LayoutAttributes(a)};
JSG.graph.attr.LayoutAttributes.prototype.getClassString=function(){return"JSG.graph.attr.LayoutAttributes"};JSG.graph.attr.LayoutAttributes.prototype.createValidator=function(){return new JSG.graph.attr.LayoutAttributesValidator};JSG.graph.attr.LayoutAttributes.prototype.doSaveValidator=function(){return this.getValidator().getClassString()!=JSG.graph.attr.LayoutAttributesValidator.CLASSNAME};
JSG.graph.attr.LayoutAttributes.prototype.isPredefinedAttribute=function(a){var b=a.getName();return JSG.hasPropertyWithValue(JSG.graph.attr.LayoutAttributes,b)||JSG.graph.attr.LayoutAttributes._super.isPredefinedAttribute.call(this,a)};
JSG.graph.attr.LayoutAttributes.prototype.fillList=function(){var a=this.getValidator(),b=JSG.graph.attr.LayoutAttributes;this.initAndAddAttribute(new JSG.graph.attr.StringAttribute(b.LAYOUT),a);this.initAndAddAttribute(new JSG.graph.attr.NumberAttribute(b.LAYOUTSIZE),a);this.initAndAddAttribute(new JSG.graph.attr.BooleanAttribute(b.LAYOUTABLE),a);this.initAndAddAttribute(new JSG.graph.attr.BooleanAttribute(b.AUTOLAYOUT),a);this.initAndAddAttribute(new JSG.graph.attr.NumberAttribute(b.AUTOREZISE),
a);this.initAndAddAttribute(new JSG.graph.attr.NumberAttribute(b.AUTOREZISELEVEL),a)};JSG.graph.attr.LayoutAttributes.prototype.initAndAddAttribute=function(a,b){void 0==this.getAttribute(a.getName())&&(this.addAttribute(a),a.setExpressionOrValue(b.getDefaultValue(a)))};JSG.graph.attr.LayoutAttributes.prototype.copy=function(){var a=this.newInstance(this._value.copy());this._constraints&&(a._constraints=this._constraints.copy());return a};
JSG.graph.attr.LayoutAttributes.prototype.getLayouter=function(){void 0==this._layouter&&(this._layouter=JSG.layoutFactory.createLayoutFromString(this.getLayout().getValue()));return this._layouter};JSG.graph.attr.LayoutAttributes.prototype.getConstraints=function(){void 0==this._constraints&&(this._constraints=JSG.layoutFactory.createConstraintsForLayout(this.getLayout().getValue()));return this._constraints};JSG.graph.attr.LayoutAttributes.prototype.getLayout=function(){return this.getAttribute(JSG.graph.attr.LayoutAttributes.LAYOUT)};
JSG.graph.attr.LayoutAttributes.prototype.setLayout=function(a,b){this.setAttribute(JSG.graph.attr.LayoutAttributes.LAYOUT,a,b)};JSG.graph.attr.LayoutAttributes.prototype.setAutoLayout=function(a,b){this.setAttribute(JSG.graph.attr.LayoutAttributes.AUTOLAYOUT,a,b)};JSG.graph.attr.LayoutAttributes.prototype.getAutoLayout=function(){return this.getAttribute(JSG.graph.attr.LayoutAttributes.AUTOLAYOUT)};
JSG.graph.attr.LayoutAttributes.prototype.setAutoResize=function(a,b){this.setAttribute(JSG.graph.attr.LayoutAttributes.AUTOREZISE,a,b)};JSG.graph.attr.LayoutAttributes.prototype.getAutoResize=function(){return this.getAttribute(JSG.graph.attr.LayoutAttributes.AUTOREZISE)};JSG.graph.attr.LayoutAttributes.prototype.setAutoResizeLevel=function(a,b){this.setAttribute(JSG.graph.attr.LayoutAttributes.AUTOREZISELEVEL,a,b)};JSG.graph.attr.LayoutAttributes.prototype.getAutoResizeLevel=function(){return this.getAttribute(JSG.graph.attr.LayoutAttributes.AUTOREZISELEVEL)};
JSG.graph.attr.LayoutAttributes.prototype.setLayoutable=function(a,b){this.setAttribute(JSG.graph.attr.LayoutAttributes.LAYOUTABLE,a,b)};JSG.graph.attr.LayoutAttributes.prototype.getLayoutable=function(){return this.getAttribute(JSG.graph.attr.LayoutAttributes.LAYOUTABLE)};JSG.graph.attr.LayoutAttributes.prototype.setLayoutSize=function(a,b){this.setAttribute(JSG.graph.attr.LayoutAttributes.LAYOUTSIZE,a,b)};JSG.graph.attr.LayoutAttributes.prototype.getLayoutSize=function(){return this.getAttribute(JSG.graph.attr.LayoutAttributes.LAYOUTSIZE)};
JSG.graph.attr.LayoutAttributes.prototype.readLegacyXML=function(a,b){var c=new JSG.graph.model.attributes.LayoutAttributes;c.register(b);c.readXML(a);this.applyLegacyAttributes(c)};
JSG.graph.attr.LayoutAttributes.prototype.applyLegacyAttributes=function(a){var b=JSG.graph.attr.LayoutAttributes;this.setAttribute(b.LAYOUT,a.getLayout());this.setAttribute(b.LAYOUTABLE,a.getLayoutable());this.setAttribute(b.LAYOUTSIZE,a.getLayoutSize());this.setAttribute(b.AUTOLAYOUT,a.getAutoLayout());this.setAttribute(b.AUTOREZISE,a.getAutoResize());this.setAttribute(b.AUTOREZISELEVEL,a.getAutoResizeLevel());a._constraints&&(this._constraints=a._constraints.copy())};
JSG.graph.attr.LayoutAttributes.prototype.setAttribute=function(a,b,c){a!==JSG.graph.attr.LayoutAttributes.LAYOUT||void 0!=b.getValue&&this.getLayout().getValue()!=b.getValue()||(this._constraints=this._layouter=void 0);JSG.graph.attr.LayoutAttributes._super.setAttribute.call(this,a,b,c)};JSG.graph.attr.LayoutAttributes.prototype._saveValue=function(a){var b=this.getConstraints(),c=JSG.graph.attr.LayoutAttributes._super._saveValue.call(this,a);b&&b.toXML(a);return c};
JSG.graph.attr.LayoutAttributes.prototype._readValue=function(a){JSG.graph.attr.LayoutAttributes._super._readValue.call(this,a);var b=this.getConstraints();b&&(a=a.getElementsByTagName(b._layoutType),0<a.length&&b.fromXML(a[0]))};JSG.namespace("JSG.graph.attr");JSG.graph.attr.LayoutAttributesValidator=function(){JSG.graph.attr.LayoutAttributesValidator._super.constructor.call(this)};JSG.extend(JSG.graph.attr.LayoutAttributesValidator,JSG.graph.attr.AbstractAttributeValidator);
JSG.graph.attr.LayoutAttributesValidator.CLASSNAME="JSG.graph.attr.LayoutAttributesValidator";JSG.graph.attr.LayoutAttributesValidator.prototype.getClassString=function(){return JSG.graph.attr.LayoutAttributesValidator.CLASSNAME};
JSG.graph.attr.LayoutAttributesValidator.prototype.fillDefaultValues=function(){var a=JSG.graph.attr.LayoutAttributes;this.setDefaultValue(a.LAYOUT,"None");this.setDefaultValue(a.LAYOUTABLE,!0);this.setDefaultValue(a.LAYOUTSIZE,0);this.setDefaultValue(a.AUTOLAYOUT,!1);this.setDefaultValue(a.AUTOREZISE,JSG.graph.attr.consts.Direction.NONE);this.setDefaultValue(a.AUTOREZISELEVEL,0)};
JSG.graph.attr.LayoutAttributesValidator.prototype.getValidValues=function(a){var b=void 0,c=JSG.graph.attr.LayoutAttributes,d=JSG.graph.attr.consts;switch(a.getName()){case c.AUTOREZISE:b=d.Direction}return b};JSG.namespace("JSG.graph.attr");JSG.graph.attr.EdgeLayoutAttributes=function(a){JSG.graph.attr.EdgeLayoutAttributes._super.constructor.call(this,a)};JSG.extend(JSG.graph.attr.EdgeLayoutAttributes,JSG.graph.attr.LayoutAttributes);JSG.graph.attr.EdgeLayoutAttributes.TYPE="type";
JSG.graph.attr.EdgeLayoutAttributes.LINEBEHAVIOR="linebehavior";JSG.graph.attr.EdgeLayoutAttributes.MIN_DIST_TO_PORT="minportdist";JSG.graph.attr.EdgeLayoutAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.EdgeLayoutAttributes(a)};JSG.graph.attr.EdgeLayoutAttributes.prototype.getClassString=function(){return"JSG.graph.attr.EdgeLayoutAttributes"};JSG.graph.attr.EdgeLayoutAttributes.prototype.createValidator=function(){return new JSG.graph.attr.EdgeLayoutAttributesValidator};
JSG.graph.attr.EdgeLayoutAttributes.prototype.doSaveValidator=function(){return this.getValidator().getClassString()!=JSG.graph.attr.EdgeLayoutAttributesValidator.CLASSNAME};JSG.graph.attr.EdgeLayoutAttributes.prototype.isPredefinedAttribute=function(a){var b=a.getName();return JSG.hasPropertyWithValue(JSG.graph.attr.EdgeLayoutAttributes,b)||JSG.graph.attr.EdgeLayoutAttributes._super.isPredefinedAttribute.call(this,a)};
JSG.graph.attr.EdgeLayoutAttributes.prototype.fillList=function(){JSG.graph.attr.EdgeLayoutAttributes._super.fillList.call(this);var a=this.getValidator(),b=JSG.graph.attr.EdgeLayoutAttributes;this.initAndAddAttribute(new JSG.graph.attr.StringAttribute(b.TYPE),a);this.initAndAddAttribute(new JSG.graph.attr.StringAttribute(b.LINEBEHAVIOR),a);this.initAndAddAttribute(new JSG.graph.attr.NumberAttribute(b.MIN_DIST_TO_PORT),a)};JSG.graph.attr.EdgeLayoutAttributes.prototype.getType=function(){return this.getAttribute(JSG.graph.attr.EdgeLayoutAttributes.TYPE)};
JSG.graph.attr.EdgeLayoutAttributes.prototype.setType=function(a,b){this.setAttribute(JSG.graph.attr.EdgeLayoutAttributes.TYPE,types,b)};JSG.graph.attr.EdgeLayoutAttributes.prototype.getLineBehavior=function(){return this.getAttribute(JSG.graph.attr.EdgeLayoutAttributes.LINEBEHAVIOR)};JSG.graph.attr.EdgeLayoutAttributes.prototype.setLineBehavior=function(a,b){this.setAttribute(JSG.graph.attr.EdgeLayoutAttributes.LINEBEHAVIOR,a,b)};JSG.graph.attr.EdgeLayoutAttributes.prototype.getMinDistToPort=function(){return this.getAttribute(JSG.graph.attr.EdgeLayoutAttributes.MIN_DIST_TO_PORT)};
JSG.graph.attr.EdgeLayoutAttributes.prototype.setMinDistToPort=function(a,b){this.setAttribute(JSG.graph.attr.EdgeLayoutAttributes.MIN_DIST_TO_PORT,a,b)};JSG.graph.attr.EdgeLayoutAttributes.prototype.readLegacyXML=function(a,b){var c=new JSG.graph.attr.FormatAttributes.EdgeLayoutAttributes;c.register(b);c.readXML(a);this.applyLegacyAttributes(c)};
JSG.graph.attr.EdgeLayoutAttributes.prototype.applyLegacyAttributes=function(a){JSG.graph.attr.EdgeLayoutAttributes._super.applyLegacyAttributes.call(this,a);var b=JSG.graph.attr.EdgeLayoutAttributes;this.setAttribute(b.TYPE,a.getType());this.setAttribute(b.LINEBEHAVIOR,a.getLineBehavior())};JSG.graph.attr.EdgeLayoutAttributesValidator=function(){JSG.graph.attr.EdgeLayoutAttributesValidator._super.constructor.call(this)};JSG.extend(JSG.graph.attr.EdgeLayoutAttributesValidator,JSG.graph.attr.LayoutAttributesValidator);
JSG.graph.attr.EdgeLayoutAttributesValidator.CLASSNAME="JSG.graph.attr.EdgeLayoutAttributesValidator";JSG.graph.attr.EdgeLayoutAttributesValidator.prototype.getClassString=function(){return JSG.graph.attr.EdgeLayoutAttributesValidator.CLASSNAME};
JSG.graph.attr.EdgeLayoutAttributesValidator.prototype.fillDefaultValues=function(){JSG.graph.attr.EdgeLayoutAttributesValidator._super.fillDefaultValues.call(this);var a=JSG.graph.attr.EdgeLayoutAttributes;this.setDefaultValue(a.TYPE,"Straight");this.setDefaultValue(a.LINEBEHAVIOR,JSG.graph.model.shapes.OrthoLineBehavior.MANUAL);this.setDefaultValue(a.MIN_DIST_TO_PORT,500)};
JSG.graph.attr.EdgeLayoutAttributesValidator.prototype.getValidValues=function(a){return a.getName()==JSG.graph.attr.EdgeLayoutAttributes.LINEBEHAVIOR?JSG.graph.model.shapes.OrthoLineBehavior:JSG.graph.attr.EdgeLayoutAttributesValidator._super.getValidValues.call(this,a)};JSG.namespace("JSG.graph.attr");JSG.graph.attr.OrthoEdgeLayoutAttributes=function(a){JSG.graph.attr.OrthoEdgeLayoutAttributes._super.constructor.call(this,a)};JSG.extend(JSG.graph.attr.OrthoEdgeLayoutAttributes,JSG.graph.attr.EdgeLayoutAttributes);
JSG.graph.attr.OrthoEdgeLayoutAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.OrthoEdgeLayoutAttributes(a)};JSG.graph.attr.OrthoEdgeLayoutAttributes.prototype.getClassString=function(){return"JSG.graph.attr.OrthoEdgeLayoutAttributes"};
JSG.graph.attr.OrthoEdgeLayoutAttributes.prototype.createValidator=function(){var a=JSG.graph.attr.EdgeLayoutAttributes,b=new JSG.graph.attr.EdgeLayoutAttributesValidator;b.setDefaultValue(a.TYPE,"Orthogonal");b.setDefaultValue(a.LINEBEHAVIOR,JSG.graph.model.shapes.OrthoLineBehavior.AUTO);return b};JSG.graph.attr.OrthoEdgeLayoutAttributes.prototype.readLegacyXML=function(a,b){var c=new JSG.graph.model.attributes.OrthoEdgeLayoutAttributes;c.register(b);c.readXML(a);this.applyLegacyAttributes(c)};JSG.namespace("JSG.graph.attr");
JSG.graph.attr.FormatAttributes=function(a){JSG.graph.attr.FormatAttributes._super.constructor.call(this,JSG.graph.attr.FormatAttributes.NAME,a)};JSG.extend(JSG.graph.attr.FormatAttributes,JSG.graph.attr.AbstractAttributeList);JSG.graph.attr.FormatAttributes.NAME="format";JSG.graph.attr.FormatAttributes.BRIGHTNESS="brightness";JSG.graph.attr.FormatAttributes.FILLSTYLE="fillstyle";JSG.graph.attr.FormatAttributes.FILLCOLOR="fillcolor";JSG.graph.attr.FormatAttributes.GRADIENTCOLOR="gradientcolor";
JSG.graph.attr.FormatAttributes.GRADIENTANGLE="gradientangle";JSG.graph.attr.FormatAttributes.GRADIENTTYPE="gradienttype";JSG.graph.attr.FormatAttributes.GRADIENTOFFSET_X="gradientoffset_x";JSG.graph.attr.FormatAttributes.GRADIENTOFFSET_Y="gradientoffset_y";JSG.graph.attr.FormatAttributes.LINECOLOR="linecolor";JSG.graph.attr.FormatAttributes.LINEWIDTH="linewidth";JSG.graph.attr.FormatAttributes.LINESTYLE="linestyle";JSG.graph.attr.FormatAttributes.LINEARROWSTART="linearrowstart";
JSG.graph.attr.FormatAttributes.LINEARROWEND="linearrowend";JSG.graph.attr.FormatAttributes.LINECORNER="linecorner";JSG.graph.attr.FormatAttributes.PATTERN="pattern";JSG.graph.attr.FormatAttributes.PATTERNSTYLE="patternstyle";JSG.graph.attr.FormatAttributes.SHADOWCOLOR="shadowcolor";JSG.graph.attr.FormatAttributes.SHADOWOFFSET_X="shadowoffset_x";JSG.graph.attr.FormatAttributes.SHADOWOFFSET_Y="shadowoffset_y";JSG.graph.attr.FormatAttributes.SHADOWBLUR="shadowblur";
JSG.graph.attr.FormatAttributes.SHADOWDIRECTION="shadowdirection";JSG.graph.attr.FormatAttributes.TRANSPARENCY="transparency";
JSG.graph.attr.FormatAttributes.ArrowStyle={NONE:0,ARROWFILLED:1,ARROWFILLEDSMALL:2,ARROWHALFFILLED:3,ARROWHALFFILLEDSMALL:4,ARROWNNARROWFILLED:5,ARROWNARROWFILLEDSMALL:6,ARROWDOUBLEFILLED:7,ARROWDOUBLEFILLEDSMALL:8,ARROW:9,ARROWSMALL:10,ARROWDOUBLE:11,ARROWDOUBLESMALL:12,ARROWSINGLESIDE:13,ARROWREVERSEFILLED:14,ARROWREVERSEFILLEDSMALL:15,ARROWREVERSE:16,ARROWREVERSESMALL:17,ARROWREVERSENARROW:18,ARROWREVERSENARROWSMALL:19,LINEARROWREVERSE:20,CIRCLEARROWREVERSE:21,CIRCLE:22,CIRCLESMALL:23,DIAMOND:24,
DIAMONDSMALL:25,DIAMONDNARROW:26,DIAMONDNARROWSMALL:27,CIRCLEDOUBLELINE:28,DOUBLELINE:29,SQUARE:30,SQUARESMALL:31,DIAMONDLONG:32,ARROWFILLEDLONG:33,DIAGONALLINE:34,CIRCLESMALLAROUND:35};JSG.graph.attr.FormatAttributes.LineStyle={HAIRLINE:-1,NONE:0,SOLID:1,DOT:2,DASH:3,DASHDOT:4,DASHDOTDOT:5};JSG.graph.attr.FormatAttributes.FillStyle={NONE:0,SOLID:1,GRADIENT:2,PATTERN:3};JSG.graph.attr.FormatAttributes.GradientStyle={LINEAR:0,RADIAL:1};
JSG.graph.attr.FormatAttributes.PatternStyle={STRETCH:0,REPEAT:1,CENTER:2,STRETCHPROPORTIONAL:3};JSG.graph.attr.FormatAttributes.ShadowDirection={LEFTTOP:0,LEFTBOTTOM:1,RIGHTTOP:2,RIGHTBOTTOM:3};JSG.graph.attr.FormatAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.FormatAttributes(a)};JSG.graph.attr.FormatAttributes.prototype.getClassString=function(){return"JSG.graph.attr.FormatAttributes"};JSG.graph.attr.FormatAttributes.prototype.createValidator=function(){return new JSG.graph.attr.FormatAttributesValidator};
JSG.graph.attr.FormatAttributes.prototype.fillList=function(){function a(a){void 0==b.getAttribute(a.getName())&&(b.addAttribute(a),a.setExpressionOrValue(c.getDefaultValue(a)))}var b=this,c=this.getValidator(),d=JSG.graph.attr.FormatAttributes;a(new JSG.graph.attr.NumberAttribute(d.BRIGHTNESS));a(new JSG.graph.attr.NumberAttribute(d.FILLSTYLE));a(new JSG.graph.attr.StringAttribute(d.FILLCOLOR));a(new JSG.graph.attr.StringAttribute(d.GRADIENTCOLOR));a(new JSG.graph.attr.NumberAttribute(d.GRADIENTANGLE));
a(new JSG.graph.attr.NumberAttribute(d.GRADIENTTYPE));a(new JSG.graph.attr.NumberAttribute(d.GRADIENTOFFSET_X));a(new JSG.graph.attr.NumberAttribute(d.GRADIENTOFFSET_Y));a(new JSG.graph.attr.StringAttribute(d.LINECOLOR));a(new JSG.graph.attr.NumberAttribute(d.LINEWIDTH));a(new JSG.graph.attr.NumberAttribute(d.LINESTYLE));a(new JSG.graph.attr.NumberAttribute(d.LINEARROWSTART));a(new JSG.graph.attr.NumberAttribute(d.LINEARROWEND));a(new JSG.graph.attr.NumberAttribute(d.LINECORNER));a(new JSG.graph.attr.StringAttribute(d.PATTERN));
a(new JSG.graph.attr.NumberAttribute(d.PATTERNSTYLE));a(new JSG.graph.attr.StringAttribute(d.SHADOWCOLOR));a(new JSG.graph.attr.NumberAttribute(d.SHADOWOFFSET_X));a(new JSG.graph.attr.NumberAttribute(d.SHADOWOFFSET_Y));a(new JSG.graph.attr.NumberAttribute(d.SHADOWBLUR));a(new JSG.graph.attr.NumberAttribute(d.SHADOWDIRECTION));a(new JSG.graph.attr.NumberAttribute(d.TRANSPARENCY))};
JSG.graph.attr.FormatAttributes.prototype.isPredefinedAttribute=function(a){a=a.getName();return JSG.hasPropertyWithValue(JSG.graph.attr.FormatAttributes,a)};JSG.graph.attr.FormatAttributes.brighten=function(a,b){a=a.replace(/^\s*#|\s*$/g,"");3==a.length&&(a=a.replace(/(.)/g,"$1$1"));var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return"#"+(0|256+c+(256-c)*b/100).toString(16).substr(1)+(0|256+d+(256-d)*b/100).toString(16).substr(1)+(0|256+e+(256-e)*b/100).toString(16).substr(1)};
JSG.graph.attr.FormatAttributes.retainFromSelection=function(a){function b(a,b){return void 0!=a&&void 0!=b&&a.getExpression().isEqualTo(b.getExpression())}if(!a.isEmpty()){for(var c=JSG.graph.attr.FormatAttributes.NAME,d=a[0].getModel().getFormat().copy(),e=1;e<a.length;e++)d.retainAll(a[e].getModel().getAttributeAtPath(c),b);return d}};JSG.graph.attr.FormatAttributes.prototype.setFormatTo=function(a,b){return this.applyAttributesMap(a.toMap(),b)};
JSG.graph.attr.FormatAttributes.prototype.hasFill=function(){var a=this.getAttribute(JSG.graph.attr.FormatAttributes.FILLSTYLE);return void 0!=a&&a.getValue()!=JSG.graph.attr.FormatAttributes.FillStyle.NONE};JSG.graph.attr.FormatAttributes.prototype.hasBorder=function(){var a=this.getAttribute(JSG.graph.attr.FormatAttributes.LINEWIDTH).getValue(),b=this.getAttribute(JSG.graph.attr.FormatAttributes.LINESTYLE).getValue();return(0<a||a==JSG.graph.attr.FormatAttributes.LineStyle.HAIRLINE)&&b!=JSG.graph.attr.FormatAttributes.LineStyle.NONE};
JSG.graph.attr.FormatAttributes.prototype.applyFillToGraphics=function(a,b){var c=JSG.graph.attr.FormatAttributes,d=this.getAttribute(c.TRANSPARENCY).getValue();100!=d&&a.setTransparency(d);var e=this.getAttribute(c.FILLSTYLE).getValue();a.setFillStyle(e);a.setLineCorner(this.getAttribute(c.LINECORNER).getValue());var d=this.getAttribute(c.FILLCOLOR).getValue(),f=this.getAttribute(c.BRIGHTNESS).getValue();0!=f&&(d=c.brighten(d,f));a.setFillColor(d);switch(e){case c.FillStyle.GRADIENT:f=this.getAttribute(c.GRADIENTTYPE).getValue();
e=this.getAttribute(c.GRADIENTCOLOR).getValue();f===c.GradientStyle.LINEAR?(c=this.getAttribute(c.GRADIENTANGLE).getValue(),a.setGradientLinear(b,d,e,c)):(f=this.getAttribute(c.GRADIENTOFFSET_X).getValue(),c=this.getAttribute(c.GRADIENTOFFSET_Y).getValue(),a.setGradientRadial(b,d,e,f,c));break;case c.FillStyle.PATTERN:d=this.getAttribute(c.PATTERN).getValue(),c=this.getAttribute(c.PATTERNSTYLE).getValue(),a.setPattern(b,d,c)}};
JSG.graph.attr.FormatAttributes.prototype.applyLineToGraphics=function(a){var b=JSG.graph.attr.FormatAttributes;a.setLineColor(this.getAttribute(b.LINECOLOR).getValue());a.setLineStyle(this.getAttribute(b.LINESTYLE).getValue());a.setLineWidth(this.getAttribute(b.LINEWIDTH).getValue());a.setLineArrowStart(this.getAttribute(b.LINEARROWSTART).getValue());a.setLineArrowEnd(this.getAttribute(b.LINEARROWEND).getValue());a.setLineCorner(this.getAttribute(b.LINECORNER).getValue())};
JSG.graph.attr.FormatAttributes.prototype.removeLineFromGraphics=function(a){var b=JSG.graph.attr.FormatAttributes,c=this.getValidator();a.setLineStyle(c.getDefaultValue(this.getAttribute(b.LINESTYLE)));a.setLineArrowStart(c.getDefaultValue(this.getAttribute(b.LINEARROWSTART)));a.setLineArrowEnd(c.getDefaultValue(this.getAttribute(b.LINEARROWEND)));a.setLineCorner(c.getDefaultValue(this.getAttribute(b.LINECORNER)))};
JSG.graph.attr.FormatAttributes.prototype.applyShadowToGraphics=function(a,b){var c=JSG.graph.attr.FormatAttributes,d=this.getAttribute(c.SHADOWOFFSET_X).getValue(),e=this.getAttribute(c.SHADOWOFFSET_Y).getValue();if(0!=d||0!=e){var f=this.getAttribute(c.SHADOWBLUR).getValue(),g=this.getAttribute(c.SHADOWCOLOR).getValue();switch(this.getAttribute(c.SHADOWDIRECTION).getValue()){case c.ShadowDirection.LEFTTOP:d=-d;e=-e;break;case c.ShadowDirection.RIGHTTOP:e=-e;break;case c.ShadowDirection.LEFTBOTTOM:d=
-d}a.setShadow(g,d,e,f,b)}};JSG.graph.attr.FormatAttributes.prototype.removeShadowFromGraphics=function(a){a.resetShadow();a.setLineCorner(0);100!=this.getAttribute(JSG.graph.attr.FormatAttributes.TRANSPARENCY).getValue()&&a.setTransparency(100)};
JSG.graph.attr.FormatAttributes.prototype.applyLegacyFormat=function(a){var b=JSG.graph.attr.FormatAttributes;this.setAttribute(b.BRIGHTNESS,a.getBrightness());this.setAttribute(b.FILLSTYLE,a.getFillStyle());this.setAttribute(b.FILLCOLOR,a.getFillColor());this.setAttribute(b.GRADIENTCOLOR,a.getGradientColor());this.setAttribute(b.GRADIENTANGLE,a.getGradientAngle());this.setAttribute(b.GRADIENTTYPE,a.getGradientType());this.setAttribute(b.GRADIENTOFFSET_X,a.getGradientOffsetX());this.setAttribute(b.GRADIENTOFFSET_Y,
a.getGradientOffsetY());this.setAttribute(b.LINECOLOR,a.getLineColor());this.setAttribute(b.LINEWIDTH,a.getLineWidth());this.setAttribute(b.LINESTYLE,a.getLineStyle());this.setAttribute(b.LINEARROWSTART,a.getLineArrowStart());this.setAttribute(b.LINEARROWEND,a.getLineArrowEnd());this.setAttribute(b.LINECORNER,a.getLineCorner());this.setAttribute(b.PATTERN,a.getPattern());this.setAttribute(b.PATTERNSTYLE,a.getPatternStyle());this.setAttribute(b.SHADOWCOLOR,a.getShadowColor());this.setAttribute(b.SHADOWOFFSET_X,
a.getShadowOffsetX());this.setAttribute(b.SHADOWOFFSET_Y,a.getShadowOffsetY());this.setAttribute(b.SHADOWBLUR,a.getShadowBlur());this.setAttribute(b.SHADOWDIRECTION,a.getShadowDirection());this.setAttribute(b.TRANSPARENCY,a.getTransparency())};JSG.graph.attr.FormatAttributes.prototype.getFillColor=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.FILLCOLOR)};
JSG.graph.attr.FormatAttributes.prototype.setFillColor=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.FILLCOLOR,a,b)};JSG.graph.attr.FormatAttributes.prototype.setFillColorRGB=function(a,b,c){this.setFillColor("#"+JSG.graph.Utils.colorFromRGB(a,b,c))};JSG.graph.attr.FormatAttributes.prototype.getFillStyle=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.FILLSTYLE)};
JSG.graph.attr.FormatAttributes.prototype.setFillStyle=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.FILLSTYLE,a,b)};JSG.graph.attr.FormatAttributes.prototype.getBrightness=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.BRIGHTNESS)};JSG.graph.attr.FormatAttributes.prototype.setBrightness=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.BRIGHTNESS,a,b)};JSG.graph.attr.FormatAttributes.prototype.getTransparency=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.TRANSPARENCY)};
JSG.graph.attr.FormatAttributes.prototype.setTransparency=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.TRANSPARENCY,a,b)};JSG.graph.attr.FormatAttributes.prototype.getGradientColor=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.GRADIENTCOLOR)};JSG.graph.attr.FormatAttributes.prototype.setGradientColor=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.GRADIENTCOLOR,a,b)};
JSG.graph.attr.FormatAttributes.prototype.setGradientColorRGB=function(a,b,c){this.setGradientColor("#"+JSG.graph.Utils.colorFromRGB(a,b,c))};JSG.graph.attr.FormatAttributes.prototype.getGradientAngle=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.GRADIENTANGLE)};JSG.graph.attr.FormatAttributes.prototype.setGradientAngle=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.GRADIENTANGLE,a,b)};JSG.graph.attr.FormatAttributes.prototype.getGradientOffsetX=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.GRADIENTOFFSET_X)};
JSG.graph.attr.FormatAttributes.prototype.setGradientOffsetX=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.GRADIENTOFFSET_X,a,b)};JSG.graph.attr.FormatAttributes.prototype.getGradientOffsetY=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.GRADIENTOFFSET_Y)};JSG.graph.attr.FormatAttributes.prototype.setGradientOffsetY=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.GRADIENTOFFSET_Y,a,b)};
JSG.graph.attr.FormatAttributes.prototype.getGradientType=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.GRADIENTTYPE)};JSG.graph.attr.FormatAttributes.prototype.setGradientType=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.GRADIENTTYPE,a,b)};JSG.graph.attr.FormatAttributes.prototype.getPattern=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.PATTERN)};
JSG.graph.attr.FormatAttributes.prototype.setPattern=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.PATTERN,a,b)};JSG.graph.attr.FormatAttributes.prototype.getPatternStyle=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.PATTERNSTYLE)};JSG.graph.attr.FormatAttributes.prototype.setPatternStyle=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.PATTERNSTYLE,a,b)};JSG.graph.attr.FormatAttributes.prototype.getLineColor=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.LINECOLOR)};
JSG.graph.attr.FormatAttributes.prototype.setLineColor=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.LINECOLOR,a,b)};JSG.graph.attr.FormatAttributes.prototype.setLineColorRGB=function(a,b,c){this.setLineColor("#"+JSG.graph.Utils.colorFromRGB(a,b,c))};JSG.graph.attr.FormatAttributes.prototype.getLineCorner=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.LINECORNER)};
JSG.graph.attr.FormatAttributes.prototype.setLineCorner=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.LINECORNER,a,b)};JSG.graph.attr.FormatAttributes.prototype.getLineArrowStart=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.LINEARROWSTART)};JSG.graph.attr.FormatAttributes.prototype.setLineArrowStart=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.LINEARROWSTART,a,b)};JSG.graph.attr.FormatAttributes.prototype.getLineArrowEnd=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.LINEARROWEND)};
JSG.graph.attr.FormatAttributes.prototype.setLineArrowEnd=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.LINEARROWEND,a,b)};JSG.graph.attr.FormatAttributes.prototype.getShadowColor=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.SHADOWCOLOR)};JSG.graph.attr.FormatAttributes.prototype.setShadowColor=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.SHADOWCOLOR,a,b)};
JSG.graph.attr.FormatAttributes.prototype.setShadowColorRGB=function(a,b,c){this.setShadowColor("#"+JSG.graph.Utils.colorFromRGB(a,b,c))};JSG.graph.attr.FormatAttributes.prototype.getShadowOffsetX=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.SHADOWOFFSET_X)};JSG.graph.attr.FormatAttributes.prototype.setShadowOffsetX=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.SHADOWOFFSET_X,a,b)};JSG.graph.attr.FormatAttributes.prototype.getShadowOffsetY=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.SHADOWOFFSET_Y)};
JSG.graph.attr.FormatAttributes.prototype.setShadowOffsetY=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.SHADOWOFFSET_Y,a,b)};JSG.graph.attr.FormatAttributes.prototype.getShadowDirection=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.SHADOWDIRECTION)};JSG.graph.attr.FormatAttributes.prototype.setShadowDirection=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.SHADOWDIRECTION,a,b)};JSG.graph.attr.FormatAttributes.prototype.getShadowBlur=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.SHADOWBLUR)};
JSG.graph.attr.FormatAttributes.prototype.setShadowBlur=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.SHADOWBLUR,a,b)};JSG.graph.attr.FormatAttributes.prototype.getLineWidth=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.LINEWIDTH)};JSG.graph.attr.FormatAttributes.prototype.setLineWidth=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.LINEWIDTH,a,b)};JSG.graph.attr.FormatAttributes.prototype.getLineStyle=function(){return this.getAttribute(JSG.graph.attr.FormatAttributes.LINESTYLE)};
JSG.graph.attr.FormatAttributes.prototype.setLineStyle=function(a,b){this.setAttribute(JSG.graph.attr.FormatAttributes.LINESTYLE,a,b)};JSG.namespace("JSG.graph.attr");JSG.graph.attr.FormatAttributesValidator=function(){JSG.graph.attr.FormatAttributesValidator._super.constructor.call(this)};JSG.extend(JSG.graph.attr.FormatAttributesValidator,JSG.graph.attr.AttributeValidator);JSG.graph.attr.FormatAttributesValidator.prototype.getClassString=function(){return"JSG.graph.attr.FormatAttributesValidator"};
JSG.graph.attr.FormatAttributesValidator.prototype.getValidValues=function(a){var b=void 0,c=JSG.graph.attr.FormatAttributes;switch(a.getName()){case c.LINEARROWEND:case c.LINEARROWSTART:b=c.ArrowStyle;break;case c.FILLSTYLE:b=c.FillStyle;break;case c.GRADIENTTYPE:b=c.GradientStyle;break;case c.LINESTYLE:b=c.LineStyle;break;case c.PATTERNSTYLE:b=c.PatternStyle;break;case c.SHADOWDIRECTION:b=c.ShadowDirection}return b};
JSG.graph.attr.FormatAttributesValidator.prototype.getDefaultValue=function(a){var b=void 0,c=JSG.graph.attr.FormatAttributes;switch(a.getName()){case c.BRIGHTNESS:b=0;break;case c.FILLSTYLE:b=c.FillStyle.SOLID;break;case c.FILLCOLOR:b="#FFFFFF";break;case c.GRADIENTCOLOR:b="#CCCCCC";break;case c.GRADIENTANGLE:b=0;break;case c.GRADIENTTYPE:b=c.GradientStyle.LINEAR;break;case c.GRADIENTOFFSET_X:b=0;break;case c.GRADIENTOFFSET_Y:b=0;break;case c.LINECOLOR:b="#000000";break;case c.LINEWIDTH:b=c.LineStyle.HAIRLINE;
break;case c.LINESTYLE:b=c.LineStyle.SOLID;break;case c.LINEARROWSTART:b=c.ArrowStyle.NONE;break;case c.LINEARROWEND:b=c.ArrowStyle.NONE;break;case c.LINECORNER:b=0;break;case c.PATTERN:b="";break;case c.PATTERNSTYLE:b=c.PatternStyle.STRETCH;break;case c.SHADOWCOLOR:b="#DDDDDD";break;case c.SHADOWOFFSET_X:b=0;break;case c.SHADOWOFFSET_Y:b=0;break;case c.SHADOWBLUR:b=0;break;case c.SHADOWDIRECTION:b=c.ShadowDirection.RIGHTBOTTOM;break;case c.TRANSPARENCY:b=100}return b};JSG.namespace("JSG.graph.attr");
JSG.graph.attr.TextFormatAttributes=function(a){JSG.graph.attr.TextFormatAttributes._super.constructor.call(this,JSG.graph.attr.TextFormatAttributes.NAME,a)};JSG.extend(JSG.graph.attr.TextFormatAttributes,JSG.graph.attr.AbstractAttributeList);JSG.graph.attr.TextFormatAttributes.NAME="textformat";JSG.graph.attr.TextFormatAttributes.VERTICALALIGN="valign";JSG.graph.attr.TextFormatAttributes.HORIZONTALALIGN="halign";JSG.graph.attr.TextFormatAttributes.FONTSIZE="fontsize";
JSG.graph.attr.TextFormatAttributes.FONTNAME="fontname";JSG.graph.attr.TextFormatAttributes.FONTCOLOR="fontcolor";JSG.graph.attr.TextFormatAttributes.FONTSTYLE="fontstyle";JSG.graph.attr.TextFormatAttributes.VERTICALPOSITION="vposition";JSG.graph.attr.TextFormatAttributes.HORIZONTALPOSITION="hpostion";JSG.graph.attr.TextFormatAttributes.TextAlignment={LEFT:0,CENTER:1,RIGHT:2};
JSG.graph.attr.TextFormatAttributes.VerticalTextPosition={CUSTOM:0,ONTOP:1,BEFORESTART:1,TOP:2,START:2,CENTER:3,BOTTOM:4,END:4,BELOWBOTTOM:5,BEHINDEND:5};JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition={CUSTOM:0,TOLEFT:1,LEFT:2,CENTER:3,RIGHT:4,TORIGHT:5};JSG.graph.attr.TextFormatAttributes.FontStyle={NORMAL:0,BOLD:1,ITALIC:2,UNDERLINE:4};JSG.graph.attr.TextFormatAttributes.prototype.newInstance=function(a){return new JSG.graph.attr.TextFormatAttributes(a)};
JSG.graph.attr.TextFormatAttributes.prototype.getClassString=function(){return"JSG.graph.attr.TextFormatAttributes"};JSG.graph.attr.TextFormatAttributes.prototype.createValidator=function(){return new JSG.graph.attr.TextFormatAttributesValidator};
JSG.graph.attr.TextFormatAttributes.prototype.fillList=function(){function a(a){void 0==b.getAttribute(a.getName())&&(b.addAttribute(a),a.setExpressionOrValue(c.getDefaultValue(a)))}var b=this,c=this.getValidator(),d=JSG.graph.attr.TextFormatAttributes;a(new JSG.graph.attr.NumberAttribute(d.FONTSIZE));a(new JSG.graph.attr.StringAttribute(d.FONTNAME));a(new JSG.graph.attr.StringAttribute(d.FONTCOLOR));a(new JSG.graph.attr.NumberAttribute(d.FONTSTYLE));a(new JSG.graph.attr.NumberAttribute(d.VERTICALPOSITION));
a(new JSG.graph.attr.NumberAttribute(d.HORIZONTALPOSITION));a(new JSG.graph.attr.NumberAttribute(d.HORIZONTALALIGN))};JSG.graph.attr.TextFormatAttributes.prototype.isPredefinedAttribute=function(a){a=a.getName();return JSG.hasPropertyWithValue(JSG.graph.attr.TextFormatAttributes,a)};
JSG.graph.attr.TextFormatAttributes.retainFromSelection=function(a){function b(a,b){return void 0!=a&&void 0!=b&&a.getExpression().isEqualTo(b.getExpression())}if(!a.isEmpty()){for(var c=a[0].getModel()._getTextFormat().copy(),d=1;d<a.length;d++)c.retainAll(a[d].getModel()._getTextFormat(),b);return c}};JSG.graph.attr.TextFormatAttributes.prototype.setFormatTo=function(a,b){return this.applyAttributesMap(a.toMap(),b)};
JSG.graph.attr.TextFormatAttributes.prototype.applyToGraphics=function(a,b){var c=JSG.graph.attr.TextFormatAttributes;a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID);a.setFillColor(this.getAttribute(c.FONTCOLOR).getValue());a.setTextBaseline("middle");a.setTextAlign(this.getAttribute(c.HORIZONTALALIGN).getValue());a.setFontName(this.getAttribute(c.FONTNAME).getValue());a.setFontSize(this.getAttribute(c.FONTSIZE).getValue());a.setFontStyle(this.getAttribute(c.FONTSTYLE).getValue())};
JSG.graph.attr.TextFormatAttributes.prototype.removeFromGraphics=function(a){a.setFontStyle(0)};
JSG.graph.attr.TextFormatAttributes.prototype.applyLegacyFormat=function(a){var b=JSG.graph.attr.TextFormatAttributes;this.setAttribute(b.FONTSIZE,a.getFontSize());this.setAttribute(b.FONTNAME,a.getFontName());this.setAttribute(b.FONTCOLOR,a.getFontColor());this.setAttribute(b.FONTSTYLE,a.getFontStyle());this.setAttribute(b.VERTICALPOSITION,a.getVerticalPosition());this.setAttribute(b.HORIZONTALPOSITION,a.getHorizontalPosition());this.setAttribute(b.HORIZONTALALIGN,a.getHorizontalAlignment())};
JSG.graph.attr.TextFormatAttributes.prototype.getHorizontalAlignment=function(){return this.getAttribute(JSG.graph.attr.TextFormatAttributes.HORIZONTALALIGN)};JSG.graph.attr.TextFormatAttributes.prototype.setHorizontalAlignment=function(a,b){this.setAttribute(JSG.graph.attr.TextFormatAttributes.HORIZONTALALIGN,a,b)};JSG.graph.attr.TextFormatAttributes.prototype.getVerticalPosition=function(){return this.getAttribute(JSG.graph.attr.TextFormatAttributes.VERTICALPOSITION)};
JSG.graph.attr.TextFormatAttributes.prototype.setVerticalPosition=function(a,b){this.setAttribute(JSG.graph.attr.TextFormatAttributes.VERTICALPOSITION,a,b)};JSG.graph.attr.TextFormatAttributes.prototype.getHorizontalPosition=function(){return this.getAttribute(JSG.graph.attr.TextFormatAttributes.HORIZONTALPOSITION)};JSG.graph.attr.TextFormatAttributes.prototype.setHorizontalPosition=function(a,b){this.setAttribute(JSG.graph.attr.TextFormatAttributes.HORIZONTALPOSITION,a,b)};
JSG.graph.attr.TextFormatAttributes.prototype.getFontSize=function(){return this.getAttribute(JSG.graph.attr.TextFormatAttributes.FONTSIZE)};JSG.graph.attr.TextFormatAttributes.prototype.setFontSize=function(a,b){this.setAttribute(JSG.graph.attr.TextFormatAttributes.FONTSIZE,a,b)};JSG.graph.attr.TextFormatAttributes.prototype.getFontName=function(){return this.getAttribute(JSG.graph.attr.TextFormatAttributes.FONTNAME)};
JSG.graph.attr.TextFormatAttributes.prototype.setFontName=function(a,b){this.setAttribute(JSG.graph.attr.TextFormatAttributes.FONTNAME,a,b)};JSG.graph.attr.TextFormatAttributes.prototype.getFontColor=function(){return this.getAttribute(JSG.graph.attr.TextFormatAttributes.FONTCOLOR)};JSG.graph.attr.TextFormatAttributes.prototype.setFontColor=function(a,b){this.setAttribute(JSG.graph.attr.TextFormatAttributes.FONTCOLOR,a,b)};JSG.graph.attr.TextFormatAttributes.prototype.getFontStyle=function(){return this.getAttribute(JSG.graph.attr.TextFormatAttributes.FONTSTYLE)};
JSG.graph.attr.TextFormatAttributes.prototype.setFontStyle=function(a,b){this.setAttribute(JSG.graph.attr.TextFormatAttributes.FONTSTYLE,a,b)};JSG.namespace("JSG.graph.attr");JSG.graph.attr.TextFormatAttributesValidator=function(){JSG.graph.attr.TextFormatAttributesValidator._super.constructor.call(this)};JSG.extend(JSG.graph.attr.TextFormatAttributesValidator,JSG.graph.attr.AttributeValidator);JSG.graph.attr.TextFormatAttributesValidator.prototype.getClassString=function(){return"JSG.graph.attr.TextFormatAttributesValidator"};
JSG.graph.attr.TextFormatAttributesValidator.prototype.getValidValues=function(a){var b=void 0,c=JSG.graph.attr.TextFormatAttributes;switch(a.getName()){case c.FONTSTYLE:b=c.FontStyle;break;case c.VERTICALPOSITION:b=c.VerticalTextPosition;break;case c.HORIZONTALPOSITION:b=c.HorizontalTextPosition;break;case c.HORIZONTALALIGN:b=c.TextAlignment}return b};
JSG.graph.attr.TextFormatAttributesValidator.prototype.getDefaultValue=function(a){var b=void 0,c=JSG.graph.attr.TextFormatAttributes;switch(a.getName()){case c.FONTCOLOR:b="#000000";break;case c.FONTNAME:b="Arial";break;case c.FONTSIZE:b=8;break;case c.FONTSTYLE:b=c.FontStyle.NORMAL;break;case c.VERTICALPOSITION:b=c.VerticalTextPosition.CENTER;break;case c.HORIZONTALPOSITION:b=c.HorizontalTextPosition.CENTER;break;case c.HORIZONTALALIGN:b=c.TextAlignment.CENTER}return b};JSG.namespace("JSG.graph.model.attributes");
JSG.graph.model.attributes.AbstractAttributes=function(){this._item=void 0};JSG.graph.model.attributes.AbstractAttributes.prototype.register=function(a){this._item=a};JSG.graph.model.attributes.AbstractAttributes.prototype.deregister=function(a){this._item=void 0};
JSG.graph.model.attributes.AbstractAttributes.prototype._setAttribute=function(a,b,c){!b.isEqualToExpressionOrValue(c)&&(a=void 0!=this._item?this._createEvent(a,c):void 0,this.sendPreEventToItem(this._item,a),void 0==a||a.doIt)&&(b.setExpressionOrValue(c),this.sendPostEventToItem(this._item,a))};JSG.graph.model.attributes.AbstractAttributes.prototype.sendPreEventToItem=function(a,b){void 0!=b&&(void 0!=a&&a.areEventsEnabled())&&a.sendPreEvent(b)};
JSG.graph.model.attributes.AbstractAttributes.prototype.sendPostEventToItem=function(a,b){void 0!=b&&(void 0!=a&&a.areEventsEnabled())&&a.sendPostEvent(b)};JSG.graph.model.attributes.AbstractAttributes.prototype._createEvent=function(a,b){};JSG.namespace("JSG.graph.model.attributes");
JSG.graph.model.attributes.FormatID={FILLCOLOR:1,FILLSTYLE:2,GRADIENTCOLOR:4,GRADIENTANGLE:8,GRADIENTTYPE:16,GRADIENTOFFSETX:32,GRADIENTOFFSETY:64,PATTERN:128,LINECOLOR:256,LINEWIDTH:512,LINESTYLE:1024,LINEARROWSTART:2048,LINEARROWEND:4096,SHADOWCOLOR:8192,SHADOWOFFSETX:16384,SHADOWOFFSETY:32768,SHADOWBLUR:65536,SHADOWDIRECTION:131072,PATTERNSTYLE:262144,BRIGHTNESS:524288,LINECORNER:1048576,TRANSPARENCY:2097152};
JSG.graph.model.attributes.LineStyle={HAIRLINE:-1,NONE:0,SOLID:1,DOT:2,DASH:3,DASHDOT:4,DASHDOTDOT:5};
JSG.graph.model.attributes.ArrowStyle={NONE:0,ARROWFILLED:1,ARROWFILLEDSMALL:2,ARROWHALFFILLED:3,ARROWHALFFILLEDSMALL:4,ARROWNNARROWFILLED:5,ARROWNARROWFILLEDSMALL:6,ARROWDOUBLEFILLED:7,ARROWDOUBLEFILLEDSMALL:8,ARROW:9,ARROWSMALL:10,ARROWDOUBLE:11,ARROWDOUBLESMALL:12,ARROWSINGLESIDE:13,ARROWREVERSEFILLED:14,ARROWREVERSEFILLEDSMALL:15,ARROWREVERSE:16,ARROWREVERSESMALL:17,ARROWREVERSENARROW:18,ARROWREVERSENARROWSMALL:19,LINEARROWREVERSE:20,CIRCLEARROWREVERSE:21,CIRCLE:22,CIRCLESMALL:23,DIAMOND:24,DIAMONDSMALL:25,
DIAMONDNARROW:26,DIAMONDNARROWSMALL:27,CIRCLEDOUBLELINE:28,DOUBLELINE:29,SQUARE:30,SQUARESMALL:31,DIAMONDLONG:32,ARROWFILLEDLONG:33,DIAGONALLINE:34,CIRCLESMALLAROUND:35};JSG.graph.model.attributes.FillStyle={NONE:0,SOLID:1,GRADIENT:2,PATTERN:3};JSG.graph.model.attributes.GradientStyle={LINEAR:0,RADIAL:1};JSG.graph.model.attributes.PatternStyle={STRETCH:0,REPEAT:1,CENTER:2,STRETCHPROPORTIONAL:3};JSG.graph.model.attributes.ShadowDirection={LEFTTOP:0,LEFTBOTTOM:1,RIGHTTOP:2,RIGHTBOTTOM:3};
JSG.graph.model.attributes.Format=function(){JSG.graph.model.attributes.Format._super.constructor.apply(this,arguments);this._fillColor=new JSG.graph.expr.StringExpression("#FFFFFF");this._fillStyle=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.FillStyle.SOLID);this._transparency=new JSG.graph.expr.NumberExpression(100);this._brightness=new JSG.graph.expr.NumberExpression(0);this._gradientColor=new JSG.graph.expr.StringExpression("#CCCCCC");this._gradientAngle=new JSG.graph.expr.NumberExpression(0);
this._gradientType=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.GradientStyle.LINEAR);this._gradientOffsetX=new JSG.graph.expr.NumberExpression(0);this._gradientOffsetY=new JSG.graph.expr.NumberExpression(0);this._pattern=new JSG.graph.expr.StringExpression("");this._patternStyle=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.PatternStyle.STRETCH);this._lineColor=new JSG.graph.expr.StringExpression("#000000");this._lineWidth=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.LineStyle.HAIRLINE);
this._lineStyle=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.LineStyle.SOLID);this._lineArrowStart=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.ArrowStyle.NONE);this._lineArrowEnd=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.ArrowStyle.NONE);this._lineCorner=new JSG.graph.expr.NumberExpression(0);this._shadowColor=new JSG.graph.expr.StringExpression("#DDDDDD");this._shadowOffsetX=new JSG.graph.expr.NumberExpression(0);this._shadowOffsetY=new JSG.graph.expr.NumberExpression(0);
this._shadowBlur=new JSG.graph.expr.NumberExpression(0);this._shadowDirection=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.ShadowDirection.RIGHTBOTTOM)};JSG.extend(JSG.graph.model.attributes.Format,JSG.graph.model.attributes.AbstractAttributes);JSG.graph.model.attributes.Format.prototype.newInstance=function(){return new JSG.graph.model.attributes.Format};
JSG.graph.model.attributes.Format.prototype.init=function(){this.setFillColor("#FFFFFF");this.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID);this.setTransparency(100);this.setBrightness(0);this.setGradientColor("#CCCCCC");this.setGradientAngle(0);this.setGradientType(JSG.graph.model.attributes.GradientStyle.LINEAR);this.setGradientOffsetX(0);this.setGradientOffsetY(0);this.setPattern("");this.setPatternStyle(JSG.graph.model.attributes.PatternStyle.STRETCH);this.setLineColor("#000000");this.setLineWidth(JSG.graph.model.attributes.LineStyle.HAIRLINE);
this.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);this.setLineArrowStart(JSG.graph.model.attributes.ArrowStyle.NONE);this.setLineArrowEnd(JSG.graph.model.attributes.ArrowStyle.NONE);this.setLineCorner(0);this.setShadowColor("#DDDDDD");this.setShadowOffsetX(0);this.setShadowOffsetY(0);this.setShadowBlur(0);this.setShadowDirection(JSG.graph.model.attributes.ShadowDirection.RIGHTBOTTOM)};
JSG.graph.model.attributes.Format.prototype.copy=function(){var a=this.newInstance();a._fillColor=this._fillColor.copy();a._fillStyle=this._fillStyle.copy();a._brightness=this._brightness.copy();a._transparency=this._transparency.copy();a._gradientColor=this._gradientColor.copy();a._gradientAngle=this._gradientAngle.copy();a._gradientType=this._gradientType.copy();a._gradientOffsetX=this._gradientOffsetX.copy();a._gradientOffsetY=this._gradientOffsetY.copy();a._pattern=this._pattern.copy();a._patternStyle=
this._patternStyle.copy();a._lineColor=this._lineColor.copy();a._lineArrowStart=this._lineArrowStart.copy();a._lineArrowEnd=this._lineArrowEnd.copy();a._lineWidth=this._lineWidth.copy();a._lineStyle=this._lineStyle.copy();a._lineCorner=this._lineCorner.copy();a._shadowColor=this._shadowColor.copy();a._shadowOffsetX=this._shadowOffsetX.copy();a._shadowOffsetY=this._shadowOffsetY.copy();a._shadowDirection=this._shadowDirection.copy();a._shadowBlur=this._shadowBlur.copy();return a};
JSG.graph.model.attributes.Format.prototype.evaluate=function(a){this._fillColor.evaluate(a);this._fillStyle.evaluate(a);this._transparency.evaluate(a);this._brightness.evaluate(a);this._gradientColor.evaluate(a);this._gradientAngle.evaluate(a);this._gradientType.evaluate(a);this._gradientOffsetX.evaluate(a);this._gradientOffsetY.evaluate(a);this._pattern.evaluate(a);this._patternStyle.evaluate(a);this._lineColor.evaluate(a);this._lineWidth.evaluate(a);this._lineStyle.evaluate(a);this._lineArrowStart.evaluate(a);
this._lineArrowEnd.evaluate(a);this._lineCorner.evaluate(a);this._shadowColor.evaluate(a);this._shadowOffsetX.evaluate(a);this._shadowOffsetY.evaluate(a);this._shadowBlur.evaluate(a);this._shadowDirection.evaluate(a)};
JSG.graph.model.attributes.Format.prototype.resolveParentReference=function(a,b){this._fillColor.resolveParentReference(a,b);this._fillStyle.resolveParentReference(a,b);this._transparency.resolveParentReference(a,b);this._brightness.resolveParentReference(a,b);this._gradientColor.resolveParentReference(a,b);this._gradientAngle.resolveParentReference(a,b);this._gradientType.resolveParentReference(a,b);this._gradientOffsetX.resolveParentReference(a,b);this._gradientOffsetY.resolveParentReference(a,
b);this._pattern.resolveParentReference(a,b);this._patternStyle.resolveParentReference(a,b);this._lineColor.resolveParentReference(a,b);this._lineWidth.resolveParentReference(a,b);this._lineStyle.resolveParentReference(a,b);this._lineArrowStart.resolveParentReference(a,b);this._lineArrowEnd.resolveParentReference(a,b);this._lineCorner.resolveParentReference(a,b);this._shadowColor.resolveParentReference(a,b);this._shadowOffsetX.resolveParentReference(a,b);this._shadowOffsetY.resolveParentReference(a,
b);this._shadowBlur.resolveParentReference(a,b);this._shadowDirection.resolveParentReference(a,b)};JSG.graph.model.attributes.Format.prototype.brighten=function(a,b){a=a.replace(/^\s*#|\s*$/g,"");3==a.length&&(a=a.replace(/(.)/g,"$1$1"));var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return"#"+(0|256+c+(256-c)*b/100).toString(16).substr(1)+(0|256+d+(256-d)*b/100).toString(16).substr(1)+(0|256+e+(256-e)*b/100).toString(16).substr(1)};
JSG.graph.model.attributes.Format.prototype.setFillColorRGB=function(a,b,c){this.setFillColor("#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1,7))};JSG.graph.model.attributes.Format.prototype.setLineColorRGB=function(a,b,c){this.setLineColor("#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1,7))};JSG.graph.model.attributes.Format.prototype.setGradientColorRGB=function(a,b,c){this.setGradientColor("#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1,7))};
JSG.graph.model.attributes.Format.prototype.setShadowColorRGB=function(a,b,c){this.setShadowColor("#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1,7))};JSG.graph.model.attributes.Format.unionFromSelection=function(a){for(var b=void 0,c=0,d=a.length;c<d;c++)void 0==b?b=a[c].getModel().getFormat().copy():b.union(a[c].getModel().getFormat());return b};
JSG.graph.model.attributes.Format.prototype.setFormatTo=function(a,b){var c=this._createEvent(b);this.sendPreEventToItem(this._item,c);!0===c.doIt&&((!b||b&JSG.graph.model.attributes.FormatID.FILLCOLOR)&&this._fillColor.setExpressionOrValue(a.getFillColor().copy()),(!b||b&JSG.graph.model.attributes.FormatID.FILLSTYLE)&&this._fillStyle.setExpressionOrValue(a.getFillStyle().copy()),(!b||b&JSG.graph.model.attributes.FormatID.TRANSPARENCY)&&this._transparency.setExpressionOrValue(a.getTransparency().copy()),
(!b||b&JSG.graph.model.attributes.FormatID.BRIGHTNESS)&&this._brightness.setExpressionOrValue(a.getBrightness().copy()),(!b||b&JSG.graph.model.attributes.FormatID.GRADIENTCOLOR)&&this._gradientColor.setExpressionOrValue(a.getGradientColor().copy()),(!b||b&JSG.graph.model.attributes.FormatID.GRADIENTANGLE)&&this._gradientAngle.setExpressionOrValue(a.getGradientAngle().copy()),(!b||b&JSG.graph.model.attributes.FormatID.GRADIENTTYPE)&&this._gradientType.setExpressionOrValue(a.getGradientType().copy()),
(!b||b&JSG.graph.model.attributes.FormatID.GRADIENTOFFSETX)&&this._gradientOffsetX.setExpressionOrValue(a.getGradientOffsetX().copy()),(!b||b&JSG.graph.model.attributes.FormatID.GRADIENTOFFSETY)&&this._gradientOffsetY.setExpressionOrValue(a.getGradientOffsetY().copy()),(!b||b&JSG.graph.model.attributes.FormatID.PATTERN)&&this._pattern.setExpressionOrValue(a.getPattern().copy()),(!b||b&JSG.graph.model.attributes.FormatID.PATTERNSTYLE)&&this._patternStyle.setExpressionOrValue(a.getPatternStyle().copy()),
(!b||b&JSG.graph.model.attributes.FormatID.LINECOLOR)&&this._lineColor.setExpressionOrValue(a.getLineColor().copy()),(!b||b&JSG.graph.model.attributes.FormatID.LINEWIDTH)&&this._lineWidth.setExpressionOrValue(a.getLineWidth().copy()),(!b||b&JSG.graph.model.attributes.FormatID.LINECORNER)&&this._lineCorner.setExpressionOrValue(a.getLineCorner().copy()),(!b||b&JSG.graph.model.attributes.FormatID.LINESTYLE)&&this._lineStyle.setExpressionOrValue(a.getLineStyle().copy()),(!b||b&JSG.graph.model.attributes.FormatID.LINEARROWSTART)&&
this._lineArrowStart.setExpressionOrValue(a.getLineArrowStart().copy()),(!b||b&JSG.graph.model.attributes.FormatID.LINEARROWEND)&&this._lineArrowEnd.setExpressionOrValue(a.getLineArrowEnd().copy()),(!b||b&JSG.graph.model.attributes.FormatID.SHADOWCOLOR)&&this._shadowColor.setExpressionOrValue(a.getShadowColor().copy()),(!b||b&JSG.graph.model.attributes.FormatID.SHADOWOFFSETX)&&this._shadowOffsetX.setExpressionOrValue(a.getShadowOffsetX().copy()),(!b||b&JSG.graph.model.attributes.FormatID.SHADOWOFFSETY)&&
this._shadowOffsetY.setExpressionOrValue(a.getShadowOffsetY().copy()),(!b||b&JSG.graph.model.attributes.FormatID.SHADOWBLUR)&&this._shadowBlur.setExpressionOrValue(a.getShadowBlur().copy()),(!b||b&JSG.graph.model.attributes.FormatID.SHADOWDIRECTION)&&this._shadowDirection.setExpressionOrValue(a.getShadowDirection().copy()),this.sendPostEventToItem(this._item,c))};
JSG.graph.model.attributes.Format.prototype.setFillColor=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.FILLCOLOR,this._fillColor,a)};JSG.graph.model.attributes.Format.prototype.getFillColor=function(){return this._fillColor};JSG.graph.model.attributes.Format.prototype.setFillStyle=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.FILLSTYLE,this._fillStyle,a)};JSG.graph.model.attributes.Format.prototype.getFillStyle=function(){return this._fillStyle};
JSG.graph.model.attributes.Format.prototype.setBrightness=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.BRIGHTNESS,this._brightness,a)};JSG.graph.model.attributes.Format.prototype.getBrightness=function(){return this._brightness};JSG.graph.model.attributes.Format.prototype.setTransparency=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.TRANSPARENCY,this._transparency,a)};JSG.graph.model.attributes.Format.prototype.getTransparency=function(){return this._transparency};
JSG.graph.model.attributes.Format.prototype.setGradientColor=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.GRADIENTCOLOR,this._gradientColor,a)};JSG.graph.model.attributes.Format.prototype.getGradientColor=function(){return this._gradientColor};JSG.graph.model.attributes.Format.prototype.setGradientAngle=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.GRADIENTANGLE,this._gradientAngle,a)};JSG.graph.model.attributes.Format.prototype.getGradientAngle=function(){return this._gradientAngle};
JSG.graph.model.attributes.Format.prototype.setGradientOffsetX=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.GRADIENTOFFSETX,this._gradientOffsetX,a)};JSG.graph.model.attributes.Format.prototype.getGradientOffsetX=function(){return this._gradientOffsetX};JSG.graph.model.attributes.Format.prototype.setGradientOffsetY=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.GRADIENTOFFSETY,this._gradientOffsetY,a)};
JSG.graph.model.attributes.Format.prototype.getGradientOffsetY=function(){return this._gradientOffsetY};JSG.graph.model.attributes.Format.prototype.setGradientType=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.GRADIENTTYPE,this._gradientType,a)};JSG.graph.model.attributes.Format.prototype.getGradientType=function(){return this._gradientType};
JSG.graph.model.attributes.Format.prototype.setPattern=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.PATTERN,this._pattern,a)};JSG.graph.model.attributes.Format.prototype.getPattern=function(){return this._pattern};JSG.graph.model.attributes.Format.prototype.setPatternStyle=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.PATTERNSTYLE,this._patternStyle,a)};JSG.graph.model.attributes.Format.prototype.getPatternStyle=function(){return this._patternStyle};
JSG.graph.model.attributes.Format.prototype.setLineColor=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.LINECOLOR,this._lineColor,a)};JSG.graph.model.attributes.Format.prototype.getLineColor=function(){return this._lineColor};JSG.graph.model.attributes.Format.prototype.setLineCorner=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.LINECORNER,this._lineCorner,a)};JSG.graph.model.attributes.Format.prototype.getLineCorner=function(){return this._lineCorner};
JSG.graph.model.attributes.Format.prototype.setLineArrowStart=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.LINEARROWSTART,this._lineArrowStart,a)};JSG.graph.model.attributes.Format.prototype.getLineArrowStart=function(){return this._lineArrowStart};JSG.graph.model.attributes.Format.prototype.setLineArrowEnd=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.LINEARROWEND,this._lineArrowEnd,a)};JSG.graph.model.attributes.Format.prototype.getLineArrowEnd=function(){return this._lineArrowEnd};
JSG.graph.model.attributes.Format.prototype.setShadowColor=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.SHADOWCOLOR,this._shadowColor,a)};JSG.graph.model.attributes.Format.prototype.getShadowColor=function(){return this._shadowColor};JSG.graph.model.attributes.Format.prototype.setShadowOffsetX=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.SHADOWOFFSETX,this._shadowOffsetX,a)};JSG.graph.model.attributes.Format.prototype.getShadowOffsetX=function(){return this._shadowOffsetX};
JSG.graph.model.attributes.Format.prototype.setShadowOffsetY=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.SHADOWOFFSETY,this._shadowOffsetY,a)};JSG.graph.model.attributes.Format.prototype.getShadowOffsetY=function(){return this._shadowOffsetY};JSG.graph.model.attributes.Format.prototype.setShadowDirection=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.SHADOWDIRECTION,this._shadowDirection,a)};
JSG.graph.model.attributes.Format.prototype.getShadowDirection=function(){return this._shadowDirection};JSG.graph.model.attributes.Format.prototype.setShadowBlur=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.SHADOWBLUR,this._shadowBlur,a)};JSG.graph.model.attributes.Format.prototype.getShadowBlur=function(){return this._shadowBlur};
JSG.graph.model.attributes.Format.prototype.setLineWidth=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.LINEWIDTH,this._lineWidth,a)};JSG.graph.model.attributes.Format.prototype.getLineWidth=function(){return this._lineWidth};JSG.graph.model.attributes.Format.prototype.setLineStyle=function(a){this._setAttribute(JSG.graph.model.attributes.FormatID.LINESTYLE,this._lineStyle,a)};JSG.graph.model.attributes.Format.prototype.getLineStyle=function(){return this._lineStyle};
JSG.graph.model.attributes.Format.prototype.hasBorder=function(){return(0<this._lineWidth.getValue()||this._lineWidth.getValue()==JSG.graph.model.attributes.LineStyle.HAIRLINE)&&this._lineStyle.getValue()!=JSG.graph.model.attributes.LineStyle.NONE};JSG.graph.model.attributes.Format.prototype.hasFill=function(){return this._fillStyle.getValue()!=JSG.graph.model.attributes.FillStyle.NONE};JSG.graph.model.attributes.Format.prototype.toString=function(){return""};
JSG.graph.model.attributes.Format.prototype.union=function(a){void 0==this._fillColor||this._fillColor.isEqualTo(a._fillColor)||(this._fillColor=void 0);void 0==this._fillStyle||this._fillStyle.isEqualTo(a._fillStyle)||(this._fillStyle=void 0);void 0==!this._transparency||this._transparency.isEqualTo(a._transparency)||(this._transparency=void 0);void 0==this._brightness||this._brightness.isEqualTo(a._brightness)||(this._brightness=void 0);void 0==this._gradientColor||this._gradientColor.isEqualTo(a._gradientColor)||
(this._gradientColor=void 0);void 0==this._gradientAngle||this._gradientAngle.isEqualTo(a._gradientAngle)||(this._gradientAngle=void 0);void 0==this._gradientOffsetX||this._gradientOffsetX.isEqualTo(a._gradientOffsetX)||(this._gradientOffsetX=void 0);void 0==this._gradientOffsetY||this._gradientOffsetY.isEqualTo(a._gradientOffsetY)||(this._gradientOffsetY=void 0);void 0==this._gradientType||this._gradientType.isEqualTo(a._gradientType)||(this._gradientType=void 0);void 0==this._pattern||this._pattern.isEqualTo(a._pattern)||
(this._pattern=void 0);void 0==this._patternStyle||this._patternStyle.isEqualTo(a._patternStyle)||(this._patternStyle=void 0);void 0==this._lineColor||this._lineColor.isEqualTo(a._lineColor)||(this._lineColor=void 0);void 0==this._lineArrowStart||this._lineArrowStart.isEqualTo(a._lineArrowStart)||(this._lineArrowStart=void 0);void 0==this._lineArrowEnd||this._lineArrowEnd.isEqualTo(a._lineArrowEnd)||(this._lineArrowEnd=void 0);void 0==this._lineWidth||this._lineWidth.isEqualTo(a._lineWidth)||(this._lineWidth=
void 0);void 0==this._lineStyle||this._lineStyle.isEqualTo(a._lineStyle)||(this._lineStyle=void 0);void 0==this._lineCorner||this._lineCorner.isEqualTo(a._lineCorner)||(this._lineCorner=void 0);void 0==this._shadowColor||this._shadowColor.isEqualTo(a._shadowColor)||(this._shadowColor=void 0);void 0==this._shadowOffsetX||this._shadowOffsetX.isEqualTo(a._shadowOffsetX)||(this._shadowOffsetX=void 0);void 0==this._shadowOffsetY||this._shadowOffsetY.isEqualTo(a._shadowOffsetY)||(this._shadowOffsetY=void 0);
void 0==this._shadowDirection||this._shadowDirection.isEqualTo(a._shadowDirection)||(this._shadowDirection=void 0);void 0==this._shadowBlur||this._shadowBlur.isEqualTo(a._shadowBlur)||(this._shadowBlur=void 0)};
JSG.graph.model.attributes.Format.prototype.applyFillToGraphics=function(a,b){100!=this._transparency.getValue()&&a.setTransparency(this._transparency.getValue());a.setFillStyle(this._fillStyle.getValue());a.setLineCorner(this._lineCorner.getValue());var c=this.getFillColor().getValue();this._brightness.getValue()&&(c=this.brighten(c,this._brightness.getValue()));a.setFillColor(c);switch(this._fillStyle.getValue()){case JSG.graph.model.attributes.FillStyle.GRADIENT:this._gradientType.getValue()==
JSG.graph.model.attributes.GradientStyle.LINEAR?a.setGradientLinear(b,c,this._gradientColor.getValue(),this._gradientAngle.getValue()):a.setGradientRadial(b,c,this._gradientColor.getValue(),this._gradientOffsetX.getValue(),this._gradientOffsetY.getValue());break;case JSG.graph.model.attributes.FillStyle.PATTERN:a.setPattern(b,this._pattern.getValue(),this._patternStyle.getValue())}};
JSG.graph.model.attributes.Format.prototype.applyLineToGraphics=function(a){a.setLineColor(this._lineColor.getValue());a.setLineStyle(this._lineStyle.getValue());a.setLineWidth(this._lineWidth.getValue());a.setLineArrowStart(this._lineArrowStart.getValue());a.setLineArrowEnd(this._lineArrowEnd.getValue());a.setLineCorner(this._lineCorner.getValue())};
JSG.graph.model.attributes.Format.prototype.applyShadowToGraphics=function(a,b){var c=this._shadowOffsetX.getValue(),d=this._shadowOffsetY.getValue();if(c||d)switch(this._shadowDirection.getValue()){case JSG.graph.model.attributes.ShadowDirection.LEFTTOP:a.setShadow(this._shadowColor.getValue(),-c,-d,this._shadowBlur.getValue(),b);break;case JSG.graph.model.attributes.ShadowDirection.RIGHTTOP:a.setShadow(this._shadowColor.getValue(),c,-d,this._shadowBlur.getValue(),b);break;case JSG.graph.model.attributes.ShadowDirection.LEFTBOTTOM:a.setShadow(this._shadowColor.getValue(),
-c,d,this._shadowBlur.getValue(),b);break;case JSG.graph.model.attributes.ShadowDirection.RIGHTBOTTOM:a.setShadow(this._shadowColor.getValue(),c,d,this._shadowBlur.getValue(),b)}};JSG.graph.model.attributes.Format.prototype.removeShadowFromGraphics=function(a){a.resetShadow();a.setLineCorner(0);100!=this._transparency.getValue()&&a.setTransparency(100)};
JSG.graph.model.attributes.Format.prototype.removeLineFromGraphics=function(a){a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.setLineArrowStart(JSG.graph.model.attributes.ArrowStyle.NONE);a.setLineArrowEnd(JSG.graph.model.attributes.ArrowStyle.NONE);a.setLineCorner(0)};JSG.graph.model.attributes.Format.prototype._createEvent=function(a,b){var c=new JSG.graph.model.events.FormatEvent(a,b);c.source=this._item;return c};
JSG.graph.model.attributes.Format.prototype.readXML=function(a){this.init();if(a){var b=findElementByTagName(a,"line");if(b)for(var c=0,d=b.childNodes.length;c<d;c++){var e=b.childNodes.item(c);switch(e.nodeName){case "width":this._lineWidth.readXML(e);1==this._lineWidth.getValue()&&(this._lineWidth._value=JSG.graph.model.attributes.LineStyle.HAIRLINE);break;case "color":this._lineColor.readXML(e);break;case "arrowstart":this._lineArrowStart.readXML(e);break;case "arrowend":this._lineArrowEnd.readXML(e);
break;case "style":this._lineStyle.readXML(e);break;case "corner":this._lineCorner.readXML(e)}}if(b=findElementByTagName(a,"fill"))for(c=0,d=b.childNodes.length;c<d;c++)switch(e=b.childNodes.item(c),e.nodeName){case "color":this._fillColor.readXML(e);break;case "backcolor":this._gradientColor.readXML(e);break;case "brightness":this._brightness.readXML(e);break;case "transparency":this._transparency.readXML(e);break;case "pattern":this._pattern.readXML(e);break;case "patternstyle":this._patternStyle.readXML(e);
break;case "gradienttype":this._gradientType.readXML(e);break;case "gradientangle":this._gradientAngle.readXML(e);break;case "gradientoffsetx":this._gradientOffsetX.readXML(e);break;case "gradientoffsety":this._gradientOffsetY.readXML(e);break;case "style":this._fillStyle.readXML(e)}if(b=findElementByTagName(a,"shadow"))for(c=0,d=b.childNodes.length;c<d;c++)switch(e=b.childNodes.item(c),e.nodeName){case "color":this._shadowColor.readXML(e);break;case "offsetx":this._shadowOffsetX.readXML(e);break;
case "offsety":this._shadowOffsetY.readXML(e);break;case "blur":this._shadowBlur.readXML(e);break;case "direction":this._shadowDirection.readXML(e)}}};
JSG.graph.model.attributes.Format.prototype.isLineFormatDefault=function(){return this._lineColor.hasFormula()||"#000000"!=this._lineColor.getValue()||this._lineWidth.hasFormula()||this._lineWidth.getValue()!=JSG.graph.model.attributes.LineStyle.HAIRLINE||this._lineStyle.hasFormula()||this._lineStyle.getValue()!=JSG.graph.model.attributes.LineStyle.SOLID||this._lineArrowStart.hasFormula()||this._lineArrowStart.getValue()!=JSG.graph.model.attributes.ArrowStyle.NONE||this._lineArrowEnd.hasFormula()||
this._lineArrowEnd.getValue()!=JSG.graph.model.attributes.ArrowStyle.NONE||this._lineCorner.hasFormula()||0!=this._lineCorner.getValue()?!1:!0};
JSG.graph.model.attributes.Format.prototype.isFillFormatDefault=function(){return this._fillColor.hasFormula()||"#FFFFFF"!=this._fillColor.getValue()||this._fillStyle.hasFormula()||this._fillStyle.getValue()!=JSG.graph.model.attributes.FillStyle.SOLID||this._brightness.hasFormula()||0!=this._brightness.getValue()||this._transparency.hasFormula()||100!=this._transparency.getValue()||this._gradientColor.hasFormula()||"#CCCCCC"!=this._gradientColor.getValue()||this._gradientAngle.hasFormula()||0!=this._gradientAngle.getValue()||
this._gradientType.hasFormula()||this._gradientType.getValue()!=JSG.graph.model.attributes.GradientStyle.LINEAR||this._gradientOffsetX.hasFormula()||0!=this._gradientOffsetX.getValue()||this._gradientOffsetY.hasFormula()||0!=this._gradientOffsetY.getValue()||this._pattern.hasFormula()||0!=this._pattern.getValue()||this._patternStyle.hasFormula()||this._patternStyle.getValue()!=JSG.graph.model.attributes.PatternStyle.STRETCH?!1:!0};
JSG.graph.model.attributes.Format.prototype.isShadowFormatDefault=function(){return this._shadowColor.hasFormula()||"#DDDDDD"!=this._shadowColor.getValue()||this._shadowOffsetX.hasFormula()||0!=this._shadowOffsetX.getValue()||this._shadowOffsetY.hasFormula()||0!=this._shadowOffsetY.getValue()||this._shadowBlur.hasFormula()||0!=this._shadowBlur.getValue()||this._shadowDirection.hasFormula()||this._shadowDirection.getValue()!=JSG.graph.model.attributes.ShadowDirection.RIGHTBOTTOM?!1:!0};
JSG.graph.model.attributes.Format.prototype.saveXML=function(a,b){var c=this.isLineFormatDefault(),d=this.isFillFormatDefault(),e=this.isShadowFormatDefault();this.isLineFormatDefault()&&this.isFillFormatDefault()&&this.isShadowFormatDefault()||(b.writeStartElement(a),c||(b.writeStartElement("line"),(this._lineWidth.hasFormula()||this._lineWidth.getValue()!=JSG.graph.model.attributes.LineStyle.HAIRLINE)&&this._lineWidth.saveXML("width",b),(this._lineColor.hasFormula()||"#000000"!=this._lineColor.getValue())&&
this._lineColor.saveXML("color",b),(this._lineStyle.hasFormula()||this._lineStyle.getValue()!=JSG.graph.model.attributes.LineStyle.SOLID)&&this._lineStyle.saveXML("style",b),(this._lineArrowStart.hasFormula()||this._lineArrowStart.getValue()!=JSG.graph.model.attributes.ArrowStyle.NONE)&&this._lineArrowStart.saveXML("arrowstart",b),(this._lineArrowEnd.hasFormula()||this._lineArrowEnd.getValue()!=JSG.graph.model.attributes.ArrowStyle.NONE)&&this._lineArrowEnd.saveXML("arrowend",b),(this._lineCorner.hasFormula()||
0!=this._lineCorner.getValue())&&this._lineCorner.saveXML("corner",b),b.writeEndElement()),d||(b.writeStartElement("fill"),(this._fillColor.hasFormula()||"#FFFFFF"!=this._fillColor.getValue())&&this._fillColor.saveXML("color",b),(this._fillStyle.hasFormula()||this._fillStyle.getValue()!=JSG.graph.model.attributes.FillStyle.SOLID)&&this._fillStyle.saveXML("style",b),(this._brightness.hasFormula()||0!=this._brightness.getValue())&&this._brightness.saveXML("brightness",b),(this._transparency.hasFormula()||
100!=this._transparency.getValue())&&this._transparency.saveXML("transparency",b),(this._gradientColor.hasFormula()||"#CCCCCC"!=this._gradientColor.getValue())&&this._gradientColor.saveXML("backcolor",b),(this._gradientType.hasFormula()||this._gradientType.getValue()!=JSG.graph.model.attributes.GradientStyle.LINEAR)&&this._gradientType.saveXML("gradienttype",b),(this._gradientAngle.hasFormula()||0!=this._gradientAngle.getValue())&&this._gradientAngle.saveXML("gradientangle",b),(this._gradientOffsetX.hasFormula()||
0!=this._gradientOffsetX.getValue())&&this._gradientOffsetX.saveXML("gradientoffsetx",b),(this._gradientOffsetY.hasFormula()||0!=this._gradientOffsetY.getValue())&&this._gradientOffsetY.saveXML("gradientoffsety",b),(this._pattern.hasFormula()||0!=this._pattern.getValue())&&this._pattern.saveXML("pattern",b),(this._patternStyle.hasFormula()||this._patternStyle.getValue()!=JSG.graph.model.attributes.PatternStyle.STRETCH)&&this._patternStyle.saveXML("patternstyle",b),b.writeEndElement()),e||(b.writeStartElement("shadow"),
(this._shadowColor.hasFormula()||"#DDDDDD"!=this._shadowColor.getValue())&&this._shadowColor.saveXML("color",b),(this._shadowOffsetX.hasFormula()||0!=this._shadowOffsetX.getValue())&&this._shadowOffsetX.saveXML("offsetx",b),(this._shadowOffsetY.hasFormula()||0!=this._shadowOffsetY.getValue())&&this._shadowOffsetY.saveXML("offsety",b),(this._shadowBlur.hasFormula()||0!=this._shadowBlur.getValue())&&this._shadowBlur.saveXML("blur",b),(this._shadowDirection.hasFormula()||this._shadowDirection.getValue()!=
JSG.graph.model.attributes.ShadowDirection.RIGHTBOTTOM)&&this._shadowDirection.saveXML("direction",b),b.writeEndElement()),b.writeEndElement())};JSG.namespace("JSG.graph.model.attributes");JSG.graph.model.attributes.TextFormatID={HORIZONTALALIGN:1,VERTICALALIGN:2,FONTSIZE:8,FONTNAME:16,FONTCOLOR:32,FONTSTYLE:64,HORIZONTALPOSITION:256,VERTICALPOSITION:512};JSG.graph.model.attributes.TextAlignment={LEFT:0,CENTER:1,RIGHT:2};
JSG.graph.model.attributes.VerticalTextPosition={CUSTOM:0,ONTOP:1,BEFORESTART:1,TOP:2,START:2,CENTER:3,BOTTOM:4,END:4,BELOWBOTTOM:5,BEHINDEND:5};JSG.graph.model.attributes.HorizontalTextPosition={CUSTOM:0,TOLEFT:1,LEFT:2,CENTER:3,RIGHT:4,TORIGHT:5};JSG.graph.model.attributes.FontStyle={NORMAL:0,BOLD:1,ITALIC:2,UNDERLINE:4};
JSG.graph.model.attributes.TextFormat=function(){JSG.graph.model.attributes.TextFormat._super.constructor.apply(this,arguments);this._horizontalAlignment=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.TextAlignment.CENTER);this._fontSize=new JSG.graph.expr.NumberExpression(8);this._fontName=new JSG.graph.expr.StringExpression("Arial");this._fontColor=new JSG.graph.expr.StringExpression("#000000");this._fontStyle=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.FontStyle.NORMAL);
this._rotation=new JSG.graph.expr.NumberExpression(0);this._verticalPosition=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.VerticalTextPosition.CENTER);this._horizontalPosition=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.HorizontalTextPosition.CENTER)};JSG.extend(JSG.graph.model.attributes.TextFormat,JSG.graph.model.attributes.AbstractAttributes);
JSG.graph.model.attributes.TextFormat.prototype.copy=function(){var a=this.newInstance();a._horizontalAlignment=this._horizontalAlignment.copy();a._fontSize=this._fontSize.copy();a._fontName=this._fontName.copy();a._fontColor=this._fontColor.copy();a._fontStyle=this._fontStyle.copy();a._rotation=this._rotation.copy();a._verticalPosition=this._verticalPosition.copy();a._horizontalPosition=this._horizontalPosition.copy();return a};JSG.graph.model.attributes.TextFormat.prototype.newInstance=function(){return new JSG.graph.model.attributes.TextFormat};
JSG.graph.model.attributes.TextFormat.prototype.evaluate=function(a){this._horizontalAlignment.evaluate(a);this._fontSize.evaluate(a);this._fontName.evaluate(a);this._fontColor.evaluate(a);this._fontStyle.evaluate(a);this._rotation.evaluate(a);this._verticalPosition.evaluate(a);this._horizontalPosition.evaluate(a)};
JSG.graph.model.attributes.TextFormat.prototype.setFormatTo=function(a,b){var c=this._createEvent(b);this.sendPreEventToItem(this._item,c);!0===c.doIt&&((!b||b&JSG.graph.model.attributes.TextFormatID.HORIZONTALALIGN)&&this._horizontalAlignment.setExpressionOrValue(a.getHorizontalAlignment().copy()),(!b||b&JSG.graph.model.attributes.TextFormatID.ROTATION)&&this._rotation.setExpressionOrValue(a.getRotation().copy()),(!b||b&JSG.graph.model.attributes.TextFormatID.FONTNAME)&&this._fontName.setExpressionOrValue(a.getFontName().copy()),
(!b||b&JSG.graph.model.attributes.TextFormatID.FONTSIZE)&&this._fontSize.setExpressionOrValue(a.getFontSize().copy()),(!b||b&JSG.graph.model.attributes.TextFormatID.FONTCOLOR)&&this._fontColor.setExpressionOrValue(a.getFontColor().copy()),(!b||b&JSG.graph.model.attributes.TextFormatID.FONTSTYLE)&&this._fontStyle.setExpressionOrValue(a.getFontStyle().copy()),(!b||b&JSG.graph.model.attributes.TextFormatID.VERTICALPOSITION)&&this._verticalPosition.setExpressionOrValue(a.getVerticalPosition().copy()),
(!b||b&JSG.graph.model.attributes.TextFormatID.HORIZONTALPOSITION)&&this._horizontalPosition.setExpressionOrValue(a.getHorizontalPosition().copy()),this.sendPostEventToItem(this._item,c))};JSG.graph.model.attributes.TextFormat.unionFromSelection=function(a){for(var b=void 0,c=0,d=a.length;c<d;c++){var e=a[c].getModel()._getTextFormat();void 0==b?b=e.copy():b.union(e)}return b};
JSG.graph.model.attributes.TextFormat.prototype.setHorizontalAlignment=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.HORIZONTALALIGN,this._horizontalAlignment,a)};JSG.graph.model.attributes.TextFormat.prototype.getHorizontalAlignment=function(){return this._horizontalAlignment};JSG.graph.model.attributes.TextFormat.prototype.setRotation=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.ROTATION,this._rotation,a)};
JSG.graph.model.attributes.TextFormat.prototype.getRotation=function(){return this._rotation};JSG.graph.model.attributes.TextFormat.prototype.setVerticalPosition=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.VERTICALPOSITION,this._verticalPosition,a)};JSG.graph.model.attributes.TextFormat.prototype.getVerticalPosition=function(){return this._verticalPosition};
JSG.graph.model.attributes.TextFormat.prototype.setHorizontalPosition=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.HORIZONTALPOSITION,this._horizontalPosition,a)};JSG.graph.model.attributes.TextFormat.prototype.getHorizontalPosition=function(){return this._horizontalPosition};JSG.graph.model.attributes.TextFormat.prototype.setFontSize=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.FONTSIZE,this._fontSize,a)};
JSG.graph.model.attributes.TextFormat.prototype.getFontSize=function(){return this._fontSize};JSG.graph.model.attributes.TextFormat.prototype.setFontName=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.FONTNAME,this._fontName,a)};JSG.graph.model.attributes.TextFormat.prototype.getFontName=function(){return this._fontName};
JSG.graph.model.attributes.TextFormat.prototype.setFontColor=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.FONTCOLOR,this._fontColor,a)};JSG.graph.model.attributes.TextFormat.prototype.setFontColorRGB=function(a,b,c){this.setFontColor("#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1,7))};JSG.graph.model.attributes.TextFormat.prototype.getFontColor=function(){return this._fontColor};
JSG.graph.model.attributes.TextFormat.prototype.setFontStyle=function(a){this._setAttribute(JSG.graph.model.attributes.TextFormatID.FONTSTYLE,this._fontStyle,a)};JSG.graph.model.attributes.TextFormat.prototype.getFontStyle=function(){return this._fontStyle};
JSG.graph.model.attributes.TextFormat.prototype.union=function(a){void 0==this._horizontalAlignment||this._horizontalAlignment.isEqualTo(a._horizontalAlignment)||(this._horizontalAlignment=void 0);void 0==this._fontSize||this._fontSize.isEqualTo(a._fontSize)||(this._fontSize=void 0);void 0==this._fontName||this._fontName.isEqualTo(a._fontName)||(this._fontName=void 0);void 0==this._fontColor||this._fontColor.isEqualTo(a._fontColor)||(this._fontColor=void 0);void 0==this._fontStyle||this._fontStyle.isEqualTo(a._fontStyle)||
(this._fontStyle=void 0);void 0==this._rotation||this._rotation.isEqualTo(a._rotation)||(this._rotation=void 0);void 0==this._verticalPosition||this._verticalPosition.isEqualTo(a._verticalPosition)||(this._verticalPosition=void 0);void 0==this._horizontalPosition||this._horizontalPosition.isEqualTo(a._horizontalPosition)||(this._horizontalPosition=void 0)};
JSG.graph.model.attributes.TextFormat.prototype.applyToGraphics=function(a,b){a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID);a.setFillColor(this.getFontColor().getValue());a.setTextBaseline("middle");a.setTextAlign(this.getHorizontalAlignment().getValue());a.setFontName(this.getFontName().getValue());a.setFontSize(this.getFontSize().getValue());a.setFontStyle(this.getFontStyle().getValue())};JSG.graph.model.attributes.TextFormat.prototype.removeFromGraphics=function(a){a.setFontStyle(0)};
JSG.graph.model.attributes.TextFormat.prototype._createEvent=function(a,b){var c=new JSG.graph.model.events.TextFormatEvent(a,b);c.source=this._item;return c};
JSG.graph.model.attributes.TextFormat.prototype.readXML=function(a){if(a&&(a=findElementByTagName(a,"font")))for(var b=0,c=a.childNodes.length;b<c;b++){var d=a.childNodes.item(b);switch(d.nodeName){case "size":this._fontSize.readXML(d);break;case "color":this._fontColor.readXML(d);break;case "name":this._fontName.readXML(d);break;case "style":this._fontStyle.readXML(d);break;case "rotation":this._rotation.readXML(d);break;case "vposition":this._verticalPosition.readXML(d);break;case "hposition":this._horizontalPosition.readXML(d);
break;case "halign":this._horizontalAlignment.readXML(d)}}};
JSG.graph.model.attributes.TextFormat.prototype.isTextFormatDefault=function(){return this._horizontalAlignment.hasFormula()||this._horizontalAlignment.getValue()!=JSG.graph.model.attributes.TextAlignment.CENTER||this._fontSize.hasFormula()||10!=this._fontSize.getValue()||this._fontName.hasFormula()||"Arial"!=this._fontName.getValue()||this._fontColor.hasFormula()||"#000000"!=this._fontColor.getValue()||this._fontStyle.hasFormula()||this._fontStyle.getValue()!=JSG.graph.model.attributes.FontStyle.NORMAL||
this._rotation.hasFormula()||0!=this._rotation.getValue()||this._verticalPosition.hasFormula()||this._verticalPosition.getValue()!=JSG.graph.model.attributes.VerticalTextPosition.CENTER||this._horizontalPosition.hasFormula()||this._horizontalPosition.getValue()!=JSG.graph.model.attributes.HorizontalTextPosition.CENTER?!1:!0};
JSG.graph.model.attributes.TextFormat.prototype.saveXML=function(a,b){this.isTextFormatDefault()||(b.writeStartElement(a),b.writeStartElement("font"),(this._horizontalAlignment.hasFormula()||this._horizontalAlignment.getValue()!=JSG.graph.model.attributes.TextAlignment.CENTER)&&this._horizontalAlignment.saveXML("halign",b),(this._fontName.hasFormula()||"Arial"!=this._fontName.getValue())&&this._fontName.saveXML("name",b),(this._fontSize.hasFormula()||8!=this._fontSize.getValue())&&this._fontSize.saveXML("size",
b),(this._fontStyle.hasFormula()||this._fontStyle.getValue()!=JSG.graph.model.attributes.FontStyle.NORMAL)&&this._fontStyle.saveXML("style",b),(this._fontColor.hasFormula()||"#000000"!=this._fontColor.getValue())&&this._fontColor.saveXML("color",b),(this._rotation.hasFormula()||0!=this._rotation.getValue())&&this._rotation.saveXML("rotation",b),(this._verticalPosition.hasFormula()||this._verticalPosition.getValue()!=JSG.graph.model.attributes.VerticalTextPosition.CENTER)&&this._verticalPosition.saveXML("vposition",
b),(this._horizontalPosition.hasFormula()||this._horizontalPosition.getValue()!=JSG.graph.model.attributes.HorizontalTextPosition.CENTER)&&this._horizontalPosition.saveXML("hposition",b),b.writeEndElement(),b.writeEndElement())};JSG.namespace("JSG.graph.model.attributes");
JSG.graph.model.attributes.AttributeID={CLIPCHILDREN:"clipchildren",CLOSED:"closed",COLLAPSABLE:"collapsable",COLLAPSED:"collapsed",COLLAPSEDBUTTON:"collapsedbutton",COMBINED:"combined",CONTAINER:"container",DELETEABLE:"deleteable",MOVEABLE:"moveable",PORTMODE:"portmode",ROTATABLE:"rotatable",SELECTIONMODE:"selectionmode",SELECTED:"selected",SIZEABLE:"sizeable",SNAPTO:"snapto",VISIBLE:"visible",ALWAYSVISIBLE:"alwaysvisible",MARGINTOP:"margintop",MARGINLEFT:"marginleft",MARGINRIGHT:"marginright",MARGINBOTTOM:"marginbottom"};
JSG.graph.model.attributes.PortMode={NONE:0,DEFAULT:1,SHAPE:2,CENTER:4,SIDESCENTER:8,SIDESQUARTER:16,CENTERSTARTATSIDE:32,ALL:7};JSG.graph.model.attributes.SelectionMode={NONE:0,BORDER:1,AREA:2,DEFAULT:4,SELECTPARENT:8};JSG.graph.model.attributes.Moveable={LIMITTOCONTAINER:4};JSG.graph.model.attributes.Direction={NONE:0,VERTICAL:1,HORIZONTAL:2,BOTH:3};JSG.graph.model.attributes.ButtonPosition={TOPLEFT:0,TOPRIGHT:1,TOPCENTER:2,BOTTOMCENTER:3};
JSG.graph.model.attributes.Attributes=function(){JSG.graph.model.attributes.Attributes._super.constructor.apply(this,arguments);this._clipChildren=new JSG.graph.expr.BooleanExpression(!1);this._closed=new JSG.graph.expr.BooleanExpression(!0);this._collapsable=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.Direction.NONE);this._collapsed=new JSG.graph.expr.BooleanExpression(!1);this._collapsedButton=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.ButtonPosition.TOPRIGHT);
this._combined=new JSG.graph.expr.BooleanExpression(!1);this._container=new JSG.graph.expr.BooleanExpression(!0);this._deletable=new JSG.graph.expr.BooleanExpression(!0);this._moveable=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.Direction.BOTH);this._portMode=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.PortMode.DEFAULT|JSG.graph.model.attributes.PortMode.CENTER);this._rotatable=new JSG.graph.expr.BooleanExpression(!0);this._selectionMode=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.SelectionMode.DEFAULT);
this._selected=new JSG.graph.expr.BooleanExpression(!1);this._sizeable=new JSG.graph.expr.BooleanExpression(!0);this._snapTo=new JSG.graph.expr.BooleanExpression(!0);this._visible=new JSG.graph.expr.BooleanExpression(!0);this._alwaysVisible=new JSG.graph.expr.NumberExpression(JSG.graph.model.attributes.Direction.NONE);this._layer=new JSG.graph.expr.StringExpression("");this._link=new JSG.graph.expr.StringExpression("");this._type=new JSG.graph.expr.StringExpression("");this._leftMargin=new JSG.graph.expr.NumberExpression(0);
this._rightMargin=new JSG.graph.expr.NumberExpression(0);this._topMargin=new JSG.graph.expr.NumberExpression(0);this._bottomMargin=new JSG.graph.expr.NumberExpression(0)};JSG.extend(JSG.graph.model.attributes.Attributes,JSG.graph.model.attributes.AbstractAttributes);JSG.graph.model.attributes.Attributes.prototype.register=function(a){this._item=a};JSG.graph.model.attributes.Attributes.prototype.deregister=function(a){this._item=void 0};
JSG.graph.model.attributes.Attributes.prototype.copy=function(){var a=this.newInstance();a._clipChildren=this._clipChildren.copy();a._closed=this._closed.copy();a._collapsable=this._collapsable.copy();a._collapsed=this._collapsed.copy();a._collapsedButton=this._collapsedButton.copy();a._combined=this._combined.copy();a._container=this._container.copy();a._deletable=this._deletable.copy();a._moveable=this._moveable.copy();a._rotatable=this._rotatable.copy();a._portMode=this._portMode.copy();a._selectionMode=
this._selectionMode.copy();a._selected=this._selected.copy();a._sizeable=this._sizeable.copy();a._snapTo=this._snapTo.copy();a._visible=this._visible.copy();a._alwaysVisible=this._alwaysVisible.copy();a._layer.setTo(this._layer);a._link.setTo(this._link);a._type.setTo(this._type);a._leftMargin=this._leftMargin.copy();a._topMargin=this._topMargin.copy();a._rightMargin=this._rightMargin.copy();a._bottomMargin=this._bottomMargin.copy();return a};
JSG.graph.model.attributes.Attributes.prototype.newInstance=function(){return new JSG.graph.model.attributes.Attributes};
JSG.graph.model.attributes.Attributes.prototype.evaluate=function(a){this._clipChildren.evaluate(a);this._closed.evaluate(a);this._collapsable.evaluate(a);this._collapsed.evaluate(a);this._collapsedButton.evaluate(a);this._combined.evaluate(a);this._container.evaluate(a);this._deletable.evaluate(a);this._moveable.evaluate(a);this._selectionMode.evaluate(a);this._portMode.evaluate(a);this._rotatable.evaluate(a);this._selected.evaluate(a);this._sizeable.evaluate(a);this._snapTo.evaluate(a);this._visible.evaluate(a);
this._alwaysVisible.evaluate(a);this._layer.evaluate(a);this._link.evaluate(a);this._type.evaluate(a);this._leftMargin.evaluate(a);this._topMargin.evaluate(a);this._rightMargin.evaluate(a);this._bottomMargin.evaluate(a)};JSG.graph.model.attributes.Attributes.prototype.setAlwaysVisible=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.ALWAYSVISIBLE,this._alwaysVisible,a)};JSG.graph.model.attributes.Attributes.prototype.getAlwaysVisible=function(){return this._alwaysVisible};
JSG.graph.model.attributes.Attributes.prototype.setClipChildren=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.CLIPCHILDREN,this._clipChildren,a)};JSG.graph.model.attributes.Attributes.prototype.getClipChildren=function(){return this._clipChildren};JSG.graph.model.attributes.Attributes.prototype.setClosed=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.CLOSED,this._closed,a)};JSG.graph.model.attributes.Attributes.prototype.getClosed=function(){return this._closed};
JSG.graph.model.attributes.Attributes.prototype.setCollapsable=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.COLLAPSABLE,this._collapsable,a)};JSG.graph.model.attributes.Attributes.prototype.getCollapsable=function(){return this._collapsable};JSG.graph.model.attributes.Attributes.prototype.setCollapsed=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.COLLAPSED,this._collapsed,a)};JSG.graph.model.attributes.Attributes.prototype.getCollapsed=function(){return this._collapsed};
JSG.graph.model.attributes.Attributes.prototype.setCollapsedButton=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.COLLAPSEDBUTTON,this._collapsedButton,a)};JSG.graph.model.attributes.Attributes.prototype.getCollapsedButton=function(){return this._collapsedButton};JSG.graph.model.attributes.Attributes.prototype.setCombined=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.COMBINED,this._combined,a)};
JSG.graph.model.attributes.Attributes.prototype.getCombined=function(){return this._combined};JSG.graph.model.attributes.Attributes.prototype.setContainer=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.CONTAINER,this._container,a)};JSG.graph.model.attributes.Attributes.prototype.getContainer=function(){return this._container};
JSG.graph.model.attributes.Attributes.prototype.setDeleteable=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.DELETEABLE,this._deletable,a)};JSG.graph.model.attributes.Attributes.prototype.getDeleteable=function(){return this._deletable};JSG.graph.model.attributes.Attributes.prototype.setMoveable=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.MOVEABLE,this._moveable,a)};JSG.graph.model.attributes.Attributes.prototype.getMoveable=function(){return this._moveable};
JSG.graph.model.attributes.Attributes.prototype.setPortMode=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.PORTMODE,this._portMode,a)};JSG.graph.model.attributes.Attributes.prototype.getPortMode=function(){return this._portMode};JSG.graph.model.attributes.Attributes.prototype.setRotatable=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.ROTATABLE,this._rotatable,a)};JSG.graph.model.attributes.Attributes.prototype.getRotatable=function(){return this._rotatable};
JSG.graph.model.attributes.Attributes.prototype.setSelectionMode=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.SELECTIONMODE,this._selectionMode,a)};JSG.graph.model.attributes.Attributes.prototype.getSelectionMode=function(){return this._selectionMode};
JSG.graph.model.attributes.Attributes.prototype.setSelectParentFirst=function(a){var b=this._selectionMode.getValue(),b=a?b|JSG.graph.model.attributes.SelectionMode.SELECTPARENT:b&~JSG.graph.model.attributes.SelectionMode.SELECTPARENT;this.setSelectionMode(b)};JSG.graph.model.attributes.Attributes.prototype.setSelected=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.SELECTED,this._selected,a)};JSG.graph.model.attributes.Attributes.prototype.getSelected=function(){return this._selected};
JSG.graph.model.attributes.Attributes.prototype.setSizeable=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.SIZEABLE,this._sizeable,a)};JSG.graph.model.attributes.Attributes.prototype.getSizeable=function(){return this._sizeable};JSG.graph.model.attributes.Attributes.prototype.setSnapTo=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.SNAPTO,this._snapTo,a)};JSG.graph.model.attributes.Attributes.prototype.getSnapTo=function(){return this._snapTo};
JSG.graph.model.attributes.Attributes.prototype.setVisible=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.VISIBLE,this._visible,a)};JSG.graph.model.attributes.Attributes.prototype.getVisible=function(){return this._visible};JSG.graph.model.attributes.Attributes.prototype._createEvent=function(a,b){var c=new JSG.graph.model.events.AttributeEvent(a,b);c.source=this._item;return c};
JSG.graph.model.attributes.Attributes.prototype.setLeftMargin=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.MARGINLEFT,this._leftMargin,a)};JSG.graph.model.attributes.Attributes.prototype.getLeftMargin=function(){return this._leftMargin};JSG.graph.model.attributes.Attributes.prototype.setRightMargin=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.MARGINRIGHT,this._rightMargin,a)};JSG.graph.model.attributes.Attributes.prototype.getRightMargin=function(){return this._rightMargin};
JSG.graph.model.attributes.Attributes.prototype.setTopMargin=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.MARGINTOP,this._topMargin,a)};JSG.graph.model.attributes.Attributes.prototype.getTopMargin=function(){return this._topMargin};JSG.graph.model.attributes.Attributes.prototype.setBottomMargin=function(a){this._setAttribute(JSG.graph.model.attributes.AttributeID.MARGINBOTTOM,this._bottomMargin,a)};JSG.graph.model.attributes.Attributes.prototype.getBottomMargin=function(){return this._bottomMargin};
JSG.graph.model.attributes.Attributes.prototype.readXML=function(a){if(a)for(var b=0,c=a.childNodes.length;b<c;b++){var d=a.childNodes.item(b);this._readAttributeXML(d)}};
JSG.graph.model.attributes.Attributes.prototype._readAttributeXML=function(a){switch(a.nodeName){case "clipchildren":this._clipChildren.readXML(a);break;case "collapsable":this._collapsable.readXML(a);break;case "collapsed":this._collapsed.readXML(a);break;case "collapsedbutton":this._collapsedButton.readXML(a);break;case "deletable":this._deletable.readXML(a);break;case "moveable":this._moveable.readXML(a);!1===this._moveable.getValue()&&this.setMoveable(JSG.graph.model.attributes.Direction.NONE);
break;case "rotatable":this._rotatable.readXML(a);break;case "selectable":this.setSelectionMode(JSG.graph.model.attributes.SelectionMode.NONE);break;case "selectparentfirst":this.setSelectParentFirst(!0);break;case "selectionmode":this._selectionMode.readXML(a);break;case "sizeable":this._sizeable.readXML(a);break;case "snapto":this._snapTo.readXML(a);break;case "visible":this._visible.readXML(a);break;case "alwaysvisible":this._alwaysVisible.readXML(a);break;case "combined":this._combined.readXML(a);
break;case "closed":this._closed.readXML(a);break;case "portmode":this._portMode.readXML(a);break;case "container":this._container.readXML(a);break;case "layer":this._layer.readXML(a);break;case "link":this._link.readXML(a);break;case "type":this._type.readXML(a);break;case "leftmargin":this._leftMargin.readXML(a);break;case "rightmargin":this._rightMargin.readXML(a);break;case "bottommargin":this._bottomMargin.readXML(a);break;case "topmargin":this._topMargin.readXML(a)}};
JSG.graph.model.attributes.Attributes.prototype.isDefault=function(){return this._clipChildren.hasFormula()||!1!=this._clipChildren.getValue()||this._collapsable.hasFormula()||this._collapsable.getValue()!=JSG.graph.model.attributes.Direction.NONE||this._collapsed.hasFormula()||!1!=this._collapsed.getValue()||this._collapsedButton.hasFormula()||this._collapsedButton.getValue()!=JSG.graph.model.attributes.ButtonPosition.TOPRIGHT||this._deletable.hasFormula()||!0!=this._deletable.getValue()||this._moveable.hasFormula()||
this._moveable.getValue()!=JSG.graph.model.attributes.Direction.BOTH||this._rotatable.hasFormula()||!0!=this._rotatable.getValue()||this._selectionMode.hasFormula()||this._selectionMode.getValue()!=JSG.graph.model.attributes.SelectionMode.DEFAULT||this._sizeable.hasFormula()||!0!=this._sizeable.getValue()||this._visible.hasFormula()||!0!=this._visible.getValue()||this._alwaysVisible.hasFormula()||this._alwaysVisible.getValue()!=JSG.graph.model.attributes.Direction.NONE||this._combined.hasFormula()||
!1!=this._combined.getValue()||this._closed.hasFormula()||!0!=this._closed.getValue()||this._container.hasFormula()||!0!=this._container.getValue()||this._portMode.hasFormula()||this._portMode.getValue()!=JSG.graph.model.attributes.PortMode.DEFAULT+JSG.graph.model.attributes.PortMode.CENTER||this._snapTo.hasFormula()||!0!=this._snapTo.getValue()||this._layer.hasFormula()||""!=this._layer.getValue()||this._link.hasFormula()||""!=this._link.getValue()||this._type.hasFormula()||""!=this._type.getValue()||
this._leftMargin.hasFormula()||0!=this._leftMargin.getValue()||this._rightMargin.hasFormula()||0!=this._rightMargin.getValue()||this._topMargin.hasFormula()||0!=this._topMargin.getValue()||this._bottomMargin.hasFormula()||0!=this._bottomMargin.getValue()?!1:!0};JSG.graph.model.attributes.Attributes.prototype.saveXML=function(a,b){this.isDefault()||(b.writeStartElement(a),this._saveAttributesToXML(b),b.writeEndElement())};
JSG.graph.model.attributes.Attributes.prototype._saveAttributesToXML=function(a){(this._clipChildren.hasFormula()||!1!=this._clipChildren.getValue())&&this._clipChildren.saveXML("clipchildren",a);(this._collapsable.hasFormula()||this._collapsable.getValue()!=JSG.graph.model.attributes.Direction.NONE)&&this._collapsable.saveXML("collapsable",a);(this._collapsed.hasFormula()||!1!=this._collapsed.getValue())&&this._collapsed.saveXML("collapsed",a);(this._collapsedButton.hasFormula()||this._collapsedButton.getValue()!=
JSG.graph.model.attributes.ButtonPosition.TOPRIGHT)&&this._collapsedButton.saveXML("collapsedbutton",a);(this._deletable.hasFormula()||!0!=this._deletable.getValue())&&this._deletable.saveXML("deletable",a);(this._moveable.hasFormula()||this._moveable.getValue()!=JSG.graph.model.attributes.Direction.BOTH)&&this._moveable.saveXML("moveable",a);(this._rotatable.hasFormula()||!0!=this._rotatable.getValue())&&this._rotatable.saveXML("rotatable",a);(this._selectionMode.hasFormula()||this._selectionMode.getValue()!=
JSG.graph.model.attributes.SelectionMode.DEFAULT)&&this._selectionMode.saveXML("selectionmode",a);(this._sizeable.hasFormula()||!0!=this._sizeable.getValue())&&this._sizeable.saveXML("sizeable",a);(this._visible.hasFormula()||!0!=this._visible.getValue())&&this._visible.saveXML("visible",a);(this._alwaysVisible.hasFormula()||this._alwaysVisible.getValue()!=JSG.graph.model.attributes.Direction.NONE)&&this._alwaysVisible.saveXML("alwaysvisible",a);(this._combined.hasFormula()||!1!=this._combined.getValue())&&
this._combined.saveXML("combined",a);(this._closed.hasFormula()||!0!=this._closed.getValue())&&this._closed.saveXML("closed",a);(this._container.hasFormula()||!0!=this._container.getValue())&&this._container.saveXML("container",a);(this._portMode.hasFormula()||this._portMode.getValue()!=JSG.graph.model.attributes.PortMode.DEFAULT+JSG.graph.model.attributes.PortMode.CENTER)&&this._portMode.saveXML("portmode",a);(this._snapTo.hasFormula()||!0!=this._snapTo.getValue())&&this._snapTo.saveXML("snapto",
a);(this._layer.hasFormula()||""!=this._layer.getValue())&&this._layer.saveXML("layer",a);(this._link.hasFormula()||""!=this._link.getValue())&&this._link.saveXML("link",a);(this._type.hasFormula()||""!=this._type.getValue())&&this._type.saveXML("type",a);(this._leftMargin.hasFormula()||0!=this._leftMargin.getValue())&&this._leftMargin.saveXML("leftmargin",a);(this._rightMargin.hasFormula()||0!=this._rightMargin.getValue())&&this._rightMargin.saveXML("rightmargin",a);(this._topMargin.hasFormula()||
0!=this._topMargin.getValue())&&this._topMargin.saveXML("topmargin",a);(this._bottomMargin.hasFormula()||0!=this._bottomMargin.getValue())&&this._bottomMargin.saveXML("bottommargin",a)};JSG.namespace("JSG.graph.model.attributes");JSG.graph.model.attributes.LayoutAttributeID={SET:"set",LAYOUT:"layout",LAYOUTABLE:"layoutable",LAYOUTSIZE:"layoutsize",AUTOLAYOUT:"autolayout",AUTOREZISE:"autoresize",AUTOREZISELEVEL:"autoresizelevel"};
JSG.graph.model.attributes.LayoutAttributes=function(){JSG.graph.model.attributes.LayoutAttributes._super.constructor.apply(this,arguments);this._layout=new JSG.graph.expr.StringExpression("None");this._autoLayout=new JSG.graph.expr.BooleanExpression(!1);this._autoResize=new JSG.graph.expr.NumberExpression(JSG.graph.attr.consts.Direction.NONE);this._autoResizeLevel=new JSG.graph.expr.NumberExpression(0);this._layoutSize=new JSG.graph.expr.NumberExpression(0);this._layoutable=new JSG.graph.expr.BooleanExpression(!0);
this._constraints=this._layouter=void 0};JSG.extend(JSG.graph.model.attributes.LayoutAttributes,JSG.graph.model.attributes.AbstractAttributes);
JSG.graph.model.attributes.LayoutAttributes.prototype.copy=function(){var a=this.newInstance();a._layout=this._layout.copy();a._autoLayout=this._autoLayout.copy();a._autoResize=this._autoResize.copy();a._autoResizeLevel=this._autoResizeLevel.copy();a._layoutable=this._layoutable.copy();a._layoutSize=this._layoutSize.copy();this._constraints&&(a._constraints=this._constraints.copy());return a};JSG.graph.model.attributes.LayoutAttributes.prototype.newInstance=function(){return new JSG.graph.model.attributes.LayoutAttributes};
JSG.graph.model.attributes.LayoutAttributes.prototype.evaluate=function(a){this._layout.evaluate();this._autoLayout.evaluate();this._autoResize.evaluate();this._autoResizeLevel.evaluate();this._layoutable.evaluate();this._layoutSize.evaluate()};
JSG.graph.model.attributes.LayoutAttributes.prototype.resolveParentReference=function(a,b){this._layout.resolveParentReference(a,b);this._autoLayout.resolveParentReference(a,b);this._autoResize.resolveParentReference(a,b);this._autoResizeLevel.resolveParentReference(a,b);this._layoutable.resolveParentReference(a,b);this._layoutSize.resolveParentReference(a,b)};
JSG.graph.model.attributes.LayoutAttributes.prototype.getLayouter=function(){void 0==this._layouter&&(this._layouter=JSG.layoutFactory.createLayoutFromString(this._layout.getValue()));return this._layouter};JSG.graph.model.attributes.LayoutAttributes.prototype.getConstraints=function(){void 0==this._constraints&&(this._constraints=JSG.layoutFactory.createConstraintsForLayout(this._layout.getValue()));return this._constraints};JSG.graph.model.attributes.LayoutAttributes.prototype.getLayout=function(){return this._layout};
JSG.graph.model.attributes.LayoutAttributes.prototype.setLayout=function(a){if(void 0==a.getValue||this._layout.getValue()==a.getValue())this._constraints=this._layouter=void 0;this._setAttribute(JSG.graph.model.attributes.LayoutAttributeID.LAYOUT,this._layout,a)};JSG.graph.model.attributes.LayoutAttributes.prototype.setAutoLayout=function(a){this._setAttribute(JSG.graph.model.attributes.LayoutAttributeID.AUTOLAYOUT,this._autoLayout,a)};
JSG.graph.model.attributes.LayoutAttributes.prototype.getAutoLayout=function(){return this._autoLayout};JSG.graph.model.attributes.LayoutAttributes.prototype.setAutoResize=function(a){this._setAttribute(JSG.graph.model.attributes.LayoutAttributeID.AUTOREZISE,this._autoResize,a)};JSG.graph.model.attributes.LayoutAttributes.prototype.getAutoResize=function(){return this._autoResize};
JSG.graph.model.attributes.LayoutAttributes.prototype.setAutoResizeLevel=function(a){this._setAttribute(JSG.graph.model.attributes.LayoutAttributeID.AUTOREZISELEVEL,this._autoResizeLevel,a)};JSG.graph.model.attributes.LayoutAttributes.prototype.getAutoResizeLevel=function(){return this._autoResizeLevel};JSG.graph.model.attributes.LayoutAttributes.prototype.setLayoutable=function(a){this._setAttribute(JSG.graph.model.attributes.LayoutAttributeID.LAYOUTABLE,this._layoutable,a)};
JSG.graph.model.attributes.LayoutAttributes.prototype.getLayoutable=function(){return this._layoutable};JSG.graph.model.attributes.LayoutAttributes.prototype.setLayoutSize=function(a){this._setAttribute(JSG.graph.model.attributes.LayoutAttributeID.LAYOUTSIZE,this._layoutSize,a)};JSG.graph.model.attributes.LayoutAttributes.prototype.getLayoutSize=function(){return this._layoutSize};
JSG.graph.model.attributes.LayoutAttributes.prototype._createEvent=function(a,b){var c=new JSG.graph.model.events.LayoutAttributeEvent(a,b);c.source=this._item;return c};
JSG.graph.model.attributes.LayoutAttributes.prototype.readXML=function(a){if(a){for(var b=0,c=a.childNodes.length;b<c;b++){var d=a.childNodes.item(b);switch(d.nodeName){case "layout":this._layout.readXML(d);break;case "autolayout":this._autoLayout.readXML(d);break;case "autoresize":this._autoResize.readXML(d);break;case "autoresizelevel":this._autoResizeLevel.readXML(d);break;case "layoutable":this._layoutable.readXML(d);break;case "layoutsize":this._layoutSize.readXML(d)}}if(d=this.getConstraints())if(a.attributes.length)for(b=
0,c=a.attributes.length;b<c;b++){var e=a.attributes[b];switch(e.nodeName){case "orientation":if("Grid"==this._layout.getValue())switch("0"==e.nodeValue?(d.flowDirection=ARAC.layout.config.FlowDirection.ROW_FLOW,d.xNodeScaling=ARAC.layout.config.NodeScaling.AREA_EXTEND):(d.flowDirection=ARAC.layout.config.FlowDirection.COL_FLOW,d.yNodeScaling=ARAC.layout.config.NodeScaling.AREA_EXTEND),d.gridType=ARAC.layout.config.GridType.GRID_FLOW_GRIDBACK,d.cellCount=1,this._item.getType().getValue()){case "bpmnpoolcontainer":d.tags=
["bpmnlane","bpmnpool"];break;case "bpmnlanecontainer":d.tags=["bpmnlane","bpmnpool"];break;case "flowhlanecontainer":d.tags=["flowhlane"];break;case "flowvlanecontainer":d.tags=["flowvlane"]}}}else a=a.getElementsByTagName(d._layoutType),0<a.length&&d.fromXML(a[0])}};
JSG.graph.model.attributes.LayoutAttributes.prototype.isDefault=function(){return this._layout.hasFormula()||"None"!=this._layout.getValue()||this._autoLayout.hasFormula()||!1!=this._autoLayout.getValue()||this._autoResize.hasFormula()||this._autoResize.getValue()!=JSG.graph.attr.consts.Direction.NONE||this._autoResizeLevel.hasFormula()||0!=this._autoResizeLevel.getValue()||this._layoutable.hasFormula()||!0!=this._layoutable.getValue()||this._layoutSize.hasFormula()||0!=this._layoutSize.getValue()?
!1:!0};
JSG.graph.model.attributes.LayoutAttributes.prototype.saveXML=function(a,b){if(!this.isDefault()){b.writeStartElement(a);(this._layout.hasFormula()||"None"!=this._layout.getValue())&&this._layout.saveXML("layout",b);(this._autoLayout.hasFormula()||!1!=this._autoLayout.getValue())&&this._autoLayout.saveXML("autolayout",b);(this._autoResize.hasFormula()||this._autoResize.getValue()!=JSG.graph.attr.consts.Direction.NONE)&&this._autoResize.saveXML("autoresize",b);(this._autoResizeLevel.hasFormula()||0!=
this._autoResizeLevel.getValue())&&this._autoResizeLevel.saveXML("autoresizelevel",b);(this._layoutable.hasFormula()||!0!=this._layoutable.getValue())&&this._layoutable.saveXML("layoutable",b);(this._layoutSize.hasFormula()||0!=this._layoutSize.getValue())&&this._layoutSize.saveXML("layoutsize",b);var c=this.getConstraints();c&&c.toXML(b);b.writeEndElement()}};JSG.namespace("JSG.graph.model.attributes");JSG.graph.model.attributes.AttributeID.AUTOLAYOUT="autolayout";
JSG.graph.model.attributes.EdgeAttributes=function(){JSG.graph.model.attributes.EdgeAttributes._super.constructor.apply(this,arguments);this.setClosed(!1);this.setSnapTo(!1);this._autolayout=void 0};JSG.extend(JSG.graph.model.attributes.EdgeAttributes,JSG.graph.model.attributes.Attributes);JSG.graph.model.attributes.EdgeAttributes.prototype.newInstance=function(){return new JSG.graph.model.attributes.EdgeAttributes};JSG.graph.model.attributes.EdgeAttributes.prototype.copy=function(){return JSG.graph.model.attributes.EdgeAttributes._super.copy.call(this)};
JSG.graph.model.attributes.EdgeAttributes.prototype.evaluate=function(a){JSG.graph.model.attributes.EdgeAttributes._super.evaluate.call(this,a)};JSG.graph.model.attributes.EdgeAttributes.prototype.setAutoLayout=function(a){this._setAttribute(JSG.graph.model.attributes.ID.AUTOLAYOUT,this._autolayout,a)};JSG.graph.model.attributes.EdgeAttributes.prototype.getAutoLayout=function(){return this._autolayout};
JSG.graph.model.attributes.EdgeAttributes.prototype._readAttributeXML=function(a){JSG.graph.model.attributes.EdgeAttributes._super._readAttributeXML.call(this,a);"autolayout"===a.nodeName&&(this._autolayout=new JSG.graph.expr.BooleanExpression(!1),this._autolayout.readXML(a))};
JSG.graph.model.attributes.EdgeAttributes.prototype.isDefault=function(){return this._clipChildren.hasFormula()||!1!=this._clipChildren.getValue()||this._collapsable.hasFormula()||this._collapsable.getValue()!=JSG.graph.model.attributes.Direction.NONE||this._collapsed.hasFormula()||!1!=this._collapsed.getValue()||this._collapsedButton.hasFormula()||this._collapsedButton.getValue()!=JSG.graph.model.attributes.ButtonPosition.TOPRIGHT||this._deletable.hasFormula()||!0!=this._deletable.getValue()||this._moveable.hasFormula()||
this._moveable.getValue()!=JSG.graph.model.attributes.Direction.BOTH||this._rotatable.hasFormula()||!0!=this._rotatable.getValue()||this._selectionMode.hasFormula()||this._selectionMode.getValue()!=JSG.graph.model.attributes.SelectionMode.DEFAULT||this._sizeable.hasFormula()||!0!=this._sizeable.getValue()||this._visible.hasFormula()||!0!=this._visible.getValue()||this._alwaysVisible.hasFormula()||this._alwaysVisible.getValue()!=JSG.graph.model.attributes.Direction.NONE||this._combined.hasFormula()||
!1!=this._combined.getValue()||this._closed.hasFormula()||!1!=this._closed.getValue()||this._container.hasFormula()||!0!=this._container.getValue()||this._portMode.hasFormula()||this._portMode.getValue()!=JSG.graph.model.attributes.PortMode.DEFAULT+JSG.graph.model.attributes.PortMode.CENTER||this._snapTo.hasFormula()||!1!=this._snapTo.getValue()||this._layer.hasFormula()||""!=this._layer.getValue()||this._link.hasFormula()||""!=this._link.getValue()||this._type.hasFormula()||""!=this._type.getValue()||
this._leftMargin.hasFormula()||0!=this._leftMargin.getValue()||this._rightMargin.hasFormula()||0!=this._rightMargin.getValue()||this._topMargin.hasFormula()||0!=this._topMargin.getValue()||this._bottomMargin.hasFormula()||0!=this._bottomMargin.getValue()?!1:!0};JSG.namespace("JSG.graph.model.attributes");JSG.graph.model.attributes.LayoutAttributeID.LINEBEHAVIOR="linebehavior";
JSG.graph.model.attributes.EdgeLayoutAttributes=function(){JSG.graph.model.attributes.EdgeLayoutAttributes._super.constructor.apply(this,arguments);this._behavior=new JSG.graph.expr.StringExpression(JSG.graph.model.shapes.OrthoLineBehavior.MANUAL)};JSG.extend(JSG.graph.model.attributes.EdgeLayoutAttributes,JSG.graph.model.attributes.LayoutAttributes);JSG.graph.model.attributes.EdgeLayoutAttributes.prototype.getType=function(){return"Straight"};
JSG.graph.model.attributes.EdgeLayoutAttributes.prototype.newInstance=function(){return new JSG.graph.model.attributes.EdgeLayoutAttributes};JSG.graph.model.attributes.EdgeLayoutAttributes.prototype.getConstraints=function(){};JSG.graph.model.attributes.EdgeLayoutAttributes.prototype.getLineBehavior=function(){return this._behavior};JSG.graph.model.attributes.EdgeLayoutAttributes.prototype.setLineBehavior=function(a){};JSG.namespace("JSG.graph.model.attributes");
JSG.graph.model.attributes.OrthoEdgeLayoutAttributes=function(){JSG.graph.model.attributes.OrthoEdgeLayoutAttributes._super.constructor.apply(this,arguments);this._behavior=new JSG.graph.expr.StringExpression(JSG.graph.model.shapes.OrthoLineBehavior.AUTO)};JSG.extend(JSG.graph.model.attributes.OrthoEdgeLayoutAttributes,JSG.graph.model.attributes.EdgeLayoutAttributes);JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.getType=function(){return"Orthogonal"};
JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.newInstance=function(){return new JSG.graph.model.attributes.OrthoEdgeLayoutAttributes};JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.copy=function(){var a=JSG.graph.model.attributes.OrthoEdgeLayoutAttributes._super.copy.call(this);a._behavior=this._behavior.copy();return a};JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.getConstraints=function(){};
JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.getLineBehavior=function(){return this._behavior};JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.setLineBehavior=function(a){if(!this._behavior.isEqualToExpressionOrValue(a)){var b=void 0!=this._item?this._createEvent(JSG.graph.model.attributes.LayoutAttributeID.LINEBEHAVIOR,a):void 0;this.sendPreEventToItem(this._item,b);if(void 0==b||b.doIt)this._behavior.setExpressionOrValue(a),this.sendPostEventToItem(this._item,b)}};
JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.readXML=function(a){if(void 0!=a){var b;a:{b=this._behavior;for(var c=a.attributes;0<c.length;){c=c[0];"linebehavior"===c.nodeName&&b.setExpressionOrValue(c.nodeValue);b=!0;break a}b=!1}if(!b)for(b=0,c=a.childNodes.length;b<c;b++){var d=a.childNodes.item(b);if("linebehavior"===d.nodeName){this._behavior.readXML(d);break}}}};
JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.saveXML=function(a,b){this.isDefault()||(b.writeStartElement(a),this._behavior.saveXML("linebehavior",b),b.writeEndElement())};JSG.graph.model.attributes.OrthoEdgeLayoutAttributes.prototype.isDefault=function(){return this._behavior.getValue()===JSG.graph.model.shapes.OrthoLineBehavior.AUTO};JSG.namespace("JSG.graph.model.settings");
JSG.graph.model.settings.GraphSettingsEvent=function(a,b){JSG.graph.model.settings.GraphSettingsEvent._super.constructor.call(this);this.id=JSG.graph.model.events.Event.GRAPHSETTINGS;this.detailId=a;this.value=b};JSG.extend(JSG.graph.model.settings.GraphSettingsEvent,JSG.graph.model.events.Event);JSG.namespace("JSG.graph.model.settings");
JSG.graph.model.settings.PageID={WIDTH:"width",HEIGHT:"height",LEFTMARGIN:"leftmargin",TOPMARGIN:"topmargin",RIGHTMARGIN:"rightmargin",BOTTOMMARGIN:"bottommargin",FOOTERMARGIN:"footermargin",HEADERMARGIN:"headermargin",HEADERLEFT:"headerleft",HEADERCENTER:"headercenter",HEADERRIGHT:"headerright",FOOTERLEFT:"footerleft",FOOTERCENTER:"footercenter",FOOTERRIGHT:"footerright",FORMAT:"format",ORIENTATION:"orientation",SCALETOPAGETYPE:"scaletopagetype",SCALETOPAGECOUNT:"scaletopagecount"};
JSG.graph.model.settings.PageOrientation={PORTRAIT:0,LANDSCAPE:1};JSG.graph.model.settings.ScaleToPageType={NONE:0,SINGLE:1,VERTICALCOUNT:2,HORIZONTALCOUNT:3};JSG.graph.model.settings.PageSize={A3:1,A4:2,A5:3,B3:4,B4:5,B5:6,LETTER:7,LEGAL:8,LEDGER:9,A0:10,A1:11,A2:12};
JSG.graph.model.settings.Page=function(){this._rightMargin=this._leftMargin=1500;this._bottomMargin=this._topMargin=2E3;this._headerRight=this._headerCenter=this._headerLeft="";this._headerMargin=800;this._footerCenter=this._footerLeft="";this._footerRight="[#p]";this._footerMargin=800;this._verticalGap=1E3;this._horizontalGap=500;this.setFormat(JSG.graph.model.settings.PageSize.A4);this._orientation=JSG.graph.model.settings.PageOrientation.LANDSCAPE;this._scaleToPageType=JSG.graph.model.settings.ScaleToPageType.NONE;
this._scaleToPageCount=1};JSG.extend(JSG.graph.model.settings.Page,JSG.graph.model.attributes.AbstractAttributes);JSG.graph.model.settings.Page.prototype.copy=function(){var a=new JSG.graph.model.settings.Page;a.setTo(this);return a};
JSG.graph.model.settings.Page.prototype.setTo=function(a){this._leftMargin=a._leftMargin;this._rightMargin=a._rightMargin;this._topMargin=a._topMargin;this._bottomMargin=a._bottomMargin;this._footerMargin=a._footerMargin;this._headerMargin=a._headerMargin;this._verticalGap=a._verticalGap;this._horizontalGap=a._horizontalGap;this._headerLeft=a._headerLeft;this._headerCenter=a._headerCenter;this._headerRight=a._headerRight;this._footerLeft=a._footerLeft;this._footerCenter=a._footerCenter;this._footerRight=
a._footerRight;this._scaleToPageType=a._scaleToPageType;this._scaleToPageCount=a._scaleToPageCount;this.setFormat(a.getFormat());this.setOrientation(a.getOrientation())};JSG.graph.model.settings.Page.prototype.getUsableWidth=function(){return this._width-this._leftMargin-this._rightMargin};JSG.graph.model.settings.Page.prototype.getUsableHeight=function(){return this._height-this._topMargin-this._bottomMargin};JSG.graph.model.settings.Page.prototype.getWidth=function(){return this._width};
JSG.graph.model.settings.Page.prototype.setWidth=function(a){this._setAttribute(JSG.graph.model.settings.PageID.WIDTH,"_width",this._width,a)};JSG.graph.model.settings.Page.prototype.getHeight=function(){return this._height};JSG.graph.model.settings.Page.prototype.setHeight=function(a){this._setAttribute(JSG.graph.model.settings.PageID.HEIGHT,"_height",this._height,a)};JSG.graph.model.settings.Page.prototype.getLeftMargin=function(){return this._leftMargin};
JSG.graph.model.settings.Page.prototype.setLeftMargin=function(a){this._setAttribute(JSG.graph.model.settings.PageID.LEFTMARGIN,"_leftMargin",this._leftMargin,a)};JSG.graph.model.settings.Page.prototype.getTopMargin=function(){return this._topMargin};JSG.graph.model.settings.Page.prototype.setTopMargin=function(a){this._setAttribute(JSG.graph.model.settings.PageID.TOPMARGIN,"_topMargin",this._topMargin,a)};JSG.graph.model.settings.Page.prototype.getRightMargin=function(){return this._rightMargin};
JSG.graph.model.settings.Page.prototype.setRightMargin=function(a){this._setAttribute(JSG.graph.model.settings.PageID.RIGHTMARGIN,"_rightMargin",this._rightMargin,a)};JSG.graph.model.settings.Page.prototype.getBottomMargin=function(){return this._bottomMargin};JSG.graph.model.settings.Page.prototype.setBottomMargin=function(a){this._setAttribute(JSG.graph.model.settings.PageID.BOTTOMMARGIN,"_bottomMargin",this._bottomMargin,a)};JSG.graph.model.settings.Page.prototype.getHeaderMargin=function(){return this._headerMargin};
JSG.graph.model.settings.Page.prototype.setHeaderMargin=function(a){this._setAttribute(JSG.graph.model.settings.PageID.HEADERMARGIN,"_headerMargin",this._headerMargin,a)};JSG.graph.model.settings.Page.prototype.getHeaderLeft=function(){return this._headerLeft};JSG.graph.model.settings.Page.prototype.setHeaderLeft=function(a){this._setAttribute(JSG.graph.model.settings.PageID.HEADERLEFT,"_headerLeft",this._headerLeft,a)};JSG.graph.model.settings.Page.prototype.getHeaderCenter=function(){return this._headerCenter};
JSG.graph.model.settings.Page.prototype.setHeaderCenter=function(a){this._setAttribute(JSG.graph.model.settings.PageID.HEADERCENTER,"_headerCenter",this._headerCenter,a)};JSG.graph.model.settings.Page.prototype.getHeaderRight=function(){return this._headerRight};JSG.graph.model.settings.Page.prototype.setHeaderRight=function(a){this._setAttribute(JSG.graph.model.settings.PageID.HEADERRIGHT,"_headerRight",this._headerRight,a)};JSG.graph.model.settings.Page.prototype.getFooterMargin=function(){return this._footerMargin};
JSG.graph.model.settings.Page.prototype.setFooterMargin=function(a){this._setAttribute(JSG.graph.model.settings.PageID.FOOTERMARGIN,"_footerMargin",this._footerMargin,a)};JSG.graph.model.settings.Page.prototype.getFooterLeft=function(){return this._footerLeft};JSG.graph.model.settings.Page.prototype.setFooterLeft=function(a){this._setAttribute(JSG.graph.model.settings.PageID.FOOTERLEFT,"_footerLeft",this._footerLeft,a)};JSG.graph.model.settings.Page.prototype.getFooterCenter=function(){return this._footerCenter};
JSG.graph.model.settings.Page.prototype.setFooterCenter=function(a){this._setAttribute(JSG.graph.model.settings.PageID.FOOTERCENTER,"_footerCenter",this._footerCenter,a)};JSG.graph.model.settings.Page.prototype.getFooterRight=function(){return this._footerRight};JSG.graph.model.settings.Page.prototype.setFooterRight=function(a){this._setAttribute(JSG.graph.model.settings.PageID.FOOTERRIGHT,"_footerRight",this._footerRight,a)};JSG.graph.model.settings.Page.prototype.getScaleToPageType=function(){return this._scaleToPageType};
JSG.graph.model.settings.Page.prototype.setScaleToPageType=function(a){this._setAttribute(JSG.graph.model.settings.PageID.SCALETOPAGETYPE,"_scaleToPageType",this._scaleToPageType,a)};JSG.graph.model.settings.Page.prototype.getScaleToPageCount=function(){return this._scaleToPageCount};JSG.graph.model.settings.Page.prototype.setScaleToPageCount=function(a){this._setAttribute(JSG.graph.model.settings.PageID.SCALETOPAGECOUNT,"_scaleToPageCount",this._scaleToPageCount,a)};
JSG.graph.model.settings.Page.prototype.getFormat=function(){return this._format};
JSG.graph.model.settings.Page.prototype.setFormat=function(a){if(this._format!=a){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.PAGE,a);b.detailId=JSG.graph.model.settings.PageID.FORMAT;b.source=this._item;this.sendPreEventToItem(this._item,b);if(!0===b.doIt){var c=1E4,d=1E4;this._format=a;switch(a){case JSG.graph.model.settings.PageSize.A0:c=84100;d=118900;break;case JSG.graph.model.settings.PageSize.A1:c=59400;d=84100;break;case JSG.graph.model.settings.PageSize.A2:c=42E3;
d=59400;break;case JSG.graph.model.settings.PageSize.A3:c=29700;d=42E3;break;case JSG.graph.model.settings.PageSize.A4:c=21E3;d=29700;break;case JSG.graph.model.settings.PageSize.A5:c=14800;d=21E3;break;case JSG.graph.model.settings.PageSize.B3:c=35300;d=5E4;break;case JSG.graph.model.settings.PageSize.B4:c=25E3;d=35300;break;case JSG.graph.model.settings.PageSize.B5:c=17600;d=25E3;break;case JSG.graph.model.settings.PageSize.LEGAL:c=21590;d=35560;break;case JSG.graph.model.settings.PageSize.LETTER:c=
21590;d=27940;break;case JSG.graph.model.settings.PageSize.LEDGER:c=27900,d=43200}this._orientation==JSG.graph.model.settings.PageOrientation.PORTRAIT?(this._width=c,this._height=d):(this._width=d,this._height=c);this.sendPostEventToItem(this._item,b)}}};JSG.graph.model.settings.Page.prototype.getOrientation=function(){return this._orientation};
JSG.graph.model.settings.Page.prototype.setOrientation=function(a){if(this._orientation!=a){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.PAGE,a);b.detailId=JSG.graph.model.settings.PageID.ORIENTATION;b.source=this._item;this.sendPreEventToItem(this._item,b);if(!0===b.doIt){this._orientation=a;var c;this._orientation==JSG.graph.model.settings.PageOrientation.LANDSCAPE?(c=Math.max(this._height,this._width),a=Math.min(this._height,this._width)):(c=Math.min(this._height,this._width),
a=Math.max(this._height,this._width));this._width=c;this._height=a;this.sendPostEventToItem(this._item,b)}}};
JSG.graph.model.settings.Page.prototype.saveXML=function(a){a.writeStartElement("page");a.writeAttributeString("format",this._format);a.writeAttributeString("width",this._width);a.writeAttributeString("height",this._height);a.writeAttributeString("leftmargin",this._leftMargin);a.writeAttributeString("topmargin",this._topMargin);a.writeAttributeString("bottommargin",this._bottomMargin);a.writeAttributeString("rightmargin",this._rightMargin);a.writeAttributeString("footermargin",this._footerMargin);
a.writeAttributeString("footerleft",this._footerLeft);a.writeAttributeString("footercenter",this._footerCenter);a.writeAttributeString("footerright",this._footerRight);a.writeAttributeString("headermargin",this._headerMargin);a.writeAttributeString("headerleft",this._headerLeft);a.writeAttributeString("headercenter",this._headerCenter);a.writeAttributeString("headerright",this._headerRight);a.writeAttributeString("orientation",this._orientation);a.writeAttributeString("vgap",this._verticalGap);a.writeAttributeString("hgap",
this._horizontalGap);a.writeAttributeString("scaletopagetype",this._scaleToPageType);a.writeAttributeString("scaletopagecount",this._scaleToPageCount);a.writeEndElement()};
JSG.graph.model.settings.Page.prototype.readXML=function(a){this._format=Number(a.getAttribute("format"));this._width=Number(a.getAttribute("width"));this._height=Number(a.getAttribute("height"));this._leftMargin=Number(a.getAttribute("leftmargin"));this._topMargin=Number(a.getAttribute("topmargin"));this._bottomMargin=Number(a.getAttribute("bottommargin"));this._rightMargin=Number(a.getAttribute("rightmargin"));this._footerMargin=Number(a.getAttribute("footermargin"));var b=a.getAttribute("footerleft");
b&&(this._footerLeft=b);if(b=a.getAttribute("footercenter"))this._footerCenter=b;if(b=a.getAttribute("footerright"))this._footerRight=b;this._headerMargin=Number(a.getAttribute("headermargin"));if(b=a.getAttribute("headerleft"))this._headerLeft=b;if(b=a.getAttribute("headercenter"))this._headerCenter=b;if(b=a.getAttribute("headerright"))this._headerRight=b;if(b=a.getAttribute("scaletopagetype"))this._scaleToPageType=Number(b);if(b=a.getAttribute("scaletopagecount"))this._scaleToPageCount=Number(b);
this._orientation=Number(a.getAttribute("orientation"))};JSG.graph.model.settings.Page.prototype._readOldPageGaps=function(a){};JSG.graph.model.settings.Page.prototype.getVerticalGap=function(){return this._verticalGap};JSG.graph.model.settings.Page.prototype.getHorizontalGap=function(){return this._horizontalGap};JSG.graph.model.settings.Page.prototype._createEvent=function(a,b){var c=new JSG.graph.model.events.PageEvent(a,b);c.source=this._item;return c};
JSG.graph.model.settings.Page.prototype._setAttribute=function(a,b,c,d){c!=d&&(c=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.PAGE,d),c.detailId=a,c.source=this._item,this.sendPreEventToItem(this._item,c),void 0==c||c.doIt)&&(this[b]=d,this.sendPostEventToItem(this._item,c))};JSG.namespace("JSG.graph.model.settings");JSG.graph.model.settings.CustomSetting=function(){};JSG.graph.model.settings.CustomSetting.prototype.getClassString=function(){};
JSG.graph.model.settings.CustomSetting.prototype.setGraphSettings=function(a){};JSG.graph.model.settings.CustomSetting.prototype.saveXML=function(a){};JSG.graph.model.settings.CustomSetting.prototype.readXML=function(a){};JSG.namespace("JSG.graph.model.settings");JSG.graph.model.settings.GraphSettings=function(){JSG.graph.model.settings.GraphSettings._super.constructor.apply(this);this._settings=new JSG.commons.Map;this._addDefaultSettings()};JSG.extend(JSG.graph.model.settings.GraphSettings,JSG.graph.model.attributes.AbstractAttributes);
JSG.graph.model.settings.SettingID={DISPLAY_MODE:"setting:displaymode",PAGE:"setting:page",GRIDVISIBLE:"setting:gridvisible",PORTSVISIBLE:"setting:portvisible",NAMESVISIBLE:"setting:namesvisible",AVAILABLEPORTSVISIBLE:"setting:availableportvisible",SCALEVISIBLE:"setting:scalevisible",SNAPTOGRID:"setting:snaptogrid",SNAPTOSHAPES:"setting:snaptoshapes",SNAPTOPORT:"setting:snaptoport",SNAPGRIDUNIT:"setting:snapgridunit",AUTOSCROLL:"setting:autoscroll"};
JSG.graph.model.settings.GraphSettings.prototype._addDefaultSettings=function(){this._settings.put(JSG.graph.model.settings.SettingID.PAGE,new JSG.graph.model.settings.Page);this._settings.put(JSG.graph.model.settings.SettingID.DISPLAY_MODE,JSG.ui.graphics.DisplayMode.PAGE);this._settings.put(JSG.graph.model.settings.SettingID.GRIDVISIBLE,!0);this._settings.put(JSG.graph.model.settings.SettingID.PORTSVISIBLE,!1);this._settings.put(JSG.graph.model.settings.SettingID.NAMESVISIBLE,!1);this._settings.put(JSG.graph.model.settings.SettingID.AVAILABLEPORTSVISIBLE,
!1);this._settings.put(JSG.graph.model.settings.SettingID.SCALEVISIBLE,!0);this._settings.put(JSG.graph.model.settings.SettingID.SNAPTOGRID,!0);this._settings.put(JSG.graph.model.settings.SettingID.SNAPTOSHAPES,!0);this._settings.put(JSG.graph.model.settings.SettingID.SNAPTOPORT,JSG.graph.attr.consts.PortMode.ALL);this._settings.put(JSG.graph.model.settings.SettingID.SNAPGRIDUNIT,250);this._settings.put(JSG.graph.model.settings.SettingID.AUTOSCROLL,!0)};
JSG.graph.model.settings.GraphSettings.prototype.copy=function(){var a=new JSG.graph.model.settings.GraphSettings;a.setTo(this);return a};
JSG.graph.model.settings.GraphSettings.prototype.setTo=function(a){var b=void 0!=this._item?this._createEvent(JSG.graph.model.events.Event.ALL):void 0;this.sendPreEventToItem(this._item,b);if(void 0==b||b.doIt)this.getPage().setTo(a.getPage()),this._settings.put(JSG.graph.model.settings.SettingID.DISPLAY_MODE,a.getDisplayMode()),this._settings.put(JSG.graph.model.settings.SettingID.GRIDVISIBLE,a.getGridVisible()),this._settings.put(JSG.graph.model.settings.SettingID.PORTSVISIBLE,a.getPortsVisible()),
this._settings.put(JSG.graph.model.settings.SettingID.NAMESVISIBLE,a.getNamesVisible()),this._settings.put(JSG.graph.model.settings.SettingID.AVAILABLEPORTSVISIBLE,a.getAvailablePortsVisible()),this._settings.put(JSG.graph.model.settings.SettingID.SCALEVISIBLE,a.getScaleVisible()),this._settings.put(JSG.graph.model.settings.SettingID.SNAPTOGRID,a.getSnapToGrid()),this._settings.put(JSG.graph.model.settings.SettingID.SNAPTOSHAPES,a.getSnapToShapes()),this._settings.put(JSG.graph.model.settings.SettingID.SNAPTOPORT,
a.getSnapToPort()),this._settings.put(JSG.graph.model.settings.SettingID.SNAPGRIDUNIT,a.getSnapStep()),this._settings.put(JSG.graph.model.settings.SettingID.AUTOSCROLL,a.getAutoScroll()),this.sendPostEventToItem(this._item,b)};JSG.graph.model.settings.GraphSettings.prototype.getPage=function(){return this.getSetting(JSG.graph.model.settings.SettingID.PAGE)};JSG.graph.model.settings.GraphSettings.prototype.getDisplayMode=function(){return this.getSetting(JSG.graph.model.settings.SettingID.DISPLAY_MODE)};
JSG.graph.model.settings.GraphSettings.prototype.setDisplayMode=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.DISPLAY_MODE,a)};JSG.graph.model.settings.GraphSettings.prototype.getGridVisible=function(){return this.getSetting(JSG.graph.model.settings.SettingID.GRIDVISIBLE)};JSG.graph.model.settings.GraphSettings.prototype.setGridVisible=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.GRIDVISIBLE,a)};
JSG.graph.model.settings.GraphSettings.prototype.getPortsVisible=function(){return this.getSetting(JSG.graph.model.settings.SettingID.PORTSVISIBLE)};JSG.graph.model.settings.GraphSettings.prototype.setPortsVisible=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.PORTSVISIBLE,a)};JSG.graph.model.settings.GraphSettings.prototype.getAvailablePortsVisible=function(){return this.getSetting(JSG.graph.model.settings.SettingID.AVAILABLEPORTSVISIBLE)};
JSG.graph.model.settings.GraphSettings.prototype.setAvailablePortsVisible=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.AVAILABLEPORTSVISIBLE,a)};JSG.graph.model.settings.GraphSettings.prototype.getNamesVisible=function(){return this.getSetting(JSG.graph.model.settings.SettingID.NAMESVISIBLE)};JSG.graph.model.settings.GraphSettings.prototype.setNamesVisible=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.NAMESVISIBLE,a)};
JSG.graph.model.settings.GraphSettings.prototype.getScaleVisible=function(){return this.getSetting(JSG.graph.model.settings.SettingID.SCALEVISIBLE)};JSG.graph.model.settings.GraphSettings.prototype.setScaleVisible=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.SCALEVISIBLE,a)};JSG.graph.model.settings.GraphSettings.prototype.getSnapToGrid=function(){return this.getSetting(JSG.graph.model.settings.SettingID.SNAPTOGRID)};
JSG.graph.model.settings.GraphSettings.prototype.setSnapToGrid=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.SNAPTOGRID,a)};JSG.graph.model.settings.GraphSettings.prototype.getSnapStep=function(){return this.getSetting(JSG.graph.model.settings.SettingID.SNAPGRIDUNIT)};JSG.graph.model.settings.GraphSettings.prototype.setSnapStep=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.SNAPGRIDUNIT,a)};JSG.graph.model.settings.GraphSettings.prototype.getSnapToPort=function(){return this.getSetting(JSG.graph.model.settings.SettingID.SNAPTOPORT)};
JSG.graph.model.settings.GraphSettings.prototype.setSnapToPort=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.SNAPTOPORT,a)};JSG.graph.model.settings.GraphSettings.prototype.getSnapToShapes=function(){return this.getSetting(JSG.graph.model.settings.SettingID.SNAPTOSHAPES)};JSG.graph.model.settings.GraphSettings.prototype.setSnapToShapes=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.SNAPTOSHAPES,a)};
JSG.graph.model.settings.GraphSettings.prototype.getAutoScroll=function(){return this.getSetting(JSG.graph.model.settings.SettingID.AUTOSCROLL)};JSG.graph.model.settings.GraphSettings.prototype.setAutoScroll=function(a){this._changeSetting(JSG.graph.model.settings.SettingID.AUTOSCROLL,a)};
JSG.graph.model.settings.GraphSettings.prototype._changeSetting=function(a,b){if(this._settings.get(a)!==b){var c=void 0!=this._item?this._createEvent(a,b):void 0;this.sendPreEventToItem(this._item,c);if(void 0==c||c.doIt)this._settings.put(a,b),this.sendPostEventToItem(this._item,c)}};JSG.graph.model.settings.GraphSettings.prototype._createEvent=function(a,b){return new JSG.graph.model.settings.GraphSettingsEvent(a,b)};
JSG.graph.model.settings.GraphSettings.prototype.addSetting=function(a,b){b.setGraphSettings(this);var c=this._settings.put(a,b);void 0!=c&&c.setGraphSettings(void 0)};JSG.graph.model.settings.GraphSettings.prototype.getSetting=function(a){return this._settings.get(a)};JSG.graph.model.settings.GraphSettings.prototype.removeSetting=function(a){a=this._settings.remove(a);void 0!=a&&a.setGraphSettings(void 0);return a};
JSG.graph.model.settings.GraphSettings.prototype.readXML=function(a){function b(a,b,c){void 0!=b&&c.put(a,"true"==b?!0:!1)}function c(a,b,c){void 0!=b&&c.put(a,Number(b))}function d(a,b){var c=a.getAttribute("id"),d=a.getAttribute("class");void 0!=c&&void 0!=d&&(d=JSG.createObjectFromString(d),void 0!=d&&(d.readXML(f[g]),b.addSetting(c,d)))}b(JSG.graph.model.settings.SettingID.GRIDVISIBLE,a.getAttribute("grid"),this._settings);b(JSG.graph.model.settings.SettingID.PORTSVISIBLE,a.getAttribute("ports"),
this._settings);a.getAttribute("availableports")&&b(JSG.graph.model.settings.SettingID.AVAILABLEPORTSVISIBLE,a.getAttribute("availableports"),this._settings);a.getAttribute("names")&&b(JSG.graph.model.settings.SettingID.NAMES,a.getAttribute("names"),this._settings);b(JSG.graph.model.settings.SettingID.SNAPTOGRID,a.getAttribute("snaptogrid"),this._settings);b(JSG.graph.model.settings.SettingID.SNAPTOSHAPES,a.getAttribute("snaptoshapes"),this._settings);b(JSG.graph.model.settings.SettingID.SCALEVISIBLE,
a.getAttribute("scale"),this._settings);b(JSG.graph.model.settings.SettingID.AUTOSCROLL,a.getAttribute("autoscroll"),this._settings);c(JSG.graph.model.settings.SettingID.SNAPTOPORT,a.getAttribute("snaptoport"),this._settings);c(JSG.graph.model.settings.SettingID.SNAPGRIDUNIT,a.getAttribute("snapstep"),this._settings);var e=findElementByTagName(a,"page");void 0!=e&&this.getPage().readXML(e);void 0!=a.getAttribute("horizontalgap")&&this.getPage()._readOldPageGaps(a);for(var f=findAllElementsByTagName(a,
"custom"),g=0;g<f.length;g++)d(f[g],this)};
JSG.graph.model.settings.GraphSettings.prototype.saveXML=function(a){function b(b){a.writeStartElement("custom");a.writeAttributeString("id",b.id);a.writeAttributeString("class",b.clazz);b.value.saveXML(a);a.writeEndElement()}a.writeStartElement("settings");a.writeAttributeString("dplmode",this.getDisplayMode());a.writeAttributeString("grid",this.getGridVisible());a.writeAttributeString("ports",this.getPortsVisible());a.writeAttributeString("names",this.getNamesVisible());a.writeAttributeString("availableports",
this.getAvailablePortsVisible());a.writeAttributeString("scale",this.getScaleVisible());a.writeAttributeString("snaptogrid",this.getSnapToGrid());a.writeAttributeString("snaptoshapes",this.getSnapToShapes());a.writeAttributeString("snaptoport",this.getSnapToPort());a.writeAttributeString("snapstep",this.getSnapStep());a.writeAttributeString("autoscroll",this.getAutoScroll());this.getPage().saveXML(a);for(var c=function(a){var b=[],c=JSG.graph.model.settings.SettingID;a.iterate(function(a,d){Object.prototype.hasOwnProperty.call(c,
a)||(void 0==d.saveXML||void 0==d.getClassString)||b.push({id:a,clazz:d.getClassString(),value:d})});return b}(this._settings),d=0;d<c.length;d++)b(c[d]);a.writeEndElement()};JSG.namespace("JSG.graph.model");JSG.graph.model.Layer=function(a){this.name=a;this.selectable=this.visible=!0};
JSG.graph.model.Layer.prototype.saveXML=function(a){a.writeStartElement("layer");a.writeAttributeString("name",this.name);a.writeAttributeString("visible",this.visible);a.writeAttributeString("selectable",this.selectable);a.writeEndElement()};JSG.graph.model.Layer.prototype.readXML=function(a){this.visible="true"==a.getAttribute("visible")?!0:!1;this.selectable="true"==a.getAttribute("selectable")?!0:!1};JSG.namespace("JSG.graph.model");
JSG.graph.model.Condition=function(a,b){this.prio=0;this.path=a;this.isActive=!0;this.expression=void 0==b?new JSG.graph.expr.StringExpression("undefined"):b};JSG.graph.model.Condition.prototype.copy=function(){var a=new JSG.graph.model.Condition(this.path,this.expression.copy());a.isActive=this.isActive;return a};JSG.graph.model.Condition.prototype.isTrue=function(){var a=this.expression.getTerm();return"cond"===a.type?a.getCondition().getValue():!!this.expression.getValue()};
JSG.graph.model.Condition.prototype.saveXML=function(a,b){b.writeStartElement(a);b.writeAttributeString("prio",this.prio);b.writeAttributeString("active",this.isActive);b.writeAttributeString("path",this.path||"");this.expression.saveXML("expr",b,2);b.writeEndElement()};JSG.graph.model.Condition.prototype.readXML=function(a){this.prio=a.getAttribute("prio")||0;this.path=a.getAttribute("path");this.isActive="false"===a.getAttribute("active")?!1:!0;(a=findElementByTagName(a,"expr"))&&this.expression.readXML(a)};
JSG.namespace("JSG.graph.model");JSG.graph.model.Conditions=function(a){this._item=a;this._conditions=[]};JSG.graph.model.Conditions.prototype.hasConditions=function(){return 0<this._conditions.length};JSG.graph.model.Conditions.prototype.getConditionsCount=function(){return this._conditions.length};JSG.graph.model.Conditions.prototype.getConditions=function(){for(var a=[],b=0;b<this._conditions.length;b++){var c=this.getConditionAt(b);c&&a.push(c)}return a};
JSG.graph.model.Conditions.prototype.getConditionAt=function(a){var b=void 0;0<=a&&a<this._conditions.length&&(a=this._conditions[a],b=a.copy(),b._org=a,b.expression.evaluate(this._item));return b};JSG.graph.model.Conditions.prototype.addCondition=function(a,b){var c=a.copy();a._org=c;c.expression.evaluate(this._item);a.expression.evaluate(this._item);this._addCondition(c,b);this._addTargetCond(c,b);this._sendEvent(c)};
JSG.graph.model.Conditions.prototype._addCondition=function(a,b){var c=void 0==b||b>this._conditions.length?this._conditions.length:b,c=Math.max(c,0);this._conditions.insertAt(c,a)};JSG.graph.model.Conditions.prototype._addTargetCond=function(a,b){if(this._item&&a.path){var c=this._item.getAttributeAtPath(a.path);c instanceof JSG.graph.attr.ConditionalAttribute||(c=new JSG.graph.attr.ConditionalAttribute(c),this._item.addAttributeAtPath(a.path,c));c.addCondition(a,this._targetIndex(a.path,b))}};
JSG.graph.model.Conditions.prototype._targetIndex=function(a,b){if(void 0!=b){for(var c=0,d=0;d<this._conditions.length&&d<b;d++)this._conditions[d].path==a&&c++;b=c++}return b};JSG.graph.model.Conditions.prototype.removeCondition=function(a){var b=a._org;b&&(this._conditions.remove(b),this._rmTargetCond(b),this._sendEvent(b),a._org=void 0)};
JSG.graph.model.Conditions.prototype._rmTargetCond=function(a){if(this._item&&a.path){var b=this._item.getAttributeAtPath(a.path);b instanceof JSG.graph.attr.ConditionalAttribute&&(b.removeCondition(a),b.hasConditions()||this._item.addAttributeAtPath(a.path,b.attribute()))}};JSG.graph.model.Conditions.prototype.moveConditionAtTo=function(a,b){this._conditions.move(a,b)};
JSG.graph.model.Conditions.prototype.updateCondition=function(a){var b=a._org;b&&(b.prio=a.prio,b.isActive=a.isActive,b.path!=a.path&&(this._rmTargetCond(b),b.path=a.path,this._addTargetCond(b)),!0==b.expression.setTo(a.expression)&&(a.expression.evaluate(this._item),b.expression.evaluate(this._item)),b=this._item.getAttributeAtPath(a.path),b instanceof JSG.graph.attr.ConditionalAttribute&&b.sortConditions(),this._sendEvent(a))};
JSG.graph.model.Conditions.prototype._sendEvent=function(a){if(a=this._item.getAttributeAtPath(a.path))a=new JSG.graph.model.events.AttributeChangeEvent(JSG.graph.model.events.AttributeChangeEvent.VALUE,a),this._item.getGraph()._changed=!0,this._item.sendPostEvent(a)};JSG.graph.model.Conditions.prototype.saveXML=function(a,b){b.writeStartElement(a);for(var c=0;c<this._conditions.length;c++)this._conditions[c].saveXML("co",b);b.writeEndElement()};
JSG.graph.model.Conditions.prototype.readXML=function(a){if(a.hasChildNodes())for(var b=0,c=a.childNodes.length;b<c;b++){var d=a.childNodes.item(b);if("co"==d.nodeName){var e=new JSG.graph.model.Condition;e.readXML(d);this.addCondition(e)}}};JSG.namespace("JSG.graph.model.shapes");JSG.graph.model.shapes.Shape=function(){this._item=void 0;this._coordinates=[];this._coordpointlist=new JSG.geometry.PointList;this._refreshEnabled=this._notificationEnabled=!0};JSG.graph.model.shapes.Shape.TYPE="graphitem";
JSG.graph.model.shapes.Shape.prototype.getType=function(){return JSG.graph.model.shapes.Shape.TYPE};JSG.graph.model.shapes.Shape.prototype.saveXML=function(a,b){b.writeStartElement(a);b.writeAttributeString("type",this.getType());this.saveXMLContent(b);b.writeEndElement()};JSG.graph.model.shapes.Shape.prototype.saveXMLContent=function(a){};JSG.graph.model.shapes.Shape.prototype.readXML=function(a){};
JSG.graph.model.shapes.Shape.prototype._newExpression=function(a,b,c){return new JSG.graph.expr.NumberExpression(a,b,c)};JSG.graph.model.shapes.Shape.prototype.newInstance=function(){return new JSG.graph.model.shapes.Shape};JSG.graph.model.shapes.Shape.prototype.copy=function(){var a=this.newInstance();a.setCoordinates(this._coordinates);return a};JSG.graph.model.shapes.Shape.prototype.init=function(){};
JSG.graph.model.shapes.Shape.prototype.disableNotification=function(){this._notificationEnabled=!1};JSG.graph.model.shapes.Shape.prototype.enableNotification=function(){this._notificationEnabled=!0};JSG.graph.model.shapes.Shape.prototype.disableRefresh=function(){var a=this._refreshEnabled;this._refreshEnabled=!1;return a};JSG.graph.model.shapes.Shape.prototype.enableRefresh=function(a){this._refreshEnabled=!0;!0===a&&this.refresh()};
JSG.graph.model.shapes.Shape.prototype.setItem=function(a){this._item=a};
JSG.graph.model.shapes.Shape.prototype.containsPoint=function(a,b){if(!a)return!1;var c=this._item.isClosed(),d=c,e=this.getPointList(),f=JSG.findRadius/this._item.getGraph().getZoom();if(b==JSG.graph.controller.FindFlags.AREAWITHFRAME)return e.contains(a)?!0:e.distance(a,c)<f;if(b!=JSG.graph.controller.FindFlags.AREA&&b!=JSG.graph.controller.FindFlags.INNERAREA){var g=this._item.getItemAttributes().getSelectionMode().getValue();g&JSG.graph.attr.consts.SelectionMode.DEFAULT?d=this._item.getItemCount()||
d&&this._item.getFormat().getFillStyle().getValue()!=JSG.graph.attr.FormatAttributes.FillStyle.NONE:g&JSG.graph.attr.consts.SelectionMode.BORDER?d=!1:g&JSG.graph.attr.consts.SelectionMode.AREA&&(d=!0)}return d?e.contains(a):e.distance(a,c)<f};JSG.graph.model.shapes.Shape.prototype.hasCoordinates=function(){return!this._coordinates.isEmpty()};JSG.graph.model.shapes.Shape.prototype.getCoordinates=function(){return this._coordinates};JSG.graph.model.shapes.Shape.prototype.getCoordinatesCount=function(){return this._coordinates.length};
JSG.graph.model.shapes.Shape.prototype.getCoordinateAt=function(a){return 0<=a&&a<this._coordinates.length?this._coordinates[a]:void 0};JSG.graph.model.shapes.Shape.prototype.keepCoordinates=function(a){for(var b=this._coordinates.length;b<a;b++)this._coordinates.push(new JSG.graph.Coordinate);this._coordinates.length=a};
JSG.graph.model.shapes.Shape.prototype.addCoordinate=function(a){var b=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.ADDCOORDINATE,a);!0===b.doIt&&(a.evaluate(this._item),this._coordinates.push(a),this.refresh(),this._shapeDidChange(b))};JSG.graph.model.shapes.Shape.prototype.insertCoordinatesAt=function(a,b){var c=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_INSERT_AT,a,b);!0===c.doIt&&(this._evalCoords(b),this._coordinates.insertAt(a,b),this.refresh(),this._shapeDidChange(c))};
JSG.graph.model.shapes.Shape.prototype.removeCoordinateAt=function(a){var b=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_REMOVE_AT,a);if(!0===b.doIt)return a=this._coordinates.removeAt(a),this.refresh(),this._shapeDidChange(b),a};JSG.graph.model.shapes.Shape.prototype.removeCoordinatesAt=function(a,b){var c=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_REMOVE_AT,a,b);!0===c.doIt&&(this._coordinates.splice(a,b),this.refresh(),this._shapeDidChange(c))};
JSG.graph.model.shapes.Shape.prototype.setCoordinateAt=function(a,b,c){if(0<=a&&a<this._coordinates.length&&!this._coordinates[a].isEqualTo(b,c)){var d=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_REPLACE_AT,a,b,c);!0===d.doIt&&(this._coordinates[a].set(b,c),void 0==this._item||this._item._reading||this._coordinates[a].evaluate(this._item),this.refresh(),this._shapeDidChange(d))}};
JSG.graph.model.shapes.Shape.prototype.setCoordinateAtTo=function(a,b){this.setCoordinateAt(a,b.getX(),b.getY())};JSG.graph.model.shapes.Shape.prototype.setCoordinates=function(a){var b=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_REPLACE_ALL,a);if(!0===b.doIt){for(var c=void 0!=this._item&&!this._item._reading,d=this._coordinates.length=0;d<a.length;d++){var e=a[d].copy();c&&e.evaluate(this._item);this._coordinates.push(e)}this.refresh();this._shapeDidChange(b)}};
JSG.graph.model.shapes.Shape.prototype.getPoints=function(){return this.getPointList().getPoints()};JSG.graph.model.shapes.Shape.prototype.getPointList=function(){return this._coordpointlist};JSG.graph.model.shapes.Shape.prototype.getPolygonPointList=function(){return this._coordpointlist};JSG.graph.model.shapes.Shape.prototype._fillPointList=function(a,b){a.keepPoints(b.length);for(var c=JSG.ptCache.get(),d=0;d<b.length;d++)a.setPointAtTo(d,b[d].toPoint(c));JSG.ptCache.release(c)};
JSG.graph.model.shapes.Shape.prototype.getValidPortLocations=function(a,b){var c=JSG.graph.attr.consts.PortMode.NONE;if(this._item&&(this._item instanceof JSG.graph.model.Node&&!this._item.isCollapsed())&&(c=this._item.getItemAttributes().getPortMode().getValue(),c&=this._item.getGraph().getSettings().getSnapToPort(),c!=JSG.graph.attr.consts.PortMode.NONE)){for(var d=this._coordpointlist,e=[],f=this._item.getPorts(),g=0,l=f.length;g<l;g++)e.push(f[g].getPin().getPoint());a&&c&JSG.graph.attr.consts.PortMode.CENTER&&
e.push(d.getCenter());if(!b&&(c&JSG.graph.attr.consts.PortMode.POINTS||c&JSG.graph.attr.consts.PortMode.LINESCENTER))for(d=d.getPoints(),g=0,l=d.length;g<l;g++)c&JSG.graph.attr.consts.PortMode.POINTS&&e.push(d[g]),!(this instanceof JSG.graph.model.shapes.BezierShape)&&(c&JSG.graph.attr.consts.PortMode.LINESCENTER&&(g||a))&&(g?e.push(new JSG.geometry.Point((d[g].x+d[g-1].x)/2,(d[g].y+d[g-1].y)/2)):a&&e.push(new JSG.geometry.Point((d[l-1].x+d[0].x)/2,(d[l-1].y+d[0].y)/2)));!b&&c&JSG.graph.attr.consts.PortMode.SIDESCENTER&&
(d=this._item.getSizeAsPoint(),e.push(new JSG.geometry.Point(0,d.y/2)),e.push(new JSG.geometry.Point(d.x/2,0)),e.push(new JSG.geometry.Point(d.x,d.y/2)),e.push(new JSG.geometry.Point(d.x/2,d.y)));!b&&c&JSG.graph.attr.consts.PortMode.SIDESQUARTER&&(d=this._item.getSizeAsPoint(),e.push(new JSG.geometry.Point(0,d.y/4)),e.push(new JSG.geometry.Point(0,0.75*d.y)),e.push(new JSG.geometry.Point(d.x/4,0)),e.push(new JSG.geometry.Point(0.75*d.x,0)),e.push(new JSG.geometry.Point(d.x,d.y/4)),e.push(new JSG.geometry.Point(d.x,
0.75*d.y)),e.push(new JSG.geometry.Point(d.x/4,d.y)),e.push(new JSG.geometry.Point(0.75*d.x,d.y)));!b&&c&JSG.graph.attr.consts.PortMode.CORNERS&&(d=this._item.getSizeAsPoint(),e.push(new JSG.geometry.Point(0,0)),e.push(new JSG.geometry.Point(d.x,0)),e.push(new JSG.geometry.Point(d.x,d.y)),e.push(new JSG.geometry.Point(0,d.y)));return e}};
JSG.graph.model.shapes.Shape.prototype.getValidPortLocation=function(a,b,c,d,e){function f(a,b,c){a=JSG.geometry.Utils.getLineLength(a,b);if(!isNaN(a)&&a<e)return c.x-=c.x-b.x,c.y-=c.y-b.y,c}if(this._item&&this._item instanceof JSG.graph.model.Node&&!this._item.isCollapsed()){var g=this._item.getItemAttributes().getPortMode().getValue(),g=g&this._item.getGraph().getSettings().getSnapToPort();if(g!=JSG.graph.attr.consts.PortMode.NONE){for(var l=this._coordpointlist,h=a.copy(),m=this._item.getPorts(),
k=0,n=m.length;k<n;k++){var q=m[k].getPin().getPoint();if(Math.abs(a.x-q.x)<e&&Math.abs(a.y-q.y)<e)return h.x-=a.x-q.x,h.y-=a.y-q.y,h}if(c&&g&JSG.graph.attr.consts.PortMode.CENTER&&(m=f(a,l.getCenter(),h),void 0!=m))return m;var p;if(!d&&g&JSG.graph.attr.consts.PortMode.POINTS&&(p=l.getOffsetFromPoint(a,e,c,!1),void 0!=p)||!(this instanceof JSG.graph.model.shapes.BezierShape)&&(!d&&g&JSG.graph.attr.consts.PortMode.LINESCENTER)&&(p=l.getOffsetFromPoint(a,e,c,!0),void 0!=p))return h.x-=p.x,h.y-=p.y,
h;if(!d&&g&JSG.graph.attr.consts.PortMode.SIDESCENTER){l=this._item.getSizeAsPoint();p=f(a,new JSG.geometry.Point(0,l.y/2),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x/2,0),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x,l.y/2),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x/2,l.y),h);if(void 0!=p)return p}if(!d&&g&JSG.graph.attr.consts.PortMode.SIDESQUARTER){l=this._item.getSizeAsPoint();p=f(a,new JSG.geometry.Point(0,l.y/4),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(0,
0.75*l.y),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x/4,0),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(0.75*l.x,0),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x,l.y/4),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x,0.75*l.y),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x/4,l.y),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(0.75*l.x,l.y),h);if(void 0!=p)return p}if(!d&&g&JSG.graph.attr.consts.PortMode.CORNERS){l=this._item.getSizeAsPoint();
p=f(a,new JSG.geometry.Point(0,0),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x,0),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(l.x,l.y),h);if(void 0!=p)return p;p=f(a,new JSG.geometry.Point(0,l.y),h);if(void 0!=p)return p}if(void 0===p&&g&JSG.graph.attr.consts.PortMode.SHAPE){p=this.getPolygonPointList().getOffsetFromSegment(a,b,e,c);if(void 0===p)return;h=b.copy()}if(void 0!==p)return h.x-=p.x,h.y-=p.y,h}}};
JSG.graph.model.shapes.Shape.prototype._shapeWillChange=function(a){a=new JSG.graph.model.events.ShapeEvent(a);a.doIt=!0;a.source=this._item;void 0!=this._item&&!0===this._notificationEnabled&&(this._initShapeEvent(a),this._item.sendPreEvent(a));return a};
JSG.graph.model.shapes.Shape.prototype._initShapeEvent=function(a){var b=JSG.graph.model.events.ShapeEvent;switch(a.detailId){case b.COORD_ADD:a.value=arguments[1];break;case b.COORDS_INSERT_AT:a.index=arguments[1];a.value=arguments[2];break;case b.COORDS_REMOVE_AT:a.index=arguments[1];a.count=2<arguments.length?arguments[2]:void 0;break;case b.COORDS_REPLACE_AT:a.index=arguments[1];3<arguments.length?(a.coordX=arguments[2],a.coordY=arguments[3]):a.coordinate=arguments[2];break;case b.COORDS_REPLACE_ALL:a.value=
arguments[1]}};JSG.graph.model.shapes.Shape.prototype._shapeDidChange=function(a){void 0!=this._item&&!0===this._notificationEnabled&&this._item.sendPostEvent(a)};JSG.graph.model.shapes.Shape.prototype.evaluate=function(){this._evalCoords(this._coordinates)};JSG.graph.model.shapes.Shape.prototype._evalCoords=function(a){if(void 0!=this._item&&!this._item._reading)for(var b=0;b<a.length;b++)a[b].evaluate(this._item)};
JSG.graph.model.shapes.Shape.prototype.resolveParentReference=function(a){for(var b=this._coordinates,c=0;c<b.length;c++)b[c].resolveParentReference(this._item,a)};JSG.graph.model.shapes.Shape.prototype.refresh=function(){!0===this._refreshEnabled&&this._fillPointList(this._coordpointlist,this.getCoordinates())};JSG.namespace("JSG.graph.model.shapes");
JSG.graph.model.shapes.RectangleShape=function(){JSG.graph.model.shapes.RectangleShape._super.constructor.apply(this,arguments);this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0),this._newExpression(0)));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH"),this._newExpression(0)));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH"),this._newExpression(0,"HEIGHT")));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0),
this._newExpression(0,"HEIGHT")))};JSG.extend(JSG.graph.model.shapes.RectangleShape,JSG.graph.model.shapes.Shape);JSG.graph.model.shapes.RectangleShape.TYPE="rectangle";JSG.graph.model.shapes.RectangleShape.prototype.getType=function(){return JSG.graph.model.shapes.RectangleShape.TYPE};JSG.graph.model.shapes.RectangleShape.prototype.newInstance=function(){return new JSG.graph.model.shapes.RectangleShape};JSG.graph.model.shapes.RectangleShape.prototype.addCoordinate=function(a){};
JSG.graph.model.shapes.RectangleShape.prototype.insertCoordinatesAt=function(a,b){};JSG.graph.model.shapes.RectangleShape.prototype.removeCoordinateAt=function(a){};JSG.graph.model.shapes.RectangleShape.prototype.setCoordinates=function(a){4==a.length&&JSG.graph.model.shapes.RectangleShape._super.setCoordinates.call(this,a)};JSG.namespace("JSG.graph.model.shapes");JSG.graph.model.shapes.PolygonShape=function(){JSG.graph.model.shapes.PolygonShape._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.model.shapes.PolygonShape,JSG.graph.model.shapes.Shape);JSG.graph.model.shapes.PolygonShape.TYPE="polygon";JSG.graph.model.shapes.PolygonShape.prototype.getType=function(){return JSG.graph.model.shapes.PolygonShape.TYPE};JSG.graph.model.shapes.PolygonShape.prototype.saveXMLContent=function(a){JSG.graph.model.shapes.PolygonShape._super.saveXMLContent.call(this,a);a.writeStartElement("cs");for(var b=0;b<this._coordinates.length;b++)this._coordinates[b].saveXML("c",a);a.writeEndElement()};
JSG.graph.model.shapes.PolygonShape.prototype.readXML=function(a){JSG.graph.model.shapes.PolygonShape._super.readXML.call(this,a);var b=a.getElementsByTagName("coordinates")[0];void 0==b&&(b=a.getElementsByTagName("cs")[0]);if(void 0!=b&&b.hasChildNodes()){a=0;for(var c=b.childNodes.length;a<c;a++){var d=b.childNodes.item(a);if("coordinate"==d.nodeName||"c"==d.nodeName){var e=new JSG.graph.Coordinate;e.readXML(d);this._coordinates.push(e)}}}};
JSG.graph.model.shapes.PolygonShape.prototype.newInstance=function(){return new JSG.graph.model.shapes.PolygonShape(this.isClosed)};JSG.graph.model.shapes.PolygonShape.prototype.removeCoordinateAt=function(a){2<this._coordinates.length&&JSG.graph.model.shapes.PolygonShape._super.removeCoordinateAt.call(this,a)};JSG.graph.model.shapes.PolygonShape.prototype.setCoordinates=function(a){2<=a.length&&JSG.graph.model.shapes.PolygonShape._super.setCoordinates.call(this,a)};JSG.namespace("JSG.graph.model.shapes");
JSG.graph.model.shapes.BezierShape=function(){JSG.graph.model.shapes.BezierShape._super.constructor.apply(this,arguments);this._cpFromCoordinates=[];this._cpToCoordinates=[];this._cpFromPoints=new JSG.geometry.PointList;this._cpToPoints=new JSG.geometry.PointList};JSG.extend(JSG.graph.model.shapes.BezierShape,JSG.graph.model.shapes.PolygonShape);JSG.graph.model.shapes.BezierShape.TYPE="bezier";JSG.graph.model.shapes.BezierShape.prototype.getType=function(){return JSG.graph.model.shapes.BezierShape.TYPE};
JSG.graph.model.shapes.BezierShape.prototype.newInstance=function(){return new JSG.graph.model.shapes.BezierShape};JSG.graph.model.shapes.BezierShape.prototype.copy=function(){var a=this.newInstance();a.setCoordinates(this._coordinates);a.setCpFromCoordinates(this._cpFromCoordinates);a.setCpToCoordinates(this._cpToCoordinates);return a};
JSG.graph.model.shapes.Shape.prototype.setCpFromCoordinates=function(a){var b=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_SET_CPFROM,a);if(!0===b.doIt){var c=void 0!=this._item&&!this._item._reading;this._cpFromCoordinates=[];for(var d=0;d<a.length;d++){var e=a[d].copy();c&&e.evaluate(this._item);this._cpFromCoordinates.push(e)}this.refresh();this._shapeDidChange(b)}};
JSG.graph.model.shapes.Shape.prototype.setCpToCoordinates=function(a){var b=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_SET_CPTO,a);if(!0===b.doIt){var c=void 0!=this._item&&!this._item._reading;this._cpToCoordinates=[];for(var d=0;d<a.length;d++){var e=a[d].copy();c&&e.evaluate(this._item);this._cpToCoordinates.push(e)}this.refresh();this._shapeDidChange(b)}};
JSG.graph.model.shapes.BezierShape.prototype.evaluate=function(){JSG.graph.model.shapes.BezierShape._super.evaluate.call(this);if(!this._item||!this._item._reading){if(this._cpFromCoordinates.length&&this._cpFromCoordinates.length)for(var a=0;a<this._cpFromCoordinates.length;a++)this._cpFromCoordinates[a].evaluate(this._item);if(this._cpToCoordinates.length&&this._cpToCoordinates.length)for(a=0;a<this._cpToCoordinates.length;a++)this._cpToCoordinates[a].evaluate(this._item)}};
JSG.graph.model.shapes.BezierShape.prototype.getCpFromCoordinates=function(){return this._cpFromCoordinates};JSG.graph.model.shapes.BezierShape.prototype.getCpToCoordinates=function(){return this._cpToCoordinates};JSG.graph.model.shapes.BezierShape.prototype.addCpFromCoordinate=function(a){var b=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORD_ADD_CPFROM,a);!0===b.doIt&&(this._cpFromCoordinates.push(a),this._shapeDidChange(b))};
JSG.graph.model.shapes.BezierShape.prototype.addCpToCoordinate=function(a){var b=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORD_ADD_CPTO,a);!0===b.doIt&&(this._cpToCoordinates.push(a),this._shapeDidChange(b))};
JSG.graph.model.shapes.BezierShape.prototype._initShapeEvent=function(a,b){var c=JSG.graph.model.events.ShapeEvent;switch(a.detailId){case c.COORD_ADD_CPTO:case c.COORD_ADD_CPFROM:case c.COORDS_SET_CPTO:case c.COORDS_SET_CPFROM:a.value=b;break;default:JSG.graph.model.shapes.BezierShape._super._initShapeEvent.call(this,a)}};
JSG.graph.model.shapes.BezierShape.prototype.getCpFromPoints=function(a){return this._cpFromCoordinates.length||void 0==a?this.getCpFromPointList().getPoints():(this.getBezierPoints(a),this._cpFromPoints.getPoints())};JSG.graph.model.shapes.BezierShape.prototype.getCpFromPointList=function(){return this._cpFromPoints};JSG.graph.model.shapes.BezierShape.prototype.getCpToPoints=function(a){return this._cpToCoordinates.length||void 0==a?this.getCpToPointList().getPoints():(this.getBezierPoints(a),this._cpToPoints.getPoints())};
JSG.graph.model.shapes.BezierShape.prototype.getCpToPointList=function(){return this._cpToPoints};
JSG.graph.model.shapes.BezierShape.prototype.getBezierPoints=function(a){if(!(2>a.length)){var b,c;this._cpFromPoints.clear();this._cpToPoints.clear();for(var d=0,e=a.length;d<e;d++)0==d?(b=0.2*(a[d+1].x-a[d].x),c=0.2*(a[d+1].y-a[d].y)):d==e-1?(b=0.2*(a[d].x-a[d-1].x),c=0.2*(a[d].y-a[d-1].y)):(b=0.2*(a[d+1].x-a[d-1].x),c=0.2*(a[d+1].y-a[d-1].y)),this._cpToPoints.addPoint(new JSG.geometry.Point(a[d].x+b,a[d].y+c)),this._cpFromPoints.addPoint(new JSG.geometry.Point(a[d].x-b,a[d].y-c))}};
JSG.graph.model.shapes.BezierShape.prototype.saveXMLContent=function(a){JSG.graph.model.shapes.BezierShape._super.saveXMLContent.call(this,a);a.writeStartElement("cpfrom");for(var b=0;b<this._cpFromCoordinates.length;b++)this._cpFromCoordinates[b].saveXML("c",a);a.writeEndElement();a.writeStartElement("cpto");for(b=0;b<this._cpToCoordinates.length;b++)this._cpToCoordinates[b].saveXML("c",a);a.writeEndElement()};
JSG.graph.model.shapes.BezierShape.prototype.readXML=function(a){JSG.graph.model.shapes.BezierShape._super.readXML.call(this,a);var b=a.getElementsByTagName("cpfrom")[0];if(void 0!=b&&b.hasChildNodes()){for(var c=0,d=b.childNodes.length;c<d;c++){var e=b.childNodes.item(c);if("coordinate"==e.nodeName||"c"==e.nodeName){var f=new JSG.graph.Coordinate;f.readXML(e);this._cpFromCoordinates.push(f)}}b=a.getElementsByTagName("cpto")[0];if(void 0!=b&&b.hasChildNodes())for(c=0,d=b.childNodes.length;c<d;c++)if(e=
b.childNodes.item(c),"coordinate"==e.nodeName||"c"==e.nodeName)f=new JSG.graph.Coordinate,f.readXML(e),this._cpToCoordinates.push(f)}};
JSG.graph.model.shapes.BezierShape.prototype.getPolygonPointList=function(){function a(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e}var b=new JSG.geometry.PointList,c=this._coordpointlist.getPoints(),d=this._cpToPoints.getPoints(),e=this._cpFromPoints.getPoints();d&&e&&0!=d.length&&0!=e.length||(this.getBezierPoints(c),d=this._cpToPoints.getPoints(),e=this._cpFromPoints.getPoints());var f,g,l=this._coordpointlist.size();this._item.isClosed()||l--;for(var h,m,k=0;k<l;k++)if(k==c.length-
1?(h=c[0],m=e[0]):(h=c[k+1],m=e[k+1]),1>Math.abs(c[k].x-d[k].x)&&1>Math.abs(d[k].x-m.x)&&1>Math.abs(h.x-m.x))b.addPoint(c[k]),0==k&&b.addPoint(h);else if(1>Math.abs(c[k].y-d[k].y)&&1>Math.abs(d[k].y-m.y)&&1>Math.abs(c[k].y-e[k].y))b.addPoint(c[k]),0==k&&b.addPoint(h);else for(var n=0;1>n;n+=0.1)f=a(n,c[k].x,d[k].x,m.x,h.x),g=a(n,c[k].y,d[k].y,m.y,h.y),b.addPoint(new JSG.geometry.Point(f,g));return b};
JSG.graph.model.shapes.BezierShape.prototype.containsPoint=function(a,b){if(!a)return!1;var c=this.getPolygonPointList();if(!c)return!1;var d=this._item.isClosed(),e=d,f=JSG.findRadius/this._item.getGraph().getZoom();if(b==JSG.graph.controller.FindFlags.AREAWITHFRAME)return c.contains(a)?!0:c.distance(a,d)<f;if(b!=JSG.graph.controller.FindFlags.AREA&&b!=JSG.graph.controller.FindFlags.INNERAREA){var g=this._item.getItemAttributes().getSelectionMode().getValue();g&JSG.graph.attr.consts.SelectionMode.DEFAULT?
e=this._item.getItemCount()||e&&this._item.getFormat().getFillStyle().getValue()!=JSG.graph.attr.FormatAttributes.FillStyle.NONE:g&JSG.graph.attr.consts.SelectionMode.BORDER?e=!1:g&JSG.graph.attr.consts.SelectionMode.AREA&&(e=!0)}return e?c.contains(a):c.distance(a,d)<f};
JSG.graph.model.shapes.BezierShape.prototype.refresh=function(){JSG.graph.model.shapes.BezierShape._super.refresh.call(this);0<this._cpFromCoordinates.length&&this._fillPointList(this._cpFromPoints,this._cpFromCoordinates);0<this._cpToCoordinates.length&&this._fillPointList(this._cpToPoints,this._cpToCoordinates)};JSG.namespace("JSG.graph.model.shapes");
JSG.graph.model.shapes.EllipseShape=function(){JSG.graph.model.shapes.EllipseShape._super.constructor.apply(this,arguments);this._cpFromCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH * 0.225"),this._newExpression(0,"HEIGHT * 0.0")));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH * 0.5"),this._newExpression(0,"HEIGHT * 0.0")));this._cpToCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH * 0.775"),this._newExpression(0,"HEIGHT * 0.0")));
this._cpFromCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH"),this._newExpression(0,"HEIGHT * 0.225")));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH"),this._newExpression(0,"HEIGHT * 0.5")));this._cpToCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH"),this._newExpression(0,"HEIGHT * 0.775")));this._cpFromCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH * 0.775"),this._newExpression(0,"HEIGHT")));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0,
"WIDTH * 0.5"),this._newExpression(0,"HEIGHT")));this._cpToCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH * 0.225"),this._newExpression(0,"HEIGHT")));this._cpFromCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH * 0"),this._newExpression(0,"HEIGHT * 0.775")));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0,"WIDTH * 0"),this._newExpression(0,"HEIGHT * 0.5")));this._cpToCoordinates.push(new JSG.graph.Coordinate(this._newExpression(0,
"WIDTH * 0"),this._newExpression(0,"HEIGHT * 0.225")))};JSG.extend(JSG.graph.model.shapes.EllipseShape,JSG.graph.model.shapes.BezierShape);JSG.graph.model.shapes.EllipseShape.TYPE="ellipse";JSG.graph.model.shapes.EllipseShape.prototype.getType=function(){return JSG.graph.model.shapes.EllipseShape.TYPE};JSG.graph.model.shapes.EllipseShape.prototype.newInstance=function(){return new JSG.graph.model.shapes.EllipseShape};JSG.graph.model.shapes.EllipseShape.prototype.addCoordinate=function(a){};
JSG.graph.model.shapes.EllipseShape.prototype.insertCoordinatesAt=function(a,b){};JSG.graph.model.shapes.EllipseShape.prototype.removeCoordinateAt=function(a){};JSG.graph.model.shapes.EllipseShape.prototype.setCoordinates=function(a){4==a.length&&JSG.graph.model.shapes.EllipseShape._super.setCoordinates.call(this,a)};JSG.graph.model.shapes.EllipseShape.prototype.saveXMLContent=function(a){};JSG.graph.model.shapes.EllipseShape.prototype.readXML=function(a){};JSG.namespace("JSG.graph.model.shapes");
JSG.graph.model.shapes.LineShape=function(){JSG.graph.model.shapes.LineShape._super.constructor.apply(this,arguments);this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0),this._newExpression(0)));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0),this._newExpression(0)));this._tc=this._sc=!1;this._vPoints=this._vlPoints=void 0};JSG.extend(JSG.graph.model.shapes.LineShape,JSG.graph.model.shapes.Shape);JSG.graph.model.shapes.LineShape.TYPE="line";
JSG.graph.model.shapes.LineShape.prototype.getType=function(){return JSG.graph.model.shapes.LineShape.TYPE};JSG.graph.model.shapes.LineShape.prototype.saveXMLContent=function(a){JSG.graph.model.shapes.LineShape._super.saveXMLContent.call(this,a);a.writeStartElement("cs");for(var b=0;b<this._coordinates.length;b++)this._coordinates[b].saveXML("c",a);a.writeEndElement()};
JSG.graph.model.shapes.LineShape.prototype.readXML=function(a){JSG.graph.model.shapes.LineShape._super.readXML.call(this,a);var b=a.getElementsByTagName("coordinates")[0];void 0==b&&(b=a.getElementsByTagName("cs")[0]);if(void 0!==b&&b.hasChildNodes()){this._coordinates=[];a=0;for(var c=b.childNodes.length;a<c;a++){var d=b.childNodes.item(a);if("coordinate"==d.nodeName||"c"==d.nodeName){var e=new JSG.graph.Coordinate;e.readXML(d);this._coordinates.push(e)}}b=JSG.ptCache.get();this._coordpointlist.keepPoints(this._coordinates.length);
for(a=0;a<this._coordinates.length;a++)e=this._coordinates[a],this._coordpointlist.setPointAtTo(a,e.toPoint(b));JSG.ptCache.release(b)}};JSG.graph.model.shapes.LineShape.prototype.newInstance=function(){return new JSG.graph.model.shapes.LineShape};JSG.graph.model.shapes.LineShape.prototype.setItem=function(a){JSG.graph.model.shapes.LineShape._super.setItem.call(this,a);void 0==this._item||this._item.getLayoutAttributes()instanceof JSG.graph.attr.EdgeLayoutAttributes||this._item.setLayoutAttributes(new JSG.graph.attr.EdgeLayoutAttributes)};
JSG.graph.model.shapes.LineShape.prototype.getStartCoordinate=function(){return this._coordinates.isEmpty()?void 0:this._coordinates[0]};JSG.graph.model.shapes.LineShape.prototype.getEndCoordinate=function(){var a=this._coordinates.isEmpty()?-1:this._coordinates.length-1;return-1<a?this._coordinates[a]:void 0};JSG.graph.model.shapes.LineShape.prototype.setStartCoordinateTo=function(a){void 0!==a&&this._replaceCoordinateAt(0,a)};
JSG.graph.model.shapes.LineShape.prototype.setEndCoordinateTo=function(a){var b=this._coordinates.isEmpty()?-1:this._coordinates.length-1;void 0!==a&&-1<b&&this._replaceCoordinateAt(b,a)};
JSG.graph.model.shapes.LineShape.prototype._replaceCoordinateAt=function(a,b){if(b instanceof JSG.graph.CoordinateProxy||this._coordinates[a]instanceof JSG.graph.CoordinateProxy||!this._coordinates[a].isEqualTo(b)){var c=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_REPLACE_AT,a,b);!0===c.doIt&&(this._coordinates[a]=b,void 0==this._item||this._item._reading||this._coordinates[a].evaluate(this._item),this.refresh(),this._shapeDidChange(c))}};
JSG.graph.model.shapes.LineShape.prototype.setStartCoordinate=function(a,b){void 0!=a&&void 0!=b&&this.setCoordinateAt(0,a,b)};JSG.graph.model.shapes.LineShape.prototype.setEndCoordinate=function(a,b){var c=this._coordinates.isEmpty()?-1:this._coordinates.length-1;void 0!=a&&(void 0!=b&&-1<c)&&this.setCoordinateAt(c,a,b)};JSG.graph.model.shapes.LineShape.prototype.setCoordinateAtToPoint=function(a,b){0<=a&&a<this._coordinates.length&&this.setCoordinateAt(a,b.x,b.y)};
JSG.graph.model.shapes.LineShape.prototype.setCoordinates=function(a){1<this._coordinates.length&&JSG.graph.model.shapes.LineShape._super.setCoordinates.call(this,a)};JSG.graph.model.shapes.LineShape.prototype.containsPoint=function(a,b,c){return-1!=this.getLineSegmentAtPoint(a,c)};
JSG.graph.model.shapes.LineShape.prototype.getLineSegmentAtPoint=function(a,b){var c=-1;if(void 0!==a){var d=this.getVisiblePoints(),e=d.length-1,f,g;b=void 0!==b?b:1;for(var l=0;l<e;l++)if(f=d[l],g=d[l+1],f=JSG.geometry.Utils.getLinePointDistance(f,g,a),f<b){c=l;break}}return c};JSG.graph.model.shapes.LineShape.prototype.getBoundingBox=function(a){};
JSG.graph.model.shapes.LineShape.prototype.getVisiblePoints=function(){function a(a,c,d,e,f){var h=a.getParent();a=h.isClosed();if(h.getItemAttributes().getPortMode().getValue()&JSG.graph.attr.consts.PortMode.CENTERSTARTATSIDE)h=h.getTranslatedBoundingBox(d).getPoints(),a=!0;else{if(!h.isClosed())return;h=h.getTranslatedShapePoints(d)}var g=0,k=0,m=new JSG.geometry.Point(0,0);if((!f||JSG.geometry.Utils.isPointInPolygon(h,c[0]))&&(f||JSG.geometry.Utils.isPointInPolygon(h,c[c.length-1]))){f=0;for(var n=
c.length-1;f<n;f++){var p=b(h,c[f],c[f+1],m,a);if(1<p)return;g+=p;if(1==p&&1==g)e.setTo(m),k=f;else if(1<g)break}1==g&&JSG.graph.Utils.traverseItemDown(d,l._item,function(a){a.translateFromParent(e);return!0});return 1!=g?void 0:k}}function b(a,b,c,d,e){var f=0,h;if(!isNaN(b.x)&&!isNaN(c.x)){for(var g=0,l=a.length-1;g<l;g++)if(JSG.geometry.Utils.getIntersectionOfLines(a[g],a[g+1],b,c,d,!1)&&(void 0===h&&(h=d.copy()),1==f&&2>Math.abs(h.x-d.x)&&2>Math.abs(h.y-d.y)&&f--,f++,1<f))return f;e&&JSG.geometry.Utils.getIntersectionOfLines(a[g],
a[0],b,c,d,!1)&&(1==f&&2>Math.abs(h.x-d.x)&&2>Math.abs(h.y-d.y)&&f--,f++);return f}}var c=this._item.getSourcePort(),d=this._item.getTargetPort(),e=this.getPoints();if(!c&&!d||e.isEmpty()||c&&d&&c.getParent()==d.getParent())return e;if(this._vPoints&&this._vlPoints&&this._vPoints.length==e.length){for(var f=0,g=e.length;f<g&&e[f].isEqualTo(this._vPoints[f]);f++);if(!(c&&this._sc!=c.getParent().isCollapsed()||d&&this._tc!=d.getParent().isCollapsed()||f!=g))return this._vlPoints}var l=this,f=this._item.getGraph(),
h=this._item.getTranslatedShapePoints(f),m=new JSG.geometry.Point(0,0),g=0,k=e.length-1,n=e[0],q=e[k];c&&(p=a(c,h,f,m,!0),void 0!==p&&(g=p,n=m.copy()));if(d){var p=a(d,h,f,m,!1);void 0!==p&&(k=p+1,q=m.copy())}h=[];for(f=g;f<=k;f++)void 0!==n&&f===g?h.push(n):f==k&&q?h.push(q):h.push(e[f]);this._vPoints=[];f=0;for(g=e.length;f<g;f++)this._vPoints.push(e[f].copy());this._vlPoints=[];f=0;for(g=h.length;f<g;f++)this._vlPoints.push(h[f].copy());this._sc=c?c.getParent().isCollapsed():!1;this._tc=d?d.getParent().isCollapsed():
!1;return h};JSG.graph.model.shapes.LineShape.prototype.getValidPortLocations=function(a,b){};JSG.graph.model.shapes.LineShape.prototype.getValidPortLocation=function(a,b,c,d,e){};JSG.namespace("JSG.graph.model.shapes");
JSG.graph.model.shapes.OrthoLineShape=function(){JSG.graph.model.shapes.OrthoLineShape._super.constructor.apply(this,arguments);this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0),this._newExpression(0)));this._coordinates.push(new JSG.graph.Coordinate(this._newExpression(0),this._newExpression(0)));this._layouter=new JSG.graph.model.shapes.OrthoLineShapeLayouter(this)};JSG.extend(JSG.graph.model.shapes.OrthoLineShape,JSG.graph.model.shapes.LineShape);
JSG.graph.model.shapes.OrthoLineShape.TYPE="ortholine";JSG.graph.model.shapes.OrthoLineShape.prototype.getType=function(){return JSG.graph.model.shapes.OrthoLineShape.TYPE};JSG.graph.model.shapes.OrthoLineShape.prototype.newInstance=function(){return new JSG.graph.model.shapes.OrthoLineShape};
JSG.graph.model.shapes.OrthoLineShape.prototype.setItem=function(a){JSG.graph.model.shapes.OrthoLineShape._super.setItem.call(this,a);void 0!=this._item&&(this._item.getLayoutAttributes()instanceof JSG.graph.attr.OrthoEdgeLayoutAttributes||this._item.setLayoutAttributes(new JSG.graph.attr.OrthoEdgeLayoutAttributes))};JSG.graph.model.shapes.OrthoLineShape.prototype.init=function(){this.layout()};
JSG.graph.model.shapes.OrthoLineShape.prototype.layout=function(){function a(a,b,e){var m=f.length-1;if(1<m){var k=!0,n=f[0].toPoint(JSG.ptCache.get()),q=f[1].toPoint(JSG.ptCache.get()),p=f[2].toPoint(JSG.ptCache.get()),s=JSG.ptCache.get().setTo(q).subtract(p);1<s.lengthSquared()&&(a=e._layouter._getOrthoDirectionFrom(a,f,0,m,b,JSG.ptCache.get(0,0)),s.isParallelTo(a)?(e._layouter._layoutAuto(),k=!1):(b=JSG.ptCache.get().setTo(a).setLength(d).add(n),c(q,a)<c(b,a)&&(e._layouter._layoutAuto(),k=!1),
JSG.ptCache.release(b)),JSG.ptCache.release(a));!0===k&&e._setCoordinateAtToPoint(0,n);JSG.ptCache.release(n,q,p,s)}}function b(a,b,e){var m=f.length-1;if(1<m){var k=!0,n=f[m].toPoint(JSG.ptCache.get()),q=f[m-1].toPoint(JSG.ptCache.get()),p=f[m-2].toPoint(JSG.ptCache.get()),s=JSG.ptCache.get().setTo(q).subtract(p);if(1<s.lengthSquared()){a=e._layouter._getOrthoDirectionFrom(a,f,m,0,b,JSG.ptCache.get(0,0));if(s.isParallelTo(a))e._layouter._layoutAuto(),k=!1;else{b=JSG.ptCache.get().setTo(a).setLength(d).add(n);
var u=c(b,a),t=c(q,a);!u.isEqual(t,0.01)&&t<u&&(e._layouter._layoutAuto(),k=!1);JSG.ptCache.release(b)}JSG.ptCache.release(a)}!0===k&&e._setCoordinateAtToPoint(m,n);JSG.ptCache.release(n,q,p,s)}}function c(a,b){return a.x*b.x+a.y*b.y}var d=JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT,e=this._item,f=this._coordinates;void 0==e||f.isEmpty()||(e=e.getLayoutAttributes().getLineBehavior().getValue(),e===JSG.graph.model.shapes.OrthoLineBehavior.MANUAL?(this._item.hasSourceAttached()&&
a(this._item.getSourcePort(),e,this),this._item.hasTargetAttached()&&b(this._item.getTargetPort(),e,this)):e!=JSG.graph.model.shapes.OrthoLineBehavior.DISABLED&&(JSG.debug.log("ortho shape do autolayout...",JSG.debug.DEBUG_ORTHO),this._layouter.layout(e)))};JSG.graph.model.shapes.OrthoLineShape.prototype.layoutFrom=function(a){this._layouter.layoutFrom(a)};
JSG.graph.model.shapes.OrthoLineShape.prototype.setCoordinateAtToPoint=function(a,b){if(0<=a&&a<this._coordinates.length){var c=this._shapeWillChange(JSG.graph.model.events.ShapeEvent.COORDS_REPLACE_AT,a,b.x,b.y);!0===c.doIt&&(this._setCoordinateAtToPoint(a,b),this.refresh(),this._shapeDidChange(c))}};
JSG.graph.model.shapes.OrthoLineShape.prototype._setCoordinateAtToPoint=function(a,b){function c(a,b){if(!(0>a||a>f)){var c=e[a].toPoint(JSG.ptCache.get()),d=JSG.ptCache.get().setTo(l),h=JSG.ptCache.get(),g=a-1,k=a+1;a.isEven()&&d.swap();k<=f&&b._layouter.biasPoint(c,e[k].toPoint(h),d);0<=g&&b._layouter.biasPoint(c,e[g].toPoint(h),d.swap());e[a].setToPoint(c);JSG.ptCache.release(c,d,h)}}function d(a,b,c){if(g===JSG.graph.model.shapes.OrthoLineBehavior.MANUAL){var d=JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT,
e=JSG.ptCache.get().setTo(b).subtract(a),f=JSG.ptCache.get().setTo(a).add(c);if(0!=c.x){if(!c.x.hasSameSignAs(e.x)||f.set(e.x,f.y).length()<d)b.x=a.x+c.x*d}else if(!c.y.hasSameSignAs(e.y)||f.set(f.x,e.y).length()<d)b.y=a.y+c.y*d;JSG.ptCache.release(e,f)}return b}var e=this._coordinates,f=e.length-1,g=this._item.getLayoutAttributes().getLineBehavior().getValue(),l=this._getOrthogonalStartDirection(e,JSG.ptCache.get()),h=JSG.ptCache.get().setTo(l).swap(),m=a+1,k=a-1;(function(a,c){if(a<=f){var h=c._item,
k=h.getTargetPort(),m=JSG.ptCache.get(0,0);void 0!=k?c._layouter.getOrthoDirectionFromPort(k,f,0,g,m):m.setTo(l);var k=JSG.ptCache.get().setTo(m).swap(),t=JSG.ptCache.get();a===f&&h.hasTargetAttached()?(e[a].toPoint(t),c._layouter.biasPoint(b,t,k),d(t,b,m)):a===f-1&&h.hasTargetAttached()&&d(e[a+1].toPoint(t),b,m);JSG.ptCache.release(m,k,t)}})(m,this);(function(a,c){if(0<=a){var f=JSG.ptCache.get();0===a&&c._item.hasSourceAttached()?(e[a].toPoint(f),c._layouter.biasPoint(b,f,h),d(f,b,l)):1===a&&c._item.hasSourceAttached()&&
d(e[a-1].toPoint(f),b,l);JSG.ptCache.release(f)}})(k,this);e[a].setToPoint(b);c(k,this);c(m,this);JSG.ptCache.release(l,h)};
JSG.graph.model.shapes.OrthoLineShape.prototype._getOrthogonalStartDirection=function(a,b){function c(c){c=JSG.ptCache.get();for(var d=0;d<a.length-1;d++)if(a[d].toPoint(l),a[d+1].toPoint(h),0<c.setTo(h).subtract(l).lengthSquared()){f.getOrthoDirectionFromLine(l,h,b);d.isEven()||b.swap();break}JSG.ptCache.release(c);return b}function d(){var c=a[1].toPoint(h).subtract(a[0].toPoint(l));0>c.x&&(b.x=-b.x);0>c.y&&(b.y=-b.y)}var e=a.length-1,f=this._layouter,g=this._item.getLayoutAttributes().getLineBehavior().getValue(),
l=JSG.ptCache.get(),h=JSG.ptCache.get(),m=this._item.getSourcePort();if(void 0!=m)f.getOrthoDirectionFromPort(m,0,e,g,b);else switch(m=JSG.graph.model.shapes.OrthoLineBehavior,g){case m.AUTO:f.getOrthoDirectionFromLine(a[0].toPoint(l),a[e].toPoint(h),b);break;case m.MANUAL:c(this);break;case m.HORIZONTAL:b.set(1,0);d();break;case m.VERTICAL:b.set(0,1),d()}JSG.ptCache.release(l,h);return b};
JSG.graph.model.shapes.OrthoLineShape.prototype.getOrthoDirectionFromPort=function(a,b,c,d){return this._layouter.getOrthoDirectionFromPort(a,b,c,void 0,d)};JSG.graph.model.shapes.OrthoLineShape.prototype.getOrthoDirectionFromLine=function(a,b,c){return this._layouter.getOrthoDirectionFromLine(a,b,c)};JSG.graph.model.shapes.OrthoLineShape.prototype._fillPointList=function(a,b){this.layout();JSG.graph.model.shapes.OrthoLineShape._super._fillPointList.call(this,a,b)};JSG.namespace("JSG.graph.model.shapes");
JSG.graph.model.shapes.OrthoLineBehavior={AUTO:"Auto",MANUAL:"Manual",HORIZONTAL:"Horizontal",VERTICAL:"Vertical",DISABLED:"Disabled"};JSG.graph.model.shapes.OrthoLineShapeLayouter=function(a){this._shape=a;this._isEnabled=!0};JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT=500;
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.layout=function(a){this._isEnabled&&a!=JSG.graph.model.shapes.OrthoLineBehavior.DISABLED&&(a===JSG.graph.model.shapes.OrthoLineBehavior.MANUAL?this._layoutManual(a):this._layoutAuto(a))};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._layoutManual=function(a){};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._layoutAuto=function(a){var b=this._shape._item,c=this._shape._coordinates,d=c.length-1,e=c[0].toPoint(JSG.ptCache.get()),f=this._getOrthoDirectionFrom(b.getSourcePort(),c,0,d,a,JSG.ptCache.get()),g=c[d].toPoint(JSG.ptCache.get()),b=this._getOrthoDirectionFrom(b.getTargetPort(),c,d,0,a,JSG.ptCache.get());f.fromPort||b.fromPort?f.fromPort&&!b.fromPort?this._routeFromSource(f):this._routeLine(e,f,g,b,!0):this._routeNotAttached(c,a);f.fromPort=
void 0;b.fromPort=void 0;JSG.ptCache.release(e,f,g,b)};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._routeNotAttached=function(a,b){var c=a[0].toPoint(JSG.ptCache.get(0,0)),d=a[a.length-1].toPoint(JSG.ptCache.get(0,0));this._requires(4,a);var e=JSG.ptCache.get().setTo(c).add(d).multiply(0.5);this._doBreakHorizontal(c,d,b)?(a[1].set(c.x,e.y),a[2].set(d.x,e.y)):(a[1].set(e.x,c.y),a[2].set(e.x,d.y));JSG.ptCache.release(c,d,e)};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._doBreakHorizontal=function(a,b,c){var d=JSG.graph.model.shapes.OrthoLineBehavior;return d.AUTO===c?1<Math.abs((b.y-a.y)/(b.x-a.x)):d.HORIZONTAL===c};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._routeFromSource=function(a){var b=this._shape._coordinates,c=b[0].toPoint(JSG.ptCache.get(0,0)),d=b[b.length-1].toPoint(JSG.ptCache.get(0,0)),e=JSG.ptCache.get().setTo(c).add(d).multiply(0.5),f=JSG.ptCache.get().setTo(e).subtract(c);f.set(f.x*Math.abs(a.x),f.y*Math.abs(a.y));f.x.isEqual(0,1E-4)&&f.y.isEqual(0,1E-4)&&f.setTo(a);var g=f.length();if(0!=a.x){var l=f.x;(!l.hasSameSignAs(a.x)||g<JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT)&&
f.setLength(JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT);l.hasSameSignAs(a.x)||(f.x=-f.x)}else l=f.y,(!l.hasSameSignAs(a.y)||g<JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT)&&f.setLength(JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT),l.hasSameSignAs(a.y)||(f.y=-f.y);f.add(c);this._requires(4,b);this.biasPoint(f,c,a.swap());b[1].setToPoint(f);this.biasPoint(f,d,a);b[2].setToPoint(f);JSG.ptCache.release(c,d,e,f)};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.pointsInDirection=function(a,b,c){a=JSG.ptCache.get().setTo(b).subtract(a);c=a.x.hasSameSignAs(c.x)&&a.y.hasSameSignAs(c.y);JSG.ptCache.release(a);return c};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.biasPoint=function(a,b,c){0!=c.x?a.x=b.x:a.y=b.y;return a};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._getOrthoDirectionFrom=function(a,b,c,d,e,f){var g=JSG.graph.model.shapes.OrthoLineBehavior,l=JSG.ptCache.get(0,0),h=JSG.ptCache.get(0,0);if(void 0!=a)this.getOrthoDirectionFromPort(a,c,d,e,f),f.fromPort=!0;else switch(f.valid=!1,f.fromPort=void 0,e){case g.HORIZONTAL:f.valid=!0;f.setTo(this._getOrthoDirectionFromPoint(1,0,b[c].toPoint(l),b[d].toPoint(h)));break;case g.VERTICAL:f.valid=!0;f.setTo(this._getOrthoDirectionFromPoint(0,1,b[c].toPoint(l),
b[d].toPoint(h)));break;case g.MANUAL:f=this._getOrthoDirectionFromLineSegment(b,f)}!1===f.valid&&(f.valid=void 0,this.getOrthoDirectionFromLine(b[c].toPoint(l),b[d].toPoint(h),f));JSG.ptCache.release(l,h);return f};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.getOrthoDirectionFromPort=function(a,b,c,d,e){function f(a){var b=JSG.graph.model.shapes.OrthoLineBehavior;switch(d){case b.HORIZONTAL:return l._getOrthoDirectionFromPoint(1,0,k,n);case b.VERTICAL:return l._getOrthoDirectionFromPoint(0,1,k,n);default:return g(k,n,a)}}function g(a,b,c){function d(a,b){B.set(a,b).rotate(k);n=(F+JSG.geometry.Utils.getAngleBetweenLines(f,B))%F;n=n<Math.PI?n:F-n;n<x&&(e.set(a,b),x=n)}var e=c,f=JSG.ptCache.get();switch(q.getIntersectionIndex(a,
b)){case 0:f.set(0,-1);break;case 1:f.set(1,0);break;case 2:f.set(0,1);break;case 3:f.set(-1,0);break;default:f.setTo(l.getOrthoDirectionFromLine(a,b,c))}a=f.x;b=f.y;c=h.getGraph();var g=0,k=0;JSG.graph.Utils.traverseItemUp(h,c,function(a){g+=a.getAngle().getValue()});f.rotate(g);JSG.graph.Utils.traverseItemUp(m,c,function(a){k+=a.getAngle().getValue()});var n=0,F=2*Math.PI,x=1E3*Math.PI,B=JSG.ptCache.get();d(a,b);d(b,a);d(-a,-b);d(-b,-a);JSG.ptCache.release(f,B);return e}var l=this,h=a.getParent(),
m=l._shape._item;a=JSG.ptCache.get();var k=m.getPointAt(b,JSG.ptCache.get()),n=m.getPointAt(c,JSG.ptCache.get()),q=h.getTranslatedBoundingBox(m.getParent(),JSG.boxCache.get());b=q.getCenter(JSG.ptCache.get()).add(q.getTopLeft(a));k.isEqualTo(b,10)?e.setTo(f(e)):g(b,k,e);JSG.boxCache.release(q);JSG.ptCache.release(k,n,b,a);return e};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._getOrthoDirectionFromPoint=function(a,b,c,d){c=d.subtract(c);c.x*=a;c.y*=b;return this._roundedOrthoPoint(c.normalize())};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._getOrthoDirectionFromLineSegment=function(a,b){var c=JSG.ptCache.get(),d=JSG.ptCache.get();b.valid=!1;for(var e=0;e<a.length-2;e++)if(a[e].toPoint(c),a[e+1].toPoint(d),0<b.setTo(d).subtract(c).lengthSquared()){b.normalize();e.isEven()||b.swap();this._roundedOrthoPoint(b);b.valid=!0;break}JSG.ptCache.release(c,d);return b};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.getOrthoDirectionFromLine=function(a,b,c){a=b.subtract(a);return this.getOrthoDirectionByAngle(a.angle(),c)};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.getOrthoDirectionByAngle=function(a,b){a>-Math.PI_4&&a<Math.PI_4?b.set(1,0):0<a&&a<3*Math.PI_4?b.set(0,1):0>a&&a>-3*Math.PI_4?b.set(0,-1):b.set(-1,0);return b};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._roundedOrthoPoint=function(a){a.x.isEqual(0,1E-4)?(a.x=0,a.y=0<a.y?1:-1):(a.x=0<a.x?1:-1,a.y=0);return a};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.layoutFrom=function(a){this._shape._item.getSourcePort()===a?this._layoutFromSource(a):this._layoutFromTarget(a)};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._layoutFromTarget=function(a){var b=this._shape._coordinates,c=b.length-1;a=this._directionFromPort(a,c,0,JSG.ptCache.get());a.fromPort=!0;var d=b[c].toPoint(JSG.ptCache.get()),e=b[c-1].toPoint(JSG.ptCache.get()),f=b[c-2].toPoint(JSG.ptCache.get()),g=JSG.ptCache.get().setTo(e).subtract(f);g.fromPort=this.isAttached(c-2,b);var g=this._roundedOrthoPoint(g),l=this._routeLine(f,g,d,a);b[c-1].setTo(l.shift());b.insertAt(c,l);a.fromPort=void 0;g.fromPort=
void 0;JSG.ptCache.release(a,d,e,f,g)};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._layoutFromSource=function(a){var b=this._shape._coordinates;a=this._directionFromPort(a,0,b.length-1,JSG.ptCache.get());a.fromPort=!0;var c=b[0].toPoint(JSG.ptCache.get()),d=b[1].toPoint(JSG.ptCache.get()),e=b[2].toPoint(JSG.ptCache.get()),f=JSG.ptCache.get().setTo(d).subtract(e);f.fromPort=this.isAttached(2,b);var f=this._roundedOrthoPoint(f),g=this._routeLine(c,a,e,f);b[1].setTo(g.pop());b.insertAt(1,g);a.fromPort=void 0;f.fromPort=void 0;
JSG.ptCache.release(a,c,d,e,f)};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._directionFromPort=function(a,b,c,d){var e=this._shape._item.getLayoutAttributes().getLineBehavior().getValue();return this.getOrthoDirectionFromPort(a,b,c,e,d)};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype.isAttached=function(a,b){var c=this._shape._item,d=b.length-1;return 0===a&&c.hasSourceAttached()||a===d&&c.hasTargetAttached()};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._routeLine=function(a,b,c,d,e){var f=JSG.ptCache.get(),g=JSG.ptCache.get(),l=JSG.ptCache.get(),h=void 0;if(d.isParallelTo(b))if(0!=b.x?d.x.hasSameSignAs(b.x):d.y.hasSameSignAs(b.y)){h=this._workCoordinates(2,e);e=this._getValueInDirection(a,b);var m=this._getValueInDirection(c,d);e>m?this._breakAt(h,0,a,1,c,b):this._breakAt(h,1,c,0,a,d)}else this._getMinDistance(a,b,f),this._getMinDistance(c,d,g),d=this._getValueInDirection(f,b),m=this._getValueInDirection(g,
b),d>m?(h=this._workCoordinates(4,e),l.setTo(c).subtract(a),l.x*=Math.abs(b.y)/2,l.y*=Math.abs(b.x)/2,h[0].setToPoint(f),h[1].setToPoint(l.add(f)),this.biasPoint(l,g,b),h[2].setToPoint(l),h[3].setToPoint(g)):(h=this._workCoordinates(2,e),this._breakAt(h,0,a,1,c,b,(m-d)/2+JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT));else{var m=JSG.ptCache.get(0,0),k=JSG.ptCache.get().setTo(a),n=JSG.ptCache.get().setTo(c);JSG.geometry.Utils.getIntersectionOfLines(a,k.add(b),c,n.add(d),m,!0);this.biasPoint(m,
c,b);var h=this.pointsInDirection(a,m,b)&&!m.isEqualTo(a,1E-4),q=this.pointsInDirection(c,m,d)&&!m.isEqualTo(c,1E-4);h&&q?(h=this._workCoordinates(1,e),h[0].setToPoint(m)):h||q?h&&!q?(h=this._workCoordinates(3,e),this._getMinDistance(a,b,f),this._getMinDistance(c,d,g),l.setTo(g).subtract(f).multiply(0.5).add(f),this.biasPoint(f,l,b),h[0].setToPoint(f),this.biasPoint(f,g,b.swap()),h[1].setToPoint(f),h[2].setToPoint(g)):!h&&q?(h=this._workCoordinates(3,e),this._getMinDistance(a,b,f),this._getMinDistance(c,
d,g),l.setTo(f).subtract(g).multiply(0.5).add(g),this.biasPoint(g,l,d),h[2].setToPoint(g),this.biasPoint(g,f,d.swap()),h[1].setToPoint(g),h[0].setToPoint(f)):(h=this._workCoordinates(4,e),this._getMinDistance(a,b,f),this._getMinDistance(c,d,g),this._getValueInDirection(f,b),this._getValueInDirection(g,b),l.setTo(c).subtract(a),l.x*=Math.abs(b.y)/2,l.y*=Math.abs(b.x)/2,h[0].setToPoint(f),h[1].setToPoint(l.add(f)),this.biasPoint(l,g,b.swap()),h[2].setToPoint(l),h[3].setToPoint(g)):(h=this._workCoordinates(3,
e),this._getMinDistance(a,b,f),this._getMinDistance(c,d,g),this._getValueInDirection(f,b),this._getValueInDirection(g,d),h[0].setToPoint(f),this.biasPoint(f,g,b.swap()),h[1].setToPoint(f),h[2].setToPoint(g));JSG.ptCache.release(m,k,n)}JSG.ptCache.release(l,f,g);return h};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._workCoordinates=function(a,b){var c=[];if(b){var d=this._shape._coordinates;this._requires(a+2,d);for(var e=1,f=a+1;e<f;e++)c.push(d[e])}else for(e=0;e<a;e++)c.push(new JSG.graph.Coordinate);return c};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._requires=function(a,b){if(b.length<a)for(var c=b.length;c<a;c++)b.insertAt(1,JSG.graph.Coordinate.fromXY(0,0));else if(b.length>a)for(c=b.length;c>a;c--)b.removeAt(1)};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._getValueInDirection=function(a,b){return a.x*b.x+a.y*b.y};JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._breakAt=function(a,b,c,d,e,f,g){g=void 0!=g?g:JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT;c=JSG.ptCache.get().setTo(f).setLength(g).add(c);a[b].setToPoint(c);this.biasPoint(c,e,f.swap());a[d].setToPoint(c);JSG.ptCache.release(c)};
JSG.graph.model.shapes.OrthoLineShapeLayouter.prototype._getMinDistance=function(a,b,c){var d=b.fromPort?JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT:1;c.setTo(b).setLength(d);return c.add(a)};JSG.namespace("JSG.graph.model.shapes");
JSG.graph.model.shapes.ShapeFactory=function(){return{createShapeFromString:function(a){switch(a){case JSG.graph.model.shapes.EllipseShape.TYPE:return new JSG.graph.model.shapes.EllipseShape;case JSG.graph.model.shapes.RectangleShape.TYPE:return new JSG.graph.model.shapes.RectangleShape;case JSG.graph.model.shapes.BezierShape.TYPE:return new JSG.graph.model.shapes.BezierShape;case JSG.graph.model.shapes.PolygonShape.TYPE:return new JSG.graph.model.shapes.PolygonShape;case JSG.graph.model.shapes.LineShape.TYPE:return new JSG.graph.model.shapes.LineShape;
case JSG.graph.model.shapes.OrthoLineShape.TYPE:return new JSG.graph.model.shapes.OrthoLineShape;default:return new JSG.graph.model.shapes.Shape}}}}();JSG.namespace("JSG.graph.model");JSG.graph.model.ConnectionRestorer=function(){this._idMap=new JSG.commons.Map;this.edges=[];this.expressions=[]};JSG.graph.model.ConnectionRestorer.prototype.addId=function(a,b){this._idMap.put(String(a),b)};
JSG.graph.model.ConnectionRestorer.prototype.updateIds=function(a){for(var b=0;b<this.expressions.length;b++){var c=this.expressions[b].getFormula();if(void 0!=c){for(var d=0,e=c.length;-1!=(pos=c.indexOf("Item.",d));){for(var f=d=pos+5;f<e&&"!"!=c[f];)f++;if("!"==c[f]){var g=Number(c.substring(d,f)),g=Number(this._idMap.get(g));isNaN(g)||(c=c.remove(d,f-d),c=c.insert(d,g))}else break}this.expressions[b].setFormula(c)}}for(b=0;b<this.edges.length;b++)c=this.edges[b],c.disableRefresh(),c.getShape().disableRefresh(),
void 0!=c.sourcePortId&&(g=Number(this._idMap.get(c.sourcePortId)),d=a.getPortById(g),void 0!=d?c.setSourcePort(d):(this._clearCoordinate(c.getStartCoordinate()),this._disableAutoLayout(c)),c.sourcePortId=void 0),void 0!=c.targetPortId&&(g=Number(this._idMap.get(c.targetPortId)),d=a.getPortById(g),void 0!=d?c.setTargetPort(d):(this._clearCoordinate(c.getEndCoordinate()),this._disableAutoLayout(c)),c.targetPortId=void 0),c.enableRefresh(),c.getShape().enableRefresh()};
JSG.graph.model.ConnectionRestorer.prototype._clearCoordinate=function(a){a.getX().setFormula(void 0);a.getY().setFormula(void 0)};JSG.graph.model.ConnectionRestorer.prototype._disableAutoLayout=function(a){a.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.MANUAL)};JSG.namespace("JSG.graph.model");JSG.graph.model.State=function(){this._state={}};JSG.graph.model.State.CLASSNAME="JSG.graph.model.State";JSG.graph.model.State.prototype.getClassName=function(){return JSG.graph.model.State.CLASSNAME};
JSG.graph.model.State.prototype.addProperty=function(a,b,c){var d=this.getProperty(a);this._state[a]=this._propEntry(a,b,c);return d};JSG.graph.model.State.prototype._propEntry=function(a,b,c){return{name:a,property:b,classname:c}};JSG.graph.model.State.prototype.getProperty=function(a){return(a=this._state[a])?a.property:void 0};JSG.graph.model.State.prototype.removeProperty=function(a){var b=this.getProperty(a);b&&delete this._state[a];return b};
JSG.graph.model.State.prototype.copy=function(){var a=new JSG.graph.model.State,b=this._state,c;for(c in b)if(Object.prototype.hasOwnProperty.call(b,c)){var d=b[c];c=d.property&&d.property.copy?d.property.copy():d.property;a.addProperty(d.name,c,d.classname)}return a};JSG.graph.model.State.prototype.saveXML=function(a){var b=this._state,c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&this.saveEntry(b[c],a)};
JSG.graph.model.State.prototype.saveEntry=function(a,b){b.writeStartElement("prop");b.writeAttributeString("n",a.name);a.property&&(b.writeAttributeString("t",this.typeFromEntry(a)),a.property.saveXML?a.property.saveXML("v",b):b.writeAttributeString("v",a.property.toString().encode()));b.writeEndElement()};JSG.graph.model.State.prototype.typeFromEntry=function(a){var b=a.classname||void 0;void 0==b&&(b=typeof a.property,b="number"==b?"n":"boolean"==b?"b":"s");return b};
JSG.graph.model.State.prototype.readXML=function(a){if(a.hasChildNodes()){a=a.childNodes;for(var b=0;b<a.length;b++){var c=a.item(b);"prop"==c.nodeName&&this.readEntry(c)}}};JSG.graph.model.State.prototype.readEntry=function(a){var b=a.getAttribute("n"),c=a.getAttribute("t"),d=void 0;"b"==c?(d=Boolean(a.getAttribute("v")),c=void 0):"n"==c?(d=Number(a.getAttribute("v")),c=void 0):"s"==c?(d=a.getAttribute("v"),c=void 0):d=this.readObject(c,a);this.addProperty(b,d,c)};
JSG.graph.model.State.prototype.readObject=function(a,b){var c=JSG.createObjectFromString(a);c&&c.readXML&&(b=findElementByTagName(b,"v"))&&c.readXML(b);return c};JSG.namespace("JSG.graph.model");JSG.graph.model.Model=function(){this._id=void 0;this._eventHandler=new JSG.graph.model.events.EventDispatcher;this._modelAttributes=new JSG.graph.model.Model.Attributes;this._modelAttributes.item=this};JSG.graph.model.Model.prototype.newInstance=function(){return new JSG.graph.model.Model};
JSG.graph.model.Model.prototype.copy=function(a,b){var c=this.newInstance();c._modelAttributes=this._modelAttributes.copy();c._modelAttributes.item=c;b&&(c._id=this._id);return c};JSG.graph.model.Model.prototype.getModelAttributes=function(){return this._modelAttributes};JSG.graph.model.Model.prototype.getAttributeAtPath=function(a){return JSG.graph.attr.AttributeUtils.findAttributeByPath(a,this._modelAttributes)};
JSG.graph.model.Model.prototype.getAttributeValueAtPath=function(a){if((a=JSG.graph.attr.AttributeUtils.findAttributeByPath(a,this._modelAttributes))&&(a=a.getExpression().getValue())&&a.length)return a};JSG.graph.model.Model.prototype.addAttribute=function(a){var b=void 0,c=this._createAttributeEvent(JSG.graph.model.events.AttributeChangeEvent.ADD,this._modelAttributes,a);this.sendPreEvent(c);!0===c.doIt&&(b=this._modelAttributes.addAttribute(a),this.sendPostEvent(c));return b};
JSG.graph.model.Model.prototype.addAttributeAtPath=function(a,b){return JSG.graph.attr.AttributeUtils.addAttributeAtPath(a,b,this._modelAttributes)};JSG.graph.model.Model.prototype.removeAttribute=function(a){var b=void 0,c=this._createAttributeEvent(JSG.graph.model.events.AttributeChangeEvent.REMOVE,this._modelAttributes,a);this.sendPreEvent(c);!0===c.doIt&&(b=this._modelAttributes.removeAttribute(a),this.sendPostEvent(c));return b};
JSG.graph.model.Model.prototype.removeAttributeAtPath=function(a){a=JSG.graph.attr.AttributeUtils.findAttributeByPath(a,this._modelAttributes);if(void 0!=a){var b=this._createAttributeEvent(JSG.graph.model.events.AttributeChangeEvent.REMOVE,this._modelAttributes,a);this.sendPreEvent(b);!0===b.doIt?(a=JSG.graph.attr.AttributeUtils.removeAttribute(a),this.sendPostEvent(b)):a=void 0}return a};
JSG.graph.model.Model.prototype.setAttribute=function(a,b){var c=a&&a.hasDifferentValue(b);if(c){var d=this._createAttributeEvent(JSG.graph.model.events.AttributeChangeEvent.VALUE,a,b);this.sendPreEvent(d);!0===d.doIt&&(a.setExpressionOrValue(b),this.sendPostEvent(d))}return c};JSG.graph.model.Model.prototype.setAttributeAtPath=function(a,b){var c=JSG.graph.attr.AttributeUtils.findAttributeByPath(a,this._modelAttributes);return this.setAttribute(c,b)};
JSG.graph.model.Model.prototype.saveAttributesXML=function(a){this._modelAttributes.saveXML(a)};JSG.graph.model.Model.prototype.readAttributesXML=function(a){a=findElementByTagName(a,"al");void 0!=a&&this._modelAttributes.readXML(a)};JSG.graph.model.Model.prototype.getId=function(){return this._id};JSG.graph.model.Model.prototype.setId=function(a){this._id=a};JSG.graph.model.Model.prototype.saveState=function(){};JSG.graph.model.Model.prototype.restoreState=function(a){};
JSG.graph.model.Model.prototype.addEventListener=function(a,b){this._eventHandler.registerListener(a,b)};JSG.graph.model.Model.prototype.removeEventListener=function(a,b){this._eventHandler.unregisterListener(a,b)};JSG.graph.model.Model.prototype.sendPreEvent=function(a){this._eventHandler.sendPreEvent(a)};JSG.graph.model.Model.prototype.sendPostEvent=function(a){this._eventHandler.sendPostEvent(a)};JSG.graph.model.Model.prototype.areEventsEnabled=function(){return this._eventHandler.areEventsEnabled()};
JSG.graph.model.Model.prototype.enableEvents=function(){this._eventHandler.enableEvents()};JSG.graph.model.Model.prototype.disableEvents=function(){this._eventHandler.disableEvents()};JSG.graph.model.Model.prototype._createAttributeEvent=function(a,b,c){a=new JSG.graph.model.events.AttributeChangeEvent(a,b,c);a.source=this;return a};JSG.graph.model.Model.Attributes=function(a){JSG.graph.model.Model.Attributes._super.constructor.call(this,JSG.graph.model.Model.Attributes.NAME,a);this.item=void 0};
JSG.extend(JSG.graph.model.Model.Attributes,JSG.graph.attr.AttributeList);JSG.graph.model.Model.Attributes.NAME="model.attributes";JSG.graph.model.Model.Attributes.prototype.getPath=function(){return""};JSG.namespace("JSG.graph.model");JSG.graph.model.Path=function(){this._path=[]};JSG.graph.model.Path.fromString=function(a){};JSG.graph.model.Path._delimiter=":";
JSG.graph.model.Path.getCommonPrefix=function(a,b){var c=void 0;if(void 0!=a&&void 0!=b)for(var c=new JSG.graph.model.Path,d=a._path.length<b._path.length?a:b,e=d===b?a:b,f=0;f<d._path.length;f++)if(d._path[f]===e._path[f])c.addId(d._path[f]);else break;return c};JSG.graph.model.Path.prototype.addId=function(a){this._path.push(a)};JSG.graph.model.Path.prototype.nextId=function(){return this._path.isEmpty()?void 0:this._path.shift()};JSG.graph.model.Path.prototype.hasNextId=function(){return!this._path.isEmpty()};
JSG.graph.model.Path.prototype.containsId=function(a){for(var b=!1,c=0,d=this._path.length;c<d;c++)if(this._path[c]==a){b=!0;break}return b};JSG.graph.model.Path.prototype.toString=function(){for(var a="",b=this._path.length-1,c=JSG.graph.model.Path._delimiter,d=0,e=this._path.length;d<e;d++)a+=this._path[d],d<b&&(a+=c);return a};JSG.namespace("JSG.graph.model");
JSG.graph.model.GraphItem=function(a){JSG.graph.model.GraphItem._super.constructor.apply(this,arguments);this._parent;this._subItems=[];this._pin=new JSG.graph.Pin(this);this._size=new JSG.graph.Size;this._angle=new JSG.graph.expr.NumberExpression(0);this._angle.getConstraint().decimals=10;this._bboxcache=new JSG.geometry.BoundingBox(0,0);this._origincache=new JSG.geometry.Point(0,0);this._collapsedSize=new JSG.graph.Size(1E3,1E3);this._reshapeCoordinates=[];this.addAttribute(new JSG.graph.attr.FormatAttributes);
this.addAttribute(new JSG.graph.attr.ItemAttributes);this.addAttribute(new JSG.graph.attr.LayoutAttributes);this._reshapeProperties=new JSG.graph.properties.Properties;this._layer=new JSG.graph.expr.StringExpression("");this._type=new JSG.graph.expr.StringExpression("");this._name=new JSG.graph.expr.StringExpression("");this._link=new JSG.graph.expr.StringExpression("");this._shape;this.setShapeTo(void 0!=a?a:new JSG.graph.model.shapes.Shape);this._friends=[];this._reading=this._isFeedback=!1;this._refreshEnabled=
!0};JSG.extend(JSG.graph.model.GraphItem,JSG.graph.model.Model);JSG.graph.model.GraphItem.prototype._defaultTextFormat=new JSG.graph.attr.TextFormatAttributes;JSG.graph.model.GraphItem.prototype.newInstance=function(){return new JSG.graph.model.GraphItem};JSG.graph.model.GraphItem.prototype.copy=function(a,b){return this._copy([],void 0!=a?a:!0,void 0!=b?b:!1)};
JSG.graph.model.GraphItem.prototype._copy=function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(void 0!=d.sourceNodeId){var f=e(d.sourceNodeId,b);void 0!=f&&d.copy.setSourcePort(f.getPortAt(d.sourcePortIndex))}void 0!=d.targetNodeId&&(f=e(d.targetNodeId,b),void 0!=f&&d.copy.setTargetPort(f.getPortAt(d.targetPortIndex)))}}function e(a,b){for(var c=void 0,d=0;d<b.length;d++)if(b[d].id===a){c=b[d].copy;break}return c}var f=JSG.graph.model.GraphItem._super.copy.call(this,b,c);this._copyPropertiesAndShape(f);
if(!0===b){var g=[],l=[];this._copyStructure(f,l,g,b,c);d(g,l);0<l.length&&a.insertAt(a.length,l)}f.refresh();return f};
JSG.graph.model.GraphItem.prototype._copyPropertiesAndShape=function(a){a._pin.setTo(this._pin);a._angle.setTo(this._angle);a._size=this._size.copy();a._collapsedSize=this._collapsedSize.copy();a.setReshapeProperties(this._reshapeProperties);a._layer=this._layer.copy();a._type=this._type.copy();a._name=this._name.copy();a._link=this._link.copy();for(var b=0;b<this._friends.length;b++)a._friends.push(this._friends[b].copy());a.setReshapeCoordinates(this._reshapeCoordinates);this._shape&&a.setShapeTo(this._shape.copy())};
JSG.graph.model.GraphItem.prototype._copyStructure=function(a,b,c,d,e){function f(a,b){var c=void 0!=a.sourceNode?a.sourceNode.getId():void 0,d=void 0!=c?a.sourceNode.getPortIndex(a.getSourcePort()):void 0,e=void 0!=a.targetNode?a.targetNode.getId():void 0,f=void 0!=e?a.targetNode.getPortIndex(a.getTargetPort()):void 0;return{copy:b,sourceNodeId:c,sourcePortIndex:d,targetNodeId:e,targetPortIndex:f}}for(var g,l=this._subItems,h=0;h<l.length;h++){g=l[h];var m=g._copy(b,d,e);m._parent=a;a._subItems.push(m);
g instanceof JSG.graph.model.Edge?c.push(f(g,m)):b.push({id:g.getId(),copy:m})}};JSG.graph.model.GraphItem.prototype.createPath=function(a){var b=this.getId(),c=void 0;void 0!=b&&(c=this!==a&&void 0!=this._parent?this._parent.createPath(a):new JSG.graph.model.Path,c.addId(b));return c};JSG.graph.model.GraphItem.prototype.getReshapeProperties=function(){return this._reshapeProperties};
JSG.graph.model.GraphItem.prototype.setReshapeProperties=function(a){this._reshapeProperties.clear();void 0!=a&&(this._reshapeProperties=a.copy())};JSG.graph.model.GraphItem.prototype.hasReshapeCoordinates=function(){return void 0!=this._reshapeCoordinates&&0<this._reshapeCoordinates.length};JSG.graph.model.GraphItem.prototype.getReshapeCoordinates=function(){return this._reshapeCoordinates};
JSG.graph.model.GraphItem.prototype.getReshapeCoordinateAt=function(a){return 0<=a&&a<this._reshapeCoordinates.length?this._reshapeCoordinates[a]:void 0};JSG.graph.model.GraphItem.prototype.setReshapeCoordinates=function(a){this._reshapeCoordinates=[];if(void 0!=a)for(var b=0;b<a.length;b++)this._reshapeCoordinates.push(a[b].copy())};
JSG.graph.model.GraphItem.prototype.setReshapeCoordinateAt=function(a){if(0<=a&&a<this._reshapeCoordinates.length){var b,c,d=this._reshapeCoordinates[a];2===arguments.length?(b=arguments[1].x,c=arguments[1].y):2<arguments.length&&(b=void 0!=arguments[1]?arguments[1]:d.getX(),c=void 0!=arguments[2]?arguments[2]:d.getY());if(!d.isEqualTo(b,c)){var e=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.RESHAPE);e.xValue=b;e.yValue=c;e.index=a;e.source=this;this.sendPreEvent(e);!0===e.doIt&&
(d.set(b,c),this.sendPostEvent(e))}}};JSG.graph.model.GraphItem.prototype.getPin=function(){return this._pin};JSG.graph.model.GraphItem.prototype.getLink=function(){var a=JSG.graphItemFactory.getLink(this.getType().getValue());return void 0!=a?a:this._link};JSG.graph.model.GraphItem.prototype.setLink=function(a){this._link.setExpressionOrValue(a)};JSG.graph.model.GraphItem.prototype.isClipChildren=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.CLIPCHILDREN).getValue()};
JSG.graph.model.GraphItem.prototype.isClosed=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.CLOSED).getValue()};JSG.graph.model.GraphItem.prototype.isCollapsable=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.COLLAPSABLE).getValue()};JSG.graph.model.GraphItem.prototype.isCollapsed=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.COLLAPSED).getValue()};
JSG.graph.model.GraphItem.prototype.isAnyParentCollapsed=function(){for(var a=this.getParent();void 0!=a;){if(a&&a.isCollapsed())return!0;a=a.getParent()}return!1};JSG.graph.model.GraphItem.prototype.isContainer=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.CONTAINER).getValue()};JSG.graph.model.GraphItem.prototype.isDeleteable=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.DELETEABLE).getValue()};JSG.graph.model.GraphItem.prototype.isMoveable=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.MOVEABLE).getValue()};
JSG.graph.model.GraphItem.prototype.isSelectable=function(){if(!this.isVisible())return!1;var a=0<this.getItemAttribute(JSG.graph.attr.ItemAttributes.SELECTIONMODE).getValue()?!0:!1;if(""!=this._layer.getValue()){var b=this.getGraph();if(void 0!=b&&(b=b._layers.get(this._layer.getValue()),void 0!=b))return b.selectable&&a}return a};JSG.graph.model.GraphItem.prototype.isSelectParentFirst=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.SELECTIONMODE).getValue()&JSG.graph.attr.consts.SelectionMode.SELECTPARENT};
JSG.graph.model.GraphItem.prototype.isSizeable=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.SIZEABLE).getValue()};JSG.graph.model.GraphItem.prototype.isVisible=function(){var a=this.getItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE).getValue();if(a&&""!=this._layer.getValue()){var b=this.getGraph();if(void 0!=b&&(b=b._layers.get(this._layer.getValue()),void 0!=b))return b.visible&&a}return a};JSG.graph.model.GraphItem.prototype.isRotatable=function(){return this.getItemAttribute(JSG.graph.attr.ItemAttributes.ROTATABLE).getValue()};
JSG.graph.model.GraphItem.prototype.getAttributes=function(){return this._attributes};JSG.graph.model.GraphItem.prototype.getAttribute=function(a){return this.getModelAttributes().getAttribute(a)};JSG.graph.model.GraphItem.prototype.getItemAttributes=function(){return this.getAttributeAtPath(JSG.graph.attr.ItemAttributes.NAME)};JSG.graph.model.GraphItem.prototype.getItemAttribute=function(a){return this.getItemAttributes().getAttribute(a)};
JSG.graph.model.GraphItem.prototype.setItemAttribute=function(a,b){return this.setAttribute(this.getItemAttribute(a),b)};JSG.graph.model.GraphItem.prototype.getLayoutAttributes=function(){return this.getAttributeAtPath(JSG.graph.attr.LayoutAttributes.NAME)};JSG.graph.model.GraphItem.prototype.setLayoutAttributes=function(a){this.addAttribute(a)};JSG.graph.model.GraphItem.prototype.getFriends=function(){var a=JSG.graphItemFactory.getFriends(this);return void 0!=a?a:this._friends};
JSG.graph.model.GraphItem.prototype.setPinCoordinateTo=function(a){this._pin.setCoordinateTo(a)};JSG.graph.model.GraphItem.prototype.setPinPointTo=function(a){this.setPinPoint(a.x,a.y)};JSG.graph.model.GraphItem.prototype.setPinPoint=function(a,b){this._pin.setPoint(a,b)};JSG.graph.model.GraphItem.prototype.getPinPoint=function(a){return this._pin.getPoint(a)};JSG.graph.model.GraphItem.prototype.getOrigin=function(a){a=a?a:new JSG.geometry.Point(0,0);a.setTo(this._origincache);return a};
JSG.graph.model.GraphItem.prototype.setOriginTo=function(a){this.setOrigin(a.x,a.y)};JSG.graph.model.GraphItem.prototype.setOrigin=function(a,b){var c=this._pin.getLocalPoint(JSG.ptCache.get()),c=JSG.geometry.Utils.rotatePoint(c,this._angle.getValue());c.translate(a,b);this.setPinPoint(c.x,c.y);JSG.ptCache.release(c)};JSG.graph.model.GraphItem.prototype.translate=function(a,b){(a||b)&&this._pin.translate(a,b)};JSG.graph.model.GraphItem.prototype.getAngle=function(){return this._angle};
JSG.graph.model.GraphItem.prototype.setAngle=function(a){if(!this.getAngle().isEqualToExpressionOrValue(a)){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.ANGLE,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(this._angle.setExpressionOrValue(a),this._update(),this.sendPostEvent(b))}};JSG.graph.model.GraphItem.prototype.getBoundingBox=function(a){a=a?a:new JSG.geometry.BoundingBox(0,0);a.setTo(this._bboxcache);return a};
JSG.graph.model.GraphItem.prototype.getTotalBoundingRect=function(a,b){a=void 0!=a?a:this._parent;for(var c=JSG.boxCache.get(),d=JSG.rectCache.get(),e=this.getTranslatedBoundingBox(a,c).getBoundingRectangle(b),f=this.isCollapsed(),g=0,l=this._subItems.length;g<l;g++){var h=this._subItems[g];(!f||h instanceof JSG.graph.model.TextNode)&&e.union(h.getTotalBoundingRect(a,d))}JSG.boxCache.release(c);JSG.rectCache.release(d);return e};JSG.graph.model.GraphItem.prototype.getCenter=function(a){return this._bboxcache.getCenter(a).add(this._bboxcache._topleft)};
JSG.graph.model.GraphItem.prototype.setCenterTo=function(a){this.setCenter(a.x,a.y)};JSG.graph.model.GraphItem.prototype.setCenter=function(a,b){var c=this._pin.getLocalPoint();c.x-=this.getWidth().getValue()/2;c.y-=this.getHeight().getValue()/2;c=JSG.geometry.Utils.rotatePoint(c,this._angle.getValue());this.setPinPoint(a+c.x,b+c.y)};
JSG.graph.model.GraphItem.prototype.setBoundingBoxTo=function(a){if(!this.getBoundingBox().isEqualTo(a,50)){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.BBOX,a);b.source=this;this.sendPreEvent(b);if(!0===b.doIt){this.disableEvents();this._angle.setExpressionOrValue(a.getAngle());var c=a.getWidth(),d=a.getHeight();if(this.isCollapsed()){var e=this.getItemAttributes().getCollapsable().getValue();e&JSG.graph.attr.consts.Direction.HORIZONTAL&&(c=this._size.getWidth().getValue());
e&JSG.graph.attr.consts.Direction.VERTICAL&&(d=this._size.getHeight().getValue())}this.setSize(c,d);this._bboxcache.setTo(a);this.setOriginTo(a.getTopLeft());this.enableEvents();this.sendPostEvent(b)}}};
JSG.graph.model.GraphItem.prototype.getSize=function(a){if(!0!==a&&this.isCollapsed()){a=this.getItemAttributes().getCollapsable().getValue();if(a==JSG.graph.attr.consts.Direction.BOTH)return this._collapsedSize;var b=this._size.copy();a&JSG.graph.attr.consts.Direction.VERTICAL&&b.setHeight(this._collapsedSize.getHeight());a&JSG.graph.attr.consts.Direction.HORIZONTAL&&b.setWidth(this._collapsedSize.getWidth());return b}return this._size};
JSG.graph.model.GraphItem.prototype.getSizeAsPoint=function(a){a=void 0!=a?a:new JSG.geometry.Point(0,0);var b=this.getItemAttributes(),c=b.getCollapsable().getValue();b.getCollapsed().getValue()?(a.x=c&JSG.graph.attr.consts.Direction.HORIZONTAL?this._collapsedSize.getWidth().getValue():this._size.getWidth().getValue(),a.y=c&JSG.graph.attr.consts.Direction.VERTICAL?this._collapsedSize.getHeight().getValue():this._size.getHeight().getValue()):(a.x=this._size.getWidth().getValue(),a.y=this._size.getHeight().getValue());
return a};JSG.graph.model.GraphItem.prototype.getWidth=function(){var a=this.getItemAttributes();return!0===a.getCollapsed().getValue()&&a.getCollapsable().getValue()&JSG.graph.attr.consts.Direction.HORIZONTAL?this._collapsedSize.getWidth():this._size.getWidth()};JSG.graph.model.GraphItem.prototype.getHeight=function(){var a=this.getItemAttributes();return a.getCollapsed().getValue()&&a.getCollapsable().getValue()&JSG.graph.attr.consts.Direction.VERTICAL?this._collapsedSize.getHeight():this._size.getHeight()};
JSG.graph.model.GraphItem.prototype.setSizeTo=function(a){this.setSize(a.getWidth(),a.getHeight())};JSG.graph.model.GraphItem.prototype.setSizeToPoint=function(a){this.setSize(a.x,a.y)};
JSG.graph.model.GraphItem.prototype.setSize=function(a,b){function c(a,b){void 0!=a.setValue?a.setValue(b):a=b;return a}var d=void 0!=a?a:this._size.getWidth(),e=void 0!=b?b:this._size.getHeight(),f=JSG.MIN_WIDTH_HEIGHT;0<=f&&(d=(void 0!=d.getValue?d.getValue():d)<f?c(d,f):d,e=(void 0!=e.getValue?e.getValue():e)<f?c(e,f):e);this._size.isEqualTo(d,e)||(f=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.SIZE,{width:d,height:e}),f.source=this,this.sendPreEvent(f),!0===f.doIt&&(this._size.set(d,
e),this.refresh(),this.sendPostEvent(f)))};JSG.graph.model.GraphItem.prototype.setWidth=function(a){this.setSize(a,void 0)};JSG.graph.model.GraphItem.prototype.setHeight=function(a){this.setSize(void 0,a)};
JSG.graph.model.GraphItem.prototype.setCollapsedSize=function(a,b){function c(a,b){void 0!=a.setValue?a.setValue(b):a=b;return a}var d=void 0!=a?a:this._collapsedSize.getWidth(),e=void 0!=b?b:this._collapsedSize.getHeight(),f=JSG.MIN_WIDTH_HEIGHT;0<=f&&(d=(void 0!=d.getValue?d.getValue():d)<f?c(d,f):d,e=(void 0!=e.getValue?e.getValue():e)<f?c(e,f):e);this._collapsedSize.isEqualTo(d,e)||(f=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.COLLAPSEDSIZE,{width:d,height:e}),f.source=this,
this.sendPreEvent(f),!0===f.doIt&&(this._collapsedSize.set(d,e),this.refresh(),this.sendPostEvent(f)))};JSG.graph.model.GraphItem.prototype.setShapeTo=function(a){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.SHAPE,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(void 0!=this._shape&&this._shape.setItem(void 0),this._shape=a,this._shape.setItem(this),this._shape.evaluate(),this._shape.refresh(),this.sendPostEvent(b))};JSG.graph.model.GraphItem.prototype.getShape=function(){return this._shape};
JSG.graph.model.GraphItem.prototype.evaluate=function(){if(!this._reading){this._angle.evaluate(this);this._layer.evaluate(this);this._type.evaluate(this);this._name.evaluate(this);this._link.evaluate(this);this._pin.evaluate();this._size.evaluate(this);this._collapsedSize.evaluate(this);this._shape.evaluate();this.getModelAttributes().evaluate(this);for(var a=0,b=this._reshapeCoordinates.length;a<b;a++)this._reshapeCoordinates[a].evaluate(this);a=0;for(b=this._subItems.length;a<b;a++)this._subItems[a].evaluate();
this._update()}};
JSG.graph.model.GraphItem.prototype.resolveParentReferences=function(a){this._angle.resolveParentReference(this,a);this._layer.resolveParentReference(this,a);this._type.resolveParentReference(this,a);this._name.resolveParentReference(this,a);this._link.resolveParentReference(this,a);this._pin.resolveParentReference(a);this._size.resolveParentReference(this,a);this._collapsedSize.resolveParentReference(this,a);this._shape.resolveParentReference(a);this.getModelAttributes().resolveParentReference(this,a);
for(var b=0,c=this._reshapeCoordinates.length;b<c;b++)this._reshapeCoordinates[b].resolveParentReference(this,a)};JSG.graph.model.GraphItem.prototype.rotate=function(a,b){0!=a&&(void 0!=b&&this._pin.rotate(a,b),this.setAngle(this.getAngle().getValue()+a))};
JSG.graph.model.GraphItem.prototype.addLabel=function(a,b){if(this.isAddLabelAllowed()){var c;void 0!=b?c=b:a instanceof JSG.graph.expr.AttributeExpression?c=new JSG.graph.model.AttributedTextNode(a):(c=new JSG.graph.model.TextNode,c.setText(a));for(var d=[],e=0,f=25;e<f;e++)d.push(!1);for(var g=!1,e=0,f=this._subItems.length;e<f;e++){var l=this._subItems[e];l instanceof JSG.graph.model.TextNode&&(g=l._getTextFormat().getVerticalPosition().getValue(),(l=l._getTextFormat().getHorizontalPosition().getValue())&&
g&&(d[5*(g-1)+l-1]=!0),g=!0)}this.addItem(c);if(g)for(e=0,f=25;e<f;e++)if(!1==d[e]){c.getTextFormat().setVerticalPosition(Math.floor(e/5)+1);c.getTextFormat().setHorizontalPosition(e%5+1);break}c.setItemAttribute(JSG.graph.attr.ItemAttributes.SNAPTO,!1);c.evaluate();c.invalidateFontMetrics();c.updateSize();return c}};JSG.graph.model.GraphItem.prototype.isAddLabelAllowed=function(){return!0};JSG.graph.model.GraphItem.prototype.getLayer=function(){return this._layer};
JSG.graph.model.GraphItem.prototype.setLayer=function(a){if(!this._layer.isEqualToExpressionOrValue(a)){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.LAYER,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(this._layer.setExpressionOrValue(a),this.getGraph().getLayer(this._layer.getValue()),this.sendPostEvent(b))}};JSG.graph.model.GraphItem.prototype.getType=function(){return this._type};
JSG.graph.model.GraphItem.prototype.setType=function(a){if(!this._type.isEqualToExpressionOrValue(a)){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.TYPE,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(this._type.setExpressionOrValue(a),this.sendPostEvent(b))}};JSG.graph.model.GraphItem.prototype.getName=function(){return this._name};
JSG.graph.model.GraphItem.prototype.setName=function(a){if(!this._name.isEqualToExpressionOrValue(a)){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.NAME,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(this._name.setExpressionOrValue(a),this.sendPostEvent(b))}};JSG.graph.model.GraphItem.prototype.layoutAll=function(){for(var a=0,b=this._subItems.length;a<b;a++)this._subItems[a].layoutAll();this.layout()};
JSG.graph.model.GraphItem.prototype.layout=function(){if(this.areEventsEnabled()&&!(this._isFeedback||this._reading||this.isCollapsed())){var a=this.getLayoutAttributes();if(a.getAutoLayout().getValue()){var b=a.getLayouter();if(void 0!=b){var c=this.getItemAttributes(),d=a.getConstraints();if(void 0!=this._graphId){for(var e=null,a=0,f=this._subItems.length;a<f&&null==e;a++)void 0!=this._subItems[a].getAttachedEdges&&(0!=this._subItems[a].getAttachedEdges().length&&this._subItems[a].getItemAttributes().getSelected().getValue())&&
(e=this._subItems[a]);null!=e?(d.layoutOriginProcessor=ARAC.layout.config.LayoutOriginProcessor.CNODE_LEFTTOP,d.layoutOriginNode=new JSG.aracadapter.AracNodeAdapter(e)):(d.layoutOriginProcessor=ARAC.layout.config.LayoutOriginProcessor.ROOT_LEFTTOP,d.layoutOriginNode=void 0)}else if("grid"==d._layoutType)d.layoutOrigin.x=0,d.layoutOrigin.y=0;else{e=null;a=0;for(f=this._subItems.length;a<f&&null==e;a++)void 0!=this._subItems[a].getAttachedEdges&&(0!=this._subItems[a].getAttachedEdges().length&&this._subItems[a].getItemAttributes().getSelected().getValue())&&
(e=this._subItems[a]);null!=e?(d.layoutOriginProcessor=ARAC.layout.config.LayoutOriginProcessor.CNODE_LEFTTOP,d.layoutOriginNode=new JSG.aracadapter.AracNodeAdapter(e)):(d.layoutOriginProcessor=ARAC.layout.config.LayoutOriginProcessor.ROOT_LEFTTOP,d.layoutOriginNode=void 0)}"grid"==d._layoutType&&(void 0!=this._graphId?(d.xArea=15E3-c.getLeftMargin().getValue()-c.getRightMargin().getValue(),d.yArea=15E3-c.getTopMargin().getValue()-c.getBottomMargin().getValue()):(d.xArea=this.getWidth().getValue()-
c.getLeftMargin().getValue()-c.getRightMargin().getValue(),d.yArea=this.getHeight().getValue()-c.getTopMargin().getValue()-c.getBottomMargin().getValue()));if(a=JSG.layoutFactory.getLayoutModel(this,d))if(b.layout(a,d),this.getLayoutAttributes().getAutoResize().getValue()!=JSG.graph.attr.consts.Direction.NONE){f=this.getLayoutAttributes().getAutoResizeLevel().getValue();b=this;for(a=0;a<f;a++)b.getParent()&&(b=b.getParent());if(void 0!=b&&!(b instanceof JSG.graph.model.Graph||b.isCollapsed())&&b._subItems.length){c=
JSG.rectCache.get();a=0;for(f=b._subItems.length;a<f;a++)b._subItems[a]._getBoundingRectOffAllSubItems(c,b,new JSG.geometry.Point(0,0));c.width+=b.getItemAttributes().getRightMargin().getValue();c.height+=b.getItemAttributes().getBottomMargin().getValue();0!=c.width&&0!=c.height&&(a=b.getSizeAsPoint(),50<Math.abs(a.x-c.width)||50<Math.abs(a.y-c.height))&&(a=b.getBoundingBox(),this.getLayoutAttributes().getAutoResize().getValue()==JSG.graph.attr.consts.Direction.BOTH?a.setSize(c.width,c.height):this.getLayoutAttributes().getAutoResize().getValue()&
JSG.graph.attr.consts.Direction.HORIZONTAL?a.setWidth(c.width):this.getLayoutAttributes().getAutoResize().getValue()&JSG.graph.attr.consts.Direction.VERTICAL&&a.setHeight(c.height),b.setBoundingBoxTo(a));JSG.rectCache.release(c)}}}}}};
JSG.graph.model.GraphItem.prototype._getBoundingRectOffAllSubItems=function(a,b,c){function d(a,b,c,d){var e=a.getOrigin(),f=JSG.rectCache.get();d.add(e);for(var q=0,p=a._subItems.length;q<p;q++)a._subItems[q]._getBoundingRectOffAllSubItems(f,c,d);d.subtract(e);f.width+=a.getItemAttributes().getRightMargin().getValue();f.height+=a.getItemAttributes().getBottomMargin().getValue();b.union(f);JSG.rectCache.release(f)}if(JSG.layoutFactory.isAutoResizeDesired(this.getType().getValue(),b.getType().getValue())){var e=
this.getBoundingBox(JSG.boxCache.get()),f=e.getBoundingRectangle(JSG.rectCache.get());JSG.boxCache.release(e);f.translate(c.x,c.y);f.x=Math.max(0,f.x);f.y=Math.max(0,f.y);a.union(f);JSG.rectCache.release(f);this.isCollapsed()||d(this,a,b,c)}else d(this,a,b,c)};
JSG.graph.model.GraphItem.prototype.updateLabelPositions=function(){for(var a=new JSG.geometry.Point(0,0),b=0,c=this._subItems.length;b<c;b++){var d=this._subItems[b];if(d instanceof JSG.graph.model.TextNode){var e=d.getBoundingBox().getBoundingRectangle(),f=d._getTextFormat().getHorizontalPosition().getValue(),g=d._getTextFormat().getVerticalPosition().getValue();a.set(d.getPin().getX().getValue(),d.getPin().getY().getValue());a=this.getLabelPositionAt(f,g,e,a);a.x&&a.y?d.getPin().setPointTo(a):
a.x?d.getPin().setX(a.x):a.y&&d.getPin().setY(a.y)}}};
JSG.graph.model.GraphItem.prototype.getLabelPositionAt=function(a,b,c,d){d=void 0!=d?d:new JSG.geometry.Point(0,0);var e=this.getBoundingBox();switch(b){case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.ONTOP:d.y=-c.height/2;break;case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.TOP:d.y=c.height/2;break;case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.CENTER:d.y=e.getHeight()/2;break;case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.BOTTOM:d.y=e.getHeight()-
c.height/2;break;case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.BELOWBOTTOM:d.y=e.getHeight()+c.height/2;break;case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.CUSTOM:d.y=void 0}switch(a){case JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.TOLEFT:d.x=-c.width/2;break;case JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.LEFT:d.x=c.width/2;break;case JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.CENTER:d.x=e.getWidth()/2;break;case JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.RIGHT:d.x=
e.getWidth()-c.width/2;break;case JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.TORIGHT:d.x=e.getWidth()+c.width/2;break;case JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.CUSTOM:d.x=void 0}return d};JSG.graph.model.GraphItem.prototype.getFormat=function(){return this.getAttributeAtPath(JSG.graph.attr.FormatAttributes.NAME)};JSG.graph.model.GraphItem.prototype._getTextFormat=function(){return this.getAttributeAtPath(JSG.graph.attr.TextFormatAttributes.NAME)||this._defaultTextFormat};
JSG.graph.model.GraphItem.prototype.getTextFormat=function(){return this.getAttributeAtPath(JSG.graph.attr.TextFormatAttributes.NAME)||this._addTextFormat()};JSG.graph.model.GraphItem.prototype._addTextFormat=function(){return this.getAttributeAtPath(JSG.graph.attr.TextFormatAttributes.NAME)||this.addAttribute(new JSG.graph.attr.TextFormatAttributes)};
JSG.graph.model.GraphItem.prototype.getTextItemCount=function(){for(var a=0,b=0;b<this._subItems.length;b++)this._subItems[b]instanceof JSG.graph.model.TextNode&&a++;return a};JSG.graph.model.GraphItem.prototype.getParent=function(){return this._parent};
JSG.graph.model.GraphItem.prototype.changeParent=function(a){if(a!==this._parent){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.PARENT,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(void 0!=this._parent&&this._parent._subItems.remove(this),this._parent=a,void 0!=this._parent&&this._parent._subItems.push(this),this.evaluate(),this.sendPostEvent(b),this.pathChanged())}};
JSG.graph.model.GraphItem.prototype.pathChanged=function(){this.sendPostEvent(new JSG.graph.model.events.Event(JSG.graph.model.events.Event.PATH));for(var a=0;a<this._subItems.length;a++)this._subItems[a].pathChanged()};JSG.graph.model.GraphItem.prototype.getGraph=function(){return void 0!=this._parent?this._parent.getGraph():void 0};JSG.graph.model.GraphItem.prototype.getItems=function(){return this._subItems};
JSG.graph.model.GraphItem.prototype.getItemAt=function(a){return 0>a||a>=this._subItems.length?void 0:this._subItems[a]};JSG.graph.model.GraphItem.prototype.getItemCount=function(){return this._subItems.length};
JSG.graph.model.GraphItem.prototype.findItemByPath=function(a){function b(a,b){var c=void 0;b.every(function(b){return b.getId()===a?(c=b,!1):!0});return c}if(void 0!=a){var c=a.nextId(),c=void 0!=c?c===this.getId()?this:b(c,this._subItems):void 0;return void 0!=c?a.hasNextId()?c.findItemByPath(a):c:void 0}};
JSG.graph.model.GraphItem.prototype.addItem=function(a,b){var c=a.getParent();if(c!==this){var d=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.ITEMADD,a);d.source=this;this.sendPreEvent(d);if(!0===d.doIt)return void 0!=c&&c.removeItem(a),this._subItems.insert(a,b),a._parent=this,a._assignId(),a.evaluate(),this.sendPostEvent(d),a}};
JSG.graph.model.GraphItem.prototype._assignId=function(){if(void 0==this.getId()){var a=this._createId();this.setId(a);this._assignName(a)}else void 0!=JSG.connectionRestorer&&(a=this._createId(),JSG.connectionRestorer.addId(this.getId(),a),this.setId(a));for(var a=0,b=this._subItems.length;a<b;a++)this._subItems[a]._assignId()};JSG.graph.model.GraphItem.prototype._assignName=function(a){this.setName(this.getShape().getType()+" "+a)};
JSG.graph.model.GraphItem.prototype._createId=function(){var a=this.getGraph();return void 0!=a?a.newUniqueId():void 0};JSG.graph.model.GraphItem.prototype.removeItem=function(a){if(a.getParent()===this){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.ITEMREMOVE,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(a._notifyRemove(),a._parent=void 0,this._subItems.remove(a)&&this.sendPostEvent(b))}};
JSG.graph.model.GraphItem.prototype._notifyRemove=function(){for(var a=0,b=this._subItems.length;a<b;a++)this._subItems[a]._notifyRemove();this.release()};JSG.graph.model.GraphItem.prototype.release=function(){};JSG.graph.model.GraphItem.prototype.getIndex=function(){return index=this._parent._subItems.indexOf(this)};JSG.graph.model.GraphItem.prototype.moveToTop=function(){this.moveToIndex(this._parent._subItems.length-1)};
JSG.graph.model.GraphItem.prototype.moveUp=function(){var a=this._parent._subItems.indexOf(this);this.moveToIndex(a+1)};JSG.graph.model.GraphItem.prototype.moveToBottom=function(){this.moveToIndex(0)};JSG.graph.model.GraphItem.prototype.moveDown=function(){var a=this._parent._subItems.indexOf(this);this.moveToIndex(a-1)};
JSG.graph.model.GraphItem.prototype.moveToIndex=function(a){var b=this._parent._subItems,c=b.length-1,d=b.indexOf(this);0<=a&&(a<=c&&a!==d)&&(c=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.INDEX,a),c.source=this,this.sendPreEvent(c),!0===c.doIt&&(b.move(d,a),this.sendPostEvent(c)))};JSG.graph.model.GraphItem.prototype.getTranslatedPoint=function(a,b){JSG.graph.Utils.traverseItemUp(this._parent,b,function(b){b.translateToParent(a);return!0});return a};
JSG.graph.model.GraphItem.prototype.translateFromParent=function(a){var b=this.getOrigin(JSG.ptCache.get());a.subtract(b);JSG.geometry.Utils.rotatePoint(a,-this._angle.getValue());JSG.ptCache.release(b);return a};JSG.graph.model.GraphItem.prototype.translateToParent=function(a){var b=this.getOrigin(JSG.ptCache.get());JSG.geometry.Utils.rotatePoint(a,this._angle.getValue());a.add(b);JSG.ptCache.release(b);return a};
JSG.graph.model.GraphItem.prototype.getTranslatedShapePoints=function(a,b){var c=function(a,b){var c=void 0!=b?b:[],g;g=a instanceof JSG.graph.model.shapes.BezierShape?a.getPolygonPointList().getPoints():a.getPoints();c.keep(g.length,JSG.geometry.Point.Factory);for(var l=0;l<g.length;l++)c[l].setTo(g[l]);return c}(this._shape,b);JSG.graph.Utils.traverseItemUp(this,a,function(a){for(var b=0;b<c.length;b++)a.translateToParent(c[b]);return!0});return c};
JSG.graph.model.GraphItem.prototype.getTranslatedBoundingBox=function(a,b){var c=this.getBoundingBox(b);JSG.graph.Utils.traverseItemUp(this._parent,a,function(a){a._translateBoundingBoxToParent(c);return!0});return c};JSG.graph.model.GraphItem.prototype._translateBoundingBoxToParent=function(a){var b=a.getTopLeft(new JSG.geometry.Point(0,0));this.translateToParent(b);a.setTopLeftTo(b);a.rotate(this.getAngle().getValue())};
JSG.graph.model.GraphItem.prototype.translateBoundingBoxToParent=function(a){var b=a.getTopLeft();this.translateToParent(b);a.setTopLeftTo(b);a.rotate(this.getAngle().getValue());return a};JSG.graph.model.GraphItem.prototype.translateBoundingBoxFromParent=function(a){var b=a.getTopLeft();this.translateFromParent(b);a.setTopLeftTo(b);a.rotate(-this.getAngle().getValue());return a};
JSG.graph.model.GraphItem.prototype.containsPoint=function(a,b){if(a){var c=JSG.boxCache.get(),d=this.getBoundingBox(c),e=JSG.findRadius/this.getGraph().getZoom();b==JSG.graph.controller.FindFlags.AREAWITHFRAME||b==JSG.graph.controller.FindFlags.BOXWITHFRAME?d.expandBy(e):b==JSG.graph.controller.FindFlags.INNERAREA&&d.reduceBy(e);var f=d.containsPoint(a),g=new JSG.geometry.Point(0,0);f&&!this.isCollapsed()&&b!=JSG.graph.controller.FindFlags.BOXWITHFRAME&&(b==JSG.graph.controller.FindFlags.AREAWITHFRAME?
d.reduceBy(e):b==JSG.graph.controller.FindFlags.INNERAREA&&d.expandBy(e),e=a.copy(),e.subtract(d.getTopLeft(g)),d.rotateLocalPointInverse(e),f=this._shape.containsPoint(e,b));JSG.boxCache.release(c);return f}return!1};
JSG.graph.model.GraphItem.prototype.saveXML=function(a,b){a.writeStartElement("graphitem");void 0!=this.getId()&&a.writeAttributeString("id",this.getId());void 0!=this._parent&&void 0!=this._parent.getId()&&a.writeAttributeString("parentid",this._parent.getId());this.saveAttributesXML(a);this._saveAngle(a,b);(this._layer.hasFormula()||""!=this._layer.getValue())&&this._layer.saveXML("layer",a);(this._type.hasFormula()||""!=this._type.getValue())&&this._type.saveXML("type",a);(this._name.hasFormula()||
""!=this._name.getValue())&&this._name.saveXML("name",a);(this._link.hasFormula()||""!=this._link.getValue())&&this._link.saveXML("link",a);this.saveXMLContent(a,b);a.writeEndElement()};
JSG.graph.model.GraphItem.prototype._saveAngle=function(a,b){function c(a){d+=a.getAngle().getValue()}if(!0===b){var d=this._angle.getValue(),e=this._angle.copy();JSG.graph.Utils.traverseItemUp(this.getParent(),this.getGraph(),c);e.setValue(d);(e.hasFormula()||0!=e.getValue())&&e.saveXML("angle",a,10)}else(this._angle.hasFormula()||0!=this._angle.getValue())&&this._angle.saveXML("angle",a,10)};
JSG.graph.model.GraphItem.prototype.saveXMLContent=function(a,b){this._pin.saveXML("pin",a,b);this._size.saveXML("size",a);1E3==this._collapsedSize.getWidth().getValue()&&1E3==this._collapsedSize.getHeight().getValue()||this._collapsedSize.saveXML("collapsedsize",a);if(this._reshapeCoordinates.length){a.writeStartElement("rscoordinates");for(var c=0;c<this._reshapeCoordinates.length;c++)this._reshapeCoordinates[c].saveXML("c",a);a.writeEndElement()}this.hasConditions()&&(c=this.getConditions(),c.hasConditions()&&
c.saveXML("conditions",a));this._shape.saveXML("shape",a);this._saveSubItemsXML(a)};JSG.graph.model.GraphItem.prototype._saveSubItemsXML=function(a){for(var b=0;b<this._subItems.length;b++)this._subItems[b].saveXML(a)};
JSG.graph.model.GraphItem.prototype.readXML=function(a){this._reading=!0;this.readAttributesXML(a);var b=findElementByTagName(a,"angle");void 0!=b&&this._angle.readXML(b);b=findElementByTagName(a,"layer");void 0!=b&&this._layer.readXML(b);var c=findElementByTagName(a,"type");void 0!=c&&this._type.readXML(c);b=findElementByTagName(a,"link");void 0!=b&&this._link.readXML(b);b=a.getAttribute("id");void 0!=b&&(b=Number(b),void 0!=JSG.connectionRestorer?void 0!=this.getId()?JSG.connectionRestorer.addId(b,
this.getId()):this.setId(b):this.setId(b));b=findElementByTagName(a,"shape");if(void 0!=b){var c=b.getAttribute("type"),d=JSG.graph.model.shapes.ShapeFactory.createShapeFromString(c);d&&(this.setShapeTo(d),d.readXML(b))}b=findElementByTagName(a,"name");void 0!=b?(this._name.readXML(b),void 0!=JSG.connectionRestorer&&this._assignName(this.getId())):""==this._name.getValue()&&this._assignName(this.getId());(b=(b=findElementByTagName(a,"lpin"))||findElementByTagName(a,"localpin"))&&this._pin._localpin.readXML(b);
b=findElementByTagName(a,"pin");this._pin.readXML(b);this._updateOrigin();b=findElementByTagName(a,"size");void 0!=b&&(this._size.readXML(b),this._updateBoundingBox());b=findElementByTagName(a,"collapsedsize");void 0!=b&&(this._collapsedSize.readXML(b),this._updateBoundingBox());b=findElementByTagName(a,"format");void 0!=b&&(d=new JSG.graph.model.attributes.Format,d.register(this),d.readXML(b),this.getFormat().applyLegacyFormat(d));b=findElementByTagName(a,"textformat");void 0!=b&&(d=new JSG.graph.model.attributes.TextFormat,
d.register(this),d.readXML(b),this.getTextFormat().applyLegacyFormat(d));b=findElementByTagName(a,"attributes");void 0!=b&&(d=new JSG.graph.model.attributes.Attributes,d.readXML(b),this.getItemAttributes().applyLegacyAttributes(d));b=findElementByTagName(a,"layoutattributes");void 0!=b&&this.getLayoutAttributes().readLegacyXML(b,this);c=0;b=findElementByTagName(a,"rscoordinates");if(void 0!=b&&b.hasChildNodes())for(var e=JSG.graph.properties.GraphItemProperties,d=0,f=b.childNodes.length;d<f;d++){var g=
b.childNodes.item(d);if("c"==g.nodeName){var l=new JSG.graph.ReshapeCoordinate;l.readXML(g);this._reshapeCoordinates.push(l);l.getVertical()?this._reshapeProperties.addIndexProperty(l.getName(),e.getReshapePointY,e.setReshapePointY,c):this._reshapeProperties.addIndexProperty(l.getName(),e.getReshapePointX,e.setReshapePointX,c);c++}}if(a.hasChildNodes())for(d=0,f=a.childNodes.length;d<f;d++)if(b=a.childNodes.item(d),"graphitem"==b.nodeName||"gi"==b.nodeName)c=b.getAttribute("type"),(c=JSG.graphItemFactory.createItemFromString(c))?
(this.addItem(c),c.readXML(b)):JSG.debug.log("unknown item...");b=findElementByTagName(a,"conditions");void 0!=b&&this.getConditions().readXML(b);JSG.graphItemFactory.initReadItem(this);this._reading=!1};JSG.graph.model.GraphItem.prototype.getItemById=function(a){if(this.getId()==a)return this;for(var b=this._subItems.length-1;0<=b;b--){var c=this._subItems[b].getItemById(a);if(void 0!=c)return c}};
JSG.graph.model.GraphItem.prototype._restoreConnections=function(a){for(var b=0,c=this._subItems.length;b<c;b++){var d=this._subItems[b];d&&d._restoreConnections(a)}};
JSG.graph.model.GraphItem.prototype.sendPostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.PIN:this.isRefreshEnabled()?this.refresh():this._update();break;case b.ATTRIBUTE:if(a.detailId==JSG.graph.model.events.AttributeChangeEvent.VALUE)if(a.isCategory(JSG.graph.attr.TextFormatAttributes.NAME)){if(b=JSG.graph.attr.TextFormatAttributes,a.hasAttribute(b.FONTSIZE,b.FONTCOLOR,b.FONTNAME))for(var b=0,c=this._subItems.length;b<c;b++)this._subItems[b]instanceof JSG.graph.model.TextNode&&
(this._subItems[b].invalidateFontMetrics(),this._subItems[b].updateSize())}else a.isCategory(JSG.graph.attr.ItemAttributes.NAME)&&a.getAttribute().getName()}JSG.graph.model.GraphItem._super.sendPostEvent.call(this,a)};JSG.graph.model.GraphItem.prototype.getTextSubItem=function(){for(var a=0,b=this._subItems.length;a<b;a++){var c=this._subItems[a];if(c instanceof JSG.graph.model.TextNode)return c}};JSG.graph.model.GraphItem.prototype.disableRefresh=function(){this._refreshEnabled=!1};
JSG.graph.model.GraphItem.prototype.enableRefresh=function(a){this._refreshEnabled=!0;!0===a&&this.refresh()};JSG.graph.model.GraphItem.prototype.isRefreshEnabled=function(){return this._refreshEnabled};JSG.graph.model.GraphItem.prototype.refresh=function(a){!0!==this._refreshEnabled&&!0!==a||this._doRefresh(a)};
JSG.graph.model.GraphItem.prototype._doRefresh=function(a){if(this._update()||!0===a){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.ALL);b.source=this;this.sendPostEvent(b)}this._shape.refresh();for(var b=0,c=this._subItems.length;b<c;b++)this._subItems[b].refresh(a)};JSG.graph.model.GraphItem.prototype._update=function(){var a=this._updateOrigin();return a=this._updateBoundingBox()||a};
JSG.graph.model.GraphItem.prototype._updateOrigin=function(){var a=this._pin.getPoint(JSG.ptCache.get()),b=this._pin.getLocalPoint(JSG.ptCache.get()),b=JSG.geometry.Utils.rotatePoint(b,this._angle.getValue());a.subtract(b);var c=a.isEqualTo(this._origincache,0.1);c||this._origincache.setTo(a);JSG.ptCache.release(a,b);return!c};
JSG.graph.model.GraphItem.prototype._updateBoundingBox=function(){var a=this.getSizeAsPoint(JSG.ptCache.get()),b=JSG.boxCache.get().setTo(this._bboxcache);this._bboxcache.setTopLeftTo(this._origincache);this._bboxcache.setSizeTo(a);this._bboxcache.setAngle(this._angle.getValue());JSG.ptCache.release(a);JSG.boxCache.release(b);return!b.isEqualTo(this._bboxcache,0.1)};
JSG.graph.model.GraphItem.prototype.getConditions=function(){void 0==this._condobj&&(this._condobj=new JSG.graph.model.Conditions(this));return this._condobj};JSG.graph.model.GraphItem.prototype.hasConditions=function(){return void 0!=this._condobj&&this._condobj.hasConditions()};JSG.namespace("JSG.graph.model");
JSG.graph.model.Graph=function(){JSG.graph.model.Graph._super.constructor.apply(this,arguments);this._uniqueId=1;this._graphId=0;this._layers=new JSG.commons.Map;this._settings=new JSG.graph.model.settings.GraphSettings;this._settings.register(this);this.setItemAttribute(JSG.graph.attr.ItemAttributes.SELECTIONMODE,JSG.graph.attr.consts.SelectionMode.NONE);this._zoom=this._horizontalPages=this._verticalPages=1;this._changed=!1;var a=this._settings.getPage();this.setSize(new JSG.graph.expr.NumberExpression(this._horizontalPages*
a.getUsableWidth()),new JSG.graph.expr.NumberExpression(this._verticalPages*a.getUsableHeight()));this.setShapeTo(new JSG.graph.model.shapes.RectangleShape);this._isDirty=!1};JSG.extend(JSG.graph.model.Graph,JSG.graph.model.GraphItem);JSG.graph.model.Graph.AttributeID={REFRESH:"refresh"};JSG.graph.model.Graph.prototype.newInstance=function(){return new JSG.graph.model.Graph};
JSG.graph.model.Graph.prototype.copy=function(a,b){var c=JSG.graph.model.Graph._super.copy.call(this,a,b);c._settings.setTo(this._settings);return c};JSG.graph.model.Graph.prototype.isChanged=function(){return this._changed};JSG.graph.model.Graph.prototype.setChanged=function(a){this._changed=a};JSG.graph.model.Graph.prototype.setZoom=function(a){this._zoom=a};JSG.graph.model.Graph.prototype.getZoom=function(){return this._zoom};JSG.graph.model.Graph.prototype.markDirty=function(){this._isDirty=!0};
JSG.graph.model.Graph.prototype._doRefresh=function(a){if(!0===this._isDirty||!0===a)this._isDirty=!1,JSG.graph.model.Graph._super._doRefresh.call(this,a),this.layoutAll(),this.updateExtent(),a=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.GRAPH,this),a.detailId=JSG.graph.model.Graph.AttributeID.REFRESH,a.source=this,this.sendPostEvent(a),JSG.debug.log("refresh")};
JSG.graph.model.Graph.prototype.getLayer=function(a){var b=this._layers.get(a);void 0==b&&void 0!=a&&(b=this._layers.put(a,new JSG.graph.model.Layer(a)));return b};JSG.graph.model.Graph.prototype.hasLayer=function(a){return void 0!=this._layers.get(a)};JSG.graph.model.Graph.prototype.getSettings=function(){return this._settings};JSG.graph.model.Graph.prototype.setSettings=function(a){void 0!=a&&(this._settings.deregister(this),this._settings=a,this._settings.register(this))};
JSG.graph.model.Graph.prototype.saveXMLContent=function(a,b){a.writeAttributeString("type","graph");a.writeAttributeString("uniqueid",this._uniqueId);this._settings.saveXML(a);a.writeStartElement("layers");for(var c=this._layers.elements(),d=0,e=c.length;d<e;d++)c[d].saveXML(a);a.writeEndElement();JSG.graph.model.Graph._super.saveXMLContent.call(this,a,b);this._changed=!1};
JSG.graph.model.Graph.prototype.readXML=function(a){JSG.graph.model.Graph._super.readXML.call(this,a);var b=findElementByTagName(a,"layers");if(void 0!=b&&b.hasChildNodes())for(var c=0,d=b.childNodes.length;c<d;c++){var e=b.childNodes.item(c);if("layer"==e.nodeName){var f=new JSG.graph.model.Layer(e.getAttribute("name"));f.readXML(e);this._layers.put(f.name,f)}}b=a.getAttribute("uniqueid");void 0!=b&&(this._uniqueId=Number(b));void 0==a.getAttribute("grid")&&(a=findElementByTagName(a,"settings"));
this._settings.readXML(a);this._changed=!1};JSG.graph.model.Graph.prototype.newUniqueId=function(){return this._uniqueId++};JSG.graph.model.Graph.prototype.createPath=function(){return new JSG.graph.model.Path};JSG.graph.model.Graph.prototype.getPortById=function(a){for(var b=0,c=this._subItems.length;b<c;b++){var d=this._subItems[b];if(d instanceof JSG.graph.model.Node&&(d=d.getPortById(a),void 0!=d))return d}};
JSG.graph.model.Graph.prototype.getItemById=function(a){for(var b=0,c=this._subItems.length;b<c;b++){var d=this._subItems[b].getItemById(a);if(void 0!=d)return d}};
JSG.graph.model.Graph.prototype.getSubItemsBoundingBox=function(a){a=void 0!=a?a:new JSG.geometry.BoundingBox(0,0);if(0<this._subItems.length){var b=JSG.boxCache.get();a.setTo(this._subItems[0].getBoundingBox(b));for(var c=1,d=this._subItems.length;c<d;c++)a.union(this._subItems[c].getBoundingBox(b));JSG.boxCache.release(b)}else a.reset();return a};JSG.graph.model.Graph.prototype.translateFromParent=function(a){return a};JSG.graph.model.Graph.prototype.translateToParent=function(a){return a};
JSG.graph.model.Graph.prototype.setPinCoordinateTo=function(a){JSG.graph.model.Graph._super.setPinCoordinateTo.call(this,a)};JSG.graph.model.Graph.prototype.setPinPoint=function(a,b){JSG.graph.model.Graph._super.setPinPoint.call(this,a,b)};
JSG.graph.model.Graph.prototype.updateExtent=function(){if(!this._reading){var a=this._settings.getPage(),b=this.getTotalBoundingRect(void 0,JSG.rectCache.get()),c=JSG.boxCache.get();c._bottomright.x=Math.max(a.getUsableWidth(),b.getRight());c._bottomright.x=Math.ceil(Math.floor(c._bottomright.x)/a.getUsableWidth())*a.getUsableWidth();c._bottomright.y=Math.max(a.getUsableHeight(),b.getBottom());c._bottomright.y=Math.ceil(c._bottomright.y/a.getUsableHeight())*a.getUsableHeight();c._topleft.x=Math.min(0,
b.x);0>c._topleft.x&&(c._topleft.x=Math.floor(c._topleft.x/a.getUsableWidth())*a.getUsableWidth());c._topleft.y=Math.min(0,b.y);0>c._topleft.y&&(c._topleft.y=Math.floor(c._topleft.y/a.getUsableHeight())*a.getUsableHeight());this._horizontalPages=Math.ceil(c.getWidth()/a.getUsableWidth());this._verticalPages=Math.ceil(c.getHeight()/a.getUsableHeight());this.setBoundingBoxTo(c);JSG.boxCache.release(c);JSG.rectCache.release(b)}};
JSG.graph.model.Graph.prototype.getTotalBoundingRect=function(a,b){for(var c=b||new JSG.geometry.Rectangle(0,0,0,0),d=JSG.rectCache.get(),e=0,f=this._subItems.length;e<f;e++){var g=this._subItems[e].getTotalBoundingRect(this,d);c.union(g)}JSG.rectCache.release(d);return c};
JSG.graph.model.Graph.prototype.getUsedRect=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);if(this.getItemCount()){var b=JSG.boxCache.get();this.getItemAt(0).getTranslatedBoundingBox(this,b).getBoundingRectangle(a);JSG.boxCache.release(b)}return this.getTotalBoundingRect(void 0,a)};
JSG.graph.model.Graph.prototype.getPageRectForLocation=function(a,b){var c=b||new JSG.geometry.Rectangle(0,0,0,0),d=this.getBoundingBox(),e=this._settings.getPage(),f=Math.floor(a.x/e.getUsableWidth()),g=Math.floor(a.y/e.getUsableHeight());c.set(f*e.getUsableWidth(),g*e.getUsableHeight(),e.getUsableWidth(),e.getUsableHeight());c.x=Math.max(d._topleft.x,c.x);c.y=Math.max(d._topleft.y,c.y);return c};JSG.graph.model.Graph.prototype.getGraphId=function(){return this._graphId};
JSG.graph.model.Graph.prototype.setGraphId=function(a){this._graphId=a};JSG.graph.model.Graph.prototype.getGraph=function(){return this};JSG.graph.model.Graph.prototype.getVerticalPages=function(){return this._verticalPages};
JSG.graph.model.Graph.prototype.getVerticalPrintPages=function(){var a=this._settings.getPage();switch(a.getScaleToPageType()){case JSG.graph.model.settings.ScaleToPageType.NONE:return this._verticalPages;case JSG.graph.model.settings.ScaleToPageType.HORIZONTALCOUNT:var b=this.getUsedRect(JSG.rectCache.get());b.expand(500,500);var c=Math.min(1,a.getUsableWidth()*a.getScaleToPageCount()/b.width);JSG.rectCache.release(b);return Math.ceil(b.height*c/a.getUsableHeight());case JSG.graph.model.settings.ScaleToPageType.VERTICALCOUNT:return a.getScaleToPageCount()}return 1};
JSG.graph.model.Graph.prototype.getHorizontalPages=function(){return this._horizontalPages};
JSG.graph.model.Graph.prototype.getHorizontalPrintPages=function(){var a=this._settings.getPage();switch(a.getScaleToPageType()){case JSG.graph.model.settings.ScaleToPageType.NONE:return this._horizontalPages;case JSG.graph.model.settings.ScaleToPageType.HORIZONTALCOUNT:return a.getScaleToPageCount();case JSG.graph.model.settings.ScaleToPageType.VERTICALCOUNT:var b=this.getUsedRect(JSG.rectCache.get());b.expandBy(500);var c=Math.min(1,a.getUsableHeight()*a.getScaleToPageCount()/b.height);JSG.rectCache.release(b);
return Math.ceil(b.width*c/a.getUsableWidth())}return 1};
JSG.graph.model.Graph.prototype.getPrintZoom=function(){var a=this._settings.getPage();switch(a.getScaleToPageType()){case JSG.graph.model.settings.ScaleToPageType.SINGLE:var b=this.getUsedRect(JSG.rectCache.get());b.expandBy(500);var c=Math.min(1,a.getUsableWidth()/b.width),a=Math.min(1,a.getUsableHeight()/b.height);JSG.rectCache.release(b);return Math.min(c,a);case JSG.graph.model.settings.ScaleToPageType.HORIZONTALCOUNT:return b=this.getUsedRect(JSG.rectCache.get()),c=Math.min(1,a.getUsableWidth()*
a.getScaleToPageCount()/b.width),JSG.rectCache.release(b),c;case JSG.graph.model.settings.ScaleToPageType.VERTICALCOUNT:return b=this.getTotalBoundingRect(void 0,JSG.rectCache.get()),c=Math.min(1,a.getUsableHeight()*a.getScaleToPageCount()/b.height),JSG.rectCache.release(b),c}return 1};JSG.graph.model.Graph.prototype.updateLabelPositions=function(){};
JSG.graph.model.Graph.prototype.sendPostEvent=function(a){var b=JSG.graph.model.events.Event;if(a.id===b.GRAPH||a.id===b.PAGE)switch(b=JSG.graph.model.settings.PageID,a.detailId){case b.WIDTH:case b.HEIGHT:case b.LEFTMARGIN:case b.TOPMARGIN:case b.RIGHTMARGIN:case b.BOTTOMMARGIN:case b.ORIENTATION:case b.FORMAT:this.layout(),this.updateExtent()}JSG.graph.model.Graph._super.sendPostEvent.call(this,a)};JSG.namespace("JSG.graph.model");
JSG.graph.model.Node=function(a){JSG.graph.model.Node._super.constructor.apply(this,arguments);this.setShapeTo(void 0!==a?a:new JSG.graph.model.shapes.RectangleShape);this._ports=[];this._pin.setLocalCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH * 0.5"),new JSG.graph.expr.NumberExpression(0,"HEIGHT * 0.5"))};JSG.extend(JSG.graph.model.Node,JSG.graph.model.GraphItem);JSG.graph.model.Node.prototype.newInstance=function(){return new JSG.graph.model.Node};
JSG.graph.model.Node.prototype._assignId=function(){JSG.graph.model.Node._super._assignId.call(this);this._ports.forEach(function(a){a._assignId()})};JSG.graph.model.Node.prototype._copy=function(a,b,c){a=JSG.graph.model.Node._super._copy.call(this,a,b,c);b=0;for(c=this._ports.length;b<c;b++)a.addPort(this._ports[b].copy());return a};JSG.graph.model.Node.prototype.evaluate=function(){JSG.graph.model.Node._super.evaluate.call(this);for(var a=0;a<this._ports.length;a++)this._ports[a].evaluate()};
JSG.graph.model.Node.prototype.getTitle=function(){for(var a=void 0,b=0,c=this._subItems.length;b<c;b++){var d=this._subItems[b];if(d instanceof JSG.graph.model.TextNode){a=d;break}}return a};JSG.graph.model.Node.prototype.layout=function(){JSG.graph.model.Node._super.layout.call(this);var a=this.getTitle();a&&this.layoutTitle(a)};
JSG.graph.model.Node.prototype.layoutTitle=function(a){if(this.isCollapsed()){if(void 0==a.getAttribute("expstate")){var b=a.getPin(),c=new JSG.graph.model.State;c.addProperty("angle",a.getAngle().copy(),"JSG.graph.expr.NumberExpression");c.addProperty("pin",b.copy(),"JSG.graph.Pin");a.addAttribute(new JSG.graph.attr.ObjectAttribute("expstate",c));a.setAngle(0);b.setCoordinate(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH * 0.5"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * 0.5"));
b.setLocalCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH * 0.5"),new JSG.graph.expr.NumberExpression(0,"HEIGHT * 0.5"));b.evaluate()}}else if(b=a.getAttribute("expstate"))c=b.getValue(),a.getPin().setTo(c.getProperty("pin")),a.getPin().evaluate(a),a.setAngle(c.getProperty("angle")),a.removeAttribute(b)};
JSG.graph.model.Node.prototype.addPort=function(a){if(0>this.getPortIndex(a)){var b=new JSG.graph.model.events.NodeEvent(JSG.graph.model.events.NodeEvent.PORTADD,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(this._ports.push(a),a._parent=this,void 0==a.getId()&&a.setId(this._createId()),a.evaluate(),this.sendPostEvent(b))}return a};
JSG.graph.model.Node.prototype.addPortAtLocation=function(a,b){var c=0!=this.getWidth().getValue()?b.x/this.getWidth().getValue():0.5,d=0!=this.getHeight().getValue()?b.y/this.getHeight().getValue():0.5,c=new JSG.graph.Coordinate(new JSG.graph.expr.Expression(0,"Parent!WIDTH * "+c),new JSG.graph.expr.Expression(0,"Parent!HEIGHT * "+d));a.setPinCoordinateTo(c);return this.addPort(a)};
JSG.graph.model.Node.prototype.addPortAtRelativeLocation=function(a,b){var c=new JSG.graph.Coordinate(new JSG.graph.expr.Expression(0,"Parent!WIDTH * "+b.x),new JSG.graph.expr.Expression(0,"Parent!HEIGHT * "+b.y));a.setPinCoordinateTo(c);return this.addPort(a)};JSG.graph.model.Node.prototype.addPortAtCoordinate=function(a,b){a.setPinCoordinateTo(b);return this.addPort(a)};JSG.graph.model.Node.prototype.getPortAt=function(a){return this._ports[a]};JSG.graph.model.Node.prototype.getPortIndex=function(a){return this._ports.indexOf(a)};
JSG.graph.model.Node.prototype.getPorts=function(){return this._ports};JSG.graph.model.Node.prototype.hasPorts=function(){return!this._ports.isEmpty()};JSG.graph.model.Node.prototype.clearPorts=function(){var a=new JSG.graph.model.events.NodeEvent(JSG.graph.model.events.NodeEvent.PORTREMOVEALL);a.source=this;this.sendPreEvent(a);!0===a.doIt&&(this._ports=[],this.sendPostEvent(a))};
JSG.graph.model.Node.prototype.removePort=function(a){var b=new JSG.graph.model.events.NodeEvent(JSG.graph.model.events.NodeEvent.PORTREMOVE,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(this._ports.remove(a),a._parent=void 0,this.sendPostEvent(b))};JSG.graph.model.Node.prototype.addCenterPort=function(){var a=JSG.graph.expr.NumberExpression,b=new a(0,"Parent!WIDTH * 0.5"),a=new a(0,"Parent!HEIGHT * 0.5");return this.addPortAtCoordinate(new JSG.graph.model.Port,new JSG.graph.Coordinate(b,a))};
JSG.graph.model.Node.prototype.addDefaultPorts=function(){function a(a,c){b.addPortAtCoordinate(new JSG.graph.model.Port,new JSG.graph.Coordinate(a,c))}var b=this;new JSG.geometry.Point(0,0);var c=JSG.graph.expr.NumberExpression;a(new c(0,"Parent!WIDTH * 0.5"),new c(0));a(new c(0,"Parent!WIDTH"),new c(0,"Parent!HEIGHT * 0.5"));a(new c(0,"Parent!WIDTH * 0.5"),new c(0,"Parent!HEIGHT"));a(new c(0),new c(0,"Parent!HEIGHT * 0.5"))};
JSG.graph.model.Node.prototype.getPortAtLocation=function(a){for(var b=void 0,c=JSG.ptCache.get(),d=0,e=this._ports.length;d<e&&!(b=this._ports[d],b.getPinPoint(c),100>Math.abs(c.x-a.x)&&100>Math.abs(c.y-a.y));d++)b=void 0;JSG.ptCache.release(c);return b};
JSG.graph.model.Node.prototype.getPortById=function(a){for(var b=0,c=this._ports.length;b<c;b++)if(this._ports[b].getId()==a)return this._ports[b];for(b=this._subItems.length-1;0<=b;b--)if(c=this._subItems[b],c instanceof JSG.graph.model.Node&&(c=c.getPortById(a),void 0!=c))return c};JSG.graph.model.Node.prototype.getAttachedEdges=function(){var a=[];this._ports.forEach(function(b){a=a.concat(b.getEdges())});return a};
JSG.graph.model.Node.prototype._doRefresh=function(a){JSG.graph.model.Node._super._doRefresh.call(this,a);for(var b=0,c=this._ports.length;b<c;b++)this._ports[b].refresh(a)};JSG.graph.model.Node.prototype.pathChanged=function(){for(var a=0;a<this._ports.length;a++)this._ports[a].pathChanged();JSG.graph.model.Node._super.pathChanged.call(this)};
JSG.graph.model.Node.prototype.readXML=function(a){JSG.graph.model.Node._super.readXML.call(this,a);a=findElementByTagName(a,"ports");if(void 0!=a&&a.hasChildNodes()){var b,c,d,e;b=0;for(c=a.childNodes.length;b<c;b++)if(d=a.childNodes.item(b),"graphitem"==d.nodeName||"gi"==d.nodeName)if(e=d.getAttribute("type"),e=JSG.graphItemFactory.createItemFromString(e||"port"))this.addPort(e),e.readXML(d)}};
JSG.graph.model.Node.prototype.saveXMLContent=function(a,b){JSG.graph.model.Node._super.saveXMLContent.call(this,a,b);a.writeAttributeString("type","node");var c=this._ports;if(!c.isEmpty()){a.writeStartElement("ports");for(var d=0,e=c.length;d<e;d++)c[d].saveXML(a,b);a.writeEndElement()}};JSG.namespace("JSG.graph.model");
JSG.graph.model.Port=function(){JSG.graph.model.Port._super.constructor.apply(this,arguments);this._outgoingEdges=[];this._incomingEdges=[];this.setShapeTo(new JSG.graph.model.shapes.RectangleShape);var a=new JSG.graph.expr.Expression(0,"width * 0.5"),b=new JSG.graph.expr.Expression(0,"height * 0.5");this._centerCoord=new JSG.graph.Coordinate(a,b);this.setSize(200,200);a=JSG.graph.expr.NumberExpression;this.getPin().setLocalCoordinate(new a(0,"width * 0.5"),new a(0,"height * 0.5"))};
JSG.extend(JSG.graph.model.Port,JSG.graph.model.GraphItem);JSG.graph.model.Port.prototype.newInstance=function(){return new JSG.graph.model.Port};JSG.graph.model.Port.prototype._copy=function(a,b,c){a=this.newInstance();a._pin.setTo(this._pin);a._size=this._size.copy();a._centerCoord.setTo(this._centerCoord);return a};
JSG.graph.model.Port.prototype.saveXMLContent=function(a,b){if(!0===b){var c=this._pin._pin.copy(),d=this._pin._pin.toPoint(JSG.ptCache.get()),d=this.getTranslatedPoint(d,this.getGraph());c.getX().setValue(d.x);c.getY().setValue(d.y);c.saveXML("pin",a);JSG.ptCache.release(d)}else this._pin._pin.saveXML("pin",a);200==this._size.getWidth().getValue()&&200==this._size.getHeight().getValue()||this._size.saveXML("size",a)};
JSG.graph.model.Port.prototype.evaluate=function(){JSG.graph.model.Port._super.evaluate.call(this);this._centerCoord.evaluate(this)};JSG.graph.model.Port.prototype.getConnectionPoint=function(a,b){var c=this.getBoundingBox(),d=c.getCenter(b).add(c._topleft);a=void 0!=a?a:this.getGraph();JSG.graph.Utils.traverseItemUp(this.getParent(),a,function(a){a.translateToParent(d)});return d};JSG.graph.model.Port.prototype.getConnectionCoordinate=function(){return this._centerCoord};
JSG.graph.model.Port.prototype.getCenter=function(a){return this._shape.getPointList().getCenter(a)};JSG.graph.model.Port.prototype.addEdge=function(a){a.getSourcePort()===this&&(this._outgoingEdges.push(a),this._incomingEdges.remove(a));a.getTargetPort()===this&&(this._incomingEdges.push(a),this._outgoingEdges.remove(a))};JSG.graph.model.Port.prototype.removeEdge=function(a){return this._outgoingEdges.remove(a)?!0:this._incomingEdges.remove(a)};
JSG.graph.model.Port.prototype.getEdges=function(){var a=[];this._incomingEdges.forEach(function(b){a.push(b)});this._outgoingEdges.forEach(function(b){a.push(b)});return a};JSG.graph.model.Port.prototype.getEdgesCount=function(){return this._incomingEdges.length+this._outgoingEdges.length};JSG.graph.model.Port.prototype.getIncomingEdges=function(){return this._incomingEdges.slice()};JSG.graph.model.Port.prototype.getOutgoingEdges=function(){return this._outgoingEdges.slice()};JSG.namespace("JSG.graph.model");
JSG.graph.model.PortMapper=function(){JSG.graph.model.PortMapper._super.constructor.call(this);this.isMapper=!0;this._mappedPorts=new JSG.commons.Map};JSG.extend(JSG.graph.model.PortMapper,JSG.graph.model.Port);JSG.graph.model.PortMapper.TYPE="portmapper";JSG.graph.model.PortMapper.prototype.mapPort=function(a,b){this.mapPortId(a.getId(),b.getId())};JSG.graph.model.PortMapper.prototype.mapPortId=function(a,b){this._mappedPorts.put(a,b)};
JSG.graph.model.PortMapper.prototype.getMappedPort=function(a){a=this._mappedPorts.get(a);return void 0!=a?this.getParent().getPortById(a):void 0};JSG.graph.model.PortMapper.prototype.getMappedPortId=function(a){return this._mappedPorts.get(a)};JSG.graph.model.PortMapper.prototype.getMappedItemPort=function(a){var b=this.getMappedPort(a);return void 0!=b?b.isMapper?b.getMappedItemPort(a):b:void 0};
JSG.graph.model.PortMapper.prototype.getMappedItemPortId=function(a){a=this.getMappedItemPort(a);return void 0!=a?a.getId():void 0};JSG.graph.model.PortMapper.prototype.saveXMLContent=function(a,b){JSG.graph.model.PortMapper._super.saveXMLContent.call(this,a,b);a.writeAttributeString("type",JSG.graph.model.PortMapper.TYPE);this._mappedPorts.iterate(function(b,d){a.writeStartElement("mp");a.writeAttributeString("key",b);a.writeAttributeString("id",d);a.writeEndElement()})};
JSG.graph.model.PortMapper.prototype.readXML=function(a){JSG.graph.model.PortMapper._super.readXML.call(this,a);if(a.hasChildNodes())for(var b=0,c=a.childNodes.length;b<c;b++){var d=a.childNodes.item(b);if("mp"==d.nodeName){var e=d.getAttribute("id"),d=d.getAttribute("key");null!=d&&null!=e&&this.mapPortId(d,e)}}};JSG.namespace("JSG.graph.model");
JSG.graph.model.TextNode=function(){JSG.graph.model.TextNode._super.constructor.apply(this,arguments);var a=this.getFormat();a.setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.NONE);a.setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE);this._text=new JSG.graph.expr.StringExpression("Text");this._metrics=void 0;this._lines=[];this.addAttribute(new JSG.graph.attr.TextNodeAttributes);this.setShapeTo(new JSG.graph.model.shapes.RectangleShape)};JSG.extend(JSG.graph.model.TextNode,JSG.graph.model.Node);
JSG.graph.model.TextNode.prototype.newInstance=function(){return new JSG.graph.model.TextNode};JSG.graph.model.TextNode.prototype._copy=function(a,b,c){a=JSG.graph.model.TextNode._super._copy.call(this,a,b,c);a._text=this.getText().copy();return a};JSG.graph.model.TextNode.prototype.containsPoint=function(a,b){return JSG.graph.model.TextNode._super.containsPoint.call(this,a,JSG.graph.controller.FindFlags.AREA)};
JSG.graph.model.TextNode.prototype.saveXMLContent=function(a,b){JSG.graph.model.TextNode._super.saveXMLContent.call(this,a,b);a.writeAttributeString("type","text");this._text.saveXML("text",a,b?this:void 0)};JSG.graph.model.TextNode.prototype._assignName=function(a){this.setName("label "+a)};
JSG.graph.model.TextNode.prototype._addTextFormat=function(){return void 0!=this.getParent()?1==this.getParent().getTextItemCount()?this.getParent()._addTextFormat():this.addAttribute(this.getParent()._getTextFormat().copy()):this.addAttribute(new JSG.graph.attr.TextFormatAttributes)};JSG.graph.model.TextNode.prototype.addTextFormat=function(){return this.addAttribute(new JSG.graph.attr.TextFormatAttributes)};
JSG.graph.model.TextNode.prototype._getTextFormat=function(){var a=this.getAttributeAtPath(JSG.graph.attr.TextFormatAttributes.NAME);void 0==a&&void 0!=this.getParent()&&(a=this.getParent().getAttributeAtPath(JSG.graph.attr.TextFormatAttributes.NAME));return a||JSG.graph.model.TextNode._super._getTextFormat.call(this)};
JSG.graph.model.TextNode.prototype.readXML=function(a){JSG.graph.model.TextNode._super.readXML.call(this,a);var b=findElementByTagName(a,"content");void 0!=b&&0<b.childNodes.length&&(this._text._formula=b.getAttribute("f"),void 0!=this._text._formula&&(this._text._formula=JSG.graph.expr.StringConstant.decode(this._text._formula),void 0!=JSG.connectionRestorer&&JSG.connectionRestorer.expressions.push(this._text)),this._text._value=void 0==b.textContent?decodeURIComponent(b.text):decodeURIComponent(b.textContent),
this._text._isLocked=void 0!=b.getAttribute("locked"));a=findElementByTagName(a,"text");void 0!=a&&this._text.readXML(a);this.updateSize()};JSG.graph.model.TextNode.prototype.readAttributesXML=function(a){JSG.graph.model.TextNode._super.readAttributesXML.call(this,a);a=this.getItemAttributes();if(!(a instanceof JSG.graph.attr.TextNodeAttributes)){var b=new JSG.graph.attr.TextNodeAttributes;b.applyLegacyAttributes(a);this.addAttribute(b)}};JSG.graph.model.TextNode.prototype.getLines=function(){return this._lines};
JSG.graph.model.TextNode.prototype.getText=function(){return this._text};
JSG.graph.model.TextNode.prototype.setText=function(a){var b=!1;if(a instanceof JSG.graph.expr.Expression)b=this._text.setExpressionOrValue(a);else if(void 0!=a){a:{b=this._text.getTerm();if(void 0!=b&&(b=b.getOperand(),void 0!=b&&b.type===JSG.graph.expr.Operand.REFERENCE)){b=b.value._attribute;break a}b=void 0}void 0!=b?(b.setExpressionOrValue(a),b=!0):b=this._text.setExpressionOrValue(a)}b&&(this.refresh(),a=this.getGraph(),void 0!=a&&a.markDirty())};
JSG.graph.model.TextNode.prototype.updateSize=function(){if(void 0!=this._text){var a=JSG.graphics,b=this._getTextFormat();a.setFontName(b.getFontName().getValue());a.setFontSize(b.getFontSize().getValue());a.setFontStyle(b.getFontStyle().getValue());a.setFont();this._lines=[];b=this.getItemAttributes();(b.getSizeMode?b.getSizeMode().getValue():-1)==JSG.graph.attr.TextNodeAttributes.SizeMode.WIDTH?this._updateSizeWrapText(a):this._updateSizeText(a)}};
JSG.graph.model.TextNode.prototype._updateSizeText=function(a){for(var b=this._text.getValue().toString().split("\n"),c=0,d=this.getFontMetrics(),e=this.getItemAttributes(),f=0,g=b.length;f<g;f++){var l=b[f].replace(/&nbsp;/g," "),h=a.measureText(l),c=Math.max(a.getCoordinateSystem().deviceToLogXNoZoom(h.width),c);this._lines.push(l)}c+=e.getLeftMargin().getValue()+e.getRightMargin().getValue();a=d.height*b.length+e.getTopMargin().getValue()+e.getBottomMargin().getValue();this._size.isEqualTo(c,a)||
(this.setSize(c,a),this.getParent()&&this.getParent().updateLabelPositions())};
JSG.graph.model.TextNode.prototype._updateSizeWrapText=function(a){for(var b=this._text.getValue().toString().split("\n"),c=0,d=this.getFontMetrics(),e=this.getItemAttributes(),f=e.getLeftMargin().getValue()+e.getRightMargin().getValue(),g=this.getSize().getWidth().getValue()-f,l=0,h=b.length;l<h;l++){var m=b[l].replace(/&nbsp;/g," "),c=a.measureText(m),c=a.getCoordinateSystem().deviceToLogXNoZoom(c.width);1E-4<c-g?(m=this._splitLine(m,a,g),this._lines.addAll(m)):this._lines.push(m)}g+=f;a=d.height*
this._lines.length+e.getTopMargin().getValue()+e.getBottomMargin().getValue();this._size.isEqualTo(g,a)||(this.setSize(g,a),this.getParent()&&this.getParent().updateLabelPositions())};
JSG.graph.model.TextNode.prototype._splitLine=function(a,b,c){var d=[],e="",f=-1;a=a.split("");for(var g=0;g<a.length;g++){var l=a[g],e=e+l;" "==l&&(f=e.length-1);b.getCoordinateSystem().deviceToLogXNoZoom(b.measureText(e).width)>c&&(-1<f?(d.push(e.substring(0,f+1)),e=e.substring(f+1,g+1),f=-1):(e=e.substring(0,e.length-1),d.push(e),e=l))}d.push(e);return d};
JSG.graph.model.TextNode.prototype.getTextSize=function(a){var b=document.createElement("canvas"),b=new JSG.ui.graphics.ScalableGraphics(b,a),c=new JSG.geometry.Point(0,0);this._getTextFormat().applyToGraphics(b);b.setFont();for(var d=this._lines,e=this.getFontMetrics(),f=0,g=d.length;f<g;f++){var l=d[f].replace(/&nbsp;/g," "),l=b.measureText(l);c.x=Math.max(l.width,c.x)}c.y=a.logToDeviceX(e.height*d.length);return c};
JSG.graph.model.TextNode.prototype.invalidateFontMetrics=function(){this._metrics=void 0};JSG.graph.model.TextNode.prototype.getFontMetrics=function(){return void 0!=this._metrics?this._metrics:this._metrics=JSG.graph.Utils.getFontMetrics(this._getTextFormat())};JSG.graph.model.TextNode.prototype.getTextAlign=function(){switch(this._getTextFormat().getHorizontalAlignment().getValue()){case JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER:return"center";case JSG.graph.attr.TextFormatAttributes.TextAlignment.RIGHT:return"right"}return"left"};
JSG.graph.model.TextNode.prototype.evaluate=function(){JSG.graph.model.TextNode._super.evaluate.call(this);this._getTextFormat().evaluate(this);this._text.evaluate(this);this.invalidateFontMetrics()};
JSG.graph.model.TextNode.prototype.sendPostEvent=function(a){if(a.id===JSG.graph.model.events.Event.ATTRIBUTE&&a.isCategory(JSG.graph.attr.TextFormatAttributes.NAME)){var b=JSG.graph.attr.TextFormatAttributes;a.hasAttribute(b.FONTSIZE,b.FONTSTYLE,b.FONTNAME)?(this.invalidateFontMetrics(),this.updateSize()):a.hasAttribute(b.VERTICALPOSITION,b.HORIZONTALPOSITION)&&this.getParent()&&this.getParent().updateLabelPositions()}JSG.graph.model.TextNode._super.sendPostEvent.call(this,a)};
JSG.graph.model.TextNode.prototype._doRefresh=function(a){JSG.graph.model.TextNode._super._doRefresh.call(this,a);this.updateSize()};JSG.namespace("JSG.graph.model");JSG.graph.model.AttributedTextNode=function(a){JSG.graph.model.AttributedTextNode._super.constructor.call(this);this._text=a||new JSG.graph.expr.AttributeExpression;this._text.setConstraint(new JSG.graph.expr.StringExpressionConstraint)};JSG.extend(JSG.graph.model.AttributedTextNode,JSG.graph.model.TextNode);
JSG.graph.model.AttributedTextNode.TYPE="attributedtext";JSG.graph.model.AttributedTextNode.prototype.newInstance=function(){return new JSG.graph.model.AttributedTextNode};JSG.graph.model.AttributedTextNode.prototype._copy=function(a,b,c){var d=this.getAttributeExpression().copy();a=JSG.graph.model.TextNode._super._copy.call(this,a,b,c);a._text=d;return a};
JSG.graph.model.AttributedTextNode.prototype.evaluate=function(){JSG.graph.model.AttributedTextNode._super.evaluate.call(this);void 0==this._getReferencedAttribute(this._text.getTerm())&&this._text.setTerm(void 0)};JSG.graph.model.AttributedTextNode.prototype.getAttributeExpression=function(){return this._text};JSG.graph.model.AttributedTextNode.prototype.getText=function(){var a=this._getReferencedAttribute(this._text.getTerm());return void 0!=a?a.getExpression():new JSG.graph.expr.StringExpression("")};
JSG.graph.model.AttributedTextNode.prototype._getReferencedAttribute=function(a){if(void 0!=a&&(a=a.getOperand(),void 0!=a&&a.type===JSG.graph.expr.Operand.REFERENCE))return a.value._attribute};JSG.graph.model.AttributedTextNode.prototype.setAttributeExpression=function(a){this._text.setTo(a)};
JSG.graph.model.AttributedTextNode.prototype.setText=function(a){var b=this._getReferencedAttribute(this._text.getTerm());void 0!=b?b.setExpressionOrValue(a)&&(this.refresh(),a=this.getGraph(),void 0!=a&&a.markDirty()):JSG.graph.model.AttributedTextNode._super.setText.call(this,a)};JSG.graph.model.AttributedTextNode.prototype.saveXMLContent=function(a,b){JSG.graph.model.AttributedTextNode._super.saveXMLContent.call(this,a,b);a.writeAttributeString("type",JSG.graph.model.AttributedTextNode.TYPE)};
JSG.namespace("JSG.graph.model");JSG.graph.model.LineConnection=function(a){JSG.graph.model.LineConnection._super.constructor.apply(this,arguments);this.setShapeTo(void 0!==a?a:new JSG.graph.model.shapes.LineShape);this.addAttribute(new JSG.graph.attr.EdgeAttributes);this._pin.setLocalCoordinateTo(JSG.graph.Coordinate.fromXY(0,0));this._pin.lockLocalPin(!0);this.targetNode=this.sourceNode=void 0};JSG.extend(JSG.graph.model.LineConnection,JSG.graph.model.GraphItem);
JSG.graph.model.LineConnection.prototype.newInstance=function(){return new JSG.graph.model.LineConnection};JSG.graph.model.LineConnection.prototype.hasTargetNode=function(){return void 0!=this.targetNode};JSG.graph.model.LineConnection.prototype.hasSourceNode=function(){return void 0!=this.sourceNode};JSG.graph.model.LineConnection.prototype.getSourceNode=function(){return this.sourceNode};JSG.graph.model.LineConnection.prototype.getTargetNode=function(){return this.targetNode};
JSG.graph.model.LineConnection.prototype.getRotationPoint=function(){return this.getStartPoint().copy()};JSG.graph.model.LineConnection.prototype.setAngle=function(a){if(!this.getAngle().isEqualToExpressionOrValue(a)){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.ANGLE,a);b.source=this;this.sendPreEvent(b);!0===b.doIt&&(this._setAngle(a,this.getRotationPoint()),this.sendPostEvent(b))}};
JSG.graph.model.LineConnection.prototype._setAngle=function(a,b){var c=this._angle.getValue();this._angle.setExpressionOrValue(a);var d=this._angle.getValue(),e=this.getPinPoint();JSG.geometry.Utils.rotatePointAround(b,e,d-c);this.setPinPointTo(e)};JSG.graph.model.LineConnection.prototype.rotate=function(a,b){if(0!=a){var c=this.getAngle().getValue()+a;b=void 0!=b?b:this.getPinPoint();this._setAngle(c,b)}};
JSG.graph.model.LineConnection.prototype.addLabel=function(a,b){var c=JSG.graph.model.LineConnection._super.addLabel.call(this,a,b);c.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.SOLID);c.getTextFormat().setFontSize(8);c.evaluate();c.updateSize();return c};JSG.graph.model.LineConnection.prototype.getEndCoordinate=function(){return this._shape.getEndCoordinate()};JSG.graph.model.LineConnection.prototype.getStartCoordinate=function(){return this._shape.getStartCoordinate()};
JSG.graph.model.LineConnection.prototype.getCoordinateAt=function(a){return this._shape.getCoordinateAt(a)};JSG.graph.model.LineConnection.prototype.getEndPoint=function(a){var b=this._shape.getCoordinatesCount()-1;return this.getPointAt(b,a)};JSG.graph.model.LineConnection.prototype.getStartPoint=function(a){return this.getPointAt(0,a)};JSG.graph.model.LineConnection.prototype.getPointAt=function(a,b){var c=this._shape.getCoordinateAt(a);if(void 0!=c)return c=c.toPoint(b),this.translateToParent(c)};
JSG.graph.model.LineConnection.prototype.getPoints=function(a){a=void 0!=a?a:[];var b=JSG.ptCache.get(),c=this.getOrigin(b),d=this._angle.getValue(),e=this._shape.getPoints();a.keep(e.length,JSG.geometry.Point.Factory);for(var f=0;f<e.length;f++)a[f].setTo(e[f]),JSG.geometry.Utils.rotatePoint(a[f],d),a[f].add(c);JSG.ptCache.release(b);return a};JSG.graph.model.LineConnection.prototype.getPointsCount=function(){return this._shape.getCoordinatesCount()};
JSG.graph.model.LineConnection.prototype.setEndCoordinateTo=function(a){this._shape.setEndCoordinateTo(a)};JSG.graph.model.LineConnection.prototype.setEndCoordinate=function(a,b){this._shape.setEndCoordinate(a,b)};JSG.graph.model.LineConnection.prototype.setStartCoordinateTo=function(a){this._shape.setStartCoordinateTo(a)};JSG.graph.model.LineConnection.prototype.setStartCoordinate=function(a,b){this._shape.setStartCoordinate(a,b)};
JSG.graph.model.LineConnection.prototype.setEndPointTo=function(a){this.setPointAt(this._shape.getCoordinatesCount()-1,a)};JSG.graph.model.LineConnection.prototype.setStartPointTo=function(a){this.setPointAt(0,a)};JSG.graph.model.LineConnection.prototype.setPointAt=function(a,b){this.translateFromParent(b);this._shape.setCoordinateAtToPoint(a,b)};
JSG.graph.model.LineConnection.prototype.setPoints=function(a){var b=new JSG.graph.model.events.ShapeEvent(JSG.graph.model.events.ShapeEvent.REPLACEPOINTS,a);b.source=this;this.sendPreEvent(b);if(!0===b.doIt){var c=this._shape,d=new JSG.geometry.Point(0,0);c.keepCoordinates(a.length);for(var e=c._coordinates,f=0;f<a.length;f++)d.setTo(a[f]),self.translateFromParent(d),e[f].set(d.x,d.y);c.refresh();this.sendPostEvent(b)}};
JSG.graph.model.LineConnection.prototype.insertPointsAt=function(a){for(var b=arguments,c=[],d=2==b.length&&Array.isArray(b[1])?0:1,b=0===d?b[1]:b;d<b.length;d++)c.push(JSG.graph.Coordinate.fromPoint(this.translateFromParent(b[d].copy())));this._shape.insertCoordinatesAt(a,c)};
JSG.graph.model.LineConnection.prototype.insertPointsAtIndexes=function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(JSG.graph.Coordinate.fromPoint(this.translateFromParent(b[d].copy())));this._shape.insertCoordinatesAtIndexes(a,c)};JSG.graph.model.LineConnection.prototype.removePointsAt=function(a,b){this._shape.removeCoordinatesAt(a,b)};JSG.graph.model.LineConnection.prototype.init=function(a,b){void 0!=a&&this.setStartPointTo(a);void 0!=b&&this.setEndPointTo(b);this._shape.init()};
JSG.graph.model.LineConnection.prototype.setBoundingBoxTo=function(a){JSG.debug.log("LineConnection.setBoundingBoxTo called!")};JSG.graph.model.LineConnection.prototype.getTotalBoundingRect=function(a,b){var c=void 0!=a?a:this._parent,d=this.getPoints(),e=JSG.boxCache.get();e.setAngle(-this.getParent().getAngle().getValue());e.setTopLeftTo(d[0]);e.enclosePoints(d);JSG.graph.Utils.translateBoundingBoxUp(e,this.getParent(),c);c=e.toRectangle(b);JSG.boxCache.release(e);return c};
JSG.graph.model.LineConnection.prototype.getSize=function(){if(2==this._shape.getCoordinates().length){var a=this.getEndPoint(),b=this.getStartPoint(),a=JSG.geometry.Utils.getLineLength(b,a);this._size.set(a,a)}else a=this.getBoundingBox(),this._size.set(a.getWidth(),a.getHeight());return this._size};JSG.graph.model.LineConnection.prototype.containsPoint=function(a,b,c){return-1!=this.getLineSegmentAtPoint(a,c)};
JSG.graph.model.LineConnection.prototype.getLineSegmentAtPoint=function(a,b){var c=-1;if(void 0!=a){var d=JSG.boxCache.get(),e=this.getBoundingBox(d);e.expandBy(b);e.containsPoint(a)&&(c=a.copy(),c=this._shape.getLineSegmentAtPoint(this.translateFromParent(c),b));JSG.boxCache.release(d)}return c};
JSG.graph.model.LineConnection.prototype._doRefresh=function(a){this._shape.refresh();if(this._update()||!0===a){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.ALL);b.source=this;this.sendPostEvent(b)}for(var b=0,c=this._subItems.length;b<c;b++)this._subItems[b].refresh(a)};
JSG.graph.model.LineConnection.prototype._updateBoundingBox=function(){var a=JSG.ptCache.get(),b=JSG.boxCache.get().setTo(this._bboxcache);this._shape.getPointList().getBoundingBox(this._bboxcache);this._bboxcache.setTopLeftTo(this.translateToParent(this._bboxcache.getTopLeft(a)));this._bboxcache.setAngle(this._angle.getValue());JSG.ptCache.release(a);JSG.boxCache.release(b);return!b.isEqualTo(this._bboxcache,0.1)};
JSG.graph.model.LineConnection.prototype.updateLabelPositions=function(){if(!(2>this._shape.getCoordinatesCount()))for(var a=new JSG.geometry.Point(0,0),b=0,c=this._subItems.length;b<c;b++){var d=this._subItems[b];if(d instanceof JSG.graph.model.TextNode){var e=d.getBoundingBox().getBoundingRectangle(),f=d._getTextFormat().getVerticalPosition().getValue();a.set(d.getPin().getX(),d.getPin().getY());(a=this.getLabelPositionAt(void 0,f,e,a))&&d.setPinPointTo(a)}}};
JSG.graph.model.LineConnection.prototype.getLabelPositionAt=function(a,b,c,d){a=void 0!=d?d:new JSG.geometry.Point(0,0);var e=this.getFormat().getLineArrowEnd().getValue()!=JSG.graph.attr.FormatAttributes.ArrowStyle.NONE,f=this.getFormat().getLineArrowStart().getValue()!=JSG.graph.attr.FormatAttributes.ArrowStyle.NONE;d=this._shape.getVisiblePoints();var g=JSG.graph.attr.TextFormatAttributes.VerticalTextPosition;if(0!=d.length){switch(b){case g.BEFORESTART:start=d[0];end=d[1];result=this._getTextLineIntersection(start,
end,start,!1,c);a.set(start.x-result.x,start.y-result.y);break;case g.START:start=d[0];end=d[1];result=this._getTextLineIntersection(start,end,start,f,c);a.set(start.x+result.x,start.y+result.y);break;case g.CENTER:b=[];for(f=e=c=0;f<d.length-1;f++)b.push(JSG.geometry.Utils.getLineLength(d[f],d[f+1])),c+=b[f];for(f=0;f<b.length-1&&!(e+=b[f],e>=c/2);f++);if(f>=d.length-1)break;start=d[f];end=d[f+1];a.set((end.x+start.x)/2,(end.y+start.y)/2);break;case g.END:start=d[d.length-2];end=d[d.length-1];result=
this._getTextLineIntersection(start,end,end,e,c);a.set(end.x+result.x,end.y+result.y);break;case g.BEHINDEND:start=d[d.length-2],end=d[d.length-1],result=this._getTextLineIntersection(start,end,end,!1,c),a.set(end.x-result.x,end.y-result.y)}return a}};
JSG.graph.model.LineConnection.prototype._getTextLineIntersection=function(a,b,c,d,e){var f=e.height,g=e.width;e=new JSG.geometry.Point(0,0);d=d?400:200;c=JSG.rectCache.get().set(c.x-g/2-d,c.y-f/2-d,g+2*d,f+2*d);f=c.getPoints();d=0;for(g=f.length;d<g;d++)if(d==g-1){if(JSG.geometry.Utils.getIntersectionOfLines(f[d],f[0],a,b,e,!1)){e.translate(-c.getCenterX(),-c.getCenterY());break}}else if(JSG.geometry.Utils.getIntersectionOfLines(f[d],f[d+1],a,b,e,!1)){e.translate(-c.getCenterX(),-c.getCenterY());
break}JSG.rectCache.release(c);return e};JSG.namespace("JSG.graph.model");JSG.graph.model.Edge=function(a){JSG.graph.model.Edge._super.constructor.apply(this,arguments);this.targetPortId=this.sourcePortId=this.targetPort=this.sourcePort=void 0};JSG.extend(JSG.graph.model.Edge,JSG.graph.model.LineConnection);JSG.graph.model.Edge.prototype.newInstance=function(){return new JSG.graph.model.Edge};
JSG.graph.model.Edge.prototype.saveXMLContent=function(a,b){JSG.graph.model.Edge._super.saveXMLContent.call(this,a,b);a.writeAttributeString("type","edge");this.getStartCoordinate().saveXML("start",a);this.getEndCoordinate().saveXML("end",a);if(void 0!=this.sourcePort||void 0!=this.targetPort)a.writeStartElement("connection"),void 0!=this.sourcePort&&(this.sourcePort.isMapper?(a.writeAttributeString("sourceid",this.sourcePort.getMappedItemPortId(this.getId())),a.writeAttributeString("srcmp",this.sourcePort.getId())):
a.writeAttributeString("sourceid",this.sourcePort.getId())),void 0!=this.targetPort&&(this.targetPort.isMapper?(a.writeAttributeString("targetid",this.targetPort.getMappedItemPortId(this.getId())),a.writeAttributeString("trgtmp",this.targetPort.getId())):a.writeAttributeString("targetid",this.targetPort.getId())),a.writeEndElement()};
JSG.graph.model.Edge.prototype.readXML=function(a){function b(a,b,c){b=Number(a.getAttribute(b));a=Number(a.getAttribute(c));return void 0!=a&&0!=a?a:void 0!=b&&0!=b?b:void 0}JSG.graph.model.Edge._super.readXML.call(this,a);void 0!=JSG.connectionRestorer&&JSG.connectionRestorer.edges.push(this);var c=findElementByTagName(a,"start");this.getStartCoordinate().readXML(c);c=findElementByTagName(a,"end");this.getEndCoordinate().readXML(c);c=findElementByTagName(a,"connection");void 0!=c&&(this.sourcePortId=
b(c,"sourceid","srcmp"),this.targetPortId=b(c,"targetid","trgtmp"))};JSG.graph.model.Edge.prototype._restoreConnections=function(a){var b=this.getShape();b.disableRefresh();if(void 0!=this.sourcePortId){var c=a.getPortById(this.sourcePortId);void 0!=c&&this.setSourcePort(c)}void 0!=this.targetPortId&&(c=a.getPortById(this.targetPortId),void 0!=c&&this.setTargetPort(c));b.enableRefresh();JSG.graph.model.Edge._super._restoreConnections.call(this,a)};JSG.graph.model.Edge.prototype.getSourcePort=function(){return this.sourcePort};
JSG.graph.model.Edge.prototype.hasSourceAttached=function(){return void 0!=this.sourcePortId||void 0!=this.sourcePort};JSG.graph.model.Edge.prototype.getTargetPort=function(){return this.targetPort};JSG.graph.model.Edge.prototype.hasTargetAttached=function(){return void 0!=this.targetPortId||void 0!=this.targetPort};
JSG.graph.model.Edge.prototype.setSourcePort=function(a){if(a!==this.sourcePort){var b=this._createAttachOrDetachEvent(a,this.sourcePort);this.sendPreEvent(b);!0===b.doIt&&(this.sourcePort=this._registerPort(a,this.sourcePort,"sourceNode"),void 0!=this.sourcePort?(this.sourcePortId=this.sourcePort.getId(),this.sourcePort.addEdge(this),this.setStartCoordinateTo(this._createCoordinateFromPort(a,this.getStartCoordinate()))):(this.sourcePortId=void 0,this._replaceCoordinateProxy(this.getStartCoordinate(),
this.setStartCoordinateTo)),this.sendPostEvent(b))}};
JSG.graph.model.Edge.prototype.setTargetPort=function(a){if(a!==this.targetPort){var b=this._createAttachOrDetachEvent(a,this.targetPort);this.sendPreEvent(b);!0===b.doIt&&(this.targetPort=this._registerPort(a,this.targetPort,"targetNode"),void 0!=this.targetPort?(this.targetPortId=this.targetPort.getId(),this.targetPort.addEdge(this),this.setEndCoordinateTo(this._createCoordinateFromPort(a,this.getEndCoordinate()))):(this.targetPortId=void 0,this._replaceCoordinateProxy(this.getEndCoordinate(),this.setEndCoordinateTo)),
this.sendPostEvent(b))}};JSG.graph.model.Edge.prototype._createAttachOrDetachEvent=function(a,b){var c=void 0!=a?new JSG.graph.model.events.Event(JSG.graph.model.events.Event.EDGEATTACHED,a):new JSG.graph.model.events.Event(JSG.graph.model.events.Event.EDGEDETACHED,b);c.source=this;return c};JSG.graph.model.Edge.prototype._registerPort=function(a,b,c){void 0!=b&&b.removeEdge(this);this[c]=void 0!=a?a.getParent():void 0;return a};
JSG.graph.model.Edge.prototype._createCoordinateFromPort=function(a,b){function c(a,b){var c=a.getConnectionCoordinate(),c=new JSG.graph.CoordinateProxy(c);c.evaluate=function(b){this._coordinate.evaluate(a)};c.setX=function(a){};c.setY=function(a){};c.copy=function(){var a=new JSG.graph.Coordinate;a.setToPoint(this.toPoint());return a};c.toPoint=function(c){var d=this._coordinate.toPoint(c);c=void 0!=b.getParent()?b.getParent():a.getGraph();JSG.graph.Utils.traverseItemUp(a,c,function(a){a.translateToParent(d)});
b.translateFromParent(d);return d};return c}var d=void 0;if(void 0==a){var e=b.toPoint(new JSG.geometry.Point(0,0)),d=JSG.graph.Coordinate.fromXY(0,0);d.set(e.x,e.y)}else d=c(a,this);return d};JSG.graph.model.Edge.prototype._replaceCoordinateProxy=function(a,b){if(a instanceof JSG.graph.CoordinateProxy){var c=a.toPoint(),c=new JSG.graph.Coordinate.fromPoint(c);b.call(this,c)}};
JSG.graph.model.Edge.prototype.setPoints=function(a){var b=this._shape,c=b.getCoordinatesCount()-1;b.disableNotification();var c=this.hasTargetAttached()?b.removeCoordinateAt(c):void 0,d=this.hasSourceAttached()?b.removeCoordinateAt(0):void 0;b.keepCoordinates(a.length);var e=new JSG.graph.model.events.ShapeEvent(JSG.graph.model.events.ShapeEvent.REPLACEPOINTS,a);e.source=this;this.sendPreEvent(e);if(!0===e.doIt){this.getOrigin();for(var f=new JSG.geometry.Point(0,0),g=0;g<a.length;g++)f.setTo(a[g]),
this.translateFromParent(f),b._coordinates[g].set(f.x,f.y);b.refresh();this.sendPostEvent(e)}void 0!=c&&b.setEndCoordinateTo(c);void 0!=d&&b.setStartCoordinateTo(d);b.enableNotification()};
JSG.graph.model.Edge.prototype.setShapeTo=function(a){var b=new JSG.graph.model.events.Event(JSG.graph.model.events.Event.SHAPE,a);b.source=this;this.sendPreEvent(b);if(!0===b.doIt){var c=void 0,d=void 0;if(void 0!=this._shape){var e=this._shape.getCoordinates();this.hasSourceAttached()&&(c=e.removeAt(0));this.hasTargetAttached()&&(d=e.removeAt(e.length-1));this._shape.setItem(void 0)}this._shape=a;this._shape.setItem(this);e=this._shape.getCoordinates();void 0!=c&&(e[0]=c);void 0!=d&&(e[e.length-
1]=d);this._shape.evaluate();this._shape.refresh();this.sendPostEvent(b)}};JSG.graph.model.Edge.prototype.detachPort=function(a){void 0!=a&&(a===this.sourcePort?this.setSourcePort(void 0):a===this.targetPort&&this.setTargetPort(void 0))};JSG.namespace("JSG.graph.model");JSG.graph.model.GraphItemFactory=function(){};
JSG.graph.model.GraphItemFactory.prototype.createItemFromString=function(a){function b(a,b){var c=new JSG.graph.model.shapes.PolygonShape,d=new JSG.graph.model.Node(c);if(b){var e=new JSG.graph.ReshapeCoordinate(c._newExpression(0.5),c._newExpression(0.3),0.5,0.5,0,0.5,"DEPTH",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);d._reshapeCoordinates.push(e)}for(e=0;e<a;e++){var g=Math.round(100*Math.sin(2*Math.PI/a*e-Math.PI/2))/100,p=Math.round(100*Math.cos(2*Math.PI/a*e-Math.PI/2))/100,s=Math.round(100*
Math.sin(2*Math.PI/a*(e+0.5)-Math.PI/2))/100,u=Math.round(100*Math.cos(2*Math.PI/a*(e+0.5)-Math.PI/2))/100;c._coordinates.push(new JSG.graph.Coordinate(c._newExpression(0,"WIDTH / 2 * "+(1+p)),c._newExpression(0,"HEIGHT / 2 * "+(1+g))));b&&c._coordinates.push(new JSG.graph.Coordinate(c._newExpression(0,"WIDTH / 2 + WIDTH / 2 * "+u+" * (1 - DEPTH * 2)"),c._newExpression(0,"HEIGHT / 2 + HEIGHT / 2 * "+s+" * (1 - DEPTH * 2)")))}b&&d._reshapeProperties.addIndexProperty("DEPTH",f.getReshapePointY,f.setReshapePointY,
0);return d}function c(a){a.getPin().setLocalCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH * 0.5"),new JSG.graph.expr.NumberExpression(0,"HEIGHT * 0.5"))}var d=JSG.graph.attr.consts,e=JSG.graph.attr.ItemAttributes,f=JSG.graph.properties.GraphItemProperties,g=JSG.graph.model.shapes.OrthoLineBehavior.AUTO;switch(a){case "node":return new JSG.graph.model.Node;case "containernode":return new JSG.graph.model.ContainerNode;case "edge":return new JSG.graph.model.Edge;case "edgeArrow":return a=
new JSG.graph.model.Edge,a.getFormat().setLineArrowEnd(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a.getFormat().setFillColor("#000000"),a;case "edgeDoubleArrow":return a=new JSG.graph.model.Edge,a.getFormat().setLineArrowStart(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a.getFormat().setLineArrowEnd(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a.getFormat().setFillColor("#000000"),a;case "orthogonalEdge":return a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),
a.getLayoutAttributes().setLineBehavior(g),a;case "orthogonalEdgeArrow":return a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),a.getLayoutAttributes().setLineBehavior(g),a.getFormat().setLineArrowEnd(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a.getFormat().setFillColor("#000000"),a;case "orthogonalEdgeDoubleArrow":return a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),a.getLayoutAttributes().setLineBehavior(g),a.getFormat().setLineArrowStart(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),
a.getFormat().setLineArrowEnd(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a.getFormat().setFillColor("#000000"),a;case "orthogonalRoundedEdge":return a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),a.getLayoutAttributes().setLineBehavior(g),a.getFormat().setLineCorner(150),a;case "orthogonalRoundedEdgeArrow":return a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),a.getLayoutAttributes().setLineBehavior(g),a.getFormat().setFillColor("#000000"),
a.getFormat().setLineCorner(150),a.getFormat().setLineArrowEnd(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a;case "orthogonalRoundedEdgeDoubleArrow":return a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),a.getLayoutAttributes().setLineBehavior(g),a.getFormat().setFillColor("#000000"),a.getFormat().setLineCorner(150),a.getFormat().setLineArrowEnd(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a.getFormat().setLineArrowStart(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),
a;case "orthogonalRoundedEdgeArrowDash":return a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),a.getLayoutAttributes().setLineBehavior(g),a.getFormat().setLineCorner(150),a.getFormat().setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.DASH),a.getFormat().setLineArrowEnd(JSG.graph.attr.FormatAttributes.ArrowStyle.ARROWFILLED),a;case "graph":return new JSG.graph.model.Graph;case "port":return new JSG.graph.model.Port;case JSG.graph.model.PortMapper.TYPE:return new JSG.graph.model.PortMapper;
case "text":return new JSG.graph.model.TextNode;case JSG.graph.model.AttributedTextNode.TYPE:return new JSG.graph.model.AttributedTextNode;default:return function(a){switch(a){case "rect":var h=new JSG.graph.model.shapes.RectangleShape,g=new JSG.graph.model.Node(h);break;case "roundRect":case "roundRectCornerCut":case "roundRectCornerCutSame":case "roundRectCornerCutDiagonal":var h=new JSG.graph.model.shapes.BezierShape,g=new JSG.graph.model.Node(h),k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.1),
h._newExpression(0),0,0.5,0,0,"ROUND",JSG.graph.ReshapeType.XRELATIVETOHEIGHTFROMRIGHT,!1);g._reshapeCoordinates.push(k);"roundRectCornerCutSame"==a?(k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(1),0,0.5,1,1,"ROUND2",JSG.graph.ReshapeType.XRELATIVETOHEIGHT,!1),g._reshapeCoordinates.push(k)):"roundRectCornerCutDiagonal"==a&&(k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0),0,0.5,0,0,"ROUND2",JSG.graph.ReshapeType.XRELATIVETOHEIGHT,!1),g._reshapeCoordinates.push(k));
k="ROUND";"roundRectCornerCutDiagonal"==a&&(k="ROUND2");"roundRectCornerCut"==a?(h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * 0.2"))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.2"),h._newExpression(0)))):(h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * "+k+" * 0.45"),h._newExpression(0))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH * "+k),h._newExpression(0))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.4"),h._newExpression(0))));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.6"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * (1 - ROUND)"),h._newExpression(0)));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * (1 - ROUND * 0.45)"),h._newExpression(0)));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH"),h._newExpression(0,"WIDTH * ROUND * 0.45")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"WIDTH * ROUND")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * 0.4")));k="ROUND";if("roundRectCornerCutSame"==a||"roundRectCornerCutDiagonal"==a)k="ROUND2";"roundRectCornerCut"==a?(h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * 0.8"))),
h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT"))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.8"),h._newExpression(0,"HEIGHT")))):(h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * 0.6"))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - "+k+" * WIDTH"))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH"),h._newExpression(0,"HEIGHT - WIDTH * "+k+" * 0.45"))),h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - WIDTH * "+k+" * 0.45"),h._newExpression(0,"HEIGHT"))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - WIDTH * "+k),h._newExpression(0,"HEIGHT"))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.6"),h._newExpression(0,"HEIGHT"))));k="ROUND";"roundRectCornerCutSame"==a&&(k="ROUND2");"roundRectCornerCut"==
a?(h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.2"),h._newExpression(0,"HEIGHT"))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT"))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * 0.8")))):(h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.4"),h._newExpression(0,"HEIGHT"))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH * "+k),h._newExpression(0,"HEIGHT"))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * "+k+" * 0.45"),h._newExpression(0,"HEIGHT"))),h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT - WIDTH * "+k+" * 0.45"))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT - WIDTH * "+k))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * 0.6"))));
k="ROUND";"roundRectCornerCutDiagonal"==a&&(k="ROUND2");"roundRectCornerCut"!=a&&(h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * 0.4"))),h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"WIDTH * "+k))),h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"WIDTH * "+k+" * 0.45"))));g._reshapeProperties.addIndexProperty("ROUND",f.getReshapePointX,f.setReshapePointX,0);"roundRectCornerCutSame"!=
a&&"roundRectCornerCutDiagonal"!=a||g._reshapeProperties.addIndexProperty("ROUND2",f.getReshapePointX,f.setReshapePointX,1);break;case "rectCornerCut":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.1),h._newExpression(0),0,1,0,0,"CUT",JSG.graph.ReshapeType.XRELATIVETOHEIGHTFROMRIGHT,!1);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),
h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * CUT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * CUT"),h._newExpression(0)));g._reshapeProperties.addIndexProperty("CUT",f.getReshapePointX,f.setReshapePointX,0);break;case "rectCornerCutSame":h=new JSG.graph.model.shapes.PolygonShape;
g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.1),h._newExpression(0),0,0.5,0,0,"CUTTOP",JSG.graph.ReshapeType.XRELATIVETOHEIGHT,!1);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(1),0,0.5,1,1,"CUTBOTTOM",JSG.graph.ReshapeType.XRELATIVETOHEIGHT,!1);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"HEIGHT * CUTTOP"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),
h._newExpression(0,"HEIGHT * CUTTOP")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * (1 - CUTBOTTOM)")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"HEIGHT * CUTBOTTOM"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * CUTBOTTOM"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * (1 - CUTBOTTOM)")));
h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * CUTTOP")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * CUTTOP"),h._newExpression(0)));g._reshapeProperties.addIndexProperty("CUTTOP",f.getReshapePointX,f.setReshapePointX,0);g._reshapeProperties.addIndexProperty("CUTBOTTOM",f.getReshapePointX,f.setReshapePointX,1);break;case "rectCornerCutDiagonal":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);
k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.1),h._newExpression(0),0,0.5,0,0,"CUTLTRB",JSG.graph.ReshapeType.XRELATIVETOHEIGHT,!1);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0),0,0.5,0,0,"CUTRTLB",JSG.graph.ReshapeType.XRELATIVETOHEIGHTFROMRIGHT,!1);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"HEIGHT * CUTLTRB"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),
h._newExpression(0,"HEIGHT * CUTLTRB")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * (1 - CUTRTLB)")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"HEIGHT * CUTRTLB"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * CUTLTRB"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * (1 - CUTLTRB)")));
h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * CUTRTLB")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * CUTRTLB"),h._newExpression(0)));g._reshapeProperties.addIndexProperty("CUTLTRB",f.getReshapePointX,f.setReshapePointX,0);g._reshapeProperties.addIndexProperty("CUTRTLB",f.getReshapePointX,f.setReshapePointX,1);break;case "cylinder":h=new JSG.graph.model.shapes.RectangleShape;g=new JSG.graph.model.Node(h);
k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.5),h._newExpression(0.2),0.5,0.5,0,1,"TOPHEIGHT",JSG.graph.ReshapeType.YRELATIVETOWIDTH,!0);g._reshapeCoordinates.push(k);g.getFormat().setFillColor("#0088DD");g.setItemAttribute(e.SELECTIONMODE,d.SelectionMode.AREA|d.SelectionMode.SELECTPARENT);g.setItemAttribute(e.EDITMASK,d.EditMask.COORDINATES);a=new JSG.graph.model.shapes.BezierShape;var n=new JSG.graph.model.Node(a);n.getFormat().setFillColor(new JSG.graph.expr.StringExpression("#FFFFFF",
"Parent!FILLCOLOR"));n.setItemAttribute(e.SELECTIONMODE,d.SelectionMode.NONE);n.setItemAttribute(e.SIZEABLE,!1);n.setItemAttribute(e.MOVEABLE,d.Direction.NONE);n.setItemAttribute(e.CONTAINER,!1);n.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT - Parent!WIDTH * Parent!TOPHEIGHT / 2"));k=n.getPin();k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH / 2"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT / 2 + Parent!WIDTH * Parent!TOPHEIGHT / 4"));
a._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"WIDTH * Parent!TOPHEIGHT / 4")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0)));a._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0)));a._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT - WIDTH * Parent!TOPHEIGHT / 2")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,
"HEIGHT - WIDTH * Parent!TOPHEIGHT / 2")));a._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT - WIDTH * Parent!TOPHEIGHT / 4")));a._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.225"),h._newExpression(0,"HEIGHT")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT")));a._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.775"),h._newExpression(0,
"HEIGHT")));a._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - WIDTH * Parent!TOPHEIGHT / 4")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - WIDTH * Parent!TOPHEIGHT / 2")));a._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - WIDTH * Parent!TOPHEIGHT / 2")));a._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),
h._newExpression(0)));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));a._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"WIDTH * Parent!TOPHEIGHT / 4")));a._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.775"),h._newExpression(0,"WIDTH * Parent!TOPHEIGHT / 2")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"WIDTH * Parent!TOPHEIGHT / 2")));
a._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.225"),h._newExpression(0,"WIDTH * Parent!TOPHEIGHT / 2")));g.addItem(n);k=new JSG.graph.model.shapes.EllipseShape;a=new JSG.graph.model.Node(k);a.setItemAttribute(e.MOVEABLE,d.Direction.NONE);a.setItemAttribute(e.SIZEABLE,!1);a.setItemAttribute(e.CONTAINER,!1);a.setItemAttribute(e.SELECTIONMODE,d.SelectionMode.NONE);a.getFormat().setFillColor(new JSG.graph.expr.StringExpression("#FFFFFF","Parent!FILLCOLOR"));a.getFormat().setBrightness(40);
a.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH"),new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH * Parent!TOPHEIGHT"));k=a.getPin();k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH / 2"),new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH * Parent!TOPHEIGHT / 2"));g.addItem(a);g.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE);g.getFormat().setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.NONE);g._reshapeProperties.addIndexProperty("TOPHEIGHT",
f.getReshapePointY,f.setReshapePointY,0);break;case "cube":h=new JSG.graph.model.shapes.RectangleShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.8),0,0,0,1,"SIDE",JSG.graph.ReshapeType.YRELATIVETOHEIGHTFROMBOTTOM,!0);g._reshapeCoordinates.push(k);g.getFormat().setFillColor("#0088DD");g.setItemAttribute(e.SELECTIONMODE,d.SelectionMode.AREA|d.SelectionMode.SELECTPARENT);g.setItemAttribute(e.EDITMASK,d.EditMask.COORDINATES);k=new JSG.graph.model.shapes.RectangleShape;
a=new JSG.graph.model.Node(k);a.setItemAttribute(e.MOVEABLE,d.Direction.NONE);a.setItemAttribute(e.SIZEABLE,!1);a.setItemAttribute(e.CONTAINER,!1);a.getFormat().setFillColor(new JSG.graph.expr.StringExpression("#FFFFFF","Parent!FILLCOLOR"));a.getFormat().setBrightness(20);a.setItemAttribute(e.SELECTIONMODE,d.SelectionMode.NONE);a.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!Width - Parent!HEIGHT * (1 - Parent!SIDE)"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * Parent!SIDE"));k=
a.getPin();k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH / 2"),new JSG.graph.expr.NumberExpression(0,"(2 - Parent!SIDE) * Parent!HEIGHT / 2"));g.addItem(a);a=new JSG.graph.model.shapes.PolygonShape;n=new JSG.graph.model.Node(a);n.setItemAttribute(e.SIZEABLE,!1);n.setItemAttribute(e.MOVEABLE,d.Direction.NONE);n.setItemAttribute(e.CONTAINER,!1);n.setItemAttribute(e.SELECTIONMODE,d.SelectionMode.NONE);n.getFormat().setFillColor(new JSG.graph.expr.StringExpression("#FFFFFF","Parent!FILLCOLOR"));
n.getFormat().setBrightness(40);n.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!Width"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * (1 - Parent!SIDE)"));k=n.getPin();k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH / 2"),new JSG.graph.expr.NumberExpression(0,"HEIGHT / 2"));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT"),h._newExpression(0,
"HEIGHT")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"HEIGHT"),h._newExpression(0)));g.addItem(n);a=new JSG.graph.model.shapes.PolygonShape;n=new JSG.graph.model.Node(a);n.getFormat().setFillColor(new JSG.graph.expr.StringExpression("#FFFFFF","Parent!FILLCOLOR"));n.setItemAttribute(e.SIZEABLE,!1);n.setItemAttribute(e.MOVEABLE,d.Direction.NONE);n.setItemAttribute(e.CONTAINER,!1);n.setItemAttribute(e.SELECTIONMODE,
d.SelectionMode.NONE);n.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * (1 - Parent!SIDE)"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT"));k=n.getPin();k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH - WIDTH / 2"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT / 2"));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"WIDTH")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));
a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - WIDTH")));a._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT")));g.addItem(n);g.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE);g.getFormat().setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.NONE);g._reshapeProperties.addIndexProperty("SIDE",f.getReshapePointY,f.setReshapePointY,0);g.addAttribute(new JSG.graph.attr.BooleanAttribute("keepreshapecoordinates",
!0));break;case "bracketSimpleBoth":h=new JSG.graph.model.shapes.RectangleShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.2),0,0,0,0.3,"CURVE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);g.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE);g.getFormat().setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.NONE);g.getItemAttributes().setSelectParentFirst(!0);g.setItemAttribute(e.EDITMASK,
d.EditMask.COORDINATES);g._reshapeProperties.addIndexProperty("CURVE",f.getReshapePointY,f.setReshapePointY,0);"bracketSimpleRight"!=a&&(n=new JSG.graph.model.shapes.BezierShape,h=new JSG.graph.model.Node(n),h.setItemAttribute(e.SIZEABLE,!1),h.setItemAttribute(e.MOVEABLE,d.Direction.NONE),h.setItemAttribute(e.CLOSED,!1),h.setItemAttribute(e.CONTAINER,!1),h.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * Parent!CURVE"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT")),c(h),k=h.getPin(),
k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * Parent!CURVE / 2"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT / 2")),k=n,k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.55"),k._newExpression(0))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),
k._newExpression(0,"WIDTH * 0.55"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"WIDTH * 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT - WIDTH * 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT - WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),
k._newExpression(0,"HEIGHT - WIDTH * 0.55"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.55"),k._newExpression(0,"HEIGHT"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT"))),g.addItem(h));"bracketSimpleLeft"!=a&&(a=new JSG.graph.model.shapes.BezierShape,h=new JSG.graph.model.Node(a),h.setItemAttribute(e.SIZEABLE,
!1),h.setItemAttribute(e.MOVEABLE,d.Direction.NONE),h.setItemAttribute(e.CLOSED,!1),h.setItemAttribute(e.CONTAINER,!1),h.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * Parent!CURVE"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT")),c(h),k=h.getPin(),k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH - Parent!HEIGHT * Parent!CURVE / 2"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT / 2")),k=a,k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),
k._newExpression(0))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.45"),k._newExpression(0))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"WIDTH * 0.55"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,
"WIDTH"),k._newExpression(0,"WIDTH * 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT - WIDTH * 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT - WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT - WIDTH * 0.55"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.45"),k._newExpression(0,
"HEIGHT"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT"))),g.addItem(h));break;case "bracketSimpleLeft":h=new JSG.graph.model.shapes.BezierShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.2),0,0,0,0.4,"CURVE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);g._reshapeProperties.addIndexProperty("CURVE",
f.getReshapePointY,f.setReshapePointY,0);g.setItemAttribute(e.CLOSED,!1);g.setItemAttribute(e.CONTAINER,!1);h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.55"),h._newExpression(0)));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * CURVE / 2")));
h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT - HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,
"HEIGHT - HEIGHT * CURVE / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.55"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT")));break;case "bracketSimpleRight":h=new JSG.graph.model.shapes.BezierShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(1),
h._newExpression(0.2),1,1,0,0.4,"CURVE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);g._reshapeProperties.addIndexProperty("CURVE",f.getReshapePointY,f.setReshapePointY,0);g.setItemAttribute(e.CLOSED,!1);g.setItemAttribute(e.CONTAINER,!1);h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0)));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH * 0.45"),h._newExpression(0)));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * CURVE / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH"),h._newExpression(0,"HEIGHT - HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - HEIGHT * CURVE / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.45"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT")));break;
case "bracketCurvedBoth":h=new JSG.graph.model.shapes.RectangleShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.2),0,0,0,0.3,"CURVE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);g.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE);g.getFormat().setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.NONE);g.getItemAttributes().setSelectParentFirst(!0);g.setItemAttribute(e.EDITMASK,d.EditMask.COORDINATES);
g._reshapeProperties.addIndexProperty("CURVE",f.getReshapePointY,f.setReshapePointY,0);"bracketCurvedRight"!=a&&(n=new JSG.graph.model.shapes.BezierShape,h=new JSG.graph.model.Node(n),h.setItemAttribute(e.SIZEABLE,!1),h.setItemAttribute(e.MOVEABLE,d.Direction.NONE),h.setItemAttribute(e.CLOSED,!1),h.setItemAttribute(e.CONTAINER,!1),h.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * Parent!CURVE"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT")),c(h),k=h.getPin(),k.setCoordinate(new JSG.graph.expr.NumberExpression(0,
"Parent!HEIGHT * Parent!CURVE / 2"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT / 2")),k=n,k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.55"),k._newExpression(0))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,
"WIDTH * 0.55"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"WIDTH * 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 4"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2 - WIDTH * 0.45"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,
"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT / 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT / 2"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT / 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,
"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2 + WIDTH * 0.45"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT * 0.75"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT - WIDTH * 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT - WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),
k._newExpression(0,"HEIGHT - WIDTH * 0.55"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.55"),k._newExpression(0,"HEIGHT"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT"))),g.addItem(h));"bracketCurvedLeft"!=a&&(a=new JSG.graph.model.shapes.BezierShape,h=new JSG.graph.model.Node(a),h.setItemAttribute(e.SIZEABLE,
!1),h.setItemAttribute(e.MOVEABLE,d.Direction.NONE),h.setItemAttribute(e.CLOSED,!1),h.setItemAttribute(e.CONTAINER,!1),h.setSize(new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT * Parent!CURVE"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT")),c(h),k=h.getPin(),k.setCoordinate(new JSG.graph.expr.NumberExpression(0,"Parent!WIDTH - Parent!HEIGHT * Parent!CURVE / 2"),new JSG.graph.expr.NumberExpression(0,"Parent!HEIGHT / 2")),k=a,k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),
k._newExpression(0))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.45"),k._newExpression(0))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"WIDTH * 0.55"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,
"WIDTH / 2"),k._newExpression(0,"WIDTH * 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 4"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2 - WIDTH * 0.45"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,
"HEIGHT / 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT / 2"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH"),k._newExpression(0,"HEIGHT / 2"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT / 2 + WIDTH * 0.45"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,
"WIDTH / 2"),k._newExpression(0,"HEIGHT * 0.75"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT - WIDTH * 2"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT - WIDTH"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH / 2"),k._newExpression(0,"HEIGHT - WIDTH * 0.55"))),k._cpFromCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0,"WIDTH * 0.45"),
k._newExpression(0,"HEIGHT"))),k._coordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT"))),k._cpToCoordinates.push(new JSG.graph.Coordinate(k._newExpression(0),k._newExpression(0,"HEIGHT"))),g.addItem(h));break;case "bracketCurvedLeft":h=new JSG.graph.model.shapes.BezierShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.2),0,0,0,0.4,"CURVE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);
g._reshapeProperties.addIndexProperty("CURVE",f.getReshapePointY,f.setReshapePointY,0);g.setItemAttribute(e.CLOSED,!1);g.setItemAttribute(e.CONTAINER,!1);h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.55"),h._newExpression(0)));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH / 2"),h._newExpression(0,"HEIGHT * CURVE / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 4")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,
"HEIGHT / 2 - HEIGHT * CURVE / 2")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT / 2")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2 + HEIGHT * CURVE / 2")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT * 0.75")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,
"HEIGHT - HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT - HEIGHT * CURVE / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.55"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT")));break;case "bracketCurvedRight":h=
new JSG.graph.model.shapes.BezierShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(1),h._newExpression(0.2),1,1,0,0.4,"CURVE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);g._reshapeProperties.addIndexProperty("CURVE",f.getReshapePointY,f.setReshapePointY,0);g.setItemAttribute(e.CLOSED,!1);g.setItemAttribute(e.CONTAINER,!1);h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),
h._newExpression(0)));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.45"),h._newExpression(0)));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT * CURVE / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH / 2"),h._newExpression(0,"HEIGHT / 4")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2 - HEIGHT * CURVE / 2")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,
"HEIGHT / 2")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2 + HEIGHT * CURVE / 2")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT * 0.75")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH / 2"),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT - HEIGHT * CURVE")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT - HEIGHT * CURVE / 2")));h._cpFromCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.45"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,
"HEIGHT")));h._cpToCoordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT")));break;case "arrowLeft":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(1),h._newExpression(0.2),1,1,0,0.5,"BASE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.5),h._newExpression(0),0,1,0,0,"ARROWLENGTH",JSG.graph.ReshapeType.XRELATIVETOHEIGHT,
!1);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * BASE")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"ARROWLENGTH * HEIGHT"),h._newExpression(0,"HEIGHT * BASE")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"ARROWLENGTH * HEIGHT"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * 0.5")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"ARROWLENGTH * HEIGHT"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"ARROWLENGTH * HEIGHT"),h._newExpression(0,"HEIGHT * (1 - BASE)")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * (1 - BASE)")));g._reshapeProperties.addIndexProperty("BASE",f.getReshapePointY,f.setReshapePointY,0);g._reshapeProperties.addIndexProperty("ARROWLENGTH",f.getReshapePointX,f.setReshapePointX,1);break;case "arrowUp":h=
new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.2),h._newExpression(1),0,0.5,1,1,"BASE",JSG.graph.ReshapeType.XRELATIVETOWIDTH,!1);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.5),0,0,0,1,"ARROWLENGTH",JSG.graph.ReshapeType.YRELATIVETOWIDTH,!0);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * BASE"),h._newExpression(0,
"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * BASE"),h._newExpression(0,"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.5"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH * (1 - BASE)"),h._newExpression(0,"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * (1 - BASE)"),h._newExpression(0,"HEIGHT")));g._reshapeProperties.addIndexProperty("BASE",f.getReshapePointX,f.setReshapePointX,0);g._reshapeProperties.addIndexProperty("ARROWLENGTH",f.getReshapePointY,f.setReshapePointY,1);break;case "arrowRight":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),
h._newExpression(0.2),0,0,0,0.5,"BASE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.5),h._newExpression(0),0,1,0,0,"ARROWLENGTH",JSG.graph.ReshapeType.XRELATIVETOHEIGHTFROMRIGHT,!1);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * BASE")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0,
"HEIGHT * BASE")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT * 0.5")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0,"HEIGHT * (1 - BASE)")));
h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * (1 - BASE)")));g._reshapeProperties.addIndexProperty("BASE",f.getReshapePointY,f.setReshapePointY,0);g._reshapeProperties.addIndexProperty("ARROWLENGTH",f.getReshapePointX,f.setReshapePointX,1);break;case "arrowDown":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.2),h._newExpression(1),0,0.5,0,0,"BASE",JSG.graph.ReshapeType.XRELATIVETOWIDTH,
!1);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.5),0,0,0,1,"ARROWLENGTH",JSG.graph.ReshapeType.YRELATIVETOWIDTHFROMBOTTOM,!0);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * BASE"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * BASE"),h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),
h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.5"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * (1 - BASE)"),h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * (1 - BASE)"),
h._newExpression(0)));g._reshapeProperties.addIndexProperty("BASE",f.getReshapePointX,f.setReshapePointX,0);g._reshapeProperties.addIndexProperty("ARROWLENGTH",f.getReshapePointY,f.setReshapePointY,1);break;case "arrowDblHorz":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.5),h._newExpression(0.2),0.5,0.5,0,0.5,"BASE",JSG.graph.ReshapeType.YRELATIVETOHEIGHT,!0);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.5),
h._newExpression(0),0,1,0,0,"ARROWLENGTH",JSG.graph.ReshapeType.XRELATIVETOHEIGHT,!1);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"ARROWLENGTH * HEIGHT"),h._newExpression(0,"HEIGHT * BASE")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"ARROWLENGTH * HEIGHT"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT * 0.5")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"ARROWLENGTH * HEIGHT"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"ARROWLENGTH * HEIGHT"),h._newExpression(0,"HEIGHT * (1 - BASE)")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0,"HEIGHT * (1 - BASE)")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH"),h._newExpression(0,"HEIGHT * 0.5")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH - HEIGHT * ARROWLENGTH"),h._newExpression(0,"HEIGHT * BASE")));g._reshapeProperties.addIndexProperty("BASE",f.getReshapePointY,f.setReshapePointY,0);g._reshapeProperties.addIndexProperty("ARROWLENGTH",f.getReshapePointX,f.setReshapePointX,1);break;case "arrowDblVert":h=
new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0.2),h._newExpression(0.5),0,0.5,0.5,0.5,"BASE",JSG.graph.ReshapeType.XRELATIVETOWIDTH,!1);g._reshapeCoordinates.push(k);k=new JSG.graph.ReshapeCoordinate(h._newExpression(0),h._newExpression(0.5),0,0,0,1,"ARROWLENGTH",JSG.graph.ReshapeType.YRELATIVETOWIDTH,!0);g._reshapeCoordinates.push(k);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * BASE"),h._newExpression(0,
"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.5"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * (1 - BASE)"),h._newExpression(0,"ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,
"WIDTH * (1 - BASE)"),h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * 0.5"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH * BASE"),
h._newExpression(0,"HEIGHT - ARROWLENGTH * WIDTH")));g._reshapeProperties.addIndexProperty("BASE",f.getReshapePointX,f.setReshapePointX,0);g._reshapeProperties.addIndexProperty("ARROWLENGTH",f.getReshapePointY,f.setReshapePointY,1);break;case "triangleLeft":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,
"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT")));break;case "triangleRight":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT / 2")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT")));
break;case "triangleTop":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0,"HEIGHT")));break;case "triangleBottom":h=new JSG.graph.model.shapes.PolygonShape;g=new JSG.graph.model.Node(h);h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0),
h._newExpression(0)));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH / 2"),h._newExpression(0,"HEIGHT")));h._coordinates.push(new JSG.graph.Coordinate(h._newExpression(0,"WIDTH"),h._newExpression(0)));break;case "parallel":break;case "polyedge4":g=b(4,!1);break;case "polyedge5":g=b(5,!1);break;case "polyedge6":g=b(6,!1);break;case "polyedge8":g=b(8,!1);break;case "polyedge10":g=b(10,!1);break;case "polyedge12":g=b(12,!1);break;case "star3":g=b(3,!0);break;case "star4":g=b(4,
!0);break;case "star5":g=b(5,!0);break;case "star6":g=b(6,!0);break;case "star8":g=b(8,!0);break;case "star12":g=b(12,!0);break;default:return}g.evaluate();return g}(a)}};JSG.graph.model.GraphItemFactory.prototype.createShape=function(a){};JSG.graph.model.GraphItemFactory.prototype.getFriends=function(a){};JSG.graph.model.GraphItemFactory.prototype.getLink=function(a){};JSG.graph.model.GraphItemFactory.prototype.isValidSubItem=function(a,b){return!0};
JSG.graph.model.GraphItemFactory.prototype.initReadItem=function(a){};JSG.graph.model.GraphItemFactory.prototype.getCommandButtons=function(a){return[]};JSG.namespace("JSG.graph.controller");JSG.graph.controller.FindFlags={AUTOMATIC:0,AREA:1,FRAME:2,AREAWITHFRAME:3,INNERAREA:4,BOXWITHFRAME:5};JSG.graph.controller.ModelController=function(a){this.model=void 0!=a?a:new JSG.graph.model.Model;this.view=void 0;this.isActive=!1;this.parent=void 0;this.children=[]};
JSG.graph.controller.ModelController.prototype.getParent=function(){return this.parent};JSG.graph.controller.ModelController.prototype.getIndex=function(){return void 0!=this.parent?this.parent.children.indexOf(this):-1};JSG.graph.controller.ModelController.prototype.moveToIndex=function(a){if(!(0>a||a>=this.parent.children.length)){var b=this.parent.children.indexOf(this);this.parent.children.move(b,a);this.getView().moveToIndex(a);this.getModel().moveToIndex(a)}};
JSG.graph.controller.ModelController.prototype.moveToTop=function(){var a=this.parent.children.indexOf(this);this.parent.children.move(a,this.parent.children.length-1);this.getView().moveToTop();this.getModel().moveToTop()};JSG.graph.controller.ModelController.prototype.moveUp=function(){var a=this.parent.children.indexOf(this);a<this.parent.children.length-1&&this.parent.children.move(a,a+1);this.getView().moveUp();this.getModel().moveUp()};
JSG.graph.controller.ModelController.prototype.moveToBottom=function(){var a=this.parent.children.indexOf(this);this.parent.children.move(a,0);this.getView().moveToBottom();this.getModel().moveToBottom()};JSG.graph.controller.ModelController.prototype.moveDown=function(){var a=this.parent.children.indexOf(this);0<a&&this.parent.children.move(a,a-1);this.getView().moveDown();this.getModel().moveDown()};JSG.graph.controller.ModelController.prototype.hasChildren=function(){return!this.children.isEmpty()};
JSG.graph.controller.ModelController.prototype.getChildren=function(){return this.children};JSG.graph.controller.ModelController.prototype.getChildAt=function(a){return 0<=a&&a<this.children.length?this.children[a]:void 0};JSG.graph.controller.ModelController.prototype.isSelectable=function(){return!1};JSG.graph.controller.ModelController.prototype.isSelected=function(){return!1};JSG.graph.controller.ModelController.prototype.setSelected=function(a){};
JSG.graph.controller.ModelController.prototype.getModel=function(){return this.model};JSG.graph.controller.ModelController.prototype.getView=function(){void 0==this.view&&(this.view=this.createView(this.model));return this.view};JSG.graph.controller.ModelController.prototype.createView=function(a){return new JSG.ui.View};JSG.graph.controller.ModelController.prototype.setView=function(a){this.view=a};
JSG.graph.controller.ModelController.prototype.addChild=function(a,b){this.children.insert(a,b);a.parent=this;this.addChildView(a,b);a._notifyAdd();this.isActive&&a.activate()};JSG.graph.controller.ModelController.prototype._notifyAdd=function(){for(var a=0,b=this.children.length;a<b;a++)this.children[a]._notifyAdd();this.refresh()};JSG.graph.controller.ModelController.prototype.activate=function(){this.isActive=!0;for(var a=0,b=this.children.length;a<b;a++)this.children[a].activate()};
JSG.graph.controller.ModelController.prototype.addChildView=function(a,b){this.getView().addView(a.getView(),b)};JSG.graph.controller.ModelController.prototype.removeChild=function(a){this.children.remove(a)&&(this.isActive&&a.deactivate(),a.parent=void 0,this._notifyRemove(),this.removeChildView(a))};JSG.graph.controller.ModelController.prototype.deactivate=function(){this.isActive=!1;for(var a=0,b=this.children.length;a<b;a++)this.children[a].deactivate()};
JSG.graph.controller.ModelController.prototype._notifyRemove=function(){for(var a=0,b=this.children.length;a<b;a++)this.children[a]._notifyRemove()};JSG.graph.controller.ModelController.prototype.removeChildView=function(a){this.getView().removeView(a.getView())};JSG.graph.controller.ModelController.prototype.refresh=function(){JSG.reading||(this._refreshViews(),this._refreshChildren())};JSG.graph.controller.ModelController.prototype._refreshViews=function(){};
JSG.graph.controller.ModelController.prototype._refreshChildren=function(){for(var a=new JSG.commons.Map,b=0,c=this.children.length;b<c;b++){var d=this.children[b];a.put(d.getModel().getId(),d)}d=this.getModelChildren();b=0;for(c=d.length;b<c;b++){var e=d[b],f=a.remove(e.getId());void 0==f&&(f=this.getViewer().getControllerFactory().createController(e),this.addChild(f,b))}var g=this;a.iterate(function(a,b){g.removeChild(b)})};JSG.graph.controller.ModelController.prototype.getModelChildren=function(){return[]};
JSG.graph.controller.ModelController.prototype.getViewer=function(){if(void 0!=this.parent)return this.parent.getViewer()};JSG.graph.controller.ModelController.prototype.getRootParent=function(){return void 0!=this.parent?this.parent.getRootParent():void 0};JSG.graph.controller.ModelController.prototype.getModelController=function(a){if(a)for(var b=0,c=this.children.length;b<c;b++)if(a.getId()==this.children[b].getModel().getId())return this.children[b]};
JSG.graph.controller.ModelController.prototype.getControllerByModelId=function(a){if(this.getModel().getId()==a)return this;for(var b=0,c=this.children.length;b<c;b++){var d=this.children[b].getControllerByModelId(a);if(void 0!=d)return d}};
JSG.graph.controller.ModelController.prototype.findControllerByConditionAndLocation=function(a,b){if(this.view){var c=new JSG.geometry.Point(a.x,a.y);if(b(this,c))return this;this.getModel().translateFromParent(c);a:{for(var d=this.children.length-1;0<=d;d--){var e=this.children[d].findControllerByConditionAndLocation(c,b);if(e){c=e;break a}}c=void 0}return void 0!=c?c:void 0}};
JSG.graph.controller.ModelController.prototype.findControllerByConditionAndBox=function(a,b){if(this.view){if(b(this,a))return this;var c;a:{for(c=this.children.length-1;0<=c;c--){var d=this.children[c].findControllerByConditionAndBox(a,b);if(d){c=d;break a}}c=void 0}return void 0!=c?c:void 0}};
JSG.graph.controller.ModelController.prototype.getControllerAt=function(a,b,c){function d(a,d){var e=void 0;d.containsPoint(a,b)&&(void 0==c||c(d,a))&&(e=g.getParent()&&g.getParent().isSelectParentFirst()&&b!=JSG.graph.controller.FindFlags.AREA?d.getParent():d);return e}var e=void 0;if(this.view){var f=new JSG.geometry.Point(a.x,a.y),g=this.getModel();if(!0===this._stopLookUp(f))e=d(f,this);else{if(!g.isCollapsed()){var l=this._getSubControllerAt(f,b,c);void 0!=l&&(e=l)}void 0==e&&(f.setTo(a),e=d(f,
this))}}return e};JSG.graph.controller.ModelController.prototype._getSubControllerAt=function(a,b,c){this.getModel().translateFromParent(a);for(var d=this.children.length-1;0<=d;d--){var e=this.children[d].getControllerAt(a,b,c);if(e)return e}};JSG.graph.controller.ModelController.prototype.containsPoint=function(a,b){return this.view.containsPoint(a,b)};
JSG.graph.controller.ModelController.prototype.traverse=function(a){function b(a,d){var e=d.call(a,a);if(void 0!=a&&e)for(var e=0,f=a.getChildren().length;e<f;e++)b(a.getChildAt(e),d)}b(this,a)};JSG.graph.controller.ModelController.prototype.createFeedback=function(){};JSG.graph.controller.ModelController.prototype._stopLookUp=function(a){return!1};JSG.namespace("JSG.graph.controller");
JSG.graph.controller.GraphItemController=function(a){JSG.graph.controller.GraphItemController._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.controller.GraphItemController,JSG.graph.controller.ModelController);JSG.graph.controller.GraphItemController.ITEM_CHANGED_NOTIFICATION="graphitemcontroller.item.changed.notification";JSG.graph.controller.GraphItemController.prototype.findModelController=function(a){if(a===this.getModel())return this;a=a.createPath();return this._findModelControllerByPath(a)};
JSG.graph.controller.GraphItemController.prototype._findModelControllerByPath=function(a){function b(a,b){var c=void 0;b.every(function(b){return b.getModel().getId()===a?(c=b,!1):!0});return c}if(void 0!=a){var c=a.nextId(),c=void 0!=c?c===this.getModel().getId()?this:b(c,this.children):void 0;return void 0!=c?a.hasNextId()?c._findModelControllerByPath(a):c:void 0}};JSG.graph.controller.GraphItemController.prototype.getModelChildren=function(){return this.getModel().getItems()};
JSG.graph.controller.GraphItemController.prototype.createView=function(a){return new JSG.graph.view.GraphItemView(a)};JSG.graph.controller.GraphItemController.prototype.onMouseDown=function(a,b,c){return this.getView().onMouseDown(a,b,c)};JSG.graph.controller.GraphItemController.prototype.isCollapsable=function(){return this.getModel().isCollapsable()};JSG.graph.controller.GraphItemController.prototype.isCollapsed=function(){return this.getModel().isCollapsed()};
JSG.graph.controller.GraphItemController.prototype.isSelectable=function(){return this._isSelectableInParent(this)};JSG.graph.controller.GraphItemController.prototype._isSelectableInParent=function(a){var b=this.getParent();return void 0!=b?b._isSelectableInParent(a):a.getModel().isSelectable()};JSG.graph.controller.GraphItemController.prototype.isSelected=function(){return this.getModel().getItemAttributes().getSelected().getValue()};
JSG.graph.controller.GraphItemController.prototype.setSelected=function(a,b){var c=this.getModel(),d=c.areEventsEnabled();!0===b&&c.disableEvents();c.setItemAttribute(JSG.graph.attr.ItemAttributes.SELECTED,a);!0===d&&!0===b&&c.enableEvents()};JSG.graph.controller.GraphItemController.prototype.getGraphController=function(){return void 0!=this.parent?this.parent.getGraphController():void 0};
JSG.graph.controller.GraphItemController.prototype.activate=function(){JSG.graph.controller.GraphItemController._super.activate.call(this);this.getModel().addEventListener(JSG.graph.model.events.Event.ALL,this)};JSG.graph.controller.GraphItemController.prototype.deactivate=function(){this.getModel().removeEventListener(JSG.graph.model.events.Event.ALL,this);JSG.graph.controller.GraphItemController._super.deactivate.call(this)};JSG.graph.controller.GraphItemController.prototype.handlePreEvent=function(a){};
JSG.graph.controller.GraphItemController.prototype.handlePostEvent=function(a){var b=!0,c=JSG.graph.controller.GraphItemController.ITEM_CHANGED_NOTIFICATION,d=JSG.graph.model.events.Event;switch(a.id){case d.PARENT:this._onParentChange(a.value);break;case d.ITEMREMOVE:this.clearSelection();case d.ITEMADD:this.refresh();break;case d.SHAPE:this.getView().setShapeRenderer(JSG.graph.view.shapes.ShapeRenderer.fromShape(this.getModel()._shape));break;case d.ATTRIBUTE:b=!this._handleAttributeChanged(a),
c=!0==b?c:void 0}b&&(b=this.getModel().getGraph(),void 0!=b&&b.markDirty());c&&this.sendNotification(c,a)};JSG.graph.controller.GraphItemController.prototype._handleAttributeChanged=function(a){var b=!1;a.id==JSG.graph.model.events.Event.ATTRIBUTE&&a.isCategory(JSG.graph.attr.ItemAttributes.NAME)&&(a=a.getAttribute(),a.getName()===JSG.graph.attr.ItemAttributes.SELECTED&&(b=a.getValue(),this.getView().isSelected=b,a=this.getViewer().getSelectionProvider(),b?a.select(this):a.deselect(this),b=!0));return b};
JSG.graph.controller.GraphItemController.prototype.sendNotification=function(a,b){var c=new JSG.graph.notifications.Notification(a,this);c.event=b;JSG.graph.notifications.NotificationCenter.getInstance().send(c)};JSG.graph.controller.GraphItemController.prototype.selectItem=function(a,b){var c=this.getViewer();if(c){var d=a.getId()==this.getModel().getId()?this:this.getControllerByModelId(a.getId());d&&(c=c.getSelectionProvider(),b?(c.clearSelection(!1),c.select(d)):c.deselect(d))}};
JSG.graph.controller.GraphItemController.prototype.clearSelection=function(){var a=this.getViewer();a&&a.getSelectionProvider().clearSelection()};JSG.graph.controller.GraphItemController.prototype._onParentChange=function(a){function b(a){var b=a.parent;void 0!=b&&(b.children.remove(a),b.removeChildView(a))}function c(b){var c=b.getGraphController().findModelController(a);void 0!=c&&(b.parent=c,c.children.push(b),c.addChildView(b))}void 0==a?this.parent.removeChild(this):(b(this),c(this))};
JSG.graph.controller.GraphItemController.prototype.createFeedback=function(){var a=this.getModel(),b=!a.getReshapeCoordinates().isEmpty(),c=this.createFeedbackItem(b),b=this.createFeedbackView(c,b),a=this._newFeedback(c,b,a);a.init();return a};JSG.graph.controller.GraphItemController.prototype._newFeedback=function(a,b,c){return new JSG.graph.feedback.Feedback(a,b,c)};
JSG.graph.controller.GraphItemController.prototype.createFeedbackItem=function(a){function b(a,c){function d(a){for(var c=0;c<a.length;c++)b(a[c],!1)}function e(a){for(var b=0;b<a.length;b++)a[b].setItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,!1)}var m=a.getFormat();m.setBrightness(0);JSG.touchDevice?(m.setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE),c=m.getLineStyle()==JSG.graph.attr.FormatAttributes.LineStyle.NONE,m.setLineCorner(0)):m.setFillColor("rgba(0,0,0,0.2)");m.setLineColor("rgba(0,0,0,0.8)");
m=a.getItems();!0===c?d(m):e(m)}var c=this.getModel(),d=c.copy(a);d._isFeedback=!0;d.setWidth(c.getWidth().getValue());d.setHeight(c.getHeight().getValue());var e=c.getPinPoint();d.setPinPointTo(e);d.evaluate();c instanceof JSG.graph.model.TextNode&&d.setText(c.getText().getPureValue());b(d,a);return d};
JSG.graph.controller.GraphItemController.prototype.createFeedbackView=function(a,b){var c=this.getViewer(),d=c.getControllerFactory().createController(a);d.getViewer=function(){return c};d.getRootParent=function(){return d};if(b)d.refresh();else{var e=a.getFormat();JSG.touchDevice||e.setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.SOLID);e.setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.SOLID)}e=d.getView();d.deactivate();return e};JSG.namespace("JSG.graph.controller");
JSG.graph.controller.GraphController=function(a){JSG.graph.controller.GraphController._super.constructor.apply(this,arguments);this.graph=a};JSG.extend(JSG.graph.controller.GraphController,JSG.graph.controller.GraphItemController);JSG.graph.controller.GraphController.GRAPH_CHANGED_NOTIFICATION="graphcontroller.graph.changed.notification";JSG.graph.controller.GraphController.prototype.getGraphController=function(){return this};JSG.graph.controller.GraphController.prototype.createView=function(a){return new JSG.graph.view.GraphView(a)};
JSG.graph.controller.GraphController.prototype.getModelChildren=function(){return this.graph.getItems()};JSG.graph.controller.GraphController.prototype.isSelectable=function(){return!0};JSG.graph.controller.GraphController.prototype.setCursor=function(a){this.getView().setCursor(a)};JSG.graph.controller.GraphController.prototype.addFeedback=function(a){this.getView().addFeedback(a)};JSG.graph.controller.GraphController.prototype.removeFeedback=function(a){this.getView().removeFeedback(a)};
JSG.graph.controller.GraphController.prototype.clearFeedback=function(){this.getView().clearFeedback()};JSG.graph.controller.GraphController.prototype.createFeedback=function(){};JSG.graph.controller.GraphController.prototype.getLayer=function(a){return this.getView().getLayer(a)};JSG.graph.controller.GraphController.prototype.hasLayer=function(a){return this.getView().hasLayer(a)};JSG.graph.controller.GraphController.prototype.clearLayer=function(a){return this.getView().clearLayer(a)};
JSG.graph.controller.GraphController.prototype.clearAllLayer=function(){this.getView().clearAllLayer()};
JSG.graph.controller.GraphController.prototype.handlePostEvent=function(a){var b=JSG.graph.controller.GraphController.GRAPH_CHANGED_NOTIFICATION,c=JSG.graph.model.events.Event;switch(a.id){case c.BBOX:case c.SIZE:this.getModel().markDirty();this.getView()._fireOnResize();break;case c.ITEMADD:this.refresh();this.getModel().markDirty();break;case c.ITEMREMOVE:this.refresh();this.clearSelection();this.getModel().markDirty();break;case c.GRAPHSETTINGS:this.getModel().markDirty();break;case c.GRAPH:a.detailId===
JSG.graph.model.Graph.AttributeID.REFRESH&&this.getView().clearCache()}b&&this.sendNotification(b,a)};JSG.namespace("JSG.graph.controller");JSG.graph.controller.NodeController=function(a){JSG.graph.controller.NodeController._super.constructor.apply(this,arguments);this._ports=[]};JSG.extend(JSG.graph.controller.NodeController,JSG.graph.controller.GraphItemController);
JSG.graph.controller.NodeController.prototype._refreshChildren=function(){JSG.graph.controller.NodeController._super._refreshChildren.call(this);for(var a=this,b=this.getModel(),c=new JSG.commons.Map,d=this.getPortControllers(),e=0,f=d.length;e<f;e++){var g=d[e];c.put(g.getModel().getId(),g)}b._ports.forEach(function(b){var d=c.remove(b.getId());void 0==d&&(d=a.getViewer().getControllerFactory().createController(b),a.addPort(d))});c.iterate(function(b,c){a.removePort(c)})};
JSG.graph.controller.NodeController.prototype.addPort=function(a){this._ports.push(a);a.parent=this;this.addPortView(a);a._notifyAdd();this.isActive&&a.activate()};JSG.graph.controller.NodeController.prototype.addPortView=function(a){this.getView().addPortView(a.getView())};JSG.graph.controller.NodeController.prototype.removePort=function(a){this._ports.remove(a)&&(this.isActive&&a.deactivate(),a.parent=void 0,a._notifyRemove(),this.removePortView(a))};
JSG.graph.controller.NodeController.prototype.removePortView=function(a){this.getView().removePortView(a.getView())};JSG.graph.controller.NodeController.prototype.createView=function(a){return a instanceof JSG.graph.model.TextNode?new JSG.graph.view.TextView(a):new JSG.graph.view.NodeView(a)};JSG.graph.controller.NodeController.prototype.hasPorts=function(){return!this._ports.isEmpty()};JSG.graph.controller.NodeController.prototype.getPortControllers=function(){return this._ports};
JSG.graph.controller.NodeController.prototype.handlePreEvent=function(a){if(a.id==JSG.graph.model.events.Event.ATTRIBUTE)switch(a.detailId){case JSG.graph.model.events.AttributeChangeEvent.VALUE:this.handlePreAttributeChange(a.getAttribute(),a)}JSG.graph.controller.NodeController._super.handlePreEvent.call(this,a)};JSG.graph.controller.NodeController.prototype.handlePreAttributeChange=function(a,b){a.getName()==JSG.graph.attr.ItemAttributes.COLLAPSED&&!1==a.getValue()&&(b._colledgeinfos=this._handlePreCollapse())};
JSG.graph.controller.NodeController.prototype._handlePreCollapse=function(){var a=[],b=[],c=[],d=this.getModel(),e=d.getGraph(),f=d.getTranslatedBoundingBox(e,JSG.boxCache.get()),g=JSG.ptCache.get(),l=JSG.ptCache.get(),h=JSG.ptCache.get();this.getInOutEdges(a,b);for(var m=0;m<a.length;m++)for(var k=a[m],n=k.getParent(),q=k.getPointsCount()-1,p=q;0<p;p--)if(k.getPointAt(p,g),k.getPointAt(p-1,l),this._translateSegment(g,l,n,e),-1<f.getIntersectionIndex(g,l,h)&&JSG.geometry.Utils.isPointOnLineSegment(h,
g,l)){JSG.graph.Utils.translatePointDown(h,e,d);c.push(this.mapPortAt(h,d,k,!1));break}for(m=0;m<b.length;m++)for(k=b[m],n=k.getParent(),q=k.getPointsCount()-1,p=0;p<q;p++)if(k.getPointAt(p,g),k.getPointAt(p+1,l),this._translateSegment(g,l,n,e),-1<f.getIntersectionIndex(g,l,h)&&JSG.geometry.Utils.isPointOnLineSegment(h,g,l)){JSG.graph.Utils.translatePointDown(h,e,d);c.push(this.mapPortAt(h,d,k,!0));break}JSG.ptCache.release(g,l,h);JSG.boxCache.release(f);return c};
JSG.graph.controller.NodeController.prototype._translateSegment=function(a,b,c,d){JSG.graph.Utils.traverseItemUp(c,d,function(c){c.translateToParent(a);c.translateToParent(b)})};JSG.graph.controller.NodeController.prototype.getInOutEdges=function(a,b){for(var c=this.getModel().getParent();void 0!=c;){for(var d=c.getItems(),e=0;e<d.length;e++){var f=d[e];f instanceof JSG.graph.model.Edge&&(this.isItemInsideNode(f.getSourceNode())?b.push(f):this.isItemInsideNode(f.getTargetNode())&&a.push(f))}c=c.getParent()}};
JSG.graph.controller.NodeController.prototype.isItemInsideNode=function(a){var b=this.getModel();a=a.getParent();for(var c=a===b;!c&&void 0!=a&&a!=b.getParent();)a=a.getParent(),c=a===b;return c};JSG.graph.controller.NodeController.prototype.mapPortAt=function(a,b,c,d){var e=d?c.getSourcePort():c.getTargetPort(),f=b.getPortAtLocation(a);f&&f.isMapper||(f=new JSG.graph.model.PortMapper,b.addPortAtLocation(f,a));f.mapPort(c,e);return{edge:c,isIncomingEdge:!d,virtualPort:f}};
JSG.graph.controller.NodeController.prototype.handlePostEvent=function(a){if(a.id==JSG.graph.model.events.Event.NODE){var b=JSG.graph.model.events.NodeEvent;switch(a.detailId){case b.PORTADD:case b.PORTREMOVE:case b.PORTREMOVEALL:this.refresh()}}else if(a.id==JSG.graph.model.events.Event.ATTRIBUTE)switch(a.detailId){case JSG.graph.model.events.AttributeChangeEvent.VALUE:this.handlePostAttributeChange(a.getAttribute(),a)}JSG.graph.controller.NodeController._super.handlePostEvent.call(this,a)};
JSG.graph.controller.NodeController.prototype.handlePostAttributeChange=function(a,b){a.getName()==JSG.graph.attr.ItemAttributes.COLLAPSED&&(!0===a.getValue()?this._didCollapse(b):this._didExpand(b),b._colledgeinfos=void 0)};JSG.graph.controller.NodeController.prototype._didCollapse=function(a){if(a=a._colledgeinfos)for(var b=0;b<a.length;b++){var c=a[b];c.isIncomingEdge?c.edge.setTargetPort(c.virtualPort):c.edge.setSourcePort(c.virtualPort)}};
JSG.graph.controller.NodeController.prototype._didExpand=function(a){a=this.getModel();for(var b=this.getPortControllers(),c=[],d=0;d<b.length;d++){var e=b[d].getModel();if(e.isMapper){for(var f=e.getIncomingEdges(),g=0;g<f.length;g++)f[g].setTargetPort(e.getMappedPort(f[g].getId()));f=e.getOutgoingEdges();for(g=0;g<f.length;g++)f[g].setSourcePort(e.getMappedPort(f[g].getId()));c.push(e)}}for(d=0;d<c.length;d++)a.removePort(c[d])};
JSG.graph.controller.NodeController.prototype._handleSubItemsOnCollapse=function(a){var b=this.getModel();a=b.getItems();if(0<a.length){for(var b=b.getBoundingBox(JSG.boxCache.get()),c=b.getCenter(JSG.ptCache.get()),d=0;d<a.length;d++){var e=a[d];if(e instanceof JSG.graph.model.TextNode){this._oldBoxAttribute(e).getValue();var f=c.y;switch(e.getTextFormat().getVerticalPosition().getValue()){case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.ONTOP:f=-oldbbox.getHeight();break;case JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.BELOWBOTTOM:f+=
f+oldbbox.getHeight()}e.setAngle(0);e.setPinPoint(c.x,f)}else f=e.getItemAttributes(),e._oldVisibleExpr=f.getVisible().getExpression().copy(),f.setVisible(!1)}JSG.boxCache.release(b);JSG.ptCache.release(c)}};JSG.graph.controller.NodeController.prototype._oldBoxAttribute=function(a){var b=a.getAttribute("oldbbox");void 0==b&&(b=JSG.graph.controller.NodeController.BoxExpression.fromItem(a),b=new JSG.graph.controller.NodeController.CollapseStateAttribute("oldbbox",b),a.addAttribute(b));return b};
JSG.graph.controller.NodeController.prototype._handleSubItemsOnExpand=function(a){a=this.getModel().getItems();if(0<a.length)for(var b=0;b<a.length;b++){var c=a[b];if(c instanceof JSG.graph.model.TextNode){var d=this._oldBoxAttribute(c);d.getExpression();c.setBoundingBoxTo(d.getValue())}else c.getItemAttributes().setVisible(c._oldVisibleExpr||!0),c._oldVisibleExpr=void 0}};
JSG.graph.controller.NodeController.CollapseStateAttribute=function(a,b){JSG.graph.controller.NodeController.CollapseStateAttribute._super.constructor.call(this,a,b)};JSG.extend(JSG.graph.controller.NodeController.CollapseStateAttribute,JSG.graph.attr.Attribute);JSG.graph.controller.NodeController.CollapseStateAttribute.prototype.getClassString=function(){return"JSG.graph.controller.NodeController.CollapseStateAttribute"};
JSG.graph.controller.NodeController.CollapseStateAttribute.prototype.newInstance=function(){return new JSG.graph.controller.NodeController.CollapseStateAttribute(this.getName())};JSG.graph.controller.NodeController.CollapseStateAttribute.prototype.getExpression=function(){void 0==this._value&&(this._value=new JSG.graph.controller.NodeController.BoxExpression);return this._value};
JSG.graph.controller.NodeController.BoxExpression=function(){JSG.graph.controller.NodeController.BoxExpression._super.constructor.call(this);this.pin;this.size;this.angle;this._bbox=new JSG.geometry.BoundingBox};JSG.extend(JSG.graph.controller.NodeController.BoxExpression,JSG.graph.expr.Expression);
JSG.graph.controller.NodeController.BoxExpression.fromItem=function(a){var b=new JSG.graph.controller.NodeController.BoxExpression;b.pin=a.getPin().copy();b.size=a.getSize().copy();b.angle=a.getAngle().copy();return b};JSG.graph.controller.NodeController.BoxExpression.prototype.newInstance=function(){return new JSG.graph.controller.NodeController.BoxExpression};
JSG.graph.controller.NodeController.BoxExpression.prototype.copy=function(){var a=this.newInstance();a.pin=this.pin?this.pin.copy():void 0;a.size=this.size?this.size.copy():void 0;a.angle=this.angle?this.angle.copy():void 0;return a};JSG.graph.controller.NodeController.BoxExpression.prototype.isValueEqualTo=function(a){return this._createBBox().isEqualTo(a,1E-4)};JSG.graph.controller.NodeController.BoxExpression.prototype.getValue=function(){return this._createBBox()};
JSG.graph.controller.NodeController.BoxExpression.prototype._createBBox=function(){var a=this.angle.getValue(),b=this.pin.getPoint(JSG.ptCache.get()),c=this.pin.getLocalPoint(JSG.ptCache.get()),c=JSG.geometry.Utils.rotatePoint(c,a);b.subtract(c);this._bbox.setTopLeftTo(b);this._bbox.setSizeTo(this.size);this._bbox.setAngle(a);JSG.ptCache.release(b,c);return this._bbox};
JSG.graph.controller.NodeController.BoxExpression.prototype.saveXML=function(a,b,c){b.writeStartElement(a);this.pin&&this.pin.saveXML("pin",b);this.size&&this.size.saveXML("s",b);this.angle&&this.angle.saveXML("a",b);b.writeEndElement()};
JSG.graph.controller.NodeController.BoxExpression.prototype.readXML=function(a){var b=findElementByTagName(a,"pin");void 0!=b&&(this.pin=this.pin||new JSG.graph.Pin,this.pin.readXML(b));b=findElementByTagName(a,"s");void 0!=b&&(this.size=this.size||new JSG.graph.Size,this.size.readXML(b));b=findElementByTagName(a,"a");void 0!=b&&(this.angle=this.angle||new JSG.graph.expr.NumberExpression(0),this.angle.readXML(b))};JSG.graph.controller.NodeController.BoxExpression.prototype.setConstraint=function(a){return!1};
JSG.graph.controller.NodeController.BoxExpression.prototype.setValue=function(a){return!1};JSG.graph.controller.NodeController.BoxExpression.prototype.setFormula=function(a){return!1};JSG.graph.controller.NodeController.BoxExpression.prototype.setTerm=function(a){return!1};JSG.graph.controller.NodeController.BoxExpression.prototype.setTo=function(a){return!1};JSG.graph.controller.NodeController.BoxExpression.prototype.set=function(a,b,c){return!1};JSG.namespace("JSG.graph.controller");
JSG.graph.controller.ConnectionController=function(a){JSG.graph.controller.ConnectionController._super.constructor.apply(this,arguments);this._pathListener=new JSG.graph.controller.ConnectionController.PathListener(this);this._registerToPortNode(a.getSourcePort());this._registerToPortNode(a.getTargetPort())};JSG.extend(JSG.graph.controller.ConnectionController,JSG.graph.controller.GraphItemController);
JSG.graph.controller.ConnectionController.prototype.createView=function(a){return a instanceof JSG.graph.model.Edge?new JSG.graph.view.EdgeView(a):new JSG.graph.view.GraphItemView(a)};
JSG.graph.controller.ConnectionController.prototype.handlePostEvent=function(a){var b=!1,c=JSG.graph.model.events.Event;switch(a.id){case c.SHAPE:!0===this._pendingDetach&&this._handlePendingDetach(this.getModel());b=!0;break;case c.EDGEATTACHED:this._handleAttach(this.getModel(),a.value);b=!0;break;case c.EDGEDETACHED:this._handleDetach(this.getModel(),a.value);b=!0;break;default:JSG.graph.controller.ConnectionController._super.handlePostEvent.call(this,a)}!0===b&&this.getModel().getGraph().markDirty();
this._pendingDetach=!1};JSG.graph.controller.ConnectionController.prototype._handleAttach=function(a,b){this._registerToPortNode(b);this._verifyEdgeParent(a,a.sourceNode,a.targetNode)};
JSG.graph.controller.ConnectionController.prototype._verifyEdgeParent=function(a,b,c){function d(a,b){var c=b.getGraph(),d=a.getOrigin(new JSG.geometry.Point(0,0));JSG.graph.Utils.translatePointUp(d,a.getParent(),c);JSG.graph.Utils.translatePointDown(d,c,b);a.setOriginTo(d);a.changeParent(b)}b=function(a,b,c){function d(a){a=void 0!=a?a.getParent():c.getParent();return void 0!=a?a.createPath():void 0}a=d(a);var h=d(b);b=c.getGraph();var m=JSG.graph.model.Path.getCommonPrefix(a,h);a=b.findItemByPath(void 0==
m?void 0!=a?a:h:m);return void 0!=a?a:b}(b,c,a);b!==a.getParent()&&d(a,b)};JSG.graph.controller.ConnectionController.prototype._handleDetach=function(a,b){this._deregisterFromPortNode(b);this._pendingDetach=!0};JSG.graph.controller.ConnectionController.prototype._registerToPortNode=function(a){void 0!==a&&(a=a.getParent(),this._pathListener.registerTo(a))};JSG.graph.controller.ConnectionController.prototype._deregisterFromPortNode=function(a){void 0!==a&&(a=a.getParent(),this._pathListener.deregisterFrom(a))};
JSG.graph.controller.ConnectionController.prototype._handlePendingDetach=function(a){function b(a){return a!==c&&!(a instanceof JSG.graph.controller.ConnectionController)}this._pendingDetach=!1;var c=this,d=a.getEndPoint(),e=a.getStartPoint();JSG.graph.Utils.traverseItemUp(a.getParent(),a.getGraph(),function(a){a.translateToParent(d);a.translateToParent(e)});var f=this.getRootParent(),g=f.getControllerAt(e,JSG.graph.controller.FindFlags.AUTOMATIC,b),f=f.getControllerAt(d,JSG.graph.controller.FindFlags.AUTOMATIC,
b);this._verifyEdgeParent(a,g.getModel(),f.getModel())};JSG.graph.controller.ConnectionController.prototype.isAttached=function(){return void 0!==this.model.sourceNode||void 0!==this.model.targetNode};JSG.graph.controller.ConnectionController.prototype.containsPoint=function(a,b){var c=this.getViewer().getCoordinateSystem(),d=this.getModel(),c=c.metricToLogXNoZoom(JSG.findRadius);return d.containsPoint(a,b,c)};
JSG.graph.controller.ConnectionController.prototype.deactivate=function(){this._deregisterFromPortNode(this.model.getSourcePort());this._deregisterFromPortNode(this.model.getTargetPort());JSG.graph.controller.ConnectionController._super.deactivate.call(this)};JSG.graph.controller.ConnectionController.prototype._newFeedback=function(a,b,c){return new (c.getShape().getType()===JSG.graph.model.shapes.OrthoLineShape.TYPE?JSG.graph.feedback.OrthoEdgeFeedback:JSG.graph.feedback.EdgeFeedback)(a,b,c)};
JSG.graph.controller.ConnectionController.PathListener=function(a){this._controller=a};JSG.graph.controller.ConnectionController.PathListener.prototype.registerTo=function(a){a.addEventListener(JSG.graph.model.events.Event.PATH,this)};JSG.graph.controller.ConnectionController.PathListener.prototype.deregisterFrom=function(a){a.removeEventListener(JSG.graph.model.events.Event.PATH,this)};JSG.graph.controller.ConnectionController.PathListener.prototype.handlePreEvent=function(a){};
JSG.graph.controller.ConnectionController.PathListener.prototype.handlePostEvent=function(a){a=this._controller.getModel();this._controller._verifyEdgeParent(a,a.sourceNode,a.targetNode)};JSG.namespace("JSG.graph.controller");JSG.graph.controller.PortController=function(a){JSG.graph.controller.PortController._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.controller.PortController,JSG.graph.controller.GraphItemController);JSG.graph.controller.PortController.prototype.isSelectable=function(){return!1};
JSG.graph.controller.PortController.prototype.createView=function(a){var b=void 0;a instanceof JSG.graph.model.Port&&(b=new JSG.graph.view.PortView(a));return b};JSG.graph.controller.PortController.prototype._newFeedback=function(a,b,c){return new JSG.graph.feedback.PortFeedback(a,b,c)};JSG.namespace("JSG.graph.controller");JSG.graph.controller.RootController=function(){JSG.graph.controller.RootController._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.controller.RootController,JSG.graph.controller.ModelController);
JSG.graph.controller.RootController.prototype.getViewer=function(){return this.viewer};JSG.graph.controller.RootController.prototype.setViewer=function(a){this.viewer=a};JSG.graph.controller.RootController.prototype.getRootParent=function(){return this};JSG.graph.controller.RootController.prototype.hasContent=function(){return void 0!=this.content};JSG.graph.controller.RootController.prototype.getContent=function(){return this.content};
JSG.graph.controller.RootController.prototype.setContent=function(a){void 0!=this.content&&this.removeChild(this.content);this.content=a;void 0!=this.content&&this.addChild(this.content,0);this.setView(a.getView())};JSG.graph.controller.RootController.prototype._isSelectableInParent=function(a){return a.getModel().isSelectable()};JSG.graph.controller.RootController.prototype.getControllerAt=function(a,b,c){return void 0!=this.content?this.content.getControllerAt(a,b,c):void 0};
JSG.graph.controller.RootController.prototype.findControllerByConditionAndLocation=function(a,b){return void 0!=this.content?this.content.findControllerByConditionAndLocation(a,b):void 0};JSG.graph.controller.RootController.prototype.findControllerByConditionAndBox=function(a,b){return void 0!=this.content?this.content.findControllerByConditionAndBox(a,b):void 0};JSG.namespace("JSG.graph.controller");
JSG.graph.controller.GraphControllerFactory=function(){function a(){return{getController:function(a){var b=void 0;a instanceof JSG.graph.model.Graph?b=JSG.graph.controller.GraphController:a instanceof JSG.graph.model.ContainerNode?b=JSG.graph.controller.ContainerNodeController:a instanceof JSG.graph.model.Node?b=JSG.graph.controller.NodeController:a instanceof JSG.graph.model.LineConnection?b=JSG.graph.controller.ConnectionController:a instanceof JSG.graph.model.Port&&(b=JSG.graph.controller.PortController);
return b},createController:function(a){var b=this.getController(a);return void 0!=b?new b(a):void 0}}}var b=void 0;return{getInstance:function(){b||(b=a());return b}}}();JSG.namespace("JSG.graph.feedback");JSG.graph.feedback.Feedback=function(a,b,c){this._fbItem=a;this._fbView=b;this._orgItem=c;this._fbItem.addEventListener(JSG.graph.model.events.Event.ALL,this);this._fbItem._original=c;this._fbItem.getOriginal=function(){return this._original}};
JSG.graph.feedback.Feedback.prototype.init=function(){this._fbItem._parent=this._orgItem.getGraph();var a=this._fbItem.getItems();if(1===a.length?a[0]instanceof JSG.graph.model.TextNode:!(1<a.length))a=this._fbItem.getFormat(),a.getLineStyle().getValue()===JSG.graph.attr.FormatAttributes.LineStyle.NONE&&a.setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.SOLID);this._fbItem.refresh();this._translate(this._orgItem,this._orgItem.getGraph())};
JSG.graph.feedback.Feedback.prototype._translate=function(a,b){if(void 0!=a&&void 0!=b&&a!==b){var c=a.getAngle().getValue(),d=c,e=a.getOrigin();JSG.graph.Utils.traverseItemUp(a.getParent(),b,function(a){c+=a.getAngle().getValue();a.translateToParent(e);return!0});this._translateTo(e,c,d)}};JSG.graph.feedback.Feedback.prototype._translateTo=function(a,b){this.setAngle(b);this.setOriginTo(a)};JSG.graph.feedback.Feedback.prototype.draw=function(a){void 0!=this._fbView&&this._fbView.draw(a)};
JSG.graph.feedback.Feedback.prototype.getItem=function(){return this._fbItem};JSG.graph.feedback.Feedback.prototype.getFeedbackItem=function(){return this._fbItem};JSG.graph.feedback.Feedback.prototype.getOriginalItem=function(){return this._orgItem};JSG.graph.feedback.Feedback.prototype.getFeedbackView=function(){return this._fbView};JSG.graph.feedback.Feedback.prototype.setFeedbackView=function(a){this._fbView=a};JSG.graph.feedback.Feedback.prototype.getAngle=function(){return this._fbItem.getAngle().getValue()};
JSG.graph.feedback.Feedback.prototype.setAngle=function(a){this._fbItem.setAngle(a)};JSG.graph.feedback.Feedback.prototype.setOriginTo=function(a){this._fbItem.setOriginTo(a)};JSG.graph.feedback.Feedback.prototype.getOrigin=function(a){a=void 0!=a?a:new JSG.geometry.Point(0,0);return this._fbItem.getOrigin(a)};JSG.graph.feedback.Feedback.prototype.getItemAttributes=function(){return this._fbItem.getItemAttributes()};JSG.graph.feedback.Feedback.prototype.getFormat=function(){return this._fbItem.getFormat()};
JSG.graph.feedback.Feedback.prototype.isMoveable=function(){return this._fbItem.getItemAttributes().getMoveable().getValue()};JSG.graph.feedback.Feedback.prototype.setMoveable=function(a){this._fbItem.setItemAttribute(JSG.graph.attr.ItemAttributes.MOVEABLE,a)};JSG.graph.feedback.Feedback.prototype.isRotatable=function(){return this._fbItem.getItemAttributes().getRotatable().getValue()};JSG.graph.feedback.Feedback.prototype.rotate=function(a,b){var c=this._fbItem;c.rotate(a,b);c.refresh()};
JSG.graph.feedback.Feedback.prototype.getBoundingBox=function(a){return this._fbItem.getBoundingBox(a)};JSG.graph.feedback.Feedback.prototype.initResize=function(a){};JSG.graph.feedback.Feedback.prototype.resize=function(a){};JSG.graph.feedback.Feedback.prototype.updateReshapePoint=function(a,b){var c=this._fbItem,d=c.getReshapeCoordinateAt(a),e=Math.min(d.getXMax(),b.x),e=Math.max(d.getXMin(),e),f=Math.min(d.getYMax(),b.y),f=Math.max(d.getYMin(),f);c.setReshapeCoordinateAt(a,e,f);c.refresh()};
JSG.graph.feedback.Feedback.prototype.handlePreEvent=function(a){};JSG.graph.feedback.Feedback.prototype.handlePostEvent=function(a){a.source!==this._fbItem&&this._fbItem.refresh()};JSG.namespace("JSG.graph.feedback");JSG.graph.feedback.PortFeedback=function(a,b,c){JSG.graph.feedback.PortFeedback._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.feedback.PortFeedback,JSG.graph.feedback.Feedback);JSG.graph.feedback.PortFeedback.prototype.init=function(){JSG.graph.feedback.PortFeedback._super.init.call(this)};
JSG.namespace("JSG.graph.feedback");JSG.graph.feedback.EdgeFeedback=function(a,b,c){JSG.graph.feedback.EdgeFeedback._super.constructor.apply(this,arguments);this._nodeListener=new JSG.graph.feedback.EdgeFeedback.NodeListener(this)};JSG.extend(JSG.graph.feedback.EdgeFeedback,JSG.graph.feedback.Feedback);
JSG.graph.feedback.EdgeFeedback.prototype.init=function(){JSG.graph.feedback.EdgeFeedback._super.init.call(this);var a=this._fbItem,b=this._orgItem;a.hasSourceAttached=function(){return b.hasSourceAttached()};a.getSourcePort=function(){return b.getSourcePort()};a.hasTargetAttached=function(){return b.hasTargetAttached()};a.getTargetPort=function(){return b.getTargetPort()};if(a.hasSourceAttached()){var c=a.getStartCoordinate(),d=b.getStartCoordinate().toPoint();a.setStartCoordinateTo(this.createCoordinateProxyAt(d,
c))}a.hasTargetAttached()&&(c=a.getEndCoordinate(),d=b.getEndCoordinate().toPoint(),a.setEndCoordinateTo(this.createCoordinateProxyAt(d,c)));a.refresh()};JSG.graph.feedback.EdgeFeedback.prototype.initResize=function(a){function b(b){b.subtract(f);a.rotateLocalPointInverse(b);b.set(b.x/e.x,b.y/e.y);return b}var c=this,d=this.getFeedbackItem().getPoints(),e=a.getSize(),f=a.getTopLeft();this._resizeFactors=[];d.forEach(function(a){c._resizeFactors.push(b(a.copy()))})};
JSG.graph.feedback.EdgeFeedback.prototype.resize=function(a){for(var b=a.getSize(),c=a.getTopLeft(),d=new JSG.geometry.Point(0,0),e=this.getFeedbackItem(),f=e._shape.getCoordinates(),g=0;g<f.length;g++)if(void 0!=this._resizeFactors[g]){var l;l=b;var h=d.setTo(this._resizeFactors[g]);h.set(h.x*l.x,h.y*l.y);a.rotateLocalPoint(h);h.add(c);l=h;e.translateFromParent(l);f[g].set(l.x,l.y)}};JSG.graph.feedback.EdgeFeedback.prototype.getPoints=function(){return this.getFeedbackItem().getPoints()};
JSG.graph.feedback.EdgeFeedback.prototype.getEndPoint=function(a){return this.getFeedbackItem().getEndPoint(a)};JSG.graph.feedback.EdgeFeedback.prototype.setEndPointTo=function(a){this.detachFromTarget();this.getFeedbackItem().setEndPointTo(a)};JSG.graph.feedback.EdgeFeedback.prototype.getStartPoint=function(a){return this.getFeedbackItem().getStartPoint(a)};JSG.graph.feedback.EdgeFeedback.prototype.setStartPointTo=function(a){this.detachFromSource();this.getFeedbackItem().setStartPointTo(a)};
JSG.graph.feedback.EdgeFeedback.prototype.setPointAt=function(a,b){var c=this.getFeedbackItem();0===a?this.detachFromSource():a==c.getPointsCount()-1&&this.detachFromTarget();c.setPointAt(a,b)};JSG.graph.feedback.EdgeFeedback.prototype.getPointAt=function(a,b){return this.getFeedbackItem().getPointAt(a,b)};JSG.graph.feedback.EdgeFeedback.prototype.setSourcePort=function(a){this.getFeedbackItem().setSourcePort(a);void 0!==a.getParent()&&this._nodeListener.registerTo(a.getParent())};
JSG.graph.feedback.EdgeFeedback.prototype.setTargetPort=function(a){this.getFeedbackItem().setTargetPort(a);void 0!==a.getParent()&&this._nodeListener.registerTo(a.getParent())};JSG.graph.feedback.EdgeFeedback.prototype.detach=function(){this.detachFromSource();this.detachFromTarget()};
JSG.graph.feedback.EdgeFeedback.prototype.detachFromSource=function(){var a=this.getFeedbackItem(),b=a.getSourcePort();if(void 0!==b){var c=a.getStartCoordinate().toPoint();a.detachPort(b);a.setStartCoordinateTo(new JSG.graph.Coordinate.fromPoint(c));a.hasSourceAttached=function(){return!1};a.getSourcePort=function(){};this._nodeListener.deregisterFrom(b.getParent())}};
JSG.graph.feedback.EdgeFeedback.prototype.detachFromTarget=function(){var a=this.getFeedbackItem(),b=a.getTargetPort();if(void 0!==b){var c=a.getEndCoordinate().toPoint();a.detachPort(b);a.setEndCoordinateTo(new JSG.graph.Coordinate.fromPoint(c));a.hasTargetAttached=function(){return!1};a.getTargetPort=function(){};this._nodeListener.deregisterFrom(b.getParent())}};JSG.graph.feedback.EdgeFeedback.prototype.onNodeChange=function(a){this.getFeedbackItem().refresh()};
JSG.graph.feedback.EdgeFeedback.prototype.isStartOrEndPointIndex=function(a){return 0===a||a===this.getFeedbackItem().getPointsCount()-1};JSG.graph.feedback.EdgeFeedback.prototype.doAutoLayout=function(){return this.getFeedbackItem().getLayoutAttributes().getLineBehavior().getValue()!==JSG.graph.model.shapes.OrthoLineBehavior.MANUAL};
JSG.graph.feedback.EdgeFeedback.prototype.createCoordinateProxyAt=function(a,b){var c=new JSG.graph.CoordinateProxy(b);c.location=a.copy();c.setX=function(a){};c.setY=function(a){};c.evaluate=function(a){};c.copy=function(){var a=new JSG.graph.Coordinate;a.setToPoint(this.toPoint());return a};c.toPoint=function(a){return void 0!=a?a.setTo(this.location):this.location.copy()};return c};JSG.graph.feedback.EdgeFeedback.prototype.draw=function(a){this._fbItem.refresh();void 0!=this._fbView&&this._fbView.draw(a)};
JSG.graph.feedback.EdgeFeedback.NodeListener=function(a){this._feedback=a};JSG.graph.feedback.EdgeFeedback.NodeListener.prototype.registerTo=function(a){var b=JSG.graph.model.events.Event;a.addEventListener(b.ANGLE,this);a.addEventListener(b.BBOX,this);a.addEventListener(b.PIN,this)};
JSG.graph.feedback.EdgeFeedback.NodeListener.prototype.deregisterFrom=function(a){var b=JSG.graph.model.events.Event;a.removeEventListener(b.ANGLE,this);a.removeEventListener(b.BBOX,this);a.removeEventListener(b.PIN,this)};JSG.graph.feedback.EdgeFeedback.NodeListener.prototype.handlePreEvent=function(a){};JSG.graph.feedback.EdgeFeedback.NodeListener.prototype.handlePostEvent=function(a){this._feedback.onNodeChange(a.source)};JSG.namespace("JSG.graph.feedback");
JSG.graph.feedback.OrthoEdgeFeedback=function(a,b,c){JSG.graph.feedback.OrthoEdgeFeedback._super.constructor.apply(this,arguments);this._fbItem.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.DASH)};JSG.extend(JSG.graph.feedback.OrthoEdgeFeedback,JSG.graph.feedback.EdgeFeedback);JSG.namespace("JSG.graph.command");JSG.graph.command.Command=function(){};JSG.graph.command.Command.prototype.execute=function(){};JSG.graph.command.Command.prototype.undo=function(){};
JSG.graph.command.Command.prototype.redo=function(){};JSG.graph.command.Command.prototype.restoreStateAfterUndo=function(a){};JSG.graph.command.Command.prototype.restoreStateAfterRedo=function(a){};JSG.graph.command.Command.prototype.selectAll=function(a){var b=[],c=arguments[0],d=arguments.length-1,e=arguments[d];if(void 0!=c.length)this._addItemControllers(c,b,e);else for(c=0;c<d;c++)this._addItemController(arguments[c],b,e);e.getSelectionProvider().setSelection(b)};
JSG.graph.command.Command.prototype._addItemControllers=function(a,b,c){for(var d=0;d<a.length;d++)this._addItemController(a[d],b,c)};JSG.graph.command.Command.prototype._addItemController=function(a,b,c){a=c.findControllerForItem(a);void 0!=a&&b.push(a)};JSG.namespace("JSG.graph.command");JSG.graph.command.CommandProxy=function(a){this._cmd=a};JSG.extend(JSG.graph.command.CommandProxy,JSG.graph.command.Command);JSG.graph.command.CommandProxy.prototype.execute=function(){this._cmd.execute()};
JSG.graph.command.CommandProxy.prototype.undo=function(){this._cmd.undo()};JSG.graph.command.CommandProxy.prototype.redo=function(){this._cmd.redo()};JSG.graph.command.CommandProxy.prototype.restoreStateAfterUndo=function(a){this._cmd.restoreStateAfterUndo(a)};JSG.graph.command.CommandProxy.prototype.restoreStateAfterRedo=function(a){this._cmd.restoreStateAfterRedo(a)};JSG.namespace("JSG.graph.command");
JSG.graph.command.CompoundCommand=function(a){JSG.graph.command.CompoundCommand._super.constructor.apply(this);this.commands=[];this._oldRefreshStates=[];this._callRefreshAfter=this._refreshDisabled=!1;this._reverseUndo=a};JSG.extend(JSG.graph.command.CompoundCommand,JSG.graph.command.Command);JSG.graph.command.CompoundCommand.prototype.add=function(a){this.commands.push(a);return a};
JSG.graph.command.CompoundCommand.prototype.execute=function(){this._disableRefresh();for(var a=0,b=this.commands.length;a<b;a++)this.initNextCommand(this.commands[a],a),this.commands[a].execute();this._enableRefresh()};JSG.graph.command.CompoundCommand.prototype.initNextCommand=function(a,b){};JSG.graph.command.CompoundCommand.prototype.undo=function(){this._disableRefresh();(this._reverseUndo?this._undoFiFo:this._undoLiFo).call(this);this._enableRefresh()};
JSG.graph.command.CompoundCommand.prototype._undoLiFo=function(){for(var a=this.commands.length-1;0<=a;a--)this.commands[a].undo()};JSG.graph.command.CompoundCommand.prototype._undoFiFo=function(){for(var a=0,b=this.commands.length;a<b;a++)this.commands[a].undo()};JSG.graph.command.CompoundCommand.prototype.redo=function(){this._disableRefresh();for(var a=0,b=this.commands.length;a<b;a++)this.commands[a].redo();this._enableRefresh()};
JSG.graph.command.CompoundCommand.prototype.disableRefresh=function(a){this._refreshDisabled=!0;this._callRefreshAfter=a};JSG.graph.command.CompoundCommand.prototype._disableRefresh=function(){if(!0===this._refreshDisabled)for(var a=0,b=this.commands.length;a<b;a++){var c=this._getItemFrom(this.commands[a]);void 0!=c&&(this._oldRefreshStates[a]=c.isRefreshEnabled(),c.disableRefresh())}};
JSG.graph.command.CompoundCommand.prototype._enableRefresh=function(){if(!0===this._refreshDisabled)for(var a=0,b=this.commands.length;a<b;a++)if(!0===this._oldRefreshStates[a]){var c=this._getItemFrom(this.commands[a]);void 0!=c&&c.enableRefresh(this._callRefreshAfter)}};JSG.graph.command.CompoundCommand.prototype._getItemFrom=function(a){return void 0!=a.getItem?a.getItem():void 0};JSG.graph.command.CompoundCommand.prototype.restoreStateAfterUndo=function(a){this.restoreState(a)};
JSG.graph.command.CompoundCommand.prototype.restoreStateAfterRedo=function(a){this.restoreState(a)};JSG.graph.command.CompoundCommand.prototype.restoreState=function(a){var b=[];this._addToSelection(this,b,a);a.setSelection(b)};JSG.graph.command.CompoundCommand.prototype._addToSelection=function(a,b,c){if(void 0==a.commands)a=this._findItemController(a,c),void 0!=a&&b.push(a);else for(var d=0,e=a.commands.length;d<e;d++)this._addToSelection(a.commands[d],b,c)};
JSG.graph.command.CompoundCommand.prototype._findItemController=function(a,b){var c=this._getItemFrom(a);return void 0!=c?b.findControllerForItem(c):void 0};JSG.namespace("JSG.graph.command");JSG.graph.command.CommandStack=function(){this.undostack=[];this.redostack=[]};JSG.graph.command.CommandStack.prototype.execute=function(a){!a||void 0!=a.isNoOp&&!1!=a.isNoOp||(this._clearRedoStack(),a.execute(),this.undostack.push(a))};
JSG.graph.command.CommandStack.prototype._clearRedoStack=function(){this.redostack=[]};JSG.graph.command.CommandStack.prototype.canUndo=function(){return!this.undostack.isEmpty()};JSG.graph.command.CommandStack.prototype.canRedo=function(){return!this.redostack.isEmpty()};JSG.graph.command.CommandStack.prototype.undo=function(){if(this.canUndo()){var a=this.undostack.pop();a.undo();this.redostack.push(a);return a}JSG.debug.log("undo stack is empty!")};
JSG.graph.command.CommandStack.prototype.redo=function(){if(this.canRedo()){var a=this.redostack.pop();a.redo();this.undostack.push(a);return a}JSG.debug.log("redo stack is empty!")};JSG.namespace("JSG.graph.command");JSG.graph.command.NoOpCommand=function(){JSG.graph.command.NoOpCommand._super.constructor.apply(this,arguments);this.isNoOp=!0};JSG.extend(JSG.graph.command.NoOpCommand,JSG.graph.command.Command);JSG.namespace("JSG.graph.command");
JSG.graph.command.AbstractItemCommand=function(a){JSG.graph.command.AbstractItemCommand._super.constructor.apply(this);this._graphItem=a};JSG.extend(JSG.graph.command.AbstractItemCommand,JSG.graph.command.Command);JSG.graph.command.AbstractItemCommand.prototype.getItem=function(){return this._graphItem};JSG.graph.command.AbstractItemCommand.prototype.execute=function(){this.redo()};JSG.graph.command.AbstractItemCommand.prototype.restoreStateAfterUndo=function(a){this.restoreState(a)};
JSG.graph.command.AbstractItemCommand.prototype.restoreStateAfterRedo=function(a){this.restoreState(a)};JSG.graph.command.AbstractItemCommand.prototype.restoreState=function(a){this.selectAll(this._graphItem,a)};JSG.namespace("JSG.graph.command");JSG.graph.command.AbstractItemCommandProxy=function(a){JSG.graph.command.AbstractItemCommandProxy._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.command.AbstractItemCommandProxy,JSG.graph.command.CommandProxy);
JSG.graph.command.AbstractItemCommandProxy.prototype.getItem=function(){return this._cmd.getItem()};JSG.namespace("JSG.graph.command");JSG.graph.command.AddItemCommand=function(a,b,c){JSG.graph.command.AddItemCommand._super.constructor.apply(this,arguments);this._index=c;this._parent=b};JSG.extend(JSG.graph.command.AddItemCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.AddItemCommand.prototype.undo=function(){var a=this._graphItem.getParent(),a=void 0!=a?a:this._parent;a.removeItem(this._graphItem)};
JSG.graph.command.AddItemCommand.prototype.redo=function(){this._parent.addItem(this._graphItem,this._index)};JSG.namespace("JSG.graph.command");JSG.graph.command.AddLabelCommand=function(a,b){JSG.graph.command.AddLabelCommand._super.constructor.apply(this,arguments);this._parent=a;this._text=b;this._label};JSG.extend(JSG.graph.command.AddLabelCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.AddLabelCommand.prototype.undo=function(){this._parent.removeItem(this._label)};
JSG.graph.command.AddLabelCommand.prototype.redo=function(){this._label=this._parent.addLabel(this._text)};JSG.namespace("JSG.graph.command");JSG.graph.command.AddPortCommand=function(a,b,c,d){JSG.graph.command.AddPortCommand._super.constructor.apply(this,arguments);this._parent=c;this._port=a;this._location=b.copy();this._relative=void 0==d?!1:d};JSG.extend(JSG.graph.command.AddPortCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.AddPortCommand.prototype.undo=function(){this._parent.removePort(this._port)};
JSG.graph.command.AddPortCommand.prototype.redo=function(){this._relative?this._parent.addPortAtRelativeLocation(this._port,this._location):this._parent.addPortAtLocation(this._port,this._location)};JSG.namespace("JSG.graph.command");JSG.graph.command.Alignment={TOP:0,MIDDLE:1,BOTTOM:2,LEFT:3,CENTER:4,RIGHT:5,HDISTRIBUTE:6,VDISTRIBUTE:7};
JSG.graph.command.AlignItemsCommand=function(a,b){JSG.graph.command.AlignItemsCommand._super.constructor.apply(this,arguments);this._iteminfos=[];this._alignFlag=b;for(var c=0;c<a.length;c++){var d=a[c].getModel();d instanceof JSG.graph.model.LineConnection||this._iteminfos.push({item:d,pin:d.getPin().copy(),angle:d.getAngle().copy()})}};JSG.extend(JSG.graph.command.AlignItemsCommand,JSG.graph.command.Command);
JSG.graph.command.AlignItemsCommand.prototype.restoreStateAfterUndo=function(a){this.selectAll(this.getItemsFromInfos(),a)};JSG.graph.command.AlignItemsCommand.prototype.restoreStateAfterRedo=function(a){this.selectAll(this.getItemsFromInfos(),a)};JSG.graph.command.AlignItemsCommand.prototype.getItemsFromInfos=function(){for(var a=[],b=0;b<this._iteminfos.length;b++)a.push(this._iteminfos[b].item);return a};JSG.graph.command.AlignItemsCommand.prototype.execute=function(){this.redo()};
JSG.graph.command.AlignItemsCommand.prototype.undo=function(){for(var a=0;a<this._iteminfos.length;a++){var b=this._iteminfos[a],c=b.item;c.setAngle(b.angle);c.getPin().setTo(b.pin);c.getAngle().evaluate(c);c.getPin().evaluate(c)}};
JSG.graph.command.AlignItemsCommand.prototype.redo=function(){var a,b,c,d,e=0,f=0,g=[],l=[],h=JSG.boxCache.get(),m=JSG.boxCache.get(),k=JSG.rectCache.get(),n=JSG.rectCache.get(),q=this._iteminfos[0].item.getGraph(),p,s;for(p=0;p<this._iteminfos.length;p++){var u=this._iteminfos[p],t=u.item.getTranslatedBoundingBox(q,m).getBoundingRectangle(n);if(p){a=Math.min(a,t.x);c=Math.min(c,t.y);b=Math.max(b,t.getRight());d=Math.max(d,t.getBottom());e+=t.width;f+=t.height;for(s=0;s<g.length;s++){var w=g[s].getTranslatedBoundingBox(q,
h).getBoundingRectangle(k);if(w.x>=t.x){g.insert(u.item,s);break}}s==g.length&&g.push(u.item);for(s=0;s<l.length;s++)if(w=l[s].getTranslatedBoundingBox(q,h).getBoundingRectangle(k),w.y>=t.y){l.insert(u.item,s);break}s==l.length&&l.push(u.item)}else a=t.x,c=t.y,b=t.getRight(),d=t.getBottom(),e=t.width,f=t.height,g.push(u.item),l.push(u.item)}s=a;w=c;for(p=0;p<this._iteminfos.length;p++){var u=this._iteminfos[p],v=u.item.getPinPoint(JSG.ptCache.get()),t=u.item.getTranslatedBoundingBox(q,m).getBoundingRectangle(n);
JSG.graph.Utils.translatePointUp(v,u.item.getParent(),q);switch(this._alignFlag){case JSG.graph.command.Alignment.HDISTRIBUTE:if(this._iteminfos.length){var A=(b-a-e)/(this._iteminfos.length-1),D=g[p],u=this._getInfoForItem(D);u.item.getPinPoint(v);t=D.getTranslatedBoundingBox(q,h).getBoundingRectangle(k);v.x+=s-t.x;this._setPinPoint(v,q,D);s+=A+t.width}break;case JSG.graph.command.Alignment.VDISTRIBUTE:this._iteminfos.length&&(A=(d-c-f)/(this._iteminfos.length-1),D=l[p],u=this._getInfoForItem(D),
u.item.getPinPoint(v),t=D.getTranslatedBoundingBox(q,h).getBoundingRectangle(k),v.y+=w-t.y,this._setPinPoint(v,q,D),w+=A+t.height);break;case JSG.graph.command.Alignment.TOP:v.y+=c-t.y;this._setPinPoint(v,q,u.item);break;case JSG.graph.command.Alignment.MIDDLE:A=(d+c)/2;v.y+=A-t.getCenterY();this._setPinPoint(v,q,u.item);break;case JSG.graph.command.Alignment.BOTTOM:v.y+=d-t.getBottom();this._setPinPoint(v,q,u.item);break;case JSG.graph.command.Alignment.LEFT:v.x+=a-t.x;this._setPinPoint(v,q,u.item);
break;case JSG.graph.command.Alignment.CENTER:A=(b+a)/2;v.x+=A-t.getCenterX();this._setPinPoint(v,q,u.item);break;case JSG.graph.command.Alignment.RIGHT:v.x+=b-t.getRight(),this._setPinPoint(v,q,u.item)}}JSG.ptCache.release(v);JSG.boxCache.release(m,h);JSG.rectCache.release(n,k)};JSG.graph.command.AlignItemsCommand.prototype._setPinPoint=function(a,b,c){JSG.graph.Utils.translatePointDown(a,b,c.getParent());c.setPinPointTo(a)};
JSG.graph.command.AlignItemsCommand.prototype._getInfoForItem=function(a){a=a.getId();for(var b=0;b<this._iteminfos.length;b++){var c=this._iteminfos[b];if(a==c.item.getId())return c}};JSG.namespace("JSG.graph.command");
JSG.graph.command.ChangeParentCommand=function(a,b){JSG.graph.command.ChangeParentCommand._super.constructor.apply(this,arguments);this._oldPin=a.getPin().copy();this._oldParent=a.getParent();for(var c=this._newParent=b,d=!1,e=a.getParent();!d&&void 0!=e;)d=e===c,e=e.getParent();this._translateUp=d};JSG.extend(JSG.graph.command.ChangeParentCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.ChangeParentCommand.prototype.undo=function(){this._graphItem.getPin().setTo(this._oldPin);this._graphItem.changeParent(this._oldParent);this._graphItem.getPin().evaluate(this._graphItem)};JSG.graph.command.ChangeParentCommand.prototype.redo=function(){this._translateItemToParent(this._newParent,this._translateUp);this._graphItem.changeParent(this._newParent)};
JSG.graph.command.ChangeParentCommand.prototype._translateItemToParent=function(a,b){function c(a){a.translateToParent(e)}function d(a){a.translateFromParent(e)}var e=this._graphItem.getPinPoint();(function(a,e){b?JSG.graph.Utils.traverseItemUp(a.getParent(),e,c):JSG.graph.Utils.traverseItemDown(a,e,d)})(this._graphItem,a);this._graphItem.setPinPointTo(e)};JSG.namespace("JSG.graph.command");
JSG.graph.command.DropItemCommand=function(a){JSG.graph.command.DropItemCommand._super.constructor.apply(this,arguments);this._editor=a.editor;this._target=a.target;this._libId=a.libId;this._libName=a.libName;this._newPinPoint=void 0!=a.newPinPoint?a.newPinPoint:new JSG.geometry.Point(0,0);this._model=a.target.getModel();this._angle=void 0!=a.angle?a.angle:0;this._nodes};JSG.extend(JSG.graph.command.DropItemCommand,JSG.graph.command.Command);
JSG.graph.command.DropItemCommand.prototype.restoreStateAfterRedo=function(a){void 0!=this._nodes&&this.selectAll(this._nodes,a)};JSG.graph.command.DropItemCommand.prototype.execute=function(){this.redo()};JSG.graph.command.DropItemCommand.prototype.undo=function(){for(var a=0;a<this._nodes.length;a++)this._model.removeItem(this._nodes[a])};JSG.graph.command.DropItemCommand.prototype.redo=function(){for(var a=0;a<this._nodes.length;a++)this._model.addItem(this._nodes[a])};
JSG.graph.command.DropItemCommand.prototype.execute=function(){var a=this._editor._graphViewer;a.getGraphView().clearFeedback();JSG.connectionRestorer=new JSG.graph.model.ConnectionRestorer;var b=JSG.graphItemFactory.createItemFromString(this._libId);b?(this._nodes=[],this._nodes.push(b),b.setSize(3E3,1E3)):this._nodes=JSG.graphItemFactory.createShape(this._libId);if(!this._nodes||!this._nodes.length)return!1;a.getCoordinateSystem();var c=this._newPinPoint.copy(),b=this._editor.getGraph(),d=a.rootController.getView(),
e=void 0;1==this._nodes.length&&(e=JSG.layoutFactory.getLayoutIndex(c,a,this._target,this._libName,!1,!0));JSG.setDrawingDisabled(!0);a.clearSelection();var f=this._nodes[0].getPinPoint(),g=this._angle;JSG.graph.Utils.traverseDown(d,this._target.getView(),function(a){g-=a.getAngle();a.translateFromParent(c);return!0});g=-1!=this._angle?g:0;for(d=0;d<this._nodes.length;d++){this._nodes[d].setAngle(g);var l=this._nodes[d].getPinPoint(),l=new JSG.geometry.Point(l.x-(f.x-c.x),l.y-(f.y-c.y));this._nodes[d].setPinPointTo(l);
this._model.addItem(this._nodes[d])}JSG.connectionRestorer.updateIds(b);JSG.connectionRestorer=void 0;b._restoreConnections(b);b.evaluate();void 0!=e&&(f=this._target.getModelController(this._nodes[0]),e.before?f.moveToIndex(e.index):f.moveToIndex(e.index+1));JSG.setDrawingDisabled(!1);for(e=0;e<this._nodes.length;e++)f=this._target.getModelController(this._nodes[e]),a.select(f);b.setChanged(!0);this._editor.invalidate()};JSG.namespace("JSG.graph.command");
JSG.graph.command.InternalMoveItemCommand=function(a,b){JSG.graph.command.InternalMoveItemCommand._super.constructor.apply(this,arguments);this._oldPin=a.getPin().copy();this._newPinPoint=b.copy();this._vPos=a.getTextFormat().getVerticalPosition().getValue();this._hPos=a.getTextFormat().getHorizontalPosition().getValue()};JSG.extend(JSG.graph.command.InternalMoveItemCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.InternalMoveItemCommand.prototype.undo=function(){this._graphItem instanceof JSG.graph.model.TextNode&&(this._graphItem.getTextFormat().setVerticalPosition(this._vPos),this._graphItem.getTextFormat().setHorizontalPosition(this._hPos));this._graphItem.getPin().setTo(this._oldPin);this._graphItem.getPin().evaluate(this._graphItem)};
JSG.graph.command.InternalMoveItemCommand.prototype.redo=function(){this._graphItem instanceof JSG.graph.model.TextNode&&(this._graphItem.getTextFormat().setVerticalPosition(JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.CUSTOM),this._graphItem.getTextFormat().setHorizontalPosition(JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.CUSTOM));this._graphItem.setPinPointTo(this._newPinPoint);this._graphItem.getPin().evaluate(this._graphItem)};JSG.namespace("JSG.graph.command");
JSG.graph.command.MoveNodeCommand=function(a,b){function c(a,b){for(var c=0;c<a.length;c++){var g=a[c];void 0==b.get(g.getId())&&b.put(g.getId(),g.getPoints())}}JSG.graph.command.MoveNodeCommand._super.constructor.apply(this,arguments);this._pointsMap=function(){for(var b=a.getPorts(),e=new JSG.commons.Map,f=0;f<b.length;f++){var g=b[f];c(g.getIncomingEdges(),e);c(g.getOutgoingEdges(),e)}return e}()};JSG.extend(JSG.graph.command.MoveNodeCommand,JSG.graph.command.InternalMoveItemCommand);
JSG.graph.command.MoveNodeCommand.prototype.undo=function(){function a(a,b){for(var c=0;c<a.length;c++){var d=a[c],h=b.get(d.getId());void 0!=h&&d.setPoints(h)}}JSG.graph.command.MoveNodeCommand._super.undo.call(this);for(var b=this._graphItem.getPorts(),c=0;c<b.length;c++){var d=b[c];a(d.getIncomingEdges(),this._pointsMap);a(d.getOutgoingEdges(),this._pointsMap)}};JSG.namespace("JSG.graph.command");
JSG.graph.command.MoveEdgeCommand=function(a,b){JSG.graph.command.MoveEdgeCommand._super.constructor.apply(this,arguments);this._edgepoints=a.getPoints()};JSG.extend(JSG.graph.command.MoveEdgeCommand,JSG.graph.command.InternalMoveItemCommand);JSG.graph.command.MoveEdgeCommand.prototype.undo=function(){JSG.graph.command.MoveEdgeCommand._super.undo.call(this);this._graphItem.setPoints(this._edgepoints)};JSG.namespace("JSG.graph.command");
JSG.graph.command.MoveItemCommand=function(a,b){var c=a instanceof JSG.graph.model.Node?new JSG.graph.command.MoveNodeCommand(a,b):a instanceof JSG.graph.model.Edge?new JSG.graph.command.MoveEdgeCommand(a,b):new JSG.graph.command.InternalMoveItemCommand(a,b);JSG.graph.command.MoveItemCommand._super.constructor.call(this,c)};JSG.extend(JSG.graph.command.MoveItemCommand,JSG.graph.command.AbstractItemCommandProxy);JSG.namespace("JSG.graph.command");
JSG.graph.command.TranslateItemsCommand=function(){function a(a,c){c._items.push(a);c._itempins.push(a.getPin().copy());if(a instanceof JSG.graph.model.Node)for(var d=c._pointsMap,e=a.getPorts(),f=0;f<e.length;f++){var n=e[f];b(n.getIncomingEdges(),d);b(n.getOutgoingEdges(),d)}}function b(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.getLayoutAttributes().getLineBehavior().getValue()!=JSG.graph.model.shapes.OrthoLineBehavior.AUTO&&void 0==b.get(d.getId())&&b.put(d.getId(),d.getPoints())}}JSG.graph.command.TranslateItemsCommand._super.constructor.call(this);
var c=arguments.length;this.translation=arguments[c-1].copy();this._items=[];this._itempins=[];this._pointsMap=new JSG.commons.Map;for(var d=0;d<c-1;d++)if(Array.isArray(arguments[d]))for(var e=arguments[d],f=0;f<e.length;f++)a(e[f],this);else a(arguments[d],this)};JSG.extend(JSG.graph.command.TranslateItemsCommand,JSG.graph.command.Command);JSG.graph.command.TranslateItemsCommand.prototype.execute=function(){this.redo()};
JSG.graph.command.TranslateItemsCommand.prototype.undo=function(){function a(a,c){for(var d=a.getPorts(),l=0;l<d.length;l++){var h=d[l];b(h.getIncomingEdges(),c);b(h.getOutgoingEdges(),c)}}function b(a,b){for(var c=0;c<a.length;c++){var d=a[c],h=b.get(d.getId());void 0!=h&&d.setPoints(h)}}for(var c=0;c<this._items.length;c++){var d=this._items[c];d.getPin().setTo(this._itempins[c]);d.getPin().evaluate(d);d instanceof JSG.graph.model.Node&&a(d,this._pointsMap)}};
JSG.graph.command.TranslateItemsCommand.prototype.redo=function(){for(var a=this.translation,b=0;b<this._items.length;b++)this._items[b].translate(a.x,a.y)};JSG.namespace("JSG.graph.command");JSG.graph.command.SizeItems={VERTICALMAX:0,VERTICALMIN:1,HORIZONTALMAX:2,HORIZONTALMIN:3,MAX:4,MIN:5};
JSG.graph.command.SizeItemsCommand=function(a,b){JSG.graph.command.SizeItemsCommand._super.constructor.apply(this,arguments);this.items=[];this.sizes=[];this.sizeFlag=b;for(var c=0;c<a.length;c++){var d=a[c].getModel();d instanceof JSG.graph.model.Edge||(this.sizes.push(d.getSize(!0).copy()),this.items.push(d))}};JSG.extend(JSG.graph.command.SizeItemsCommand,JSG.graph.command.Command);JSG.graph.command.SizeItemsCommand.prototype.restoreStateAfterUndo=function(a){this.selectAll(this.items,a)};
JSG.graph.command.SizeItemsCommand.prototype.restoreStateAfterRedo=function(a){this.selectAll(this.items,a)};JSG.graph.command.SizeItemsCommand.prototype.execute=function(){this.redo()};JSG.graph.command.SizeItemsCommand.prototype.undo=function(){for(var a=0;a<this.items.length;a++){var b=this.items[a];b.setSizeTo(this.sizes[a]);b.getSize(!0).evaluate(b)}};
JSG.graph.command.SizeItemsCommand.prototype.redo=function(){if(this.items.length){for(var a=0,b=0,c=maxWidth=this.items[0].getWidth().getValue(),d=maxHeight=this.items[0].getHeight().getValue(),e=maxArea=c*d,f=c,g=d,l=maxWidth,h=maxHeight,m=1;m<this.items.length;m++)a=this.items[m].getWidth().getValue(),b=this.items[m].getHeight().getValue(),c=Math.min(c,a),d=Math.min(d,b),maxWidth=Math.max(a,maxWidth),maxHeight=Math.max(b,maxHeight),a*b>maxArea&&(l=a,h=b,maxArea=a*b),a*b<e&&(f=a,g=b,e=a*b);for(m=
0;m<this.items.length;m++)switch(this.sizeFlag){case JSG.graph.command.SizeItems.VERTICALMAX:this.items[m].setHeight(maxHeight);break;case JSG.graph.command.SizeItems.VERTICALMIN:this.items[m].setHeight(d);break;case JSG.graph.command.SizeItems.HORIZONTALMAX:this.items[m].setWidth(maxWidth);break;case JSG.graph.command.SizeItems.HORIZONTALMIN:this.items[m].setWidth(c);break;case JSG.graph.command.SizeItems.MAX:this.items[m].setSize(l,h);break;case JSG.graph.command.SizeItems.MIN:this.items[m].setSize(f,
g)}}};JSG.namespace("JSG.graph.command");JSG.graph.command.InternalResizeItemCommand=function(a,b){JSG.graph.command.InternalResizeItemCommand._super.constructor.apply(this,arguments);this._oldPin=a.getPin().copy();this._oldSize=a.getSize(!0).copy();this._oldAngleExpr=a.getAngle().copy();this._newbbox=b.copy()};JSG.extend(JSG.graph.command.InternalResizeItemCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.InternalResizeItemCommand.prototype.undo=function(){this._graphItem.isSizeable()&&(this._graphItem.getPin().setTo(this._oldPin),this._graphItem.setSizeTo(this._oldSize),this._graphItem.setAngle(this._oldAngleExpr),this._graphItem.evaluate())};JSG.graph.command.InternalResizeItemCommand.prototype.redo=function(){this._graphItem.isSizeable()&&this._graphItem.setBoundingBoxTo(this._newbbox)};JSG.namespace("JSG.graph.command");
JSG.graph.command.ResizeNodeCommand=function(a,b){function c(a,b){for(var c=0;c<a.length;c++){var g=a[c];void 0==b.get(g.getId())&&b.put(g.getId(),g.getPoints())}}JSG.graph.command.ResizeNodeCommand._super.constructor.apply(this,arguments);a instanceof JSG.graph.model.TextNode&&(this._oldSizeMode=a.getItemAttributes().getSizeMode().getExpression().copy(),this._newSizeMode=JSG.graph.attr.TextNodeAttributes.SizeMode.WIDTH);this._pointsMap=function(){for(var b=a.getPorts(),e=new JSG.commons.Map,f=0;f<
b.length;f++){var g=b[f];c(g.getIncomingEdges(),e);c(g.getOutgoingEdges(),e)}return e}()};JSG.extend(JSG.graph.command.ResizeNodeCommand,JSG.graph.command.InternalResizeItemCommand);JSG.graph.command.ResizeNodeCommand.prototype.redo=function(){void 0!=this._newSizeMode&&this._graphItem.getItemAttributes().setSizeMode(this._newSizeMode);JSG.graph.command.ResizeNodeCommand._super.redo.call(this)};
JSG.graph.command.ResizeNodeCommand.prototype.undo=function(){function a(a,b){for(var c=0;c<a.length;c++){var d=a[c],h=b.get(d.getId());void 0!=h&&d.setPoints(h)}}void 0!=this._oldSizeMode&&this._graphItem.getItemAttributes().setSizeMode(this._oldSizeMode);JSG.graph.command.ResizeNodeCommand._super.undo.call(this);for(var b=this._graphItem.getPorts(),c=0;c<b.length;c++){var d=b[c];a(d.getIncomingEdges(),this._pointsMap);a(d.getOutgoingEdges(),this._pointsMap)}};JSG.namespace("JSG.graph.command");
JSG.graph.command.ResizeItemCommand=function(a,b){JSG.graph.command.ResizeItemCommand._super.constructor.apply(this,arguments);a instanceof JSG.graph.model.Node?this.add(new JSG.graph.command.ResizeNodeCommand(a,b)):a instanceof JSG.graph.model.Edge?this.add(new JSG.graph.command.ResizeEdgeCommand(a,b)):this.add(new JSG.graph.command.InternalResizeItemCommand(a,b))};JSG.extend(JSG.graph.command.ResizeItemCommand,JSG.graph.command.CompoundCommand);JSG.namespace("JSG.graph.command");
JSG.graph.command.ReshapeItemCommand=function(a,b,c){JSG.graph.command.ReshapeItemCommand._super.constructor.apply(this,arguments);this._index=b;this._point=c.copy();this._oldPoint=a.getReshapeCoordinateAt(b).toPoint()};JSG.extend(JSG.graph.command.ReshapeItemCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.ReshapeItemCommand.prototype.undo=function(){this._graphItem.setReshapeCoordinateAt(this._index,this._oldPoint)};
JSG.graph.command.ReshapeItemCommand.prototype.redo=function(){var a=this._graphItem.getReshapeCoordinateAt(this._index),b=Math.min(a.getXMax(),this._point.x),b=Math.max(a.getXMin(),b),c=Math.min(a.getYMax(),this._point.y),c=Math.max(a.getYMin(),c);this._graphItem.setReshapeCoordinateAt(this._index,b,c)};JSG.namespace("JSG.graph.command");
JSG.graph.command.InternalRotateItemCommand=function(a,b,c){JSG.graph.command.InternalRotateItemCommand._super.constructor.apply(this,arguments);this._angle=b;this._oldAngle=a.getAngle().copy();this._point=c?c.copy():void 0};JSG.extend(JSG.graph.command.InternalRotateItemCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.InternalRotateItemCommand.prototype.undo=function(){this._graphItem.rotate(-this._angle,this._point);this._graphItem.setAngle(this._oldAngle);this._graphItem.getAngle().evaluate(this._graphItem)};
JSG.graph.command.InternalRotateItemCommand.prototype.redo=function(){this._graphItem.rotate(this._angle,this._point)};JSG.namespace("JSG.graph.command");JSG.graph.command.ReplaceSubItemCommand=function(a,b,c){JSG.graph.command.ReplaceSubItemCommand._super.constructor.call(this,a);this._index=b.getIndex();this._subItem=b;this._replacement=c};JSG.extend(JSG.graph.command.ReplaceSubItemCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.ReplaceSubItemCommand.prototype.undo=function(){this._graphItem.removeItem(this._replacement);this._graphItem.addItem(this._subItem,this._index)};JSG.graph.command.ReplaceSubItemCommand.prototype.redo=function(){this._graphItem.removeItem(this._subItem);this._graphItem.addItem(this._replacement,this._index)};JSG.namespace("JSG.graph.command");
JSG.graph.command.RotateNodeCommand=function(a,b,c){function d(a,b){for(var c=0;c<a.length;c++){var d=a[c];void 0==b.get(d.getId())&&b.put(d.getId(),d.getPoints())}}JSG.graph.command.RotateNodeCommand._super.constructor.apply(this,arguments);this._pointsMap=function(){for(var b=a.getPorts(),c=new JSG.commons.Map,g=0;g<b.length;g++){var l=b[g];d(l.getIncomingEdges(),c);d(l.getOutgoingEdges(),c)}return c}()};JSG.extend(JSG.graph.command.RotateNodeCommand,JSG.graph.command.InternalRotateItemCommand);
JSG.graph.command.RotateNodeCommand.prototype.undo=function(){function a(a,b){for(var c=0;c<a.length;c++){var d=a[c],h=b.get(d.getId());void 0!=h&&d.setPoints(h)}}JSG.graph.command.RotateNodeCommand._super.undo.call(this);for(var b=this._graphItem.getPorts(),c=0;c<b.length;c++){var d=b[c];a(d.getIncomingEdges(),this._pointsMap);a(d.getOutgoingEdges(),this._pointsMap)}};JSG.namespace("JSG.graph.command");
JSG.graph.command.RotateEdgeCommand=function(a,b,c){JSG.graph.command.RotateEdgeCommand._super.constructor.apply(this,arguments);this._edgepoints=a.getPoints()};JSG.extend(JSG.graph.command.RotateEdgeCommand,JSG.graph.command.InternalRotateItemCommand);JSG.graph.command.RotateEdgeCommand.prototype.undo=function(){JSG.graph.command.RotateEdgeCommand._super.undo.call(this);this._graphItem.setPoints(this._edgepoints)};JSG.namespace("JSG.graph.command");
JSG.graph.command.RotateItemCommand=function(a,b,c){a=a instanceof JSG.graph.model.Node?new JSG.graph.command.RotateNodeCommand(a,b,c):a instanceof JSG.graph.model.Edge?new JSG.graph.command.RotateEdgeCommand(a,b,c):new JSG.graph.command.InternalRotateItemCommand(a,b,c);JSG.graph.command.RotateItemCommand._super.constructor.call(this,a)};JSG.extend(JSG.graph.command.RotateItemCommand,JSG.graph.command.AbstractItemCommandProxy);JSG.namespace("JSG.graph.command");
JSG.graph.command.FormatItemCommand=function(a,b){JSG.graph.command.FormatItemCommand._super.constructor.apply(this,arguments);this._newFormatMap=b.toMap();this._oldFormatMap=a.getFormat().toMap()};JSG.extend(JSG.graph.command.FormatItemCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.FormatItemCommand.prototype.undo=function(){this._graphItem.getFormat().applyAttributesMap(this._oldFormatMap,this._graphItem)};
JSG.graph.command.FormatItemCommand.prototype.redo=function(){this._graphItem.getFormat().applyAttributesMap(this._newFormatMap,this._graphItem)};JSG.namespace("JSG.graph.command");JSG.graph.command.TextAttributeCommand=function(a,b,c){JSG.graph.command.TextAttributeCommand._super.constructor.apply(this,arguments);this._name=b;this._newValue=c;var d=a._getTextFormat().getAttribute(b);this._oldValue=d?d.getExpression().copy():void 0};JSG.extend(JSG.graph.command.TextAttributeCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.TextAttributeCommand.prototype.undo=function(){this._applyAttributeValue(this._oldValue)};JSG.graph.command.TextAttributeCommand.prototype.redo=function(){this._applyAttributeValue(this._newValue)};JSG.graph.command.TextAttributeCommand.prototype._applyAttributeValue=function(a){this._graphItem.getTextFormat().setAttribute(this._name,a,this._graphItem);this._graphItem instanceof JSG.graph.model.TextNode&&this._graphItem.updateSize()};JSG.namespace("JSG.graph.command");
JSG.graph.command.TextFormatItemCommand=function(a,b){JSG.graph.command.TextFormatItemCommand._super.constructor.apply(this,arguments);this._oldFormat=a._getTextFormat().copy();this._newFormat=b.copy()};JSG.extend(JSG.graph.command.TextFormatItemCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.TextFormatItemCommand.prototype.undo=function(){this._setTextFormatTo(this._oldFormat)};JSG.graph.command.TextFormatItemCommand.prototype.redo=function(){this._setTextFormatTo(this._newFormat)};
JSG.graph.command.TextFormatItemCommand.prototype._setTextFormatTo=function(a){this._graphItem.getTextFormat().setFormatTo(a);this._graphItem instanceof JSG.graph.model.TextNode&&this._graphItem.updateSize()};JSG.namespace("JSG.graph.command");JSG.graph.command.SetTextCommand=function(a,b,c){JSG.graph.command.SetTextCommand._super.constructor.apply(this,arguments);this.oldText=b instanceof JSG.graph.expr.Expression?b.copy():b;this.newText=c};JSG.extend(JSG.graph.command.SetTextCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.SetTextCommand.prototype.undo=function(){this._graphItem.setText(this.oldText)};JSG.graph.command.SetTextCommand.prototype.redo=function(){this._graphItem.setText(this.newText)};JSG.namespace("JSG.graph.command");JSG.graph.command.AbstractGroupUngroupCommand=function(){JSG.graph.command.AbstractGroupUngroupCommand._super.constructor.apply(this,arguments);this._oldBBoxes=[]};JSG.extend(JSG.graph.command.AbstractGroupUngroupCommand,JSG.graph.command.Command);
JSG.graph.command.AbstractGroupUngroupCommand.prototype.saveBBoxes=function(a){for(var b=0;b<a.length;b++){var c=a[b];this._oldBBoxes.push({pin:c.getPin().copy(),size:c.getSize(!0).copy(),angle:c.getAngle().copy()})}};JSG.graph.command.AbstractGroupUngroupCommand.prototype.restoreBBoxes=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=this._oldBBoxes[b];c.getPin().setTo(d.pin);c.setSizeTo(d.size);c.setAngle(d.angle);c.evaluate()}};
JSG.graph.command.AbstractGroupUngroupCommand.prototype.newGroup=function(){var a=new JSG.graph.model.Node(new JSG.graph.model.shapes.RectangleShape),b=JSG.graph.attr.consts;a.setItemAttribute(JSG.graph.attr.ItemAttributes.SELECTIONMODE,b.SelectionMode.AREA|b.SelectionMode.SELECTPARENT);a.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE);a.getFormat().setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.NONE);return a};
JSG.graph.command.AbstractGroupUngroupCommand.prototype.group=function(a,b){function c(a,b){for(var c=a[0].getBoundingBox(b),d=JSG.boxCache.get(),e=1,f=a.length;e<f;e++)c.union(a[e].getBoundingBox(d));JSG.boxCache.release(d);return c}function d(a,b,c){c.addItem(a);a.setName("group "+a.getId());a.setBoundingBoxTo(b)}function e(a,b,c,d){c=a.getAngle().getValue();var e=new JSG.geometry.Point(0,0),f=JSG.graph.expr.NumberExpression,g=d.getWidth();d=d.getHeight();for(var l=0,t=b.length;l<t;l++){var w=b[l];
w.getOrigin(e);a.translateFromParent(e);w.rotate(-c);w.setOriginTo(e);var v=w.getPin(),A=0!=g?v.getX().getValue()/g+" * Parent!WIDTH":0,D=0!=d?v.getY().getValue()/d+" * Parent!HEIGHT":0;v.setCoordinate(new f(0,A),new f(0,D));v=w.getSize();A=0!=g?v.getWidth().getValue()/g+" * Parent!WIDTH":0;D=0!=d?v.getHeight().getValue()/d+" * Parent!HEIGHT":0;v.set(new f(0,A),new f(0,D));A=w.getItemAttributes();A.setMoveable(JSG.graph.attr.consts.Direction.NONE,w);A.setSizeable(!1,w);a.addItem(w)}}a=function(a){var b=
[];if(a&&!a.isEmpty())for(var c=a[0].getParent(),d=0,e=a.length;d<e;d++)a[d].getParent()==c&&b.push(a[d]);return b}(a);if(!(2>a.length)){var f=a[0].getParent(),g=c(a,JSG.boxCache.get()),l=g.getTopLeft();d(b,g,f);e(b,a,l,g);JSG.boxCache.release(g)}};
JSG.graph.command.AbstractGroupUngroupCommand.prototype.ungroup=function(a){function b(a){var b=[],c=a.getAngle().getValue(),g=new JSG.geometry.Point(0,0),l=JSG.graph.expr.NumberExpression,h=a.getItemAttributes().getSelectionMode().getValue();a.getItems().forEach(function(m){m.getOrigin(g);a.translateToParent(g);m.rotate(c);m.setOriginTo(g);var k=m.getItemAttributes();k.setSelectionMode(h,m);k.setMoveable(JSG.graph.attr.consts.Direction.BOTH,m);k.setSizeable(!0,m);var k=m.getSize(),n=k.getWidth().getValue(),
q=k.getHeight().getValue();k.set(new l(n),new l(q));b.push(m)});return b}if(void 0!=a){var c=a.getParent();b(a).forEach(function(a){c.addItem(a)});c.removeItem(a)}};JSG.namespace("JSG.graph.command");JSG.graph.command.GroupItemsCommand=function(a){JSG.graph.command.GroupItemsCommand._super.constructor.apply(this,arguments);this._group=void 0;this._items=[];this._bboxes=[];for(var b=0;b<a.length;b++)this._items.push(a[b].getModel())};JSG.extend(JSG.graph.command.GroupItemsCommand,JSG.graph.command.AbstractGroupUngroupCommand);
JSG.graph.command.GroupItemsCommand.prototype.restoreStateAfterUndo=function(a){this.selectAll(this._items,a)};JSG.graph.command.GroupItemsCommand.prototype.restoreStateAfterRedo=function(a){void 0!=this._group&&this.selectAll(this._group,a)};JSG.graph.command.GroupItemsCommand.prototype.execute=function(){this.saveBBoxes(this._items);this.redo()};JSG.graph.command.GroupItemsCommand.prototype.undo=function(){this.ungroup(this._group);this._group=void 0;this.restoreBBoxes(this._items)};
JSG.graph.command.GroupItemsCommand.prototype.redo=function(){this._group=this.newGroup();this.group(this._items,this._group)};JSG.namespace("JSG.graph.command");JSG.graph.command.UnGroupItemsCommand=function(a){JSG.graph.command.UnGroupItemsCommand._super.constructor.apply(this,arguments);this._group=a;var b=[];this._group.getItems().forEach(function(a){b.push(a)});this._items=b};JSG.extend(JSG.graph.command.UnGroupItemsCommand,JSG.graph.command.AbstractGroupUngroupCommand);
JSG.graph.command.UnGroupItemsCommand.prototype.restoreStateAfterUndo=function(a){this.selectAll(this._group,a)};JSG.graph.command.UnGroupItemsCommand.prototype.restoreStateAfterRedo=function(a){this.selectAll(this._items,a)};JSG.graph.command.UnGroupItemsCommand.prototype.execute=function(){this.redo()};JSG.graph.command.UnGroupItemsCommand.prototype.undo=function(){this.group(this._items,this._group)};JSG.graph.command.UnGroupItemsCommand.prototype.redo=function(){this.ungroup(this._group)};JSG.namespace("JSG.graph.command");
JSG.graph.command.ChangeItemOrder={TOTOP:-1,TOBOTTOM:-2,UP:-3,DOWN:-4};JSG.graph.command.ChangeItemOrderCommand=function(a,b){JSG.graph.command.ChangeItemOrderCommand._super.constructor.apply(this,arguments);this._targetPosition=b;this._controller=a;this._oldIndex=this._controller.getIndex()};JSG.extend(JSG.graph.command.ChangeItemOrderCommand,JSG.graph.command.Command);JSG.graph.command.ChangeItemOrderCommand.prototype.restoreStateAfterUndo=function(a){this._select(this._controller,a)};
JSG.graph.command.ChangeItemOrderCommand.prototype.restoreStateAfterRedo=function(a){this._select(this._controller,a)};JSG.graph.command.ChangeItemOrderCommand.prototype._select=function(a,b){var c=[];void 0!=a&&c.push(a);b.setSelection(c)};JSG.graph.command.ChangeItemOrderCommand.prototype.execute=function(){this.redo()};JSG.graph.command.ChangeItemOrderCommand.prototype.undo=function(){this._controller.moveToIndex(this._oldIndex)};
JSG.graph.command.ChangeItemOrderCommand.prototype.redo=function(){switch(this._targetPosition){case JSG.graph.command.ChangeItemOrder.TOTOP:this._controller.moveToTop();break;case JSG.graph.command.ChangeItemOrder.TOBOTTOM:this._controller.moveToBottom();break;case JSG.graph.command.ChangeItemOrder.UP:this._controller.moveUp();break;case JSG.graph.command.ChangeItemOrder.DOWN:this._controller.moveDown();break;default:this._controller.moveToIndex(this._targetPosition)}};JSG.namespace("JSG.graph.command");
JSG.graph.command.ChangeAttributeCommand=function(a,b,c,d){JSG.graph.command.ChangeAttributeCommand._super.constructor.apply(this,arguments);this._path=b;this._newValue=c;if(void 0==d){var e=a.getAttributeAtPath(b);void 0!=e&&(d=e.getExpression())}this._oldValue=d instanceof JSG.graph.expr.Expression?d.copy():d};JSG.extend(JSG.graph.command.ChangeAttributeCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.ChangeAttributeCommand.prototype.undo=function(){this._graphItem.setAttributeAtPath(this._path,this._oldValue)};JSG.graph.command.ChangeAttributeCommand.prototype.redo=function(){this._graphItem.setAttributeAtPath(this._path,this._newValue)};JSG.namespace("JSG.graph.command");
JSG.graph.command.CollapseItemCommand=function(a){JSG.graph.command.CollapseItemCommand._super.constructor.apply(this);this._item=a;this._colBtnPos=this.getCollapseButtonPosition(a,new JSG.geometry.Point);var b=a.isCollapsed(),c=JSG.graph.attr.AttributeUtils.createItemAttributePath(JSG.graph.attr.ItemAttributes.COLLAPSED);this.add(new JSG.graph.command.ChangeAttributeCommand(a,c,!b,b));a.isMoveable()&&this.add(new JSG.graph.command.TranslateItemsCommand(a,new JSG.geometry.Point))};
JSG.extend(JSG.graph.command.CollapseItemCommand,JSG.graph.command.CompoundCommand);JSG.graph.command.CollapseItemCommand.prototype.initNextCommand=function(a,b){if(1==b){var c=this.getCollapseButtonPosition(this._item,JSG.ptCache.get());this._colBtnPos.subtract(c);a.translation.setTo(this._colBtnPos);JSG.ptCache.release(c)}};
JSG.graph.command.CollapseItemCommand.prototype.getCollapseButtonPosition=function(a,b){var c=a.getOrigin(b),d=a.getSizeAsPoint(JSG.ptCache.get()),e=JSG.ptCache.get();switch(a.getItemAttribute(JSG.graph.attr.ItemAttributes.COLLAPSEDBUTTON).getValue()){case JSG.graph.attr.consts.ButtonPosition.TOPLEFT:e.set(0,0);break;case JSG.graph.attr.consts.ButtonPosition.TOPRIGHT:e.set(d.x,0);break;case JSG.graph.attr.consts.ButtonPosition.TOPCENTER:e.set(d.x/2,0);break;case JSG.graph.attr.consts.ButtonPosition.BOTTOMCENTER:e.set(d.x/
2,d.y)}JSG.geometry.Utils.rotatePoint(e,a.getAngle().getValue());c.add(e);JSG.ptCache.release(d,e);return c};JSG.namespace("JSG.graph.command");JSG.graph.command.AttachCommand=function(a,b,c){JSG.graph.command.AttachCommand._super.constructor.apply(this,arguments);this._port=b;this._attachToSourcePort=c;this._oldPointsCount=a.getPointsCount();this._oldparent=a.getParent()};JSG.extend(JSG.graph.command.AttachCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.AttachCommand.prototype.undo=function(){var a=this._graphItem.getPointsCount(),b=a-this._oldPointsCount,a=this._attachToSourcePort?0:a-b;this._graphItem.detachPort(this._port);this._graphItem.removePointsAt(a,b);this._oldparent&&this._graphItem.getParent()!==this._oldparent&&this._switchToOldParent(this._graphItem,this._oldparent)};JSG.graph.command.AttachCommand.prototype.redo=function(){this._attachToSourcePort?this._graphItem.setSourcePort(this._port):this._graphItem.setTargetPort(this._port)};
JSG.graph.command.AttachCommand.prototype._switchToOldParent=function(a,b){(function(){var c=b.getGraph(),d=a.getOrigin(new JSG.geometry.Point(0,0));JSG.graph.Utils.traverseItemUp(a.getParent(),c,function(a){a.translateToParent(d)});JSG.graph.Utils.traverseItemDown(c,b,function(a){a.translateFromParent(d)});a.setOriginTo(d)})();a.changeParent(b)};JSG.namespace("JSG.graph.command");
JSG.graph.command.DeletePortCommand=function(a){JSG.graph.command.DeletePortCommand._super.constructor.apply(this,arguments);this.setPort(a)};JSG.extend(JSG.graph.command.DeletePortCommand,JSG.graph.command.Command);JSG.graph.command.DeletePortCommand.prototype.setPort=function(a){this._port=a;this._portnode=void 0!=a?a.getParent():void 0};JSG.graph.command.DeletePortCommand.prototype.execute=function(){this.redo()};
JSG.graph.command.DeletePortCommand.prototype.undo=function(){void 0!==this._port&&void 0!==this._portnode&&this._portnode.addPort(this._port)};JSG.graph.command.DeletePortCommand.prototype.redo=function(){void 0!==this._port&&void 0!==this._portnode&&this._portnode.removePort(this._port)};JSG.graph.command.DeletePortCommand.prototype.restoreStateAfterUndo=function(a){void 0!==this._port&&this.selectAll(this._port,a)};JSG.namespace("JSG.graph.command");
JSG.graph.command.DetachCommand=function(a,b){JSG.graph.command.DetachCommand._super.constructor.apply(this);this.add(new JSG.graph.command.InternalDetachCommand(a,b));this.add(new JSG.graph.command.DeletePortCommand(void 0))};JSG.extend(JSG.graph.command.DetachCommand,JSG.graph.command.CompoundCommand);JSG.graph.command.DetachCommand.prototype.initNextCommand=function(a,b){if(1===b){var c=this.commands[b-1]._oldport;void 0!=c&&(0===c.getEdgesCount()&&c.isDeleteable())&&a.setPort(c)}};
JSG.graph.command.InternalDetachCommand=function(a,b){JSG.graph.command.InternalDetachCommand._super.constructor.apply(this,arguments);this._oldport;this._fromSource=b===a.getSourcePort()};JSG.extend(JSG.graph.command.InternalDetachCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.InternalDetachCommand.prototype.execute=function(){this._oldport=this._fromSource?this._graphItem.getSourcePort():this._graphItem.getTargetPort();JSG.graph.command.InternalDetachCommand._super.execute.call(this)};
JSG.graph.command.InternalDetachCommand.prototype.undo=function(){void 0!=this._oldport&&(this._fromSource?this._graphItem.setSourcePort:this._graphItem.setTargetPort).call(this._graphItem,this._oldport)};JSG.graph.command.InternalDetachCommand.prototype.redo=function(){this._graphItem.detachPort(this._oldport)};JSG.namespace("JSG.graph.command");
JSG.graph.command.InternalDeleteItemCommand=function(a){JSG.graph.command.InternalDeleteItemCommand._super.constructor.apply(this,arguments);this._parent=a._parent;this._index=this._graphItem.getIndex()};JSG.extend(JSG.graph.command.InternalDeleteItemCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.InternalDeleteItemCommand.prototype.undo=function(){this._parent&&this._parent.addItem(this._graphItem,this._index)};
JSG.graph.command.InternalDeleteItemCommand.prototype.redo=function(){if(this._parent){var a=this._graphItem.getItemAttributes();!0===a.getSelected().getValue()&&a.setSelected(!1,this._graphItem);this._parent.removeItem(this._graphItem)}};JSG.namespace("JSG.graph.command");
JSG.graph.command.DeleteEdgeCommand=function(a){JSG.graph.command.DeleteEdgeCommand._super.constructor.apply(this);this._edge=a;this.add(new JSG.graph.command.DetachCommand(a,a.getSourcePort()));this.add(new JSG.graph.command.DetachCommand(a,a.getTargetPort()));this.add(new JSG.graph.command.InternalDeleteItemCommand(a))};JSG.extend(JSG.graph.command.DeleteEdgeCommand,JSG.graph.command.CompoundCommand);JSG.namespace("JSG.graph.command");
JSG.graph.command.DeleteNodeCommand=function(a){JSG.graph.command.DeleteNodeCommand._super.constructor.apply(this);this.detachEdges(a);this.add(new JSG.graph.command.InternalDeleteItemCommand(a))};JSG.extend(JSG.graph.command.DeleteNodeCommand,JSG.graph.command.CompoundCommand);
JSG.graph.command.DeleteNodeCommand.prototype.detachEdges=function(a){var b=a.getId();for(a=a.getParent();void 0!=a;){for(var c=a.getItems(),d=0,e=c.length;d<e;d++){var f=c[d];if(f instanceof JSG.graph.model.LineConnection){if(f.hasSourceNode()){var g=f.getSourceNode().createPath();g.containsId(b)&&this.add(this.createDetachCommand(f,f.getSourcePort()))}f.hasTargetNode()&&(g=f.getTargetNode().createPath(),g.containsId(b)&&this.add(this.createDetachCommand(f,f.getTargetPort())))}}a=a.getParent()}};
JSG.graph.command.DeleteNodeCommand.prototype.createDetachCommand=function(a,b){return new JSG.graph.command.DetachCommand(a,b)};JSG.namespace("JSG.graph.command");JSG.graph.command.DeleteItemCommand=function(a){JSG.graph.command.DeleteItemCommand._super.constructor.apply(this);a instanceof JSG.graph.model.Node?this.add(new JSG.graph.command.DeleteNodeCommand(a)):a instanceof JSG.graph.model.Edge?this.add(new JSG.graph.command.DeleteEdgeCommand(a)):this.add(new JSG.graph.command.InternalDeleteItemCommand(a))};
JSG.extend(JSG.graph.command.DeleteItemCommand,JSG.graph.command.CompoundCommand);JSG.namespace("JSG.graph.command");JSG.graph.command.PasteItemsCommand=function(a,b,c,d){JSG.graph.command.PasteItemsCommand._super.constructor.apply(this,arguments);this.xml=a;this.items=[];this.viewer=b;this.parent=void 0!=c?c.getModel():void 0;this.offset=d;this.oldSelection=b.getSelection()};JSG.extend(JSG.graph.command.PasteItemsCommand,JSG.graph.command.Command);
JSG.graph.command.PasteItemsCommand.prototype.execute=function(){var a=this._getStartNode();if(void 0!=a&&a.hasChildNodes()){var b=this.viewer.getGraph();JSG.connectionRestorer=new JSG.graph.model.ConnectionRestorer;this._paste(a);JSG.connectionRestorer.updateIds(b);JSG.connectionRestorer=void 0;b.evaluate();b._restoreConnections(b)}this._selectItems(this.items)};
JSG.graph.command.PasteItemsCommand.prototype._getStartNode=function(){if(void 0!=this.xml)return(new DOMParser).parseFromString(this.xml,"text/xml").getElementsByTagName("clip")[0]};JSG.graph.command.PasteItemsCommand.prototype._paste=function(a){void 0==this.parent&&(this.parent=this._getTargetParent());return this._pasteTo(this.parent,a)};
JSG.graph.command.PasteItemsCommand.prototype._getTargetParent=function(){if(this.viewer.getDefaultController())return this.viewer.getDefaultController().getModel();var a=this.viewer.getSelectionProvider();if(a.hasSingleSelection()){for(var b=JSG.graph.attr.ItemAttributes.CONTAINER,c=a.getFirstSelection();!1==c.getModel().getItemAttribute(b).getValue();)c=c.getParent();ids=this._getPasteIds(a);return this._getVerifiedParent(c.getModel(),ids)}return this.viewer.getGraphController().getModel()};
JSG.graph.command.PasteItemsCommand.prototype._getPasteIds=function(a){var b=[],c=this._getStartNode();if(void 0!=c&&c.hasChildNodes())for(var d=0,e=c.childNodes.length;d<e;d++){var f=c.childNodes.item(d);if("graphitem"==f.nodeName||"gi"==f.nodeName)f=f.getAttribute("id"),void 0!=f&&b.push(Number(f))}a=a.getSelectionContext();if(void 0!=a&&"type.jsgpaste"==a.type)for(d=0;d<a.length;d++)b.push(a[d]);return b};
JSG.graph.command.PasteItemsCommand.prototype._getVerifiedParent=function(a,b){for(var c=JSG.graph.attr.ItemAttributes.CONTAINER;void 0!=a&&(b.contains(a.getId())||!1==a.getItemAttribute(c).getValue());)a=a.getParent();return a};
JSG.graph.command.PasteItemsCommand.prototype._pasteTo=function(a,b){for(var c=JSG.boxCache.get(),d=JSG.boxCache.get(),e=0,f=b.childNodes.length;e<f;e++){var g=b.childNodes.item(e);if("graphitem"==g.nodeName||"gi"==g.nodeName){var l=g.getAttribute("type");if(l=JSG.graphItemFactory.createItemFromString(l))a.addItem(l),l.readXML(g),l.getBoundingBox(c),1===e?d.setTo(c):d.union(c),this._translateToParent(l,a),this.items.push(l)}}this._translateItems(this.items,d);JSG.boxCache.release(c,d)};
JSG.graph.command.PasteItemsCommand.prototype._translateToParent=function(a,b){var c=a.getAngle().getValue(),d=a.getPinPoint(JSG.ptCache.get());JSG.graph.Utils.traverseItemDown(a,b,function(a){c-=a.getAngle().getValue();a.translateFromParent(d);return!0});a.disableRefresh();a.setAngle(c);a.setPinPointTo(d);a.enableRefresh();JSG.ptCache.release(d)};
JSG.graph.command.PasteItemsCommand.prototype._translateItems=function(a,b){var c=0,d=void 0!=this.offset?JSG.ptCache.get().setTo(this.offset):this._getOffset(this.parent,b,JSG.ptCache.get());JSG.graph.Utils.traverseItemUp(this.parent,this.parent.getGraph(),function(a){c+=a.getAngle().getValue();return!0});d.rotate(-c);for(var e=0;e<a.length;e++){var f=a[e];f.disableRefresh();f.translate(d.x,d.y);f.enableRefresh()}JSG.ptCache.release(d)};
JSG.graph.command.PasteItemsCommand.prototype._getOffset=function(a,b,c){a=void 0!=c?c:new JSG.geometry.Point(0,0);c=b.getTopLeft(JSG.ptCache.get());b=b.getCenter(JSG.ptCache.get()).add(c);this._getPasteCenter(a).subtract(b);JSG.ptCache.release(c,b);return a};
JSG.graph.command.PasteItemsCommand.prototype._getPasteCenter=function(a){var b=this.viewer,c=b.getSelectionProvider();a=void 0!=a?a:new JSG.geometry.Point;if(c.hasSelection()){var b=this._getSelectionBox(b,JSG.boxCache.get()),d=b.getTopLeft(JSG.ptCache.get());b.getCenter(a).add(d);JSG.boxCache.release(b);JSG.ptCache.release(d);c.hasSingleSelection()?c.getFirstSelection().getModel()!=this.parent&&a.add(JSG.clipOffset):a.add(JSG.clipOffset)}else b.getScrollPanel().getViewPort().getBounds().getCenter(a),
b.translateFromParent(a);return a};JSG.graph.command.PasteItemsCommand.prototype._getSelectionBox=function(a,b){var c=a.getSelectionProvider();if(c.hasSingleSelection()&&(c=c.getFirstSelection().getModel(),c instanceof JSG.graph.model.TextNode)){var c=c.getParent(),d=c.getBoundingBox(b);JSG.graph.Utils.translateBoundingBoxUp(d,c.getParent(),c.getGraph());return d}return a.getSelectionView().getBoundingBox(b)};JSG.graph.command.PasteItemsCommand.prototype.undo=function(){for(var a=0;a<this.items.length;a++)this.parent.removeItem(this.items[a])};
JSG.graph.command.PasteItemsCommand.prototype.redo=function(){for(var a=0;a<this.items.length;a++)this.parent.addItem(this.items[a])};JSG.graph.command.PasteItemsCommand.prototype.restoreStateAfterUndo=function(a){void 0!=this.oldSelection&&a.getSelectionProvider().setSelection(this.oldSelection)};JSG.graph.command.PasteItemsCommand.prototype.restoreStateAfterRedo=function(a){this._selectItems(this.items)};
JSG.graph.command.PasteItemsCommand.prototype._selectItems=function(a){var b=[],c=[],d=this.viewer.getGraphController(),e=this.viewer.getSelectionProvider();e.clearSelection();for(var f=0;f<a.length;f++){var g=d.getControllerByModelId(a[f].getId());void 0!=g&&(b.push(a[f].getId()),c.push(g))}b.type="type.jsgpaste";e.setSelection(c,b)};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetShapeCommand=function(a,b){JSG.graph.command.SetShapeCommand._super.constructor.apply(this,arguments);this._oldShape=a._shape;this._newShape=b};JSG.extend(JSG.graph.command.SetShapeCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.SetShapeCommand.prototype.undo=function(){this._graphItem.setShapeTo(this._oldShape)};JSG.graph.command.SetShapeCommand.prototype.redo=function(){this._graphItem.setShapeTo(this._newShape)};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetShapePointsCommand=function(a,b){function c(a){var b=new JSG.geometry.PointList;a.forEach(function(a){b.addPoint(a.copy())});return b}function d(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].copy());return b}JSG.graph.command.SetShapePointsCommand._super.constructor.apply(this,arguments);this._oldbbox=a.getBoundingBox();this._newbbox=this._resizeBBox(a.getBoundingBox(),b);this._translate(b,this._oldbbox,this._newbbox);this._newpointlist=c(b);this._oldpointlist=c(a._shape.getPoints());
this._oldCoordinates=d(a.getShape().getCoordinates());this._oldReshapeProperties=a._reshapeProperties.copy();this._oldReshapeCoordinates=d(a._reshapeCoordinates)};JSG.extend(JSG.graph.command.SetShapePointsCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.SetShapePointsCommand.prototype.undo=function(){this._graphItem.setBoundingBoxTo(this._oldbbox);this._graphItem.getShape().setCoordinates(this._oldCoordinates);this._graphItem.setReshapeProperties(this._oldReshapeProperties);this._graphItem.setReshapeCoordinates(this._oldReshapeCoordinates);this._graphItem.evaluate()};JSG.graph.command.SetShapePointsCommand.prototype.redo=function(){this._graphItem.setBoundingBoxTo(this._newbbox);this._setCoordinates(this._newbbox,this._newpointlist)};
JSG.graph.command.SetShapePointsCommand.prototype._setCoordinates=function(a,b){for(var c=a.getWidth(),d=a.getHeight(),e=[],f=b.getPoints(),g=0,l=f.length;g<l;g++){var h=0!=c?f[g].x/c:1,m=0!=d?f[g].y/d:1,h=new JSG.graph.expr.NumberExpression(h,"width * "+h.toFixed(5)),m=new JSG.graph.expr.NumberExpression(m,"height * "+m.toFixed(5));e.push(new JSG.graph.Coordinate(h,m))}this._graphItem._shape.setCoordinates(e);c=this._graphItem.getAttributeAtPath("keepreshapecoordinates");if(void 0==c||!0!==c.getValue())this._graphItem._reshapeCoordinates=
[],this._graphItem._reshapeProperties.clear()};
JSG.graph.command.SetShapePointsCommand.prototype._resizeBBox=function(a,b){a.setSize(0,0);var c=void 0,d=void 0,e=void 0,f=void 0,g=new JSG.geometry.Point(0,0);b.forEach(function(b){g.setTo(b).translate(a._topleft.x,a._topleft.y);c=void 0==g.x?c:void 0==c?g.x:g.x<c?g.x:c;e=void 0==g.x?e:void 0==e?g.x:g.x>e?g.x:e;d=void 0==g.y?d:void 0==d?g.y:g.y<d?g.y:d;f=void 0==g.y?f:void 0==f?g.y:g.y>f?g.y:f});g.set(c,d);a.rotatePoint(g);a.setTopLeftTo(g);a.setSize(e-c,f-d);return a};
JSG.graph.command.SetShapePointsCommand.prototype._translate=function(a,b,c){var d=c.getTopLeft().subtract(b.getTopLeft());b.rotateLocalPointInverse(d);a.forEach(function(a){a.subtract(d)})};JSG.namespace("JSG.graph.command");JSG.graph.command.InsertLinePointsAtCommand=function(a,b,c){JSG.graph.command.InsertLinePointsAtCommand._super.constructor.apply(this,arguments);this._index=b;for(var d=c,e=[],f=0;f<d.length;f++)e.push(d[f].copy());this._newpoints=e};
JSG.extend(JSG.graph.command.InsertLinePointsAtCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.InsertLinePointsAtCommand.prototype.undo=function(){this._doWithoutEvents(function(a){a._graphItem.removePointsAt(a._index,a._newpoints.length)})};JSG.graph.command.InsertLinePointsAtCommand.prototype.redo=function(){this._doWithoutEvents(function(a){a._graphItem.insertPointsAt(a._index,a._newpoints)})};
JSG.graph.command.InsertLinePointsAtCommand.prototype._doWithoutEvents=function(a){this._graphItem.disableEvents();this._graphItem.getShape().disableNotification();a.call(this,this);this._graphItem.getShape().enableNotification();this._graphItem.enableEvents()};JSG.namespace("JSG.graph.command");
JSG.graph.command.RemoveLinePointsCommand=function(a,b){JSG.graph.command.RemoveLinePointsCommand._super.constructor.apply(this,arguments);this._oldpoints=void 0;this._indices=b.slice(0);this._indices.sort(function(a,b){return a<b?-1:a>b?1:0})};JSG.extend(JSG.graph.command.RemoveLinePointsCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.RemoveLinePointsCommand.prototype.execute=function(){for(var a=this._graphItem,b=this._indices,c=[],d=0;d<b.length;d++){var e=a.getPointAt(b[d]);void 0!==e&&c.push(e)}this._oldpoints=c;JSG.graph.command.RemoveLinePointsCommand._super.execute.call(this)};JSG.graph.command.RemoveLinePointsCommand.prototype.undo=function(){this._doWithoutEvents(function(a){for(var b=0;b<a._indices.length;b++)a._graphItem.insertPointsAt(a._indices[b],a._oldpoints[b])})};
JSG.graph.command.RemoveLinePointsCommand.prototype.redo=function(){this._doWithoutEvents(function(a){for(var b=0;b<a._indices.length;b++)a._graphItem.removePointsAt(a._indices[b]-b,1)})};JSG.graph.command.RemoveLinePointsCommand.prototype._doWithoutEvents=function(a){this._graphItem.disableEvents();this._graphItem.getShape().disableNotification();a.call(this,this);this._graphItem.getShape().enableNotification();this._graphItem.enableEvents()};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetPinCommand=function(a,b){JSG.graph.command.SetPinCommand._super.constructor.apply(this,arguments);this._oldPin=a.getPin().copy();this._newPin=b.copy()};JSG.extend(JSG.graph.command.SetPinCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.SetPinCommand.prototype.undo=function(){this._graphItem.getPin().setTo(this._oldPin);this._graphItem.getPin().evaluate(this._graphItem)};
JSG.graph.command.SetPinCommand.prototype.redo=function(){this._graphItem.getPin().setTo(this._newPin);this._graphItem.getPin().evaluate(this._graphItem)};JSG.namespace("JSG.graph.command");JSG.graph.command.SetSizeCommand=function(a,b){JSG.graph.command.SetSizeCommand._super.constructor.apply(this,arguments);this._oldSize=a.getSize().copy();this._newSize=b.copy()};JSG.extend(JSG.graph.command.SetSizeCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.SetSizeCommand.prototype.undo=function(){this._graphItem.setSizeTo(this._oldSize);this._graphItem.getSize().evaluate(this._graphItem)};JSG.graph.command.SetSizeCommand.prototype.redo=function(){this._graphItem.setSizeTo(this._newSize);this._graphItem.getSize().evaluate(this._graphItem)};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetLinePointAtCommand=function(a,b,c){JSG.graph.command.SetLinePointAtCommand._super.constructor.apply(this,arguments);this._index=b;this._newpoint=c.copy();this._oldpoint=void 0};JSG.extend(JSG.graph.command.SetLinePointAtCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.SetLinePointAtCommand.prototype.execute=function(){this._oldpoint=this._graphItem.getPointAt(this._index);this.redo()};
JSG.graph.command.SetLinePointAtCommand.prototype.undo=function(){void 0!=this._oldpoint&&this._graphItem.setPointAt(this._index,this._oldpoint.copy())};JSG.graph.command.SetLinePointAtCommand.prototype.redo=function(){this._graphItem.setPointAt(this._index,this._newpoint.copy())};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetLineShapePointsCommand=function(a,b){JSG.graph.command.SetLineShapePointsCommand._super.constructor.apply(this,arguments);this._newpoints=function(a){for(var b=[],e=0;e<a.length;e++)b.push(a[e].copy());return b}(b);this._oldpoints=function(b){for(var d=[],e=0;e<b.length;e++)d.push(a.translateToParent(b[e].copy()));return d}(a._shape.getPoints())};JSG.extend(JSG.graph.command.SetLineShapePointsCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.SetLineShapePointsCommand.prototype.undo=function(){this._graphItem.setPoints(this._oldpoints)};JSG.graph.command.SetLineShapePointsCommand.prototype.redo=function(){this._graphItem.setPoints(this._newpoints)};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetBezierShapePointsCommand=function(a,b,c,d){function e(a){var b=new JSG.geometry.PointList;a.forEach(function(a){b.addPoint(a.copy())});return b}JSG.graph.command.SetBezierShapePointsCommand._super.constructor.apply(this,arguments);this._oldbbox=a.getBoundingBox();this._newbbox=this._resizeBBox(a.getBoundingBox(),b,c,d);this._translate(b,c,d,this._oldbbox,this._newbbox);this._newpointlist=e(b);this._newCpFrompointlist=e(c);this._newCpTopointlist=e(d);this._oldpointlist=e(a._shape.getPoints());
this._oldCpFrompointlist=e(a._shape.getCpFromPoints());this._oldCpTopointlist=e(a._shape.getCpToPoints())};JSG.extend(JSG.graph.command.SetBezierShapePointsCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.SetBezierShapePointsCommand.prototype.undo=function(){this._graphItem.setBoundingBoxTo(this._oldbbox);this._setCoordinates(this._oldbbox,this._oldpointlist,this._oldCpFrompointlist,this._oldCpTopointlist)};
JSG.graph.command.SetBezierShapePointsCommand.prototype.redo=function(){this._graphItem.setBoundingBoxTo(this._newbbox);this._setCoordinates(this._newbbox,this._newpointlist,this._newCpFrompointlist,this._newCpTopointlist)};
JSG.graph.command.SetBezierShapePointsCommand.prototype._setCoordinates=function(a,b,c,d){var e=a.getWidth();a=a.getHeight();var f=[];b=b.getPoints();for(var g=0,l=b.length;g<l;g++){var h=0!=e?b[g].x/e:1,m=0!=a?b[g].y/a:1,h=new JSG.graph.expr.NumberExpression(h,"width * "+h.toFixed(5)),m=new JSG.graph.expr.NumberExpression(m,"height * "+m.toFixed(5));f.push(new JSG.graph.Coordinate(h,m))}this._graphItem._shape.setCoordinates(f);f=[];b=c.getPoints();g=0;for(l=b.length;g<l;g++)h=0!=e?b[g].x/e:1,m=0!=
a?b[g].y/a:1,h=new JSG.graph.expr.NumberExpression(h,"width * "+h.toFixed(5)),m=new JSG.graph.expr.NumberExpression(m,"height * "+m.toFixed(5)),f.push(new JSG.graph.Coordinate(h,m));this._graphItem._shape.setCpFromCoordinates(f);f=[];b=d.getPoints();g=0;for(l=b.length;g<l;g++)h=0!=e?b[g].x/e:1,m=0!=a?b[g].y/a:1,h=new JSG.graph.expr.NumberExpression(h,"width * "+h.toFixed(5)),m=new JSG.graph.expr.NumberExpression(m,"height * "+m.toFixed(5)),f.push(new JSG.graph.Coordinate(h,m));this._graphItem._shape.setCpToCoordinates(f);
this._graphItem._reshapeCoordinates=[];this._graphItem._reshapeProperties.clear()};
JSG.graph.command.SetBezierShapePointsCommand.prototype._resizeBBox=function(a,b,c,d){function e(a,b){return void 0==a?b:void 0==b?a:a<b?a:b}function f(a,b){return void 0==a?b:void 0==b?a:a>b?a:b}a.setSize(0,0);var g=void 0,l=void 0,h=void 0,m=void 0,k=new JSG.geometry.Point(0,0);b.forEach(function(b){k.setTo(b).translate(a._topleft.x,a._topleft.y);g=e(k.x,g);h=f(k.x,h);l=e(k.y,l);m=f(k.y,m)});c.forEach(function(b){k.setTo(b).translate(a._topleft.x,a._topleft.y);g=e(k.x,g);h=f(k.x,h);l=e(k.y,l);m=
f(k.y,m)});d.forEach(function(b){k.setTo(b).translate(a._topleft.x,a._topleft.y);g=e(k.x,g);h=f(k.x,h);l=e(k.y,l);m=f(k.y,m)});k.set(g,l);a.rotatePoint(k);a.setTopLeftTo(k);a.setSize(h-g,m-l);return a};JSG.graph.command.SetBezierShapePointsCommand.prototype._translate=function(a,b,c,d,e){var f=e.getTopLeft().subtract(d.getTopLeft());d.rotateLocalPointInverse(f);a.forEach(function(a){a.subtract(f)});b.forEach(function(a){a.subtract(f)});c.forEach(function(a){a.subtract(f)})};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetAttributeCommand=function(a,b,c,d){JSG.graph.command.SetAttributeCommand._super.constructor.apply(this,arguments);this._setter=b;this._oldvalue=c instanceof JSG.graph.expr.Expression?c.copy():c;this._newvalue=d};JSG.extend(JSG.graph.command.SetAttributeCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.SetAttributeCommand.prototype.undo=function(){this._setAttributeValue(this._oldvalue)};JSG.graph.command.SetAttributeCommand.prototype.redo=function(){this._setAttributeValue(this._newvalue)};
JSG.graph.command.SetAttributeCommand.prototype._setAttributeValue=function(a){var b=this._graphItem.getItemAttributes();b[this._setter].call(b,a,this._graphItem)};JSG.namespace("JSG.graph.command");
JSG.graph.command.SetAttributesMapCommand=function(a,b,c){JSG.graph.command.SetAttributesMapCommand._super.constructor.apply(this,arguments);this._map=b;this._listpath=(this._oldMap=function(a){function c(b,e){var h=a.getAttribute(b);h&&f.put(b,h.getExpression().copy())}if(a instanceof JSG.graph.attr.AttributeList){var f=new JSG.commons.Map;b.iterate(c);return f}}(this._getAttributeList(c,!1)))?c:void 0};JSG.extend(JSG.graph.command.SetAttributesMapCommand,JSG.graph.command.AbstractItemCommand);
JSG.graph.command.SetAttributesMapCommand.prototype.undo=function(){var a=this._getAttributeList(this._listpath,!1);a&&a.applyAttributesMap(this._oldMap,this._graphItem)};JSG.graph.command.SetAttributesMapCommand.prototype.redo=function(){var a=this._getAttributeList(this._listpath,!0);a&&a.applyAttributesMap(this._map,this._graphItem)};
JSG.graph.command.SetAttributesMapCommand.prototype._getAttributeList=function(a,b){if(a)return a==JSG.graph.attr.TextFormatAttributes.NAME?b?this._graphItem.getTextFormat():this._graphItem._getTextFormat():this._graphItem.getAttributeAtPath(a)};JSG.namespace("JSG.graph.command");JSG.graph.command.SetLayoutAttributeCommand=function(a,b,c,d){JSG.graph.command.SetLayoutAttributeCommand._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.command.SetLayoutAttributeCommand,JSG.graph.command.SetAttributeCommand);
JSG.graph.command.SetLayoutAttributeCommand.prototype._setAttributeValue=function(a){var b=this._graphItem.getLayoutAttributes();b[this._setter].call(b,a)};JSG.namespace("JSG.graph.command");JSG.graph.command.SetTextSizeModeCommand=function(a,b){JSG.graph.command.SetTextSizeModeCommand._super.constructor.apply(this,arguments);this._oldsize=a.getSize().copy();this._oldsizemode=a.getItemAttributes().getSizeMode().getExpression().copy();this._newsizemode=b};
JSG.extend(JSG.graph.command.SetTextSizeModeCommand,JSG.graph.command.AbstractItemCommand);JSG.graph.command.SetTextSizeModeCommand.prototype.undo=function(){this._graphItem.getItemAttributes().setSizeMode(this._oldsizemode,this._graphItem);this._graphItem.setSizeTo(this._oldsize)};JSG.graph.command.SetTextSizeModeCommand.prototype.redo=function(){this._graphItem.getItemAttributes().setSizeMode(this._newsizemode,this._graphItem)};JSG.namespace("JSG.graph.command");
JSG.graph.command.ResizeEdgeCommand=function(a,b){function c(a){a.subtract(h);g.rotateLocalPointInverse(a);a.x=0===l.x?0:a.x/l.x;a.y=0===l.y?0:a.y/l.y;return a}function d(a){a=n.setTo(a);a.set(a.x*m.x,a.y*m.y);b.rotateLocalPoint(a);a.add(k);return a}for(var e=[],f=a.getPoints(),g=a.getBoundingBox(JSG.boxCache.get()),l=g.getSize(JSG.ptCache.get()),h=g.getTopLeft(JSG.ptCache.get()),m=b.getSize(JSG.ptCache.get()),k=b.getTopLeft(JSG.ptCache.get()),n=JSG.ptCache.get(),q=0;q<f.length;q++){var p=c(f[q]);
e.push(d(p).copy())}JSG.boxCache.release(g);JSG.ptCache.release(l,h,m,k,n);JSG.graph.command.ResizeEdgeCommand._super.constructor.call(this,a,e)};JSG.extend(JSG.graph.command.ResizeEdgeCommand,JSG.graph.command.SetLineShapePointsCommand);JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.InteractionUtils={};
JSG.graph.interaction.InteractionUtils.highlightSnapItemofController=function(a,b,c){function d(a){for(var b=0;b<l.length;b++){if(a==l[b])return!0;for(var c=a.getParent();c;){if(c==l[b])return!0;c=c.getParent()}}return!1}function e(a,b,c){var d=new JSG.graph.view.SnapFeedbackView;d.setOrigin(a,c);d.setTarget(b,c);return d}function f(a,b,c){var d=new JSG.graph.view.SnapFeedbackView;d.setOrigin(c,a);d.setTarget(c,b);return d}var g=a.getInteractionHandler().viewer,l=g.getSelection(),h=a.getControllerForSnap(b,
function(a,b){return!a instanceof JSG.graph.controller.NodeController||!a.getModel().isVisible()||!a.getModel().getItemAttributes().getSnapTo().getValue()?!1:!0});g.getGraphView();var m=2*JSG.snapRadius,k=new JSG.geometry.Point(b.x+b.width/2,b.y+b.height/2),n,q,p=JSG.boxCache.get();c=JSG.rectCache.get();for(var s=JSG.ptCache.get(),u=0,t=h.length;u<t;u++){var w=h[u];c=w.getModel().getTranslatedBoundingBox(g.getGraph(),p).getBoundingRectangle(c);var v=c.getCenter(s);if(w._snapType&JSG.graph.interaction.SnapType.CENTERY||
w._snapType&JSG.graph.interaction.SnapType.TOP||w._snapType&JSG.graph.interaction.SnapType.BOTTOM)a._horizontalSnapController?(Math.abs(v.x-k.x)<Math.abs(q.x-k.x)||d(a._horizontalSnapController))&&!d(w)&&(q=v.copy(),a._horizontalSnapController=w):(a._horizontalSnapController=w,q=v.copy());if(w._snapType&JSG.graph.interaction.SnapType.CENTERX||w._snapType&JSG.graph.interaction.SnapType.LEFT||w._snapType&JSG.graph.interaction.SnapType.RIGHT)a._verticalSnapController?(Math.abs(v.y-k.y)<Math.abs(n.y-
k.y)||d(a._verticalSnapController))&&!d(w)&&(n=v.copy(),a._verticalSnapController=w):(a._verticalSnapController=w,n=v.copy())}JSG.boxCache.release(p);JSG.ptCache.release(s);JSG.rectCache.release(c);a._horizontalSnapController&&(c=a._horizontalSnapController.getModel().getTranslatedBoundingBox(g.getGraph(),p).getBoundingRectangle(c),v=c.getCenter(s),n=g.getLayer(JSG.graph.view.LayerId.SNAPLINES),v.x>k.x?(v=b.x-m,h=c.getRight()+m):(v=b.getRight()+m,h=c.x-m),a._horizontalSnapController._snapType&JSG.graph.interaction.SnapType.CENTERY&&
(q=c.getCenter(s).y,n.push(e(v,h,q)),c.height==b.height&&(n.push(e(v,h,c.y)),n.push(e(v,h,c.getBottom())))),a._horizontalSnapController._snapType&JSG.graph.interaction.SnapType.TOP&&(q=c.y,n.push(e(v,h,q)),c.height==b.height&&(n.push(e(v,h,c.getCenter(s).y)),n.push(e(v,h,c.getBottom())))),a._horizontalSnapController._snapType&JSG.graph.interaction.SnapType.BOTTOM&&(q=c.getBottom(),n.push(e(v,h,q)),c.height==b.height&&(n.push(e(v,h,c.y)),n.push(e(v,h,c.getCenter(s).y)))));a._verticalSnapController&&
(c=a._verticalSnapController.getModel().getTranslatedBoundingBox(g.getGraph(),p).getBoundingRectangle(c),v=c.getCenter(s),n=g.getLayer(JSG.graph.view.LayerId.SNAPLINES),v.y>k.y?(g=b.y-m,k=c.getBottom()+m):(g=b.getBottom()+m,k=c.y-m),a._verticalSnapController._snapType&JSG.graph.interaction.SnapType.CENTERX&&(m=c.getCenter(s).x,n.push(f(g,k,m)),c.width==b.width&&(n.push(f(g,k,c.x)),n.push(f(g,k,c.getRight())))),a._verticalSnapController._snapType&JSG.graph.interaction.SnapType.LEFT&&(m=c.x,n.push(f(g,
k,m)),c.width==b.width&&(n.push(f(g,k,c.getCenter(s).x)),n.push(f(g,k,c.getRight())))),a._verticalSnapController._snapType&JSG.graph.interaction.SnapType.RIGHT&&(m=c.getRight(),n.push(f(g,k,m)),c.width==b.width&&(n.push(f(g,k,c.x)),n.push(f(g,k,c.getCenter(s).x)))))};
JSG.graph.interaction.InteractionUtils.getPortsController=function(a,b){var c=b.findControllerAt(a.location.copy(),JSG.graph.controller.FindFlags.BOXWITHFRAME,function(a){return a instanceof JSG.graph.controller.NodeController?(a=a.getModel(),!(a instanceof JSG.graph.model.TextNode)&&a.isVisible()&&a.getItemAttributes().getPortMode().getValue()!=JSG.graph.attr.consts.PortMode.NONE):!1});return void 0!=c?JSG.graph.interaction.InteractionUtils._checkForChildControllerAt(c,a,b):void 0};
JSG.graph.interaction.InteractionUtils._checkForChildControllerAt=function(a,b,c){function d(b,c){if(!1===f&&(f=b.isCollapsed(),b!=a&&b.containsPoint(c,JSG.graph.controller.FindFlags.AREAWITHFRAME))){var d=b.getModel();return!(d instanceof JSG.graph.model.TextNode)&&d.isVisible()&&d.getItemAttributes().getPortMode().getValue()!=JSG.graph.attr.consts.PortMode.NONE}return!1}var e=void 0,f=!1;a.hasChildren()&&(b=c.translateFromParent(b.location.copy()),b=c.translateFromRoot(b,a.getView().getParent()),
e=a.findControllerByConditionAndLocation(b,d));return void 0!=e?e:a};
JSG.graph.interaction.InteractionUtils.getPortsFor=function(a,b,c){var d=a.getModel(),e=b.getViewer();a=a.getView();var f=e.rootController.getView(),g=b.currentLocation.copy(),l=b.alignToGrid(g,e,c);JSG.graph.Utils.traverseDown(f,a,function(a){a.translateFromParent(g);a.translateFromParent(l);return!0});b=[];e=e.getCoordinateSystem().metricToLogXNoZoom(JSG.portFindRadius);e=d.getShape().getValidPortLocation(g,l,d.isClosed(),c,e);if(void 0==e){if((e=d.getShape().getValidPortLocations(d.isClosed(),
c))&&e.length)for(var h=0,m=e.length;h<m;h++){c=e[h].copy();JSG.graph.Utils.translatePointUp(c,a,f);var k=this._createPortView(d,e[h]);k.setActive(!1);k.setPosition(c);k.setFillColor("rgba(255,255,255, 0.5)");b.push(k)}}else c=e.copy(),JSG.graph.Utils.translatePointUp(c,a,f),k=this._createPortView(d,e),k.setPosition(c),k.setFillColor("rgba(255,0,0,0.5)"),b.push(k);return b};
JSG.graph.interaction.InteractionUtils._createPortView=function(a,b){var c=new JSG.graph.view.PositionFeedbackView;c._model=a;c._location=b;return c};
JSG.graph.interaction.InteractionUtils.highlightTargetController=function(a,b){var c=b.createFeedback(),d=a.getLayer(JSG.graph.view.LayerId.TARGETCONTAINER),e=c.getFormat();e.setFillColor("rgba(144,181,238,0.1)");e.setLineColor("rgba(144,181,238,0.7)");e.setLineWidth(150/a.getZoom());e.setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.SOLID);c.getFeedbackView().drawDecorations=function(a,b){a.setFillColor("#333333");a.setTextBaseline("top");a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT);
a.setFontName("Arial");a.setFontSize(8/a.getCoordinateSystem().getZoom());a.setFont();a.fillText("Add to Container",0,this._item.getHeight().getValue()+100)};d.push(c)};
JSG.graph.interaction.InteractionUtils.highlightControllerLayoutPosition=function(a,b,c){function d(a,c,d){var e=new JSG.graph.view.MarqueeFeedbackView,f=b.getLayer(JSG.graph.view.LayerId.LAYOUTMARKER);e._bgColor=JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR;e._fgColor="#333333";d?e.setBounds(c.x,a-75,c.width,150):e.setBounds(a-75,c.y,150,c.height);f.push(e);return e}if(void 0!=c){var e=c.getModel();c=e.getLayoutAttributes().getConstraints();if(void 0!=c){var f=e._subItems[a.index],e=JSG.boxCache.get(),
f=f.getTranslatedBoundingBox(b.getGraph(),e).getBoundingRectangle();switch(c.flowDirection){case ARAC.layout.config.FlowDirection.ROW_FLOW:return a.before?d(f.y,f,!0):d(f.getBottom(),f,!0);case ARAC.layout.config.FlowDirection.COL_FLOW:return a.before?d(f.x,f,!1):d(f.getRight(),f,!1)}JSG.boxCache.release(e)}}};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.Interaction=function(){this.startLocation=new JSG.geometry.Point(0,0);this.currentLocation=new JSG.geometry.Point(0,0);this.lastLocation=new JSG.geometry.Point(0,0);this._delegate=void 0};JSG.graph.interaction.Interaction.prototype.getInteractionHandler=function(){return this.interactionHandler};JSG.graph.interaction.Interaction.prototype.setInteractionHandler=function(a){this.interactionHandler=a};
JSG.graph.interaction.Interaction.prototype.setDelegate=function(a){this._delegate=a};JSG.graph.interaction.Interaction.prototype._notifyDelegate=function(){if(void 0!=this._delegate){var a=Array.prototype.shift.call(arguments);if("function"==typeof this._delegate[a])return Array.prototype.unshift.call(arguments,this),this._delegate[a].apply(this._delegate,arguments)}};
JSG.graph.interaction.Interaction.prototype.getViewer=function(){return void 0!=this.interactionHandler?this.interactionHandler.viewer:void 0};JSG.graph.interaction.Interaction.prototype.activate=function(a){};
JSG.graph.interaction.Interaction.prototype.deactivate=function(a){a&&a instanceof JSG.ui.viewer.GraphViewer&&(a.clearLayer(JSG.graph.view.LayerId.LAYOUTMARKER),a.clearLayer(JSG.graph.view.LayerId.TARGETCONTAINER),a.clearLayer(JSG.graph.view.LayerId.SNAPLINES),a.clearInteractionFeedback());this._delegate=void 0};JSG.graph.interaction.Interaction.prototype.isScrollBarEvent=function(){return!1};
JSG.graph.interaction.Interaction.prototype.finishInteraction=function(a,b){this.willFinish(a,b);this.didFinish(a,b)};JSG.graph.interaction.Interaction.prototype.willFinish=function(a,b){};JSG.graph.interaction.Interaction.prototype.didFinish=function(a,b){var c=this.getInteractionHandler();c.setActiveInteraction(c.getDefaultInteraction())};JSG.graph.interaction.Interaction.prototype.cancelInteraction=function(a,b){this.didFinish(a,b)};JSG.graph.interaction.Interaction.prototype.condition=function(a){return!0};
JSG.graph.interaction.Interaction.prototype.onResizeCanvas=function(a,b,c){return!1};JSG.graph.interaction.Interaction.prototype.onMouseDown=function(a,b){};JSG.graph.interaction.Interaction.prototype.onMouseDoubleClick=function(a,b){};JSG.graph.interaction.Interaction.prototype.onMouseMove=function(a,b){};JSG.graph.interaction.Interaction.prototype.onMouseDrag=function(a,b){};JSG.graph.interaction.Interaction.prototype.onMouseUp=function(a,b){this.finishInteraction(a,b)};
JSG.graph.interaction.Interaction.prototype.onMouseExit=function(a,b){this.cancelInteraction(a,b)};JSG.graph.interaction.Interaction.prototype.onMouseWheel=function(a,b){};JSG.graph.interaction.Interaction.prototype.onDragEnter=function(a,b){};JSG.graph.interaction.Interaction.prototype.onDragExit=function(a,b){};JSG.graph.interaction.Interaction.prototype.onDragLeave=function(a,b){};JSG.graph.interaction.Interaction.prototype.onDragOver=function(a,b){};
JSG.graph.interaction.Interaction.prototype.onDrop=function(a,b){};JSG.graph.interaction.Interaction.prototype.onRotateStart=function(a,b){};JSG.graph.interaction.Interaction.prototype.onRotate=function(a,b){};JSG.graph.interaction.Interaction.prototype.onRotateEnd=function(a,b){};JSG.graph.interaction.Interaction.prototype.onPinchStart=function(a,b){};JSG.graph.interaction.Interaction.prototype.onPinch=function(a,b){};JSG.graph.interaction.Interaction.prototype.onPinchEnd=function(a,b){};
JSG.graph.interaction.Interaction.prototype.onPanStart=function(a,b){};JSG.graph.interaction.Interaction.prototype.onPan=function(a,b){};JSG.graph.interaction.Interaction.prototype.onPanEnd=function(a,b){};JSG.graph.interaction.Interaction.prototype.onHold=function(a,b){};JSG.graph.interaction.Interaction.prototype.onKeyDown=function(a,b){a.isPressed(JSG.ui.events.KeyType.ESC)&&this.cancelInteraction(a,b)};JSG.graph.interaction.Interaction.prototype.onKeyUp=function(a,b){};
JSG.graph.interaction.Interaction.prototype.onScroll=function(){};JSG.graph.interaction.Interaction.prototype.setCurrentLocation=function(a){this.currentLocation.setTo(a)};JSG.graph.interaction.Interaction.prototype.getCurrentLocation=function(){return this.currentLocation};JSG.graph.interaction.Interaction.prototype.setStartLocation=function(a){this.startLocation.setTo(a)};JSG.graph.interaction.Interaction.prototype.getStartLocation=function(){return this.startLocation};
JSG.graph.interaction.Interaction.prototype.setLastLocation=function(a){this.lastLocation.setTo(a)};JSG.graph.interaction.Interaction.prototype.getLastLocation=function(){return this.lastLocation};JSG.graph.interaction.Interaction.prototype.getCursor=function(){return this.interactionHandler.getCursor()};JSG.graph.interaction.Interaction.prototype.setCursor=function(a){this.interactionHandler.setCursor(a)};
JSG.graph.interaction.Interaction.prototype.getControllerAtLocation=function(a,b){function c(){return!0}var d=this.interactionHandler.viewer,e=void 0!=b?b:c,f=d.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);return d.findControllerByConditionAndLocation(a,function(a,b){var c=!1,d=a.getModel().getBoundingBox(JSG.boxCache.get());d.expandBy(f);d.containsPoint(b)&&a.containsPoint(b,JSG.graph.controller.FindFlags.AREAWITHFRAME)&&(c=e(a,b));JSG.boxCache.release(d);return c})};
JSG.graph.interaction.Interaction.prototype.alignToGrid=function(a,b,c,d){d=void 0!=d?d:new JSG.geometry.Point(0,0);d.setTo(a);a=b.getGraphSettings();if(void 0!=a){if(!a.getSnapToGrid()||c)return d;c=a.getSnapStep();a=d.x%c;b=d.y%c;d.x=a>c/2?d.x+(c-a):d.x-a;d.y=b>c/2?d.y+(c-b):d.y-b}return d};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.InteractionActivator=function(){this.isDisposed=!1};
JSG.graph.interaction.InteractionActivator.prototype.activateInteraction=function(a,b){var c=b.getInteractionHandler();void 0!=c&&(a.setStartLocation(b.startLocation),a.setCurrentLocation(b.currentLocation),c.setActiveInteraction(a));return a};JSG.graph.interaction.InteractionActivator.prototype.init=function(a){this.isDisposed=!1};JSG.graph.interaction.InteractionActivator.prototype.dispose=function(a){this.isDisposed=!0};JSG.graph.interaction.InteractionActivator.prototype.getKey=function(){return""};
JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.InteractionDispatcher=function(){JSG.graph.interaction.InteractionDispatcher._super.constructor.call(this);this._activators=new JSG.commons.Map};JSG.extend(JSG.graph.interaction.InteractionDispatcher,JSG.graph.interaction.Interaction);JSG.graph.interaction.InteractionDispatcher.prototype.activate=function(a){JSG.graph.interaction.InteractionDispatcher._super.activate.call(this,a);this._activators.iterate(function(b,c){c.init(a)})};
JSG.graph.interaction.InteractionDispatcher.prototype.deactivate=function(a){JSG.graph.interaction.InteractionDispatcher._super.deactivate.call(this,a);this._activators.iterate(function(b,c){c.dispose(a)})};JSG.graph.interaction.InteractionDispatcher.prototype.getActivatorsForFunc=function(a){var b=[];this._activators.iterate(function(c,d){"function"==typeof d[a]&&b.push(d)});return b};JSG.graph.interaction.InteractionDispatcher.prototype.addActivator=function(a,b){this._activators.put(a,b)};
JSG.graph.interaction.InteractionDispatcher.prototype.getActivator=function(a){return this._activators.get(a)};JSG.graph.interaction.InteractionDispatcher.prototype.getAllActivators=function(){return this._activators.elements()};JSG.graph.interaction.InteractionDispatcher.prototype.removeActivator=function(a){return this._activators.remove(a)};JSG.graph.interaction.InteractionDispatcher.prototype.removeAllActivators=function(){this._activators.clear()};
JSG.graph.interaction.InteractionDispatcher.prototype.condition=function(a){return!0};JSG.graph.interaction.InteractionDispatcher.prototype.getControllerAt=function(a,b,c){};JSG.graph.interaction.InteractionDispatcher.prototype.getActiveHandle=function(){};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.InteractionHandler=function(a){this.viewer=a;this.isDragging=!1;this.gfxsys=void 0;this.commandStack=new JSG.graph.command.CommandStack;this.activeInteraction;this.scrollTimer=void 0};
JSG.graph.interaction.InteractionHandler.prototype.registerGraphicSystem=function(a){this.gfxsys=a};JSG.graph.interaction.InteractionHandler.prototype.unregisterGraphicSystem=function(){this.gfxsys=void 0};JSG.graph.interaction.InteractionHandler.prototype.getDefaultInteraction=function(){return this.viewer.getDefaultInteraction()};
JSG.graph.interaction.InteractionHandler.prototype.setActiveInteraction=function(a){this.activeInteraction&&this.activeInteraction.deactivate(this.viewer);if(this.activeInteraction=a)this.activeInteraction.setInteractionHandler(this),this.activeInteraction.activate(this.viewer)};JSG.graph.interaction.InteractionHandler.prototype.getActiveInteraction=function(){void 0==this.activeInteraction&&this.setActiveInteraction(this.viewer.getDefaultInteraction());return this.activeInteraction};
JSG.graph.interaction.InteractionHandler.prototype.cancelActiveInteraction=function(){var a=this.getActiveInteraction();void 0!=a&&a.cancelInteraction(void 0,this.viewer)};JSG.graph.interaction.InteractionHandler.prototype.dispose=function(){this.activeInteraction&&this.activeInteraction.deactivate(this.viewer);this.removeTimer()};JSG.graph.interaction.InteractionHandler.prototype.handleResizeCanvas=function(a,b){this.getActiveInteraction().onResizeCanvas(a,b,this.viewer)||this.setActiveInteraction(this.viewer.getDefaultInteraction())};
JSG.graph.interaction.InteractionHandler.prototype.handleGestureEvent=function(a){function b(){c.isDragging=!0;d.setTo(a.location);c.viewer.translateFromParent(d);c.getActiveInteraction().setStartLocation(d)}var c=this,d=new JSG.geometry.Point(0,0);d.setTo(a.location);this.viewer.translateFromParent(d);this.getActiveInteraction().setLastLocation(this.getActiveInteraction().getCurrentLocation());this.getActiveInteraction().setCurrentLocation(d);switch(a.type){case JSG.ui.events.GestureEventType.CANCEL:this.setActiveInteraction(this.viewer.getDefaultInteraction());
break;case JSG.ui.events.GestureEventType.ROTATESTART:b();this.getActiveInteraction().onRotateStart(a,this.viewer);break;case JSG.ui.events.GestureEventType.ROTATE:this.getActiveInteraction().onRotate(a,this.viewer);break;case JSG.ui.events.GestureEventType.ROTATEEND:this.isDragging=!1;this.getActiveInteraction().onRotateEnd(a,this.viewer);break;case JSG.ui.events.GestureEventType.PINCHSTART:b();this.getActiveInteraction().onPinchStart(a,this.viewer);break;case JSG.ui.events.GestureEventType.PINCH:this.getActiveInteraction().onPinch(a,
this.viewer);break;case JSG.ui.events.GestureEventType.PINCHEND:this.isDragging=!1;this.getActiveInteraction().onPinchEnd(a,this.viewer);break;case JSG.ui.events.GestureEventType.PANSTART:b();this.getActiveInteraction().onPanStart(a,this.viewer);break;case JSG.ui.events.GestureEventType.PAN:this.getActiveInteraction().onPan(a,this.viewer);break;case JSG.ui.events.GestureEventType.PANEND:this.isDragging=!1;this.getActiveInteraction().onPanEnd(a,this.viewer);break;case JSG.ui.events.GestureEventType.HOLD:b(),
this.getActiveInteraction().onHold(a,this.viewer)}};
JSG.graph.interaction.InteractionHandler.prototype.handleMouseEvent=function(a){var b=this,c=a.location.copy(),d=this.getActiveInteraction();this.viewer.translateFromParent(c);d.setLastLocation(d.getCurrentLocation());d.setCurrentLocation(c);this.doCancelActiveInteraction(d,a)&&void 0!=d&&d.finishInteraction(a,this.viewer);var e=a.type,f=JSG.ui.events.MouseEventType;if(e==f.DOWN&&a.isClicked(JSG.ui.events.ButtonType.RIGHT))this.handleRightClick(a);else switch(e){case f.DOWN:this.isDragging=!0;d.setStartLocation(c);
d.onMouseDown(a,this.viewer);break;case f.DBLCLK:d.onMouseDoubleClick(a,this.viewer);break;case f.MOVE:if(this.isDragging)d.onMouseDrag(a,this.viewer),c=this.viewer.getGraph(),d=d.isScrollBarEvent(),c&&(c.getSettings().getAutoScroll()&&!d)&&this.viewer._scrollPanel&&(d=!a.isInCanvas(),this._lastEvent=a,void 0==this.scrollTimer&&d?this.scrollTimer=setInterval(function(){JSG.graph.interaction.InteractionHandler.prototype.scrollTimerFunction(b)},300):d||this.removeTimer());else d.onMouseMove(a,this.viewer);
break;case f.UP:this.isDragging&&this.removeTimer();this.isDragging=!1;d.onMouseUp(a,this.viewer);break;case f.EXIT:this.isDragging=!1;d.onMouseExit(a,this.viewer);break;case f.WHEEL:this.isDragging=!1,d.onMouseWheel(a,this.viewer)}a.doRepaint=this.isDragging||a.doRepaint};
JSG.graph.interaction.InteractionHandler.prototype.doCancelActiveInteraction=function(a,b){return b.type==JSG.ui.events.MouseEventType.DOWN?void 0!=this.viewer.isScrollBarEvent&&this.viewer.isScrollBarEvent(b)&&a!==this.viewer.getDefaultInteraction():!1};JSG.graph.interaction.InteractionHandler.prototype.handleRightClick=function(a){var b=this.getActiveInteraction();b.handleRightClick&&b.handleRightClick(a,this.viewer)};
JSG.graph.interaction.InteractionHandler.prototype.scrollTimerFunction=function(a){var b=a._lastEvent,c=a.viewer.getScrollPanel(),d,e;b.gesture?(d=b.gesture.touches[0].clientX,e=b.gesture.touches[0].clientY):(d=b.event.clientX,e=b.event.clientY);d<=b.canvasRect.left?100>Math.abs(d-b.canvasRect.left)?c.getHorizontalScrollBar().scroll(-500,!0):c.getHorizontalScrollBar().scroll(-1500,!0):d>=b.canvasRect.right&&(100>Math.abs(d-b.canvasRect.right)?c.getHorizontalScrollBar().scroll(500,!0):c.getHorizontalScrollBar().scroll(1500,
!0));e<=b.canvasRect.top?100>Math.abs(e-b.canvasRect.top)?c.getVerticalScrollBar().scroll(-500,!0):c.getVerticalScrollBar().scroll(-1500,!0):e>=b.canvasRect.bottom&&(100>Math.abs(e-b.canvasRect.bottom)?c.getVerticalScrollBar().scroll(500,!0):c.getVerticalScrollBar().scroll(1500,!0));a.repaint()};JSG.graph.interaction.InteractionHandler.prototype.removeTimer=function(a){void 0!=this.scrollTimer&&(window.clearInterval(this.scrollTimer),this.scrollTimer=void 0)};
JSG.graph.interaction.InteractionHandler.prototype.handleDragEvent=function(a){var b=new JSG.geometry.Point(0,0);b.setTo(a.location);this.viewer.translateFromParent(b);this.getActiveInteraction().setCurrentLocation(b);switch(a.type){case JSG.ui.events.DragEventType.DROP:this.getActiveInteraction().onDrop(a,this.viewer);break;case JSG.ui.events.DragEventType.ENTER:this.getActiveInteraction().onDragEnter(a,this.viewer);break;case JSG.ui.events.DragEventType.EXIT:this.getActiveInteraction().onDragExit(a,
this.viewer);break;case JSG.ui.events.DragEventType.LEAVE:this.getActiveInteraction().onDragLeave(a,this.viewer);break;case JSG.ui.events.DragEventType.OVER:this.getActiveInteraction().onDragOver(a,this.viewer)}};
JSG.graph.interaction.InteractionHandler.prototype.handleKeyEvent=function(a){var b=new JSG.geometry.Point(0,0);b.setTo(a.location);this.viewer.translateFromParent(b);this.getActiveInteraction().setCurrentLocation(b);switch(a.type){case JSG.ui.events.KeyEventType.DOWN:this.getActiveInteraction().onKeyDown(a,this.viewer);break;case JSG.ui.events.KeyEventType.UP:this.getActiveInteraction().onKeyUp(a,this.viewer)}};JSG.graph.interaction.InteractionHandler.prototype.getCursor=function(){return this.gfxsys.getCursor()};
JSG.graph.interaction.InteractionHandler.prototype.setCursor=function(a){this.gfxsys&&this.gfxsys.setCursor(a)};JSG.graph.interaction.InteractionHandler.prototype.repaint=function(a){this.gfxsys.paint()};
JSG.graph.interaction.InteractionHandler.prototype.execute=function(a,b){JSG.debug.log("execute command!");JSG.setDrawingDisabled(!0);this.commandStack.execute(a);void 0!=b&&b.call(this,a,this.viewer);a._interaction=this.getActiveInteraction();this.viewer.getGraphView().clearFeedback();this.viewer.getGraph().setChanged(!0);JSG.setDrawingDisabled(!1);this.repaint()};
JSG.graph.interaction.InteractionHandler.prototype.undo=function(){if(this.isUndoAvailable()){JSG.debug.log("undo command!");JSG.setDrawingDisabled(!0);this.viewer.clearSelection();var a=this.commandStack.undo();void 0!=a&&(a.restoreStateAfterUndo(this.viewer),a._interaction!=this.getActiveInteraction()&&(a._interaction=void 0,this.setActiveInteraction(this.viewer.getDefaultInteraction())));this.viewer.getGraph().setChanged(!0);JSG.setDrawingDisabled(!1);this.repaint()}};
JSG.graph.interaction.InteractionHandler.prototype.isUndoAvailable=function(){return 0!=this.commandStack.undostack.length};JSG.graph.interaction.InteractionHandler.prototype.redo=function(){if(this.isRedoAvailable()){JSG.debug.log("redo command!");JSG.setDrawingDisabled(!0);this.viewer.clearSelection();var a=this.commandStack.redo();void 0!=a&&a.restoreStateAfterRedo(this.viewer);this.viewer.getGraph().setChanged(!0);JSG.setDrawingDisabled(!1);this.repaint()}};
JSG.graph.interaction.InteractionHandler.prototype.isRedoAvailable=function(){return 0!=this.commandStack.redostack.length};JSG.graph.interaction.InteractionHandler.prototype.copySelection=function(){JSG.clipOffset=new JSG.geometry.Point(200,200);JSG.clipXML=JSG.copyItems(this.viewer.getSelection())};JSG.graph.interaction.InteractionHandler.prototype.copySelectionFormat=function(){var a=this.viewer.getSelection();1==a.length&&(JSG.clipFormat=a[0].getModel().getFormat().copy(),JSG.clipTextFormat=a[0].getModel()._getTextFormat().copy())};
JSG.graph.interaction.InteractionHandler.prototype.cutSelection=function(){JSG.clipOffset=new JSG.geometry.Point(0,0);JSG.clipXML=JSG.copyItems(this.viewer.getSelection());for(var a=new JSG.graph.command.CompoundCommand,b=this.viewer.getSelection(),c=b.length-1;0<=c;c--)b[c].getModel().isDeleteable()&&a.add(new JSG.graph.command.DeleteItemCommand(b[c].getModel()));this.execute(a);this.viewer.clearSelection();this.viewer.clearAllLayer();this.repaint()};
JSG.graph.interaction.InteractionHandler.prototype.paste=function(){this.isPasteAvailable()&&(cmd=new JSG.graph.command.PasteItemsCommand(JSG.clipXML,this.viewer),this.execute(cmd))};JSG.graph.interaction.InteractionHandler.prototype.isPasteAvailable=function(){return void 0!=JSG.clipXML};
JSG.graph.interaction.InteractionHandler.prototype.pasteFormat=function(){if(this.isPasteFormatAvailable()){for(var a=JSG.clipFormat.copy(),b=void 0!=JSG.clipTextFormat?JSG.clipTextFormat.copy():void 0,c=new JSG.graph.command.CompoundCommand,d=this.viewer.getSelection(),e=0,f=d.length;e<f;e++)c.add(new JSG.graph.command.FormatItemCommand(d[e].getModel(),a)),void 0!=b&&c.add(new JSG.graph.command.TextFormatItemCommand(d[e].getModel(),b));this.execute(c)}};
JSG.graph.interaction.InteractionHandler.prototype.isPasteFormatAvailable=function(){return 0!=this.viewer.getSelection().length&&void 0!=JSG.clipFormat};
JSG.graph.interaction.InteractionHandler.prototype.deleteSelection=function(){for(var a=this.viewer.getSelection(),b=[],c=0,d=a.length;c<d;c++){var e=a[c].getModel();e.isDeleteable()&&b.push(e)}if(0<b.length){b.sort(function(a,b){return-1*(a.getIndex()-b.getIndex())});a=new JSG.graph.command.CompoundCommand;for(c=0;c<b.length;c++)a.add(new JSG.graph.command.DeleteItemCommand(b[c]));this.execute(a)}this.viewer.clearSelection();this.viewer.clearAllLayer()};
JSG.graph.interaction.InteractionHandler.prototype.groupSelection=function(){var a=this.viewer.getSelection();this.viewer.clearSelection();a=new JSG.graph.command.GroupItemsCommand(a);this.execute(a,function(a,c){a.selectAll(a._group,c)})};JSG.graph.interaction.InteractionHandler.prototype.ungroupSelection=function(){for(var a=new JSG.graph.command.CompoundCommand,b=this.viewer.getSelection(),c=0,d=b.length;c<d;c++)a.add(new JSG.graph.command.UnGroupItemsCommand(b[c].getModel()));this.execute(a)};
JSG.graph.interaction.InteractionHandler.prototype.changeDrawingOrderSelection=function(a){var b=new JSG.graph.command.CompoundCommand,c=this.viewer.getSelection();if(a==JSG.graph.command.ChangeItemOrder.UP)for(var d=c.length-1;0<=d;d--)b.add(new JSG.graph.command.ChangeItemOrderCommand(c[d],a));else for(var d=0,e=c.length;d<e;d++)b.add(new JSG.graph.command.ChangeItemOrderCommand(c[d],a));this.execute(b)};
JSG.graph.interaction.InteractionHandler.prototype.editSelection=function(){var a=this.viewer.getSelection();if(1==a.length){var b=void 0;switch(a[0].getModel().getShape().getType()){case JSG.graph.model.shapes.LineShape.TYPE:case JSG.graph.model.shapes.OrthoLineShape.TYPE:b=new JSG.graph.interaction.EditLineShapeInteraction;break;case JSG.graph.model.shapes.BezierShape.TYPE:case JSG.graph.model.shapes.EllipseShape.TYPE:b=new JSG.graph.interaction.EditBezierShapeInteraction;break;default:b=new JSG.graph.interaction.EditShapeInteraction}this.setActiveInteraction(b)}};
JSG.graph.interaction.InteractionHandler.prototype.alignSelection=function(a){var b=this.viewer.getSelection();a=new JSG.graph.command.AlignItemsCommand(b,a);this.execute(a)};JSG.graph.interaction.InteractionHandler.prototype.sizeSelection=function(a){var b=this.viewer.getSelection();a=new JSG.graph.command.SizeItemsCommand(b,a);this.execute(a)};JSG.graph.interaction.InteractionHandler.prototype.applyFormatMap=function(a){this.applyAttributesMapToSelection(a,JSG.graph.attr.FormatAttributes.NAME)};
JSG.graph.interaction.InteractionHandler.prototype.applyTextFormatMap=function(a){this.applyAttributesMapToSelection(a,JSG.graph.attr.TextFormatAttributes.NAME)};JSG.graph.interaction.InteractionHandler.prototype.applyAttributesMapToSelection=function(a,b){var c=this.viewer.getSelection();if(!c.isEmpty()){for(var d=new JSG.graph.command.CompoundCommand,e=0,f=c.length;e<f;e++){var g=c[e].getModel();d.add(new JSG.graph.command.SetAttributesMapCommand(g,a,b))}this.execute(d)}};
JSG.graph.interaction.InteractionHandler.prototype.executeLink=function(a){function b(a){for(var b=Array.prototype.slice.call(arguments).splice(1),c=a.split("."),d=c.pop(),e=this[c[0]],f=e,q=1;q<c.length;q++)if(f=e,e=e[c[q]],void 0==e)return"Undefined Namespace";if(void 0==e)this[d].apply(this,b);else return c=e.prototype[d],void 0==c&&(c=e[d]),void 0!=c?c.apply(f,b):"Undefined Function"}var c=a.getModel().getLink().getValue();if(c.length){var d=c.indexOf(":");if(-1!=d){var e=c.substring(0,d),d=c.substring(d+
1);if(d.length)try{switch(e){case "code":eval("function onClick(item) {"+d+"}");onClick(a.getModel());this.viewer.getGraph().markDirty();this.repaint();break;case "function":b(d,a.getModel());break;case "http":case "https":window.open(c,"_blank")}}catch(f){alert("Error: "+f.message)}}}};JSG.graph.interaction.InteractionHandler.prototype.collapse=function(a){a=new JSG.graph.command.CollapseItemCommand(a);this.execute(a);return!0};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.ActionHandle=function(a,b){this._type=void 0!=a?a:void 0;this._cursor=void 0!=b?b:JSG.ui.Cursor.Style.AUTO};JSG.graph.interaction.ActionHandle.prototype.reset=function(){this._type=void 0;this._cursor=JSG.ui.Cursor.Style.AUTO};JSG.graph.interaction.ActionHandle.prototype.getType=function(){return this._type};JSG.graph.interaction.ActionHandle.prototype.setType=function(a){this._type=a};JSG.graph.interaction.ActionHandle.prototype.getCursor=function(){return this._cursor};
JSG.graph.interaction.ActionHandle.prototype.setCursor=function(a){this._cursor=a};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.LinkHandle=function(a,b,c){JSG.graph.interaction.LinkHandle._super.constructor.apply(this,arguments);this._controller=c};JSG.extend(JSG.graph.interaction.LinkHandle,JSG.graph.interaction.ActionHandle);JSG.graph.interaction.LinkHandle.TYPE={LINK:"link",EDIT:"edit"};
JSG.graph.interaction.LinkHandle.prototype.reset=function(){this._type=JSG.graph.interaction.LinkHandle.TYPE_EDIT;this._cursor=JSG.ui.Cursor.Style.TEXT};JSG.graph.interaction.LinkHandle.prototype.getController=function(a){return this._controller};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.GraphInteraction=function(){JSG.graph.interaction.GraphInteraction._super.constructor.apply(this,arguments);this.registerActivators();this._keyHandler=new JSG.graph.interaction.DefaultKeyHandler;this._activeHandle=this._controller=void 0;this._cursorChanged=!1};JSG.extend(JSG.graph.interaction.GraphInteraction,JSG.graph.interaction.InteractionDispatcher);
JSG.graph.interaction.GraphInteraction.prototype.activate=function(a){JSG.graph.interaction.GraphInteraction._super.activate.call(this,a);this._reset()};JSG.graph.interaction.GraphInteraction.prototype.deactivate=function(a){JSG.graph.interaction.GraphInteraction._super.deactivate.call(this,a);this._reset()};JSG.graph.interaction.GraphInteraction.prototype._reset=function(){this._activeHandle=this._controller=void 0;this._cursorChanged=!1};
JSG.graph.interaction.GraphInteraction.prototype.registerActivators=function(){this.addActivator(JSG.graph.interaction.ViewInteraction.Activator.KEY,new JSG.graph.interaction.ViewInteraction.Activator);this.addActivator(JSG.graph.interaction.CreateEdgeActivator.KEY,new JSG.graph.interaction.CreateEdgeActivator);this.addActivator(JSG.graph.interaction.CreateFriendActivator.KEY,new JSG.graph.interaction.CreateFriendActivator);this.addActivator(JSG.graph.interaction.ResizeActivator.KEY,new JSG.graph.interaction.ResizeActivator);
this.addActivator(JSG.graph.interaction.ReshapeActivator.KEY,new JSG.graph.interaction.ReshapeActivator);this.addActivator(JSG.graph.interaction.RotateActivator.KEY,new JSG.graph.interaction.RotateActivator);this.addActivator(JSG.graph.interaction.EditTextActivator.KEY,new JSG.graph.interaction.EditTextActivator);this.addActivator(JSG.graph.interaction.MoveActivator.KEY,new JSG.graph.interaction.MoveActivator);this.addActivator(JSG.graph.interaction.CommandButtonActivator.KEY,new JSG.graph.interaction.CommandButtonActivator);
this.addActivator(JSG.graph.interaction.MarqueeActivator.KEY,new JSG.graph.interaction.MarqueeActivator);this.addActivator(JSG.graph.interaction.PinchInteraction.Activator.KEY,new JSG.graph.interaction.PinchInteraction.Activator);this.addActivator(JSG.graph.interaction.PanInteraction.Activator.KEY,new JSG.graph.interaction.PanInteraction.Activator);this.addActivator(JSG.graph.interaction.LinkActivator.KEY,new JSG.graph.interaction.LinkActivator)};
JSG.graph.interaction.GraphInteraction.prototype.setDefaultKeyHandler=function(a){this._keyHandler=a};JSG.graph.interaction.GraphInteraction.prototype.condition=function(a){if(a.getModel()instanceof JSG.graph.model.TextNode){var b=a.getParent();if(b)for(var c=0,d=b.children.length;c<d;c++)if(child=b.children[c],child.getModel()instanceof JSG.graph.model.TextNode&&child.isSelected())return!0;if(!a.getParent().isSelected())return!1}return a.isSelectable()};
JSG.graph.interaction.GraphInteraction.prototype.getControllerAt=function(a,b,c){b=void 0!=b?b:JSG.graph.controller.FindFlags.AUTOMATIC;if(void 0!=c||void 0==this._controller||b!=JSG.graph.controller.FindFlags.AUTOMATIC)this._controller=this._findControllerAt(a,b,c,this.getViewer());return this._controller};JSG.graph.interaction.GraphInteraction.prototype._findControllerAt=function(a,b,c,d){c=void 0!=c?c:this.condition;return d.findControllerAt(a,b,c)};
JSG.graph.interaction.GraphInteraction.prototype.getActiveHandle=function(){return this._activeHandle};JSG.graph.interaction.GraphInteraction.prototype._setActiveHandle=function(a){this._activeHandle=void 0;void 0!=a&&void 0!=a.getType()&&(this._activeHandle=a);void 0!=this._activeHandle?JSG.graph.interaction.GraphInteraction._super.setCursor.call(this,this._activeHandle.getCursor()):this._cursorChanged||JSG.graph.interaction.GraphInteraction._super.setCursor.call(this,JSG.ui.Cursor.Style.AUTO)};
JSG.graph.interaction.GraphInteraction.prototype.handleRightClick=function(a,b){var c=a.event.keyCode;if(0==c||void 0==c)if(c=this.getControllerAt(a.location,JSG.graph.controller.FindFlags.AREA,this._condition),c=this._getControllerToSelect(c,b),c instanceof JSG.graph.controller.GraphController){var c=b.getSelectionView(),d=JSG.ptCache.get().setTo(a.location);b.translateFromParent(d);void 0!=c&&c.containsPoint(d)||(b.clearSelection(!0),this.getInteractionHandler().repaint());JSG.ptCache.release(d)}else c&&
!c.isSelected()&&(b.clearSelection(!1),b.select(c),this.getInteractionHandler().repaint())};JSG.graph.interaction.GraphInteraction.prototype._condition=function(a,b){return a.isSelectable()&&a.containsPoint(b,JSG.graph.controller.FindFlags.AUTOMATIC)};
JSG.graph.interaction.GraphInteraction.prototype._getControllerToSelect=function(a,b){if(a&&!(a instanceof JSG.graph.controller.GraphController)){var c=a.getParent(),d=c.getModel().getType().getValue();if(c.isSelected()||"bpmnpool"!=d&&"bpmnlane"!=d){var e=a.getModel();if(e instanceof JSG.graph.model.TextNode){var c=e.getParent(),d=a.getParent(),f=c.getBoundingBox(JSG.boxCache.get()),c=e.getTranslatedBoundingBox(c.getParent(),JSG.boxCache.get());f.doesIntersectWith(c)&&!a.isSelected()&&(a=d)}}else a=
c}return a.isSelected()?void 0:a};JSG.graph.interaction.GraphInteraction.prototype._checkParent=function(a){if(a&&!(a instanceof JSG.graph.controller.GraphController)){var b=a.getParent(),c=b.getModel().getType().getValue();if(!b.isSelected()&&("bpmnpool"==c||"bpmnlane"==c))return b}return a};JSG.graph.interaction.GraphInteraction.prototype.onResizeCanvas=function(a,b,c){var d=this.getActivator(JSG.graph.interaction.EditTextActivator.KEY);return void 0!=d?d.onResizeCanvas(a,b,c,this):!1};
JSG.graph.interaction.GraphInteraction.prototype.onRotateStart=function(a,b){var c=this.getActivator(JSG.graph.interaction.RotateActivator.KEY);if(void 0!=c)c.onRotateStart(a,b,this)};JSG.graph.interaction.GraphInteraction.prototype.onPinchStart=function(a,b){var c=this.getActivator(JSG.graph.interaction.PinchInteraction.Activator.KEY);if(void 0!=c)c.onPinchStart(a,b,this)};
JSG.graph.interaction.GraphInteraction.prototype.onPanStart=function(a,b){var c=this.getActivator(JSG.graph.interaction.PanInteraction.Activator.KEY);if(void 0!=c)c.onPanStart(a,b,this)};JSG.graph.interaction.GraphInteraction.prototype.onMouseDown=function(a,b){if(JSG.touchDevice)this.onMouseMove(a,b);this._controller=void 0;var c=this.getActivatorsForFunc("onMouseDown");this.sortActivatorsForFunc("onMouseDown",c);for(var d=0;d<c.length&&(c[d].onMouseDown(a,b,this),!0!==a.hasActivated);d++);};
JSG.graph.interaction.GraphInteraction.prototype.onMouseDoubleClick=function(a,b){this._controller=void 0;var c=this.getActivatorsForFunc("onMouseDoubleClick");this.sortActivatorsForFunc("onMouseDoubleClick",c);for(var d=0;d<c.length&&(c[d].onMouseDoubleClick(a,b,this),!0!==a.hasActivated);d++);};
JSG.graph.interaction.GraphInteraction.prototype.onMouseMove=function(a,b){this._reset();var c=this.getActivatorsForFunc("onMouseMove");this.sortActivatorsForFunc("onMouseMove",c);for(var d=0;d<c.length&&(c[d].onMouseMove(a,b,this),!0!==a.hasActivated);d++);this._updateCursor(a,b)};JSG.graph.interaction.GraphInteraction.prototype._updateCursor=function(a,b){var c=void 0;a.isConsumed||a.hasActivated||(b.hasSelection()&&(c=a.location.copy(),b.translateFromParent(c),c=b.getHandleAt(c,a)),this._setActiveHandle(c))};
JSG.graph.interaction.GraphInteraction.prototype.setCursor=function(a){this._cursorChanged=!0;JSG.graph.interaction.GraphInteraction._super.setCursor.call(this,a)};JSG.graph.interaction.GraphInteraction.prototype.onMouseDrag=function(a,b){var c=this.getActivatorsForFunc("onMouseDrag");this.sortActivatorsForFunc("onMouseDrag",c);for(var d=0;d<c.length&&(c[d].onMouseDrag(a,b,this),!0!==a.hasActivated);d++);};
JSG.graph.interaction.GraphInteraction.prototype.onMouseUp=function(a,b){this._controller=void 0;var c=this.getActivatorsForFunc("onMouseUp");this.sortActivatorsForFunc("onMouseUp",c);for(var d=0;d<c.length&&(c[d].onMouseUp(a,b,this),!0!==a.hasActivated);d++);};
JSG.graph.interaction.GraphInteraction.prototype.onKeyDown=function(a,b){var c=this.getActivatorsForFunc("onKeyDown");this.sortActivatorsForFunc("onKeyDown",c);for(var d=0;d<c.length&&(c[d].onKeyDown(a,b,this),!0!==a.hasActivated);d++);if(void 0!=this._keyHandler&&!a.hasActivated)this._keyHandler.onKeyDown(a,b,this)};
JSG.graph.interaction.GraphInteraction.prototype.onKeyUp=function(a,b){var c=this.getActivatorsForFunc("onKeyUp");this.sortActivatorsForFunc("onKeyUp",c);for(var d=0;d<c.length&&(c[d].onKeyUp(a,b,this),!0!==a.hasActivated);d++);if(void 0!=this._keyHandler&&!a.hasActivated)this._keyHandler.onKeyUp(a,b,this)};
JSG.graph.interaction.GraphInteraction.prototype.sortActivatorsForFunc=function(a,b){var c=void 0;switch(a){case "onMouseUp":c=this._compareOnMouseUp;break;case "onMouseDown":c=this._compareOnMouseDown;break;case "onMouseDoubleClick":c=this._compareOnMouseDoubleClick;break;case "onMouseMove":c=this._compareOnMouseMove;break;case "onKeyDown":c=this._compareOnKeyDown}void 0!=c&&b.sort(c);return b};
JSG.graph.interaction.GraphInteraction.prototype._compareOnMouseDown=function(a,b){return a.getKey()===JSG.graph.interaction.MoveActivator.KEY?1:-1};JSG.graph.interaction.GraphInteraction.prototype._compareOnMouseMove=function(a,b){return a.getKey()===JSG.graph.interaction.CreateEdgeActivator.KEY?1:-1};JSG.graph.interaction.GraphInteraction.prototype._compareOnMouseUp=function(a,b){return a.getKey()===JSG.graph.interaction.CreateFriendActivator.KEY?1:-1};
JSG.graph.interaction.GraphInteraction.prototype._compareOnKeyDown=function(a,b){a.getKey();return-1};JSG.graph.interaction.GraphInteraction.prototype._compareOnMouseDoubleClick=function(a,b){return a.getKey()===JSG.graph.interaction.EditTextActivator.KEY?1:-1};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.SnapType={NONE:0,CENTERX:1,CENTERY:2,LEFT:4,TOP:8,RIGHT:16,BOTTOM:32};
JSG.graph.interaction.AbstractInteraction=function(){JSG.graph.interaction.AbstractInteraction._super.constructor.apply(this,arguments);this.feedback=[];this.actionFeedback;this._subfeedbacks=new JSG.commons.Map;this._offset=new JSG.geometry.Point(0,0);this._horizontalSnapController=this._verticalSnapController=void 0};JSG.extend(JSG.graph.interaction.AbstractInteraction,JSG.graph.interaction.Interaction);
JSG.graph.interaction.AbstractInteraction.prototype.deactivate=function(a){a.removeInteractionFeedback(this.actionFeedback);this.feedback=[];this._subfeedbacks.clear();this.actionFeedback=void 0;JSG.graph.interaction.AbstractInteraction._super.deactivate.call(this,a)};JSG.graph.interaction.AbstractInteraction.prototype.updateFeedback=function(a,b,c){};JSG.graph.interaction.AbstractInteraction.prototype.updateSubFeedbacks=function(a,b,c){};
JSG.graph.interaction.AbstractInteraction.prototype.createCommand=function(a,b,c,d){};JSG.graph.interaction.AbstractInteraction.prototype.onRotate=function(a,b){this.onMouseDrag(a,b)};JSG.graph.interaction.AbstractInteraction.prototype.onMouseDown=function(a,b){JSG.touchDevice&&(this.actionFeedback||(this.actionFeedback=this.createActionFeedback(a,b)),this.actionFeedback&&(this.updateActionFeedback(a,b),b.addInteractionFeedback(this.actionFeedback)))};
JSG.graph.interaction.AbstractInteraction.prototype.onMouseDrag=function(a,b){this.checkForEscape(a,b)||(this._setFeedback(a,b),this._offset.setTo(this.currentLocation),this._offset.subtract(this.lastLocation),this.updateFeedback(a,b,this._offset),this.updateSubFeedbacks(a,b,this._subfeedbacks.elements()),this.actionFeedback||(this.actionFeedback=this.createActionFeedback(a,b))&&b.addInteractionFeedback(this.actionFeedback),this.updateActionFeedback(a,b),this.lastLocation.setTo(this.currentLocation))};
JSG.graph.interaction.AbstractInteraction.prototype.createActionFeedback=function(a,b){};JSG.graph.interaction.AbstractInteraction.prototype.updateActionFeedback=function(a,b){};JSG.graph.interaction.AbstractInteraction.prototype._setFeedback=function(a,b){if(this.feedback.isEmpty()){this._subfeedbacks.clear();var c=b.getSelection();c.isEmpty()||(this.lastLocation.setTo(this.getStartLocation()),this._createAndAddSelectionFeedback(c,b))}};
JSG.graph.interaction.AbstractInteraction.prototype._createAndAddSelectionFeedback=function(a,b){function c(a,b){for(var c=a.getId(),d=0;d<b.length;d++)if(b[d].getOriginalItem().getId()===c)return b[d]}for(var d=[],e=0,f=a.length;e<f;e++){var g=this._createSelectionFeedback(a[e],b);void 0!==g&&(this.feedback.push(g),b.addInteractionFeedback(g),JSG.touchDevice||(this._createSubFeedbacks(a[e],g),a[e]instanceof JSG.graph.controller.ConnectionController&&d.push(g)))}for(e=0;e<d.length;e++){var f=d[e],
g=f.getOriginalItem(),l=g.getSourcePort();if(void 0!=l){var h=l.getParent(),l=h.getPortIndex(l),h=c(h,this.feedback);void 0!=h&&(h=h._fbItem.getPortAt(l),f.setSourcePort(h),f.getFeedbackItem().getSourcePort=JSG.graph.model.Edge.prototype.getSourcePort)}l=g.getTargetPort();void 0!=l&&(h=l.getParent(),g=c(h,this.feedback),void 0!=g&&(h=g._fbItem.getPortAt(h.getPortIndex(l)),f.setTargetPort(h),f.getFeedbackItem().getTargetPort=JSG.graph.model.Edge.prototype.getTargetPort))}(function(a,b){b.forEach(function(b){a.remove(b.getOriginalItem().getId())})})(this._subfeedbacks,
this.feedback);this._subfeedbacks.iterate(function(a,c){b.addInteractionFeedback(c.getFeedbackView())})};JSG.graph.interaction.AbstractInteraction.prototype._createSelectionFeedback=function(a,b){return a.createFeedback()};
JSG.graph.interaction.AbstractInteraction.prototype._createSubFeedbacks=function(a,b){function c(a){a=e(a,m);void 0!==a&&(a.setSourcePort(f),a.getFeedbackItem().getSourcePort=JSG.graph.model.Edge.prototype.getSourcePort)}function d(a){a=e(a,m);void 0!==a&&(a.setTargetPort(f),a.getFeedbackItem().getTargetPort=JSG.graph.model.Edge.prototype.getTargetPort)}function e(a,b){var c=g.get(a.getId());if(void 0===c){var d=b.getControllerByModelId(a.getId());void 0!==d&&(c=d.createFeedback(),c.getFeedbackItem().disableEvents(),
c.getFeedbackItem().getShape().disableNotification(),g.put(c.getOriginalItem().getId(),c))}return c}var f,g=this._subfeedbacks;if(a instanceof JSG.graph.controller.NodeController)for(var l=a.getModel().getPorts(),h=b.getFeedbackItem(),m=a.getGraphController(),k=0;k<l.length;k++)if(f=h.getPortAt(k),void 0!=f){var n=l[k],q=n.getIncomingEdges();q.forEach(d);q=n.getOutgoingEdges();q.forEach(c)}};
JSG.graph.interaction.AbstractInteraction.prototype.onMouseUp=function(a,b){this._offset.setTo(this.currentLocation);this._offset.subtract(this.startLocation);this.finishInteraction(a,b)};JSG.graph.interaction.AbstractInteraction.prototype.finishInteraction=function(a,b){this.willFinish(a,b,this._offset);this.didFinish(a,b)};
JSG.graph.interaction.AbstractInteraction.prototype.cancelInteraction=function(a,b){void 0!=a&&(a.doRepaint=!0);this.setCursor(JSG.ui.Cursor.Style.AUTO);JSG.graph.interaction.AbstractInteraction._super.cancelInteraction.call(this,a,b)};
JSG.graph.interaction.AbstractInteraction.prototype.willFinish=function(a,b,c){var d=this.getInteractionHandler();if(d){for(var e=[],f=b.getSelection(),g=0;g<f.length;g++){var l=this.createCommand(c,f[g],a,b);void 0!=l&&e.push(l)}e.length&&d.execute(this._createCommand(e),this.executed)}};JSG.graph.interaction.AbstractInteraction.prototype.executed=function(a,b){};
JSG.graph.interaction.AbstractInteraction.prototype._createCommand=function(a,b){if(1==a.length)return a[0];for(var c=new JSG.graph.command.CompoundCommand(b),d=0,e=a.length;d<e;d++)c.add(a[d]);return c};JSG.graph.interaction.AbstractInteraction.prototype.getSnapRect=function(a,b){var c=b||new JSG.geometry.Rectangle(0,0,0,0),d=a.getSelectionView().getBoundingBox(JSG.boxCache.get());d.getBoundingRectangle(c);JSG.boxCache.release(d);return c};
JSG.graph.interaction.AbstractInteraction.prototype.getSnapAndGridOffset=function(a,b,c,d){d=void 0!=d?d:new JSG.geometry.Point(0,0);var e=this.currentLocation.copy().subtract(this.startLocation),f=new JSG.geometry.Point(c.x+e.x,c.y+e.y);c=new JSG.geometry.Point(c.getRight()+e.x,c.getBottom()+e.y);var g=this.alignToGrid(f,a,b.event.altKey,new JSG.geometry.Point(0,0));b=this.alignToGrid(c,a,b.event.altKey,new JSG.geometry.Point(0,0));this.alignToSnapController(f,c,g,b,a);d.x=f.x-g.x<c.x-b.x?e.x+g.x-
f.x:e.x+b.x-c.x;d.y=f.y-g.y<c.y-b.y?e.y+g.y-f.y:e.y+b.y-c.y;return d};
JSG.graph.interaction.AbstractInteraction.prototype.getControllerForSnap=function(a,b){function c(){return!0}var d=this.interactionHandler.viewer,e=void 0!=b?b:c,f=d.getGraph(),g=[];d.findControllerByConditionAndBox(a,function(a,b){var c=!1,k=a.getModel().getTranslatedBoundingBox(f,JSG.boxCache.get()),n=k.getBoundingRectangle(JSG.rectCache.get()),q=n.getCenter(JSG.ptCache.get()),p=JSG.ptCache.get(b.x+b.width/2,b.y+b.height/2);if(c=e(a,b)){a._snapType=JSG.graph.interaction.SnapType.NONE;var s=Math.abs(p.x-
q.x),u=Math.abs(b.x-n.x),t=Math.abs(b.getRight()-n.getRight()),c=d.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);s<c&&s<=u&&s<=t?a._snapType|=JSG.graph.interaction.SnapType.CENTERX:u<c&&u<=s&&u<=t?a._snapType|=JSG.graph.interaction.SnapType.LEFT:t<c&&(t<=s&&t<=u)&&(a._snapType|=JSG.graph.interaction.SnapType.RIGHT);s=Math.abs(p.y-q.y);u=Math.abs(b.y-n.y);t=Math.abs(b.getBottom()-n.getBottom());s<c&&s<=u&&s<=t?a._snapType|=JSG.graph.interaction.SnapType.CENTERY:u<c&&u<=s&&u<=t?a._snapType|=
JSG.graph.interaction.SnapType.TOP:t<c&&(t<=s&&t<=u)&&(a._snapType|=JSG.graph.interaction.SnapType.BOTTOM);a._snapType!=JSG.graph.interaction.SnapType.NONE&&g.push(a)}JSG.boxCache.release(k);JSG.rectCache.release(n);JSG.ptCache.release(q,p);return!1});return g};
JSG.graph.interaction.AbstractInteraction.prototype.alignToSnapController=function(a,b,c,d,e){var f=JSG.boxCache.get(),g=JSG.rectCache.get(),l=JSG.rectCache.get(),h=JSG.ptCache.get(),m=JSG.ptCache.get(),k=e.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);if(this._horizontalSnapController)switch(g.set(a.x,a.y,b.x-a.x,b.y-a.y),h=g.getCenter(h),l=this._horizontalSnapController.getModel().getTranslatedBoundingBox(e.getGraph(),f).getBoundingRectangle(l),m=l.getCenter(m),this._horizontalSnapController._snapType){case JSG.graph.interaction.SnapType.CENTERY:Math.abs(h.y-
m.y)<k&&(c.y=a.y-(h.y-m.y),d.y=b.y-(h.y-m.y));break;case JSG.graph.interaction.SnapType.TOP:Math.abs(g.y-l.y)<k&&(c.y=a.y-(g.y-l.y),d.y=b.y-(g.y-l.y));break;case JSG.graph.interaction.SnapType.BOTTOM:Math.abs(g.getBottom()-l.getBottom())<k&&(c.y=a.y-(g.getBottom()-l.getBottom()),d.y=b.y-(g.getBottom()-l.getBottom()))}if(this._verticalSnapController)switch(g.set(a.x,a.y,b.x-a.x,b.y-a.y),h=g.getCenter(h),l=this._verticalSnapController.getModel().getTranslatedBoundingBox(e.getGraph(),f).getBoundingRectangle(l),
m=l.getCenter(m),this._verticalSnapController._snapType){case JSG.graph.interaction.SnapType.CENTERX:Math.abs(h.x-m.x)<k&&(c.x=a.x-(h.x-m.x),d.x=b.x-(h.x-m.x));break;case JSG.graph.interaction.SnapType.LEFT:Math.abs(g.x-l.x)<k&&(c.x=a.x-(g.x-l.x),d.x=b.x-(g.x-l.x));break;case JSG.graph.interaction.SnapType.RIGHT:Math.abs(g.getRight()-l.getRight())<k&&(c.x=a.x-(g.getRight()-l.getRight()),d.x=b.x-(g.getRight()-l.getRight()))}JSG.boxCache.release(f);JSG.rectCache.release(g,l);JSG.ptCache.release(h,m)};
JSG.graph.interaction.AbstractInteraction.prototype.checkForEscape=function(a,b){return a.isPressed(27)?(this.cancelInteraction(a,b),!0):!1};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.DragDropInteraction=function(a,b){JSG.graph.interaction.DragDropInteraction._super.constructor.apply(this,arguments);this._dragInteraction=new JSG.graph.interaction.DragDropInteraction.Drag(a);this._dropInteraction=new JSG.graph.interaction.DragDropInteraction.Drop(b,this)};
JSG.extend(JSG.graph.interaction.DragDropInteraction,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.DragDropInteraction.prototype.setDraggedItem=function(a){this._dragInteraction.createFeedback(a);this._dropInteraction.createFeedback(a)};JSG.graph.interaction.DragDropInteraction.prototype.setDropDelegate=function(a){this._dropInteraction.setDelegate(a)};JSG.graph.interaction.DragDropInteraction.prototype.registerTargetEditor=function(a){this._dropInteraction.setTarget(a)};
JSG.graph.interaction.DragDropInteraction.prototype._updatePositions=function(){this._dragInteraction.startLocation=this.startLocation;this._dragInteraction.currentLocation=this.currentLocation;this._dropInteraction.startLocation=this.startLocation;this._dropInteraction.currentLocation=this.currentLocation};
JSG.graph.interaction.DragDropInteraction.prototype.onMouseDown=function(a,b){JSG.keepFocus=!0;this._updatePositions();this._dragInteraction.onMouseDown(a,b);this._dropInteraction.onMouseDown(a,b)};JSG.graph.interaction.DragDropInteraction.prototype.updateFeedback=function(a,b,c){this._updatePositions();this._dragInteraction.updateFeedback(a,b,c);this._dropInteraction.updateFeedback(a,b,c)};
JSG.graph.interaction.DragDropInteraction.prototype.onMouseUp=function(a,b){this.updateFeedback(a,b,new JSG.geometry.Point(0,0));var c=this._dropInteraction.drop(a);this.finished(b);c&&this.activateTextEditor()};JSG.graph.interaction.DragDropInteraction.prototype.activateTextEditor=function(){};
JSG.graph.interaction.DragDropInteraction.prototype.finished=function(a){JSG.keepFocus=!1;var b=this._dropInteraction.getTarget();this._dragInteraction.finished(a);this._dropInteraction.finished(a);a=this.getInteractionHandler();a.setActiveInteraction(a.getDefaultInteraction());a=b.getInteractionHandler();a.setActiveInteraction(a.getDefaultInteraction());b.repaint()};JSG.graph.interaction.DragDropInteraction.prototype.cancelInteraction=function(a,b){this.finished(b);void 0!=a&&(a.doRepaint=!0)};
JSG.graph.interaction.DragDropInteraction.prototype.deactivate=function(a){JSG.keepFocus=!1;this._dragInteraction.deactivate(a);this._dropInteraction.deactivate(a);this._dropInteraction=this._dragInteraction=void 0};JSG.graph.interaction.DragDropInteraction.prototype.createDropCommand=function(a,b,c){var d=a.getType().getValue();a={libId:d,libName:d,newPinPoint:a.getPinPoint(),target:b,editor:c};return void 0!=d?new JSG.graph.command.DropItemCommand(a):void 0};
JSG.graph.interaction.DragDropInteraction.DnD=function(a){JSG.graph.interaction.DragDropInteraction.DnD._super.constructor.call(this);this._viewer=a;this._feedback=void 0};JSG.extend(JSG.graph.interaction.DragDropInteraction.DnD,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.DragDropInteraction.DnD.prototype.getFeedback=function(){return this._feedback};
JSG.graph.interaction.DragDropInteraction.DnD.prototype.createFeedback=function(a){this.clearFeedbacksAndHighlights();feedbacks=[];var b,c;c=a.getType().getValue();(a=JSG.graphItemFactory.createItemFromString(c))?(c=[],c.push(a)):c=JSG.graphItemFactory.createShape(c);void 0!=c&&0<c.length&&(b=this.createFeedbackViewFor(c[0],this._viewer));return this._feedback=b};
JSG.graph.interaction.DragDropInteraction.DnD.prototype.createFeedbackViewFor=function(a,b){var c=b.getControllerFactory().createController(a);c.getViewer=function(){return b};c.refresh();var d=c.getView();c.deactivate();return d};
JSG.graph.interaction.DragDropInteraction.DnD.prototype.clearFeedbacksAndHighlights=function(){var a=this._viewer.getGraphView();this._viewer.clearLayer(JSG.graph.view.LayerId.LAYOUTMARKER);this._viewer.clearLayer(JSG.graph.view.LayerId.TARGETCONTAINER);this._viewer.clearLayer(JSG.graph.view.LayerId.SNAPLINES);a.clearFeedback()};
JSG.graph.interaction.DragDropInteraction.DnD.prototype.onMouseDown=function(a,b){if(void 0!=this._feedback){var c=this.startLocation.copy();this._viewer.translateFromParent(c);this._feedback.getItem().setPinPointTo(c);this._viewer.getGraphView().addFeedback(this._feedback)}};JSG.graph.interaction.DragDropInteraction.DnD.prototype.getPosition=function(a,b,c){c=void 0!=c?c.getBoundingClientRect():a.canvasRect;a=new JSG.geometry.Point(a.windowLocation.x-c.left,a.windowLocation.y-c.top);return b.deviceToLogPoint(a)};
JSG.graph.interaction.DragDropInteraction.DnD.prototype.finished=function(a){};JSG.graph.interaction.DragDropInteraction.DnD.prototype.deactivate=function(a){this.clearFeedbacksAndHighlights()};JSG.graph.interaction.DragDropInteraction.Drag=function(a){JSG.graph.interaction.DragDropInteraction.Drag._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.DragDropInteraction.Drag,JSG.graph.interaction.DragDropInteraction.DnD);
JSG.graph.interaction.DragDropInteraction.Drag.prototype.createFeedback=function(a){this.clearFeedbacksAndHighlights();this._feedback=this.createFeedbackViewFor(a.copy(),this._viewer);a=a.getSizeAsPoint();this._feedback.getItem().setSize(a.x,a.y)};JSG.graph.interaction.DragDropInteraction.Drag.prototype.updateFeedback=function(a,b,c){a=this.getPosition(a,this._viewer.getCoordinateSystem());this._viewer.translateFromParent(a);this._feedback.getItem().setPinPointTo(a)};
JSG.graph.interaction.DragDropInteraction.Drop=function(a,b){JSG.graph.interaction.DragDropInteraction.Drop._super.constructor.call(this,a);this._targetController=this._targetEditor=void 0;this._mainInteraction=b};JSG.extend(JSG.graph.interaction.DragDropInteraction.Drop,JSG.graph.interaction.DragDropInteraction.DnD);JSG.graph.interaction.DragDropInteraction.Drop.prototype.getTarget=function(){return this._targetEditor};
JSG.graph.interaction.DragDropInteraction.Drop.prototype.setTarget=function(a){this._targetEditor=a;this._trgtCanvas=document.getElementById(a.getCanvasId());this.setInteractionHandler(a.getInteractionHandler())};JSG.graph.interaction.DragDropInteraction.Drop.prototype.getViewer=function(){return this._viewer};
JSG.graph.interaction.DragDropInteraction.Drop.prototype.updateFeedback=function(a,b,c){b=this.getPosition(a,this._viewer.getCoordinateSystem(),this._trgtCanvas);this._viewer.getGraphView();c=this._notifyDelegate("findTargetControllerAt",b,a,this._viewer);this._targetController=c=void 0!=c?c:this.findTargetControllerAt(b,a,this._viewer);this._viewer.translateFromParent(b);this._viewer.clearLayer(JSG.graph.view.LayerId.LAYOUTMARKER);this._viewer.clearLayer(JSG.graph.view.LayerId.TARGETCONTAINER);this._viewer.clearLayer(JSG.graph.view.LayerId.SNAPLINES);
this._notifyDelegate("highlightTargetController",c,b,a,this._viewer)||this.highlightTargetController(c,b,a,this._viewer);this._feedback.getItem().setPinPointTo(b);if(this._viewer.getGraphSettings().getSnapToShapes()&&(this._horizontalSnapController=this._verticalSnapController=void 0,this._viewer.getGraphSettings().getSnapToShapes()&&!a.event.altKey)){c=this._feedback.getBoundingBox();var d=c.getBoundingRectangle();this._targetEditor.getVisibleGraphRect().intersect(c.toRectangle())&&JSG.graph.interaction.InteractionUtils.highlightSnapItemofController(this,
d,a.event.altKey)}a=this.getSnapAndGridOffset(this._viewer,a);b.translate(a.x,a.y);this._feedback.getItem().setPinPointTo(b);this._targetEditor.repaint()};
JSG.graph.interaction.DragDropInteraction.Drop.prototype.findTargetControllerAt=function(a,b,c){function d(a){return JSG.graphItemFactory.isValidSubItem(e,a.getModel().getType().getValue())?a.getModel().isContainer()&&!(a instanceof JSG.graph.controller.ConnectionController)&&!(a instanceof JSG.graph.controller.PortController)&&!(a instanceof JSG.graph.controller.GraphController):!1}if(void 0!=this._feedback){var e=this._feedback.getItem();return c.findControllerAt(a,JSG.graph.controller.FindFlags.AREA,
d)}};JSG.graph.interaction.DragDropInteraction.Drop.prototype.highlightTargetController=function(a,b,c,d){c=!1;a=this._validateController(a,b,d);if(void 0!=a){c=!0;JSG.graph.interaction.InteractionUtils.highlightTargetController(d,a);var e=this._feedback.getItem().getType().getValue();b=JSG.layoutFactory.getLayoutIndex(b,d,a,e,!0,!0);void 0!=b&&JSG.graph.interaction.InteractionUtils.highlightControllerLayoutPosition(b,d,a)}return c};
JSG.graph.interaction.DragDropInteraction.Drop.prototype._validateController=function(a,b,c){function d(a){a.getModel().getTranslatedBoundingBox(g,f);return f.containsPoint(b)}var e=void 0,f=JSG.boxCache.get(),g=c.getGraph();void 0!=a&&(e=d(a)?a:d(a.getParent())?a.getParent():void 0);JSG.boxCache.release(f);return e instanceof JSG.graph.controller.GraphController?void 0:e};
JSG.graph.interaction.DragDropInteraction.Drop.prototype.getSnapAndGridOffset=function(a,b){var c=new JSG.geometry.Point(0,0),d=this._feedback.getBoundingBox().getBoundingRectangle(),e=new JSG.geometry.Point(d.x,d.y),d=new JSG.geometry.Point(d.getRight(),d.getBottom()),f=this.alignToGrid(e,a,b.event.altKey),g=this.alignToGrid(d,a,b.event.altKey);this.alignToSnapController(e,d,f,g,a);c.x=e.x-f.x<d.x-g.x?f.x-e.x:g.x-d.x;c.y=e.y-f.y<d.y-g.y?f.y-e.y:g.y-d.y;return c};
JSG.graph.interaction.DragDropInteraction.Drop.prototype.drop=function(a){function b(a,b){void 0!=a&&void 0!=b&&b.execute(a)}var c=function(b){var c=document.elementFromPoint(a.windowLocation.x,a.windowLocation.y);return c&&"canvas"==c.nodeName.toLowerCase()&&c._jsgEditor?b==c.id:!1}(this._trgtCanvas.id);if(c){var d=this._notifyDelegate("createDropCommand",a);void 0==d&&(void 0==this._targetController&&(this._targetController=this._viewer.getGraphController()),d=this._mainInteraction.createDropCommand(this._feedback.getItem(),
this._targetController,this._targetEditor));b(d,this.getInteractionHandler())}return c};JSG.graph.interaction.DragDropInteraction.Drop.prototype.deactivate=function(a){this._targetController=void 0;this._notifyDelegate("deactivate",this._viewer);JSG.graph.interaction.DragDropInteraction.Drop._super.deactivate.call(this,a)};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.CreateItemInteraction=function(a,b){JSG.graph.interaction.CreateItemInteraction._super.constructor.apply(this,arguments);this._graphItem=a;this._parent=this._fbView=void 0;this._label=b};JSG.extend(JSG.graph.interaction.CreateItemInteraction,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.CreateItemInteraction.prototype.activate=function(a){JSG.graph.interaction.CreateItemInteraction._super.activate.call(this,a);a.clearSelection()};
JSG.graph.interaction.CreateItemInteraction.prototype.deactivate=function(a){this._parent=this._fbView=this._bbox=this._graphItem=void 0;JSG.graph.interaction.CreateItemInteraction._super.deactivate.call(this,a)};JSG.graph.interaction.CreateItemInteraction.prototype.onMouseDown=function(a,b){this._parent=this._findParentControllerAt(a.location.copy(),b)};
JSG.graph.interaction.CreateItemInteraction.prototype._setFeedback=function(a,b){void 0==this._fbView&&(this._fbView=this.createFeedback(this._graphItem,b),this.initializeFeedback(this._fbView,b,a),b.addInteractionFeedback(this._fbView),this.lastLocation.setTo(this.getStartLocation()),(this.actionFeedback=this.createActionFeedback())&&b.addInteractionFeedback(this.actionFeedback))};JSG.graph.interaction.CreateItemInteraction.prototype.createActionFeedback=function(a,b){return new JSG.graph.view.SelectionFeedbackView(11)};
JSG.graph.interaction.CreateItemInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback&&this._graphItem){var c=this._graphItem.getBoundingBox();this.actionFeedback._box.setTo(c)}};JSG.graph.interaction.CreateItemInteraction.prototype.createFeedback=function(a,b){var c=b.getControllerFactory().createController(a);c.getViewer=function(){return b};c.refresh();var d=c.getView();c.deactivate();return d};
JSG.graph.interaction.CreateItemInteraction.prototype.initializeFeedback=function(a,b,c){a=this._graphItem.getPin();a.setLocalPoint(0,0);b=this.alignToGrid(this.startLocation,b,c.event.altKey,new JSG.geometry.Point(0,0));a.setPointTo(b)};
JSG.graph.interaction.CreateItemInteraction.prototype.updateFeedback=function(a,b,c){var d=this.alignToGrid(this.startLocation,b,a.event.altKey,new JSG.geometry.Point(0,0)),e=this.alignToGrid(this.lastLocation,b,a.event.altKey,new JSG.geometry.Point(0,0));c=d.x-e.x;d=d.y-e.y;e=e.copy();e.x=Math.min(e.x,e.x+c);e.y=Math.min(e.y,e.y+d);e=this.alignToGrid(e,b,a.event.altKey,e);this._graphItem.setPinPointTo(e);this._graphItem.setSize(Math.abs(c),Math.abs(d))};
JSG.graph.interaction.CreateItemInteraction.prototype.onMouseMove=function(a,b){this._highlightTargetController(a,b);this.setCursor(JSG.ui.Cursor.Style.CROSS);a.isConsumed=!0};JSG.graph.interaction.CreateItemInteraction.prototype._highlightTargetController=function(a,b){b.clearLayer(JSG.graph.view.LayerId.TARGETCONTAINER);var c=this._findParentControllerAt(a.location.copy(),b);void 0!=c&&JSG.graph.interaction.InteractionUtils.highlightTargetController(b,c);a.doRepaint=!0};
JSG.graph.interaction.CreateItemInteraction.prototype._findParentControllerAt=function(a,b){var c=this;return b.getDefaultController()?b.getDefaultController():b.findControllerAt(a,JSG.graph.controller.FindFlags.AREA,function(a){return c._graphItem&&!JSG.graphItemFactory.isValidSubItem(c._graphItem,a.getModel().getType().getValue())?!1:a.getModel().isContainer()&&!(a instanceof JSG.graph.controller.ConnectionController)&&!(a instanceof JSG.graph.controller.PortController)&&!(a instanceof JSG.graph.controller.GraphController)})};
JSG.graph.interaction.CreateItemInteraction.prototype.willFinish=function(a,b){var c=this.getInteractionHandler(),d=this._graphItem.getSize();if(c&&this.hasExtend(b,d)){var d=this._graphItem.copy(),e=b.getRootController(),f=e.getContent().getModel(),f=this._initNewItem(d,f,this._graphItem);c.execute(new JSG.graph.command.AddItemCommand(d,f));this._parent=this._parent?this._parent:e.getContent();this._parent.selectItem(d,!0);void 0!=this._label&&d.addLabel(this._label)}};
JSG.graph.interaction.CreateItemInteraction.prototype.hasExtend=function(a,b){var c=a.getCoordinateSystem().metricToLogXNoZoom(250);return Math.abs(b.getWidth().getValue())>c||Math.abs(b.getHeight().getValue())>c};
JSG.graph.interaction.CreateItemInteraction.prototype._initNewItem=function(a,b,c){var d=c.getAngle().getValue(),e=c.getOrigin(),f=void 0!=this._parent?this._parent.getModel():b;JSG.graph.Utils.traverseItemDown(b,f,function(a){d-=a.getAngle().getValue();a.translateFromParent(e);return!0});a.setAngle(d);this._initPinOf(a);a.setSizeTo(c.getSize());a.setOriginTo(e);return f};
JSG.graph.interaction.CreateItemInteraction.prototype._initPinOf=function(a){a=a.getPin();a.setLocalCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH * 0.5"),new JSG.graph.expr.NumberExpression(0,"HEIGHT * 0.5"));a.evaluate()};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.CreateNodeInteraction=function(a,b){arguments[0]=new JSG.graph.model.Node(a);JSG.graph.interaction.CreateNodeInteraction._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.interaction.CreateNodeInteraction,JSG.graph.interaction.CreateItemInteraction);JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.CreateEdgeInteraction=function(a,b){JSG.graph.interaction.CreateEdgeInteraction._super.constructor.apply(this,arguments);this._targetPortInfo=this._sourcePortInfo=this._portFeedback=void 0};JSG.extend(JSG.graph.interaction.CreateEdgeInteraction,JSG.graph.interaction.CreateItemInteraction);
JSG.graph.interaction.CreateEdgeInteraction.prototype.deactivate=function(a){this._targetPortInfo=this._sourcePortInfo=this._portFeedback=void 0;JSG.graph.interaction.CreateEdgeInteraction._super.deactivate.call(this,a)};JSG.graph.interaction.CreateEdgeInteraction.prototype.updateFeedback=function(a,b,c){a=this._alignedLocation(this.lastLocation,b,a);this._graphItem.setEndPointTo(a);this._graphItem.refresh()};
JSG.graph.interaction.CreateEdgeInteraction.prototype.initializeFeedback=function(a,b,c){this._graphItem.getParent=function(){return b.getGraph()};void 0==this._graphItem.getSourcePort()&&JSG.graph.interaction.CreateEdgeInteraction._super.initializeFeedback.call(this,a,b,c)};JSG.graph.interaction.CreateEdgeInteraction.prototype.createActionFeedback=function(a,b){return new JSG.graph.view.SelectionFeedbackView(12)};
JSG.graph.interaction.CreateEdgeInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback&&this._graphItem){var c=this._graphItem.getBoundingBox();this.actionFeedback._box.setTo(c);c=this.alignToGrid(this.lastLocation,b,a.event.altKey,new JSG.geometry.Point(0,0));this.actionFeedback._point.setTo(c)}};
JSG.graph.interaction.CreateEdgeInteraction.prototype.onMouseDown=function(a,b){JSG.graph.interaction.CreateEdgeInteraction._super.onMouseDown.call(this,a,b);var c=this._alignedLocation(this.startLocation,b,a);JSG.touchDevice&&this.highlightPortsUnderMouse(a,b);this._graphItem.setEndPointTo(c);this._attachSourcePort()};
JSG.graph.interaction.CreateEdgeInteraction.prototype._attachSourcePort=function(){function a(a,b){var c=b.copy();JSG.graph.Utils.traverseItemDown(a.getGraph(),a,function(a){a.translateFromParent(c);return!0});return{getParent:function(){return a},getConnectionPoint:function(a,d){return void 0!=a?c:b}}}if(void 0!==this._portFeedback&&void 0!==this._portFeedback._model.addPortAtLocation){this._sourcePortInfo=this._createPortInfo();var b=this._getPortLocation(this._sourcePortInfo);this._graphItem.getPin().setPointTo(b);
this._graphItem.hasSourceAttached=function(){return!0};var c=a(this._sourcePortInfo.node,b);this._graphItem.getSourcePort=function(){return c}}};JSG.graph.interaction.CreateEdgeInteraction.prototype._getPortLocation=function(a){var b=new JSG.geometry.Point(0,0);b.setTo(a.location);JSG.graph.Utils.translatePointUp(b,a.node,a.node.getGraph());return b};JSG.graph.interaction.CreateEdgeInteraction.prototype._alignedLocation=function(a,b,c){return this.alignToGrid(a,b,c.event.altKey)};
JSG.graph.interaction.CreateEdgeInteraction.prototype.onMouseDrag=function(a,b){this.setPortFeedback(b,a);JSG.graph.interaction.CreateEdgeInteraction._super.onMouseDrag.call(this,a,b)};JSG.graph.interaction.CreateEdgeInteraction.prototype.onMouseMove=function(a,b){this.setPortFeedback(b,a);this.setCursor(JSG.ui.Cursor.Style.CROSS);a.isConsumed=!0};
JSG.graph.interaction.CreateEdgeInteraction.prototype.setPortFeedback=function(a,b){this._portFeedback=void 0;this.highlightPortsUnderMouse(b,a);b.doRepaint=!0};
JSG.graph.interaction.CreateEdgeInteraction.prototype.highlightPortsUnderMouse=function(a,b){b.clearLayer(JSG.graph.view.LayerId.PORTS);var c=JSG.graph.interaction.InteractionUtils.getPortsController(a,b);void 0!=c&&(c=JSG.graph.interaction.InteractionUtils.getPortsFor(c,this,a.event.altKey),b.getLayer(JSG.graph.view.LayerId.PORTS).addAll(c),1===c.length&&(this._portFeedback=c[0]))};
JSG.graph.interaction.CreateEdgeInteraction.prototype.onMouseUp=function(a,b){this._attachTargetPort();this.finishInteraction(a,b)};
JSG.graph.interaction.CreateEdgeInteraction.prototype.willFinish=function(a,b,c){function d(a){return a.getModel()instanceof JSG.graph.model.TextNode&&!a.getParent().isSelected()?!1:a.isSelectable()&&!(a instanceof JSG.graph.controller.GraphController)}function e(a,b){f.executed(a,b)}var f=this;this.hasExtend(100)?(a=this.getInteractionHandler())&&a.execute(this.createCommand(b),e):(c=b.findControllerAt(a.location,JSG.graph.controller.FindFlags.AUTOMATIC,d),a.isPressed(JSG.ui.events.KeyType.CTRL)||
b.clearSelection(),void 0!==c&&b.select(c))};JSG.graph.interaction.CreateEdgeInteraction.prototype.hasExtend=function(a){a=void 0!=a?a:100;return Math.abs(this.currentLocation.x-this.startLocation.x)>a||Math.abs(this.currentLocation.y-this.startLocation.y)>a};
JSG.graph.interaction.CreateEdgeInteraction.prototype.createCommand=function(a){var b=this._graphItem.copy();a=a.getRootController().getContent().getModel();a=this._initNewItem(b,a,this._graphItem);var c=new JSG.graph.command.CompoundCommand;this._sourcePortInfo&&this._sourcePortInfo.isNew&&c.add(new JSG.graph.command.AddPortCommand(this._sourcePortInfo.port,this._sourcePortInfo.location,this._sourcePortInfo.node));this._targetPortInfo&&this._targetPortInfo.isNew&&c.add(new JSG.graph.command.AddPortCommand(this._targetPortInfo.port,
this._targetPortInfo.location,this._targetPortInfo.node));c.add(new JSG.graph.command.AddItemCommand(b,a));this._sourcePortInfo&&this._sourcePortInfo.port&&c.add(new JSG.graph.command.AttachCommand(b,this._sourcePortInfo.port,!0));this._targetPortInfo&&this._targetPortInfo.port&&c.add(new JSG.graph.command.AttachCommand(b,this._targetPortInfo.port,!1));return 1===c.commands.length?c.commands[0]:c};
JSG.graph.interaction.CreateEdgeInteraction.prototype._initNewItem=function(a,b,c){var d=c.getAngle().getValue(),e=c.getOrigin(),f=c.getPoints();c=function(a,c){var d=void 0;if(void 0==c._sourcePortInfo&&void 0==c._targetPortInfo)d=void 0!=c._parent?c._parent.getModel():b;else if(void 0!=c._sourcePortInfo&&void 0==c._targetPortInfo)d=c._sourcePortInfo.node.getParent();else if(void 0==c._sourcePortInfo&&void 0!=c._targetPortInfo)d=void 0!=c._parent?c._parent.getModel():b,d=JSG.graph.Utils.findCommonParent(d,
c._targetPortInfo.node.getParent(),b);else if(void 0!=c._sourcePortInfo&&void 0!=c._targetPortInfo)var d=c._sourcePortInfo.node.getParent(),e=c._targetPortInfo.node.getParent(),d=JSG.graph.Utils.findCommonParent(d,e,b);return void 0!==d?d:b}(a,this);JSG.graph.Utils.traverseItemDown(b,c,function(a){for(var b=0;b<f.length;b++)a.translateFromParent(f[b]);a.translateFromParent(e);d-=a.getAngle().getValue();return!0});a.setAngle(d);a.setOriginTo(e);a.setPoints(f);a.getPin().setLocalCoordinateTo(JSG.graph.Coordinate.fromXY(0,
0));void 0!=this._label&&a.addLabel("Text");return c};
JSG.graph.interaction.CreateEdgeInteraction.prototype._attachTargetPort=function(){function a(a,b){return{getParent:function(){return a},getConnectionPoint:function(c,g){return void 0!=c?a.translateFromParent(b.copy()):b}}}if(void 0!==this._portFeedback&&void 0!==this._portFeedback._model.addPortAtLocation){this._targetPortInfo=this._createPortInfo();var b=this._getPortLocation(this._targetPortInfo);this._graphItem.hasTargetAttached=function(){return!0};var c=a(this._targetPortInfo.node,b);this._graphItem.getTargetPort=
function(){return c}}};JSG.graph.interaction.CreateEdgeInteraction.prototype._createPortInfo=function(){var a={};a.node=this._portFeedback._model;a.port=this._portFeedback._model.getPortAtLocation(this._portFeedback._location);a.location=this._portFeedback._location.copy();a.port||(a.port=new JSG.graph.model.Port,a.isNew=!0);return a};
JSG.graph.interaction.CreateEdgeInteraction.prototype.executed=function(a,b){var c;if(a instanceof JSG.graph.command.CompoundCommand)for(var d=a.commands,e=0;e<d.length;e++){if(d[e]instanceof JSG.graph.command.AbstractItemCommand){var f=d[e].getItem();if(f instanceof JSG.graph.model.LineConnection){c=f;break}}}else c=a.getItem();this._createdItem(c,b)};JSG.graph.interaction.CreateEdgeInteraction.prototype._createdItem=function(a,b){b.getRootController().getContent().selectItem(a,!0)};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.CreateOrthoEdgeInteraction=function(a,b,c){void 0==a&&(a=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape));JSG.graph.interaction.CreateOrthoEdgeInteraction._super.constructor.call(this,a,c);this._ortholine=this._graphItem._shape;this._ortholine._coordinates.removeAll();this._creationmode=void 0;this.useCreationMode(void 0!=b?b:JSG.graph.interaction.CreateOrthoEdgeInteraction.CREATION_MODE.CLICK)};
JSG.extend(JSG.graph.interaction.CreateOrthoEdgeInteraction,JSG.graph.interaction.CreateEdgeInteraction);JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.deactivate=function(a){this._creationmode=this._ortholine=void 0;JSG.graph.interaction.CreateOrthoEdgeInteraction._super.deactivate.call(this,a)};JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.useCreationMode=function(a){this._creationmode=a;this._useDragCreationMode()||this._graphItem.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.MANUAL)};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype._useDragCreationMode=function(){return this._creationmode===JSG.graph.interaction.CreateOrthoEdgeInteraction.CREATION_MODE.DRAG};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.onMouseDown=function(a,b){var c=this._ortholine.getCoordinatesCount()-1;JSG.touchDevice&&this.highlightPortsUnderMouse(a,b);if(0>c)this.initEdge(this._ortholine,b,a);else if(this.hitTargetPort())this.finishInteraction(a,b);else if(this._graphItem.isVisible()){var d=this._alignedLocation(this.currentLocation.copy(),b,a),d=this._graphItem.translateFromParent(d);this._ortholine.setCoordinateAtToPoint(c,d);this._graphItem.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.MANUAL);
this._ortholine.addCoordinate(JSG.graph.Coordinate.fromPoint(d))}else this.finishInteraction(a,b)};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.initEdge=function(a,b,c){a.addCoordinate(JSG.graph.Coordinate.fromXY(0,0));a.addCoordinate(JSG.graph.Coordinate.fromXY(0,0));a.addCoordinate(JSG.graph.Coordinate.fromXY(0,0));this._useDragCreationMode()&&(a.addCoordinate(JSG.graph.Coordinate.fromXY(0,0)),this._graphItem.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.AUTO));void 0==this._parent&&(a=c.location.copy(),this._parent=b.findControllerAt(a,JSG.graph.controller.FindFlags.AUTOMATIC),
this._parent instanceof JSG.graph.controller.ConnectionController||this._parent instanceof JSG.graph.controller.PortController)&&(this._parent=this._parent.getParent());this._setFeedback(c,b);this._attachSourcePort();b=this._useDragCreationMode();this._graphItem.setItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,b)};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.hitTargetPort=function(){if(void 0!=this._portFeedback){if(void 0!=this._graphItem.getSourcePort()){var a=this._portFeedback.getPosition(),b=this._graphItem.getSourcePort().getConnectionPoint();return!a.isEqualTo(b,1)}return!0}return!1};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype._attachSourcePort=function(){JSG.graph.interaction.CreateOrthoEdgeInteraction._super._attachSourcePort.call(this);var a=this._graphItem;if(a.hasSourceAttached()){var b=this._getPortLocation(this._sourcePortInfo),b=this._createCoordinateProxy(a.getStartCoordinate(),a.translateFromParent(b));a.setStartCoordinateTo(b)}};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.onMouseDrag=function(a,b){if(!this._useDragCreationMode()&&3===this._graphItem.getPointsCount()){var c=this._ortholine.getCoordinates(),d=c[0].toPoint();200<c[c.length-1].toPoint().subtract(d).length()&&(this._ortholine.addCoordinate(JSG.graph.Coordinate.fromXY(0,0)),this._creationmode=JSG.graph.interaction.CreateOrthoEdgeInteraction.CREATION_MODE.DRAG,this._graphItem.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.AUTO))}this.setPortFeedback(b,
a);this._updateFeedback(b,a)};JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.onMouseMove=function(a,b){this.setPortFeedback(b,a);this._updateFeedback(b,a);this.setCursor(JSG.ui.Cursor.Style.CROSS);a.isConsumed=!0};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.setPortFeedback=function(a,b){function c(a,b){var c=b._graphItem,e=b._ortholine;c.pointsCount=c.getPointsCount();b._targetPortInfo=b._createPortInfo();c.hasTargetAttached=function(){return!0};var f=b._getPortLocation(b._targetPortInfo),n=d(b._targetPortInfo.node,f);c.getTargetPort=function(){return n};var f=b._createCoordinateProxy(c.getEndCoordinate(),c.translateFromParent(f)),q=e.disableRefresh();c.setEndCoordinateTo(f);e.layoutFrom(n);
!0===q&&e.enableRefresh()}function d(a,b){var c=b.copy();JSG.graph.Utils.traverseItemDown(a.getGraph(),a,function(a){a.translateFromParent(c);return!0});return{getParent:function(){return a},getConnectionPoint:function(a,d){return void 0!=a?c:b}}}function e(a){a._targetPortInfo=void 0;a._graphItem.hasTargetAttached=function(){return!1};a._graphItem.getTargetPort=function(){};a._graphItem.setEndCoordinateTo(f(a._graphItem.getEndCoordinate()));if(0<a._graphItem.pointsCount){var b=a._graphItem.getPointsCount();
a._graphItem.pointsCount!=b&&a._ortholine.removeCoordinatesAt(a._graphItem.pointsCount,b-a._graphItem.pointsCount);a._graphItem.pointsCount=0}}function f(a){return void 0!=a.getCoordinate?a.getCoordinate():a}JSG.graph.interaction.CreateOrthoEdgeInteraction._super.setPortFeedback.call(this,a,b);1<this._graphItem.getPointsCount()&&(this._graphItem.hasTargetAttached()&&e(this),this.hitTargetPort()&&(this._graphItem.hasTargetAttached()||c(this._portFeedback,this)))};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype._createCoordinateProxy=function(a,b){var c=new JSG.graph.CoordinateProxy(a);c.location=b.copy();c.setX=function(a){};c.setY=function(a){};c.evaluate=function(a){};c.copy=function(){var a=new JSG.graph.Coordinate;a.setToPoint(this.toPoint());return a};c.toPoint=function(a){return void 0!=a?a.setTo(this.location):this.location.copy()};return c};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype._updateFeedback=function(a,b){var c=this._ortholine._coordinates,d=this._alignedLocation(this.currentLocation.copy(),a,b),e=c.length-1,d=this._graphItem.translateFromParent(d);if(2===e&&!this._useDragCreationMode()){var f=JSG.ptCache.get(0,0),g=c[0].toPoint();this._graphItem.hasSourceAttached()?this._ortholine.getOrthoDirectionFromPort(this._graphItem.getSourcePort(),0,e,f):this._ortholine.getOrthoDirectionFromLine(g,d.copy(),f);f.setLength(JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT);
f.add(g);c[1].setToPoint(f);JSG.ptCache.release(f)}this._ortholine.setCoordinateAtToPoint(e,d);c=this._useDragCreationMode()||this.hasExtend();this._graphItem.setItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,c);this._graphItem.refresh();this.updateActionFeedback(b,a)};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback&&this._graphItem){var c=this._graphItem.getBoundingBox();this.actionFeedback._box.setTo(c);c=this.alignToGrid(this.lastLocation,b,a.event.altKey,new JSG.geometry.Point(0,0));this.actionFeedback._point.setTo(c)}};JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.onMouseUp=function(a,b){this._useDragCreationMode()&&this.finishInteraction(a,b)};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.onMouseDoubleClick=function(a,b){this.hasExtend(500)?this.finishInteraction(a,b):this.cancelInteraction(a,b)};JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.cancelInteraction=function(a,b){JSG.graph.interaction.CreateOrthoEdgeInteraction._super.cancelInteraction.call(this,a,b);!a.isConsumed&&a instanceof JSG.ui.events.MouseEvent&&this.getInteractionHandler().handleMouseEvent(a)};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.willFinish=function(a,b,c){function d(a){for(var b=a.length-1,c=b,d=new JSG.geometry.Point(0,0),e=new JSG.geometry.Point(0,0);1<b;)if(a[b].toPoint(d),d.subtract(a[b-1].toPoint(e)),200>d.length())a.removeAt(b),b--;else break;return b!==c}function e(a,b){f.executed(a,b)}var f=this;if(c=this.getInteractionHandler()){d(this._ortholine.getCoordinates())&&this._ortholine.refresh();var g=this.createCommand(b);void 0!=g?c.execute(g,e):this.cancelInteraction(a,
b)}};JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype._initNewItem=function(a,b,c){this._graphItem._lineBehavior=a.getLayoutAttributes().getLineBehavior().getValue();a.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.DISABLED);return JSG.graph.interaction.CreateOrthoEdgeInteraction._super._initNewItem.call(this,a,b,c)};
JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype._createdItem=function(a,b){a.getLayoutAttributes().setLineBehavior(this._graphItem._lineBehavior);JSG.graph.interaction.CreateOrthoEdgeInteraction._super._createdItem.call(this,a,b)};JSG.graph.interaction.CreateOrthoEdgeInteraction.prototype.hasExtend=function(a){var b=this._graphItem.getSize();a=void 0!=a?a:500;return Math.abs(b.getWidth().getValue())>a||Math.abs(b.getHeight().getValue())>a};
JSG.graph.interaction.CreateOrthoEdgeInteraction.CREATION_MODE={DRAG:1,CLICK:2};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.CreatePolyLineInteraction=function(a){JSG.graph.interaction.CreatePolyLineInteraction._super.constructor.apply(this,arguments);this._polyline=a;this._polyshape=a._shape;this._isClosed=this._polyline.isClosed();this._polyline.setItemAttribute(JSG.graph.attr.ItemAttributes.CLOSED,!1);this._parent=this._fbView=void 0;this._lastAction=0};
JSG.extend(JSG.graph.interaction.CreatePolyLineInteraction,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.CreatePolyLineInteraction._INIT=0;JSG.graph.interaction.CreatePolyLineInteraction._MOUSE_UP=1;JSG.graph.interaction.CreatePolyLineInteraction._MOUSE_DOWN=2;JSG.graph.interaction.CreatePolyLineInteraction._MOUSE_MOVE=4;JSG.graph.interaction.CreatePolyLineInteraction._MOUSE_DRAG=8;
JSG.graph.interaction.CreatePolyLineInteraction.prototype.deactivate=function(a){this._parent=this._fbView=this._polyline=void 0;JSG.graph.interaction.CreatePolyLineInteraction._super.deactivate.call(this,a)};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.onMouseDown=function(a,b){var c=this._polyshape.getCoordinatesCount()-1,d=new JSG.geometry.Point(0,0);void 0==this._parent&&(b.getDefaultController()?this._parent=b.getDefaultController():this._parent=b.findControllerAt(d.setTo(a.location),JSG.graph.controller.FindFlags.AUTOMATIC));void 0==this._fbView&&(d=b.getControllerFactory().createController(this._polyline),this._polyline.setItemAttribute(JSG.graph.attr.ItemAttributes.CLOSED,!1),this._fbView=
d.getView(),this.lastLocation.setTo(this.getStartLocation()),b.addInteractionFeedback(this._fbView));0>c?(c=new JSG.graph.Coordinate,d=this.alignToGrid(this.currentLocation.copy(),b,a.event.altKey),c.set(d.x,d.y),this._polyshape.addCoordinate(c),this._polyshape.addCoordinate(c.copy())):this._addNewPoint(this._polyshape,a,b);JSG.graph.interaction.CreatePolyLineInteraction._super.onMouseDown.call(this,a,b)};
JSG.graph.interaction.CreatePolyLineInteraction.prototype._addNewPoint=function(a,b,c){var d=a.getCoordinatesCount()-1,e=a.getCoordinateAt(d),d=a.getCoordinateAt(d-1);b=this.alignToGrid(this.currentLocation.copy(),c,b.event.altKey);this._atSameLocation(d.toPoint(),b,400)||(e.set(b.x,b.y),a.addCoordinate(e.copy()))};JSG.graph.interaction.CreatePolyLineInteraction.prototype._atSameLocation=function(a,b,c){a.subtract(b);c=void 0!=c?c:250;return a.length()<c};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.onMouseDrag=function(a,b){this._updateFeedback(a,b);this._lastAction=JSG.graph.interaction.CreatePolyLineInteraction._MOUSE_DRAG};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.onMouseMove=function(a,b){function c(){var c=b.findControllerAt(a.location.copy(),JSG.graph.controller.FindFlags.AREA,function(a){return a.getModel().isContainer()&&!(a instanceof JSG.graph.controller.ConnectionController)&&!(a instanceof JSG.graph.controller.PortController)&&!(a instanceof JSG.graph.controller.GraphController)});void 0!=c&&JSG.graph.interaction.InteractionUtils.highlightTargetController(b,c)}b.clearLayer(JSG.graph.view.LayerId.TARGETCONTAINER);
0===this._polyshape.getCoordinatesCount()&&c();a.doRepaint=!0;a.isConsumed=!0;this.setCursor(JSG.ui.Cursor.Style.CROSS);this._updateFeedback(a,b)};JSG.graph.interaction.CreatePolyLineInteraction.prototype.onMouseExit=function(a,b){JSG.graph.interaction.CreatePolyLineInteraction._super.onMouseExit.call(this,a,b)};JSG.graph.interaction.CreatePolyLineInteraction.prototype.createActionFeedback=function(a,b){return new JSG.graph.view.SelectionFeedbackView(12)};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback&&this._polyline){var c=this.getNewBoundingBox(this._polyline._shape);this.actionFeedback._box.setTo(c);c=this.alignToGrid(this.lastLocation,b,a.event.altKey,new JSG.geometry.Point(0,0));this.actionFeedback._point.setTo(c)}};
JSG.graph.interaction.CreatePolyLineInteraction.prototype._updateFeedback=function(a,b){var c=this._polyshape.getCoordinatesCount()-1,d=this.alignToGrid(this.currentLocation.copy(),b,a.event.altKey),c=this._polyshape.getCoordinateAt(c);void 0!=c&&(this._offset.setTo(d),this.lastLocation.setTo(d),c.set(this._offset.x,this._offset.y));this._polyshape.refresh();this.updateActionFeedback(a,b)};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.onMouseUp=function(a,b){this._lastAction===JSG.graph.interaction.CreatePolyLineInteraction._MOUSE_DRAG&&this._addNewPoint(this._polyshape,a,b);this._lastAction=JSG.graph.interaction.CreatePolyLineInteraction._MOUSE_UP};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.onMouseDoubleClick=function(a,b){var c=this.getInteractionHandler();if(c){for(var d=this._polyshape.getCoordinates(),e=d.length-1,f=e,g=new JSG.geometry.Point(0,0);1<e;)if(d[e].toPoint(g),this._atSameLocation(g,d[e-1].toPoint(),100))d.removeAt(e),e--;else break;e!=f&&this._polyshape.refresh();d=this._polyline.copy();e=b.getRootController();e=this._parent?this._parent.getModel():e.getContent().getModel();this.initNewItem(d,b);c.execute(new JSG.graph.command.AddItemCommand(d,
e));void 0!=this._parent&&this._parent.selectItem(d,!0)}this.didFinish(a,b)};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.initNewItem=function(a,b){var c=0,d=this.getNewBoundingBox(a._shape),e=d.getTopLeft();if(void 0!=this._parent){var f=this._parent.getView(),g=b.rootController.getView();JSG.graph.Utils.traverseDown(g,f,function(a){c-=a.getAngle();a.translateFromParent(e);return!0});a.setAngle(c)}f=d.getSize();this.translate(a._shape,d.getTopLeft(),f);d=a.getPin();d.setLocalCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH * 0.5"),new JSG.graph.expr.NumberExpression(0,
"HEIGHT * 0.5"));d.evaluate();a.setSize(f.x,f.y);a.setOriginTo(e);a.setItemAttribute(JSG.graph.attr.ItemAttributes.CLOSED,this._isClosed)};JSG.graph.interaction.CreatePolyLineInteraction.prototype.getNewBoundingBox=function(a,b){return a.getPointList().getBoundingBox(b)};
JSG.graph.interaction.CreatePolyLineInteraction.prototype.translate=function(a,b,c){var d=new JSG.geometry.Point(0,0);a.getCoordinates().forEach(function(a){a.toPoint(d);d.translate(-b.x,-b.y);a.set(new JSG.graph.expr.NumberExpression(0,"width * "+d.x/c.x),new JSG.graph.expr.NumberExpression(0,"height * "+d.y/c.y))})};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.CreateBezierInteraction=function(a){JSG.graph.interaction.CreateBezierInteraction._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.interaction.CreateBezierInteraction,JSG.graph.interaction.CreatePolyLineInteraction);
JSG.graph.interaction.CreateBezierInteraction.prototype.translate=function(a,b,c){var d=new JSG.geometry.Point(0,0),e=JSG.graph.expr.NumberExpression;a.getCoordinates().forEach(function(a){a.toPoint(d);d.translate(-b.x,-b.y);a.set(new e(d.x,"WIDTH * "+d.x/c.x),new e(d.x,"HEIGHT * "+d.y/c.y))});a.getCpFromPoints().forEach(function(d){d.translate(-b.x,-b.y);d=new JSG.graph.Coordinate(new e(0,"WIDTH * "+d.x/c.x),new e(0,"HEIGHT * "+d.y/c.y));a.getCpFromCoordinates().push(d)});a.getCpToPoints().forEach(function(d){d.translate(-b.x,
-b.y);d=new JSG.graph.Coordinate(new e(0,"WIDTH * "+d.x/c.x),new e(0,"HEIGHT * "+d.y/c.y));a.getCpToCoordinates().push(d)})};
JSG.graph.interaction.CreateBezierInteraction.prototype.getNewBoundingBox=function(a,b){var c=void 0!=b?b:new JSG.geometry.BoundingBox(0,0);a.getBezierPoints(a.getPoints());a.getPointList().getBoundingBox(c);var d=a.getCpFromPointList().getBoundingBox(JSG.boxCache.get()),e=a.getCpToPointList().getBoundingBox(JSG.boxCache.get());c.union(d);c.union(e);JSG.boxCache.release(d,e);return c};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.CreateFriendInteraction=function(a,b){JSG.graph.interaction.CreateFriendInteraction._super.constructor.call(this);this._friends=a;this._friendedges=[];this._friendports=new JSG.commons.Map;this._srcnode=b;this._pinPoints=[];this._isInitialized=!1;this._connection=this._target=this._source=void 0};JSG.extend(JSG.graph.interaction.CreateFriendInteraction,JSG.graph.interaction.CreateItemInteraction);
JSG.graph.interaction.CreateFriendInteraction.prototype.deactivate=function(a){this._pinPoints=this._srcnode=this._connection=this._target=this._source=this._friendports=this._friendedges=this._friends=void 0;JSG.graph.interaction.CreateFriendInteraction._super.deactivate.call(this,a)};
JSG.graph.interaction.CreateFriendInteraction.prototype.onMouseDown=function(a,b){var c=this._friends[0];this._snapRect=void 0;this._source=this._createPortInfo(this._srcnode);this._target=this._createPortInfo(c,c.getWidth().getValue()/2,c.getHeight().getValue()/2)};
JSG.graph.interaction.CreateFriendInteraction.prototype._createPortInfo=function(a,b,c){var d=new JSG.geometry.Point(0,0);void 0!=b&&void 0!=c?d.set(b,c):(b=a.getBoundingBox(),d.set(b.getWidth()/2,b.getHeight()/2));b={};b.node=a;b.port=a.getPortAtLocation(d);b.location=d;b.port||(b.port=new JSG.graph.model.Port,b.isNew=!0);return b};
JSG.graph.interaction.CreateFriendInteraction.prototype._setFeedback=function(a,b){function c(c,d){function g(a,b){for(var c=0;c<b.length;c++)a.put(b[c].getId(),b[c])}for(var l=c[0].getPinPoint(),h=new JSG.geometry.Point(0,0),m=new JSG.geometry.Point(0,0),k=d.alignToGrid(d.startLocation,b,a.event.altKey,new JSG.geometry.Point(0,0)),n=0;n<c.length;n++){m=c[n].getPinPoint(m);h.set(m.x-(l.x-k.x),m.y-(l.y-k.y));c[n].setPinPointTo(h);d._pinPoints.push(h.copy());var q=d.createFeedback(c[n],b);b.addInteractionFeedback(q);
c[n]instanceof JSG.graph.model.Edge?d._friendedges.push(c[n]):g(d._friendports,c[n].getPorts())}(function(){var a,b=new JSG.geometry.Point(0,0);new JSG.geometry.Point(0,0);for(var c=0;c<d._friendedges.length;c++)b=d._friendedges[c].getPinPoint(b),a=d._friendports.get(d._friendedges[c].sourcePortId),void 0!=a&&d._friendedges[c].setSourcePort(a),a=d._friendports.get(d._friendedges[c].targetPortId),void 0!=a&&d._friendedges[c].setTargetPort(a)})()}if(!this._friends.isEmpty()&&!this._isInitialized){this._isInitialized=
!0;if(void 0==this._connection){this._connection=this.createConnection();var d=this.createConnectionFeedback(a,b);b.addInteractionFeedback(d)}c(this._friends,this)}this.lastLocation.setTo(this.getStartLocation())};
JSG.graph.interaction.CreateFriendInteraction.prototype.createConnection=function(){var a=JSG.graphItemFactory.createItemFromString(JSG.defaultEdgeType),b=this._source.location.copy();JSG.graph.Utils.translatePointUp(b,this._source.node,this._source.node.getGraph());a.setPinPointTo(b);var c=this.createPortDummy(this._source);a.hasSourceAttached=function(){return!0};a.getSourcePort=function(){return c};var d=this.createPortDummy(this._target);a.hasTargetAttached=function(){return!0};a.getTargetPort=
function(){return d};return a};JSG.graph.interaction.CreateFriendInteraction.prototype.createPortDummy=function(a){var b=a.node,c=JSG.graph.Utils.translatePointUp(a.location.copy(),b,b.getGraph());return{getParent:function(){return b},getConnectionPoint:function(a,e){return void 0!=a?b.translateFromParent(c.copy()):c}}};JSG.graph.interaction.CreateFriendInteraction.prototype.createConnectionFeedback=function(a,b){return this.createFeedback(this._connection,b)};
JSG.graph.interaction.CreateFriendInteraction.prototype.getSnapRect=function(a,b){for(var c=b||new JSG.geometry.Rectangle(0,0,0,0),d=this._friends[0].getBoundingBox(new JSG.geometry.BoundingBox(0,0)),e=JSG.boxCache.get(),f=1;f<this._friends.length;f++)d.union(this._friends[f].getBoundingBox(e));JSG.boxCache.release(e);d.getBoundingRectangle(c);return c};
JSG.graph.interaction.CreateFriendInteraction.prototype.updateFeedback=function(a,b,c){void 0==this._snapRect&&(this._snapRect=this.getSnapRect(b));b.clearLayer(JSG.graph.view.LayerId.SNAPLINES);this._horizontalSnapController=this._verticalSnapController=void 0;if(b.getGraphSettings().getSnapToShapes()&&!this._friends.isEmpty()&&!a.event.altKey){c=JSG.rectCache.get().setTo(this._snapRect);var d=this.currentLocation.copy();d.subtract(this.startLocation);c.translate(d.x,d.y);JSG.graph.interaction.InteractionUtils.highlightSnapItemofController(this,
c,a.event.altKey);JSG.rectCache.release(c)}a=this.getSnapAndGridOffset(b,a,this._snapRect);for(b=0;b<this._friends.length;b++)c=this._pinPoints[b].copy(),c.translate(a.x,a.y),this._friends[b].setPinPointTo(c);void 0!=this._connection&&(a=this._friends[0].getBoundingBox(JSG.boxCache.get()),b=a.getBoundingRectangle(JSG.rectCache.get()),c=b.getCenter(JSG.ptCache.get()),this._connection.translateFromParent(c),this._connection.getEndCoordinate().set(c.x,c.y),this._connection.refresh(),JSG.ptCache.release(c),
JSG.boxCache.release(a),JSG.rectCache.release(b))};JSG.graph.interaction.CreateFriendInteraction.prototype.onMouseMove=function(a,b){};JSG.graph.interaction.CreateFriendInteraction.prototype.onMouseDrag=function(a,b){this._highlightTargetController(a,b);JSG.graph.interaction.CreateFriendInteraction._super.onMouseDrag.call(this,a,b)};JSG.graph.interaction.CreateFriendInteraction.prototype.onMouseUp=function(a,b){this.finishInteraction(a,b)};
JSG.graph.interaction.CreateFriendInteraction.prototype._findParentControllerAt=function(a,b){var c=this;return b.findControllerAt(a,JSG.graph.controller.FindFlags.AREA,function(a){return c._friends[0]&&!JSG.graphItemFactory.isValidSubItem(c._friends[0],a.getModel().getType().getValue())?!1:a.getModel().isContainer()&&!(a instanceof JSG.graph.controller.ConnectionController)&&!(a instanceof JSG.graph.controller.PortController)&&!(a instanceof JSG.graph.controller.GraphController)})};
JSG.graph.interaction.CreateFriendInteraction.prototype.willFinish=function(a,b,c){function d(a,b,c){var d=e.get(a.getParent().getId());a=a.getParent().getPorts().indexOf(a);c.call(b,d.getPortAt(a))}c=this.getInteractionHandler();if(void 0!=c&&void 0!=this._connection){this._parent=this._findParentControllerAt(a.location.copy(),b);var e=new JSG.commons.Map;b=b.getRootController().getContent().getModel();a=new JSG.graph.command.CompoundCommand;for(var f=0;f<this._friends.length;f++){var g=this._friends[f].copy(),
l=this._initNewItem(g,b,this._friends[f]);a.add(new JSG.graph.command.AddItemCommand(g,l));e.put(this._friends[f].getId(),g)}for(f=0;f<this._friendedges.length;f++)g=e.get(this._friendedges[f].getId()),l=this._friendports.get(this._friendedges[f].sourcePortId),void 0!=l&&d(l,g,g.setSourcePort),l=this._friendports.get(this._friendedges[f].targetPortId),void 0!=l&&d(l,g,g.setTargetPort);this._addPortCommands(a,e.get(this._target.node.getId()));b=this._addConnectionCommand(a,b);this._addAttachCommands(a,
b);c.execute(a,this.executed)}};JSG.graph.interaction.CreateFriendInteraction.prototype._initPinOf=function(a){a instanceof JSG.graph.model.Edge||JSG.graph.interaction.CreateFriendInteraction._super._initPinOf.call(this,a)};JSG.graph.interaction.CreateFriendInteraction.prototype._addPortCommands=function(a,b){var c=this._source,d=this._target;c&&c.isNew&&a.add(new JSG.graph.command.AddPortCommand(c.port,c.location,c.node));d&&d.isNew&&a.add(new JSG.graph.command.AddPortCommand(d.port,d.location,b))};
JSG.graph.interaction.CreateFriendInteraction.prototype._addConnectionCommand=function(a,b){var c=this._connection.copy(),d=this._initNewFriendConnection(c,b,this._connection);a.add(new JSG.graph.command.AddItemCommand(c,d));return c};
JSG.graph.interaction.CreateFriendInteraction.prototype._initNewFriendConnection=function(a,b,c){a=JSG.graph.interaction.CreateFriendInteraction._super._initNewItem.call(this,a,b,c);c=c.getSourcePort().getParent();c=c!=a?JSG.graph.Utils.findCommonParent(c,a,a.getGraph()):a;return void 0!=c?c:b};
JSG.graph.interaction.CreateFriendInteraction.prototype._addAttachCommands=function(a,b){var c=this._source,d=this._target;c&&c.port&&a.add(new JSG.graph.command.AttachCommand(b,c.port,!0));d&&d.port&&a.add(new JSG.graph.command.AttachCommand(b,d.port,!1))};
JSG.graph.interaction.CreateFriendInteraction.prototype.executed=function(a,b){function c(a){if(a instanceof JSG.graph.command.AddItemCommand&&a._graphItem instanceof JSG.graph.model.Node)a=b.findControllerForItem(a._graphItem),void 0!=a&&d.push(a);else if(void 0!=a.commands){a=a.commands;for(var e=0;e<a.length;e++)c(a[e],d)}}var d=[];c(a);if(!d.isEmpty()){var e=b.getSelectionProvider();e.clearSelection();e.selectAll(d)}};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.EditShapeInteraction=function(){JSG.graph.interaction.EditShapeInteraction._super.constructor.apply(this,arguments);this._selection=this._editview=this._marker=this._item=this._view=void 0;this._shapeListener=this.createShapeListener()};JSG.extend(JSG.graph.interaction.EditShapeInteraction,JSG.graph.interaction.Interaction);
JSG.graph.interaction.EditShapeInteraction.prototype.activate=function(a){var b=a.getSelectionProvider();this._selection=b.hasSingleSelection()?b.getFirstSelection():void 0;void 0!=this._selection?(this._view=this._selection.getView(),this._graphView=a.getGraphView(),this._item=this._view._item,this._item.addEventListener(JSG.graph.model.events.Event.SHAPE,this._shapeListener),this._editview=this.createEditShapeView(a.getCoordinateSystem()),this.initEditView(this._editview),a.clearSelection(),a.setOverlayView(this._editview),
this.getInteractionHandler().repaint()):this.didFinish(void 0,a)};JSG.graph.interaction.EditShapeInteraction.prototype.createShapeListener=function(){return new JSG.graph.interaction.EditShapeInteraction.ShapeListener(this)};JSG.graph.interaction.EditShapeInteraction.prototype.createEditShapeView=function(a){return new JSG.graph.view.EditShapeView(a)};JSG.graph.interaction.EditShapeInteraction.prototype.initEditView=function(a){a.setIsClosed(this._item.isClosed());this.setPointList(this._item._shape.getPointList())};
JSG.graph.interaction.EditShapeInteraction.prototype.deactivate=function(a){a.removeOverlayView();this._item&&(this._item.removeEventListener(JSG.graph.model.events.Event.SHAPE,this._shapeListener),this._item=void 0);this._selection=this._editview=this._marker=this._view=void 0;JSG.graph.interaction.EditShapeInteraction._super.deactivate.call(this,a)};
JSG.graph.interaction.EditShapeInteraction.prototype.createActionFeedback=function(a,b){var c=new JSG.graph.view.PositionFeedbackView,d=a.location.copy();b.translateFromParent(d);c.setPosition(d);return c};JSG.graph.interaction.EditShapeInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback){var c=a.location.copy();b.translateFromParent(c);this.actionFeedback.setPosition(c)}};
JSG.graph.interaction.EditShapeInteraction.prototype.setPointList=function(a){if(a&&!a.isEmpty()){var b=this._item.getOrigin(),c=this.translateOriginAndAngle(b,this._item.getAngle().getValue());this._editview.setPointList(a,b,c)}};JSG.graph.interaction.EditShapeInteraction.prototype.translateOriginAndAngle=function(a,b){var c=this._graphView,d=this._view.getParent();JSG.graph.Utils.traverseUp(d,c,function(c){c.translateToParent(a);b+=c.getAngle();return!0});return b};
JSG.graph.interaction.EditShapeInteraction.prototype.getMarkerAt=function(a){if(void 0!=this._editview)return this._editview.translatePoint(a),this._editview.getMarkerAt(a)};JSG.graph.interaction.EditShapeInteraction.prototype.onKeyDown=function(a,b){if(a.event.ctrlKey)switch(a.event.keyCode){case 90:this.getInteractionHandler().undo();break;case 89:this.getInteractionHandler().redo()}};
JSG.graph.interaction.EditShapeInteraction.prototype.onMouseDown=function(a,b){this.setCurrentMarker(a,b);this._marker?this.actionFeedback||(this.actionFeedback=this.createActionFeedback(a,b),this.updateActionFeedback(a,b),b.addInteractionFeedback(this.actionFeedback)):this.didFinish(a,b)};JSG.graph.interaction.EditShapeInteraction.prototype.onMouseMove=function(a,b){this.setCurrentMarker(a,b)};
JSG.graph.interaction.EditShapeInteraction.prototype.setCurrentMarker=function(a,b){var c=new JSG.geometry.Point(0,0);c.setTo(a.location);b.translateFromParent(c);(this._marker=this.getMarkerAt(c))?(c=-1==this._marker.index?JSG.ui.Cursor.Style.CROSS:JSG.ui.Cursor.Style.MOVE,this.getInteractionHandler().setCursor(c)):this.getInteractionHandler().setCursor(JSG.ui.Cursor.Style.AUTO)};
JSG.graph.interaction.EditShapeInteraction.prototype.onMouseDrag=function(a,b){if(this._marker){-1==this._marker.index&&(this._marker=this._editview.insertMarker(this._marker));var c=new JSG.geometry.Point(0,0);c.setTo(this.currentLocation);this._editview.translatePoint(c);c.x-=this._editview._markersize/2;c.y-=this._editview._markersize/2;this._marker.setLocationTo(c);this.updateActionFeedback(a,b)}};JSG.graph.interaction.EditShapeInteraction.prototype.onMouseUp=function(a,b){this._marker&&this._performChange()};
JSG.graph.interaction.EditShapeInteraction.prototype.deleteMarker=function(a){return a&&2<this._editview.getMarkerCount()?(this._editview.deleteMarker(a),this._performChange(),!0):!1};JSG.graph.interaction.EditShapeInteraction.prototype.close=function(a){this.getInteractionHandler()&&this._editview.setIsClosed(a)};
JSG.graph.interaction.EditShapeInteraction.prototype._performChange=function(){var a=this.getInteractionHandler();if(a){var b=this._createCustomCompoundCommand(),c=this._item._shape.getType(),c=this._createSwitchShapeCommandIfNecessary(this._item,c);void 0!=c&&b.add(c);b.add(this._createEditShapeCommand(this._item,this._editview.getMarkerPoints()));a.execute(b);this.actionFeedback=void 0}};
JSG.graph.interaction.EditShapeInteraction.prototype._createCustomCompoundCommand=function(){var a=new JSG.graph.command.CompoundCommand;a.restoreStateAfterUndo=function(b){if(void 0!=b.getGraphicSystem){var c=b.getGraphicSystem().interactionHandler;c&&a._interaction!=c.getActiveInteraction()&&Object.getPrototypeOf(a).restoreStateAfterUndo.call(a,b)}};a.restoreStateAfterRedo=function(b){if(void 0!=b.getGraphicSystem){var c=b.getGraphicSystem().interactionHandler;c&&a._interaction!=c.getActiveInteraction()&&
Object.getPrototypeOf(a).restoreStateAfterRedo.call(a,b)}};return a};
JSG.graph.interaction.EditShapeInteraction.prototype._createSwitchShapeCommandIfNecessary=function(a,b){if(JSG.graph.model.shapes.RectangleShape.TYPE===b){var c=new JSG.graph.model.shapes.PolygonShape(!0);c.setCoordinates(a._shape.getCoordinates());return new JSG.graph.command.SetShapeCommand(a,c)}if(JSG.graph.model.shapes.EllipseShape.TYPE===b)return c=new JSG.graph.model.shapes.BezierShape(!0),c.setCoordinates(a._shape.getCoordinates()),new JSG.graph.command.SetShapeCommand(a,c)};
JSG.graph.interaction.EditShapeInteraction.prototype._createEditShapeCommand=function(a,b){return new JSG.graph.command.SetShapePointsCommand(this._item,b)};JSG.graph.interaction.EditShapeInteraction.prototype.cancelInteraction=function(a,b){void 0!=a&&(a.doRepaint=!0);this.setCursor(JSG.ui.Cursor.Style.AUTO);JSG.graph.interaction.EditShapeInteraction._super.cancelInteraction.call(this,a,b)};
JSG.graph.interaction.EditShapeInteraction.prototype.didFinish=function(a,b){var c=this._selection;JSG.graph.interaction.EditShapeInteraction._super.didFinish.call(this,a,b);!a.isConsumed&&a instanceof JSG.ui.events.MouseEvent?this.getInteractionHandler().handleMouseEvent(a):void 0!=c&&b.select(c)};JSG.graph.interaction.EditShapeInteraction.ShapeListener=function(a){this._editor=a};JSG.graph.interaction.EditShapeInteraction.ShapeListener.prototype.handlePreEvent=function(a){};
JSG.graph.interaction.EditShapeInteraction.ShapeListener.prototype.handlePostEvent=function(a){this._editor.setPointList(this._editor._item._shape.getPointList())};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.EditLineShapeInteraction=function(){JSG.graph.interaction.EditLineShapeInteraction._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.EditLineShapeInteraction,JSG.graph.interaction.EditShapeInteraction);
JSG.graph.interaction.EditLineShapeInteraction.prototype.createEditShapeView=function(a){return new JSG.graph.view.EditLineShapeView(a)};JSG.graph.interaction.EditLineShapeInteraction.prototype._createSwitchShapeCommandIfNecessary=function(a,b){if(JSG.graph.model.shapes.OrthoLineShape.TYPE===b){var c=new JSG.graph.model.shapes.LineShape;c.setCoordinates(a._shape.getCoordinates());return new JSG.graph.command.SetShapeCommand(a,c)}};
JSG.graph.interaction.EditLineShapeInteraction.prototype._createEditShapeCommand=function(a,b){var c=this._graphView,d=this._view.getParent();b=this._editview.getMarkerPoints(!0);b.forEach(function(a){JSG.graph.Utils.traverseDown(c,d,function(b){b.translateFromParent(a);return!0})});return new JSG.graph.command.SetLineShapePointsCommand(this._item,b)};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.EditBezierShapeInteraction=function(){JSG.graph.interaction.EditBezierShapeInteraction._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.EditBezierShapeInteraction,JSG.graph.interaction.EditShapeInteraction);JSG.graph.interaction.EditBezierShapeInteraction.prototype.createShapeListener=function(){return new JSG.graph.interaction.EditBezierShapeInteraction.ShapeListener(this)};
JSG.graph.interaction.EditBezierShapeInteraction.prototype.createEditShapeView=function(a){return new JSG.graph.view.EditBezierShapeView(a)};JSG.graph.interaction.EditBezierShapeInteraction.prototype.initEditView=function(a){JSG.graph.interaction.EditBezierShapeInteraction._super.initEditView.call(this,a);this.setCpFromPointList(this._item._shape.getCpFromPointList());this.setCpToPointList(this._item._shape.getCpToPointList())};
JSG.graph.interaction.EditBezierShapeInteraction.prototype.setCpToPointList=function(a){if(a&&!a.isEmpty()){var b=this._item.getOrigin(),c=this.translateOriginAndAngle(b,this._item.getAngle().getValue());this._editview.setCpToPointList(a,b,c)}};JSG.graph.interaction.EditBezierShapeInteraction.prototype.setCpFromPointList=function(a){if(a&&!a.isEmpty()){var b=this._item.getOrigin(),c=this.translateOriginAndAngle(b,this._item.getAngle().getValue());this._editview.setCpFromPointList(a,b,c)}};
JSG.graph.interaction.EditBezierShapeInteraction.prototype.getCpFromMarkerAt=function(a){if(void 0!=this._editview)return this._editview.translatePoint(a),this._editview.getCpFromMarkerAt(a)};JSG.graph.interaction.EditBezierShapeInteraction.prototype.getCpToMarkerAt=function(a){if(void 0!=this._editview)return this._editview.translatePoint(a),this._editview.getCpToMarkerAt(a)};
JSG.graph.interaction.EditBezierShapeInteraction.prototype.onMouseDown=function(a,b){this.setCurrentMarker(a,b);this._marker||this._cpFromMarker||this._cpToMarker?this.actionFeedback||(this.actionFeedback=this.createActionFeedback(a,b),this.updateActionFeedback(a,b),b.addInteractionFeedback(this.actionFeedback)):this.didFinish(a,b)};
JSG.graph.interaction.EditBezierShapeInteraction.prototype.setCurrentMarker=function(a,b){var c=JSG.ui.Cursor.Style.AUTO,d=new JSG.geometry.Point(0,0),e=new JSG.geometry.Point(0,0);d.setTo(a.location);b.translateFromParent(d);this._cpToMarker=this._cpFromMarker=this._marker=void 0;(this._cpFromMarker=this.getCpFromMarkerAt(e.setTo(d)))?c=JSG.ui.Cursor.Style.MOVE:(this._cpToMarker=this.getCpToMarkerAt(e.setTo(d)))?c=JSG.ui.Cursor.Style.MOVE:(this._marker=this.getMarkerAt(e.setTo(d)))&&(c=-1==this._marker.index?
JSG.ui.Cursor.Style.CROSS:JSG.ui.Cursor.Style.MOVE);this.getInteractionHandler().setCursor(c)};
JSG.graph.interaction.EditBezierShapeInteraction.prototype.onMouseDrag=function(a,b){var c=new JSG.geometry.Point(0,0);c.setTo(this.currentLocation);this._editview.translatePoint(c);if(this._cpFromMarker)this._cpFromMarker.setLocationTo(c);else if(this._cpToMarker)this._cpToMarker.setLocationTo(c);else if(this._marker){var d=!1;-1==this._marker.index&&(this._marker=this._editview.insertMarker(this._marker),this._marker.isTemporary=!1,d=!0);var e=this._marker.center.copy();this._marker.setLocationTo(c);
var f=this._marker.center.copy();f.subtract(e);var g=this._editview.getMarkerIndexOf(this._marker),e=this._editview.getCpToMarker(g),l=this._editview.getCpFromMarker(g);d?(f=this._editview.getMarker(g-1),d=g==this._editview.getMarkerCount()-1?this._editview.getMarker(0):this._editview.getMarker(g+1),f=f.getLocation(new JSG.geometry.Point(0,0)),d=d.getLocation(new JSG.geometry.Point(0,0)),xDiff=0.2*(d.x-f.x),yDiff=0.2*(d.y-f.y),l.setLocation(c.x-xDiff,c.y-yDiff),e.setLocation(c.x+xDiff,c.y+yDiff)):
(c=e.getLocation(new JSG.geometry.Point(0,0)),c.add(f),e.setLocationTo(c),c=l.getLocation(c),c.add(f),l.setLocationTo(c))}this.updateActionFeedback(a,b)};JSG.graph.interaction.EditBezierShapeInteraction.prototype.onMouseUp=function(a,b){(this._marker||this._cpFromMarker||this._cpToMarker)&&this._performChange()};
JSG.graph.interaction.EditBezierShapeInteraction.prototype.deleteMarker=function(a){if(a&&2<this._editview.getMarkerCount()){var b=this._editview.getMarkerIndexOf(a),c=this._editview.getCpToMarker(b),b=this._editview.getCpFromMarker(b);this._editview.deleteMarker(a);this._editview.deleteCpFromMarker(b);this._editview.deleteCpToMarker(c);this._performChange();return!0}return!1};
JSG.graph.interaction.EditBezierShapeInteraction.prototype._performChange=function(){function a(a,b){if(JSG.graph.model.shapes.RectangleShape.TYPE===b){var d=new JSG.graph.model.shapes.PolygonShape;d.setCoordinates(a._shape.getCoordinates());c.add(new JSG.graph.command.SetShapeCommand(a,d))}else JSG.graph.model.shapes.EllipseShape.TYPE===b&&(d=new JSG.graph.model.shapes.BezierShape,d.setCoordinates(a._shape.getCoordinates()),d.setCpFromCoordinates(a._shape.getCpFromCoordinates()),d.setCpToCoordinates(a._shape.getCpToCoordinates()),
c.add(new JSG.graph.command.SetShapeCommand(a,d)))}var b=this.getInteractionHandler();if(b){var c=this._createCustomCompoundCommand(),d=this._item._shape.getType();a(this._item,d);if(d==JSG.graph.model.shapes.LineShape.TYPE){var e=this._graphView,f=this._view.getParent(),d=this._editview.getMarkerPoints(!0);d.forEach(function(a){JSG.graph.Utils.traverseDown(e,f,function(b){b.translateFromParent(a);return!0})});c.add(new JSG.graph.command.SetLineShapePointsCommand(this._item,d))}else c.add(new JSG.graph.command.SetBezierShapePointsCommand(this._item,
this._editview.getMarkerPoints(!1),this._editview.getCpFromMarkerPoints(!1),this._editview.getCpToMarkerPoints(!1)));b.execute(c);this.actionFeedback=void 0}};JSG.graph.interaction.EditBezierShapeInteraction.ShapeListener=function(a){this._editor=a};JSG.graph.interaction.EditBezierShapeInteraction.ShapeListener.prototype.handlePreEvent=function(a){};
JSG.graph.interaction.EditBezierShapeInteraction.ShapeListener.prototype.handlePostEvent=function(a){var b=this._editor._item._shape;switch(a.detailId){case JSG.graph.model.events.ShapeEvent.COORDS_SET_CPFROM:this._editor.setCpFromPointList(b.getCpFromPointList());break;case JSG.graph.model.events.ShapeEvent.COORDS_SET_CPTO:this._editor.setCpToPointList(b.getCpToPointList());break;default:this._editor.setPointList(b.getPointList())}};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.MarqueeInteraction=function(){JSG.graph.interaction.MarqueeInteraction._super.constructor.apply(this,arguments);this._feedbackRect=void 0};JSG.extend(JSG.graph.interaction.MarqueeInteraction,JSG.graph.interaction.Interaction);JSG.graph.interaction.MarqueeInteraction.prototype.deactivate=function(a){a.removeInteractionFeedback(this._feedbackRect);this._feedbackRect=void 0;JSG.graph.interaction.MarqueeInteraction._super.deactivate.call(this,a)};
JSG.graph.interaction.MarqueeInteraction.prototype.onMouseDrag=function(a,b){var c=new JSG.geometry.Point(0,0);c.setTo(a.location);b.translateFromParent(c);this._getFeedbackRect(b).setBounds(Math.min(this.startLocation.x,c.x),Math.min(this.startLocation.y,c.y),Math.abs(c.x-this.startLocation.x),Math.abs(c.y-this.startLocation.y))};
JSG.graph.interaction.MarqueeInteraction.prototype._getFeedbackRect=function(a){void 0==this._feedbackRect&&(a.clearInteractionFeedback(),this._feedbackRect=new JSG.graph.view.MarqueeFeedbackView,a.addInteractionFeedback(this._feedbackRect));return this._feedbackRect};JSG.graph.interaction.MarqueeInteraction.prototype.willFinish=function(a,b,c){this._feedbackRect&&this._doSelect(b)};
JSG.graph.interaction.MarqueeInteraction.prototype._doSelect=function(a){var b=[],c=JSG.ptCache.get(),d=JSG.boxCache.get(),e=this._feedbackRect.getBounds(JSG.rectCache.get()),f=a.getRootController().getContent(),g=a.getGraphView(),l=g.getItem();f.traverse(function(a){var m=a.getModel(),k=m.getItemAttribute(JSG.graph.attr.ItemAttributes.ITEMPART).getValue();if(a===f)return!0;var n;if(n=!k)if(n=a instanceof JSG.graph.controller.ConnectionController)if(n=m.isSelectable()){n=m.getTranslatedShapePoints(l);
for(var q=!n.isEmpty(),p=0;p<n.length&&q;p++)q=e.containsPoint(n[p]);n=q}if(n)return b.push(a),!1;n=a.getView();n.getOrigin(c);n=n.getTranslatedBoundingBox(g,d);return k||m instanceof JSG.graph.model.TextNode||!m.isSelectable()||!e.containsBoundingBox(n)?!(a instanceof JSG.graph.controller.ContainerNodeController):(b.push(a),!1)});a.setSelection(b);JSG.ptCache.release(c);JSG.boxCache.release(d);JSG.rectCache.release(e)};
JSG.graph.interaction.MarqueeInteraction.prototype.onMouseExit=function(a,b){this.cancelInteraction(a,b)};JSG.graph.interaction.MarqueeInteraction.prototype.cancelInteraction=function(a,b){void 0!=a&&(a.doRepaint=!0);this.setCursor(JSG.ui.Cursor.Style.AUTO);JSG.graph.interaction.MarqueeInteraction._super.cancelInteraction.call(this,a,b)};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.MoveInteraction=function(){JSG.graph.interaction.MoveInteraction._super.constructor.apply(this,arguments);this._failed=!1;this._keyOffset};JSG.extend(JSG.graph.interaction.MoveInteraction,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.MoveInteraction.MOVE_THRESHOLD=100;
JSG.graph.interaction.MoveInteraction.prototype.deactivate=function(a){this._keyOffset=void 0;a.getSelectionView().setVisible(!0);this._notifyDelegate("deactivate",a);JSG.graph.interaction.MoveInteraction._super.deactivate.call(this,a)};JSG.graph.interaction.MoveInteraction.prototype._createSelectionFeedback=function(a,b){if(this._isMoveable(a,b)){var c=a.createFeedback();c&&!c.isMoveable()&&c.setMoveable(JSG.graph.attr.consts.Direction.BOTH);return c}};
JSG.graph.interaction.MoveInteraction.prototype._createAndAddSelectionFeedback=function(a,b){JSG.graph.interaction.MoveInteraction._super._createAndAddSelectionFeedback.call(this,a,b);for(var c=0;c<this.feedback.length;c++){var d=this.feedback[c].getFeedbackItem();d.getShape().getType()===JSG.graph.model.shapes.OrthoLineShape.TYPE&&d.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.DISABLED)}};
JSG.graph.interaction.MoveInteraction.prototype.onKeyDown=function(a,b){if(!this._keyOffset)switch(a.event.keyCode){case 37:case 38:case 39:case 40:b.getSelectionView().setVisible(!1),this._failed=!1,this._setFeedback(a,b),this._keyOffset=new JSG.geometry.Point(0,0),a.doRepaint=!0}if(this._keyOffset){switch(a.event.keyCode){case 37:this._keyOffset.x-=a.event.shiftKey?1E3:a.event.ctrlKey?a.cs.deviceToLogX(1):b.getGraphSettings().getSnapStep();break;case 38:this._keyOffset.y-=a.event.shiftKey?1E3:a.event.ctrlKey?
a.cs.deviceToLogX(1):b.getGraphSettings().getSnapStep();break;case 39:this._keyOffset.x+=a.event.shiftKey?1E3:a.event.ctrlKey?a.cs.deviceToLogX(1):b.getGraphSettings().getSnapStep();break;case 40:this._keyOffset.y+=a.event.shiftKey?1E3:a.event.ctrlKey?a.cs.deviceToLogX(1):b.getGraphSettings().getSnapStep()}this._updateFeedback(a,b,this._keyOffset);this.updateSubFeedbacks(a,b,this._subfeedbacks.elements());a.doRepaint=!0}JSG.graph.interaction.MoveInteraction._super.onKeyDown.call(this,a,b)};
JSG.graph.interaction.MoveInteraction.prototype.onKeyUp=function(a,b){switch(a.event.keyCode){case 37:case 38:case 39:case 40:this._keyOffset&&(this._offset.setTo(this._keyOffset),this.finishInteraction(a,b),a.doRepaint=!0)}a.isPressed(JSG.ui.events.KeyType.ESC)&&this.cancelInteraction(a,b)};JSG.graph.interaction.MoveInteraction.prototype.onMouseDown=function(a,b){this._failed=!1;JSG.graph.interaction.MoveInteraction._super.onMouseDown.call(this,a,b)};
JSG.graph.interaction.MoveInteraction.prototype.createActionFeedback=function(a,b){var c=new JSG.graph.view.SelectionFeedbackView(10),d=b.getSelectionView();d.refresh();c.setBoundingBox(d.getBoundingBox());d.setVisible(!1);return c};JSG.graph.interaction.MoveInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback&&this.feedback.length){var c=b.getSelectionView().getBoundingBox(),d=this.getSnapRect(b),d=this.getSnapAndGridOffset(b,a,d);c.translateTo(d);this.actionFeedback.setBoundingBox(c)}};
JSG.graph.interaction.MoveInteraction.prototype.updateFeedback=function(a,b,c){c=this.getSnapRect(b);c=this.getSnapAndGridOffset(b,a,c);this._updateFeedback(a,b,c)};
JSG.graph.interaction.MoveInteraction.prototype._updateFeedback=function(a,b,c){function d(a,b){var c=a.getFeedbackItem();if(c.hasSourceAttached()){var d=c.getSourcePort().getParent();e(d,b)||a.detachFromSource()}c.hasTargetAttached()&&(c=c.getTargetPort().getParent(),e(c,b)||a.detachFromTarget())}function e(a,b){if(void 0!=a)for(var c=void 0!=a.getOriginal?a.getOriginal().getId():a.getId(),d=0;d<b.length;d++)if(b[d].getOriginalItem().getId()===c)return!0;return!1}for(var f=new JSG.geometry.Point(0,
0),g=0,l=this.feedback.length;g<l;g++){var h=this.feedback[g],m=h.isMoveable(),k=h.getOriginalItem().getTranslatedPoint(h.getOriginalItem().getOrigin(),b.getGraph()),f=h.getOrigin(f);newOffset=this.adjustOffset(c,h.getOriginalItem(),b,a);(m&JSG.graph.attr.consts.Direction.BOTH)==JSG.graph.attr.consts.Direction.BOTH?(f.x=k.x+newOffset.x,f.y=k.y+newOffset.y):m&JSG.graph.attr.consts.Direction.VERTICAL?(f.x=k.x,f.y=k.y+newOffset.y):m&JSG.graph.attr.consts.Direction.HORIZONTAL&&(f.x=k.x+newOffset.x,f.y=
k.y);h.getFeedbackItem()instanceof JSG.graph.model.Edge&&d(h,this.feedback);h.setOriginTo(f)}};JSG.graph.interaction.MoveInteraction.prototype.updateSubFeedbacks=function(a,b,c){if(this.isCopyOnMoveEvent(a))for(a=0;a<c.length;a++)c[a].getFeedbackItem().setItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,!1)};
JSG.graph.interaction.MoveInteraction.prototype.onMouseDrag=function(a,b){if(!this.checkForEscape(a,b)){b.clearLayer(JSG.graph.view.LayerId.LAYOUTMARKER);b.clearLayer(JSG.graph.view.LayerId.TARGETCONTAINER);b.clearLayer(JSG.graph.view.LayerId.SNAPLINES);this._horizontalSnapController=this._verticalSnapController=void 0;if(!0!==this._notifyDelegate("highlightTargetController",a,b)){var c=this.findTargetController(a,b);if(void 0!=c&&!(c instanceof JSG.graph.controller.GraphController)){JSG.graph.interaction.InteractionUtils.highlightTargetController(b,
c);var d=this.findLayoutIndex(b,c,!0);void 0!=d&&(this._layoutFeedback=JSG.graph.interaction.InteractionUtils.highlightControllerLayoutPosition(d,b,c))}if(b.getGraphSettings().getSnapToShapes()&&this.feedback.length&&!a.event.altKey){for(var c=b.getSelection(),d=0,e=c.length;d<e&&(c[d].getModel().getItemAttributes().getMoveable().getValue()&JSG.graph.attr.consts.Direction.BOTH)==JSG.graph.attr.consts.Direction.BOTH;d++);d==e&&(c=this.currentLocation.copy(),c.subtract(this.startLocation),d=b.getSelectionView().getBoundingBox().getBoundingRectangle(),
d.translate(c.x,c.y),JSG.graph.interaction.InteractionUtils.highlightSnapItemofController(this,d,a.event.altKey))}}a.doRepaint=!0;this.setCursor(JSG.ui.Cursor.Style.MOVE);JSG.graph.interaction.MoveInteraction._super.onMouseDrag.call(this,a,b)}};
JSG.graph.interaction.MoveInteraction.prototype.findTargetController=function(a,b){if(b.getDefaultController())return b.getDefaultController();var c=b.getSelection();if(c.length){for(var d=c[0].getParent(),e=0;e<c.length;e++){var f=c[e];if(f.getParent()!=d||!this._isMoveable(f,b)||f.getModel()instanceof JSG.graph.model.TextNode)return}var g=this.isCopyOnMoveEvent(a),l=b.getRootController().getContent(),c=b.findControllerAt(a.location.copy(),JSG.graph.controller.FindFlags.AREA,function(a){if(!a.getModel().isContainer()||
a instanceof JSG.graph.controller.GraphController||a instanceof JSG.graph.controller.ConnectionController||a instanceof JSG.graph.controller.PortController)return!1;for(var c=b.getSelection(),d=0;d<c.length;d++){if(!JSG.graphItemFactory.isValidSubItem(c[d].getModel(),a.getModel().getType().getValue()))return!1;if(a==c[d])return l=a.getParent(),!1;if(!g)for(var e=a.getParent();void 0!=e&&!(e instanceof JSG.graph.controller.GraphController);){if(e==c[d])return l=e.getParent(),!1;e=e.getParent()}}return!0});
void 0==c?c=l:c instanceof JSG.graph.controller.ContainerNodeController&&(c=c.getContentPaneController());return c}};JSG.graph.interaction.MoveInteraction.prototype._isMoveable=function(a,b){var c=a.getModel();return c.getItemAttributes().getMoveable().getValue()==JSG.graph.attr.consts.Direction.NONE?c instanceof JSG.graph.model.Edge?this.isMoved(c.sourceNode,b)&&this.isMoved(c.targetNode,b):!1:!0};
JSG.graph.interaction.MoveInteraction.prototype.findLayoutIndex=function(a,b,c){if(void 0!=b){var d=a.getSelection();return d.length?JSG.layoutFactory.getLayoutIndex(this.currentLocation.copy(),a,b,d[0].getModel().getType().getValue(),c,!1):void 0}};JSG.graph.interaction.MoveInteraction.prototype.onMouseExit=function(a,b){this._failed=!0;this.cancelInteraction(a,b)};
JSG.graph.interaction.MoveInteraction.prototype.onMouseUp=function(a,b){JSG.graph.interaction.MoveInteraction._super.onMouseUp.call(this,a,b);!0!==this._failed||a.isConsumed||this.getInteractionHandler().handleMouseEvent(a)};
JSG.graph.interaction.MoveInteraction.prototype.willFinish=function(a,b,c){if(this._keyOffset)this._handleMouseUp(b,this._keyOffset,a);else{var d=this.getSnapRect(b,JSG.rectCache.get()),e=this.getSnapAndGridOffset(b,a,d,JSG.ptCache.get()),f=b.getCoordinateSystem().metricToLogXNoZoom(JSG.graph.interaction.MoveInteraction.MOVE_THRESHOLD);Math.abs(c.x)<f&&Math.abs(c.y)<f?this._failed=!0:this._handleMouseUp(b,e,a);JSG.ptCache.release(e);JSG.rectCache.release(d)}};
JSG.graph.interaction.MoveInteraction.prototype.isCopyOnMoveEvent=function(a){return a&&(a.event.ctrlKey&&!a.event.altKey)&&void 0==this._keyOffset};JSG.graph.interaction.MoveInteraction.prototype.isMoveHVEvent=function(a){return a&&a.event.shiftKey&&void 0!=this._keyOffset};
JSG.graph.interaction.MoveInteraction.prototype._handleMouseUp=function(a,b,c){function d(a){for(var b=new JSG.geometry.Point(0,0),c=0;c<a.length;c++){var d=a[c].getOriginalItem();d.sourceNode===d.targetNode&&(b=a[c].getFeedbackItem().getOrigin(b),JSG.graph.Utils.translatePointDown(b,d.getGraph(),d.getParent()),n.push(new JSG.graph.command.MoveItemCommand(d,b)))}}function e(a,b){for(var c=a.getId(),d=0;d<b.length;d++){var e=b[d];if(e.getOriginalItem().getId()==c)return e}}var f=this.getInteractionHandler();
if(f){var g=this._notifyDelegate("createCommand",c,a);if(void 0!=g)f.execute(g),this._notifyDelegate("setSelection",c,a);else{g=void 0;if(!this._keyOffset){var l=this.findTargetController(c,a);void 0!=l&&(g=this.findLayoutIndex(a,l,!1,!1));var h=this.isCopyOnMoveEvent(c),m=this._notifyDelegate("allowCopyOnMove",c,a);if(h&&(void 0==m||!0===m)){if(b=this._notifyDelegate("createCopyOnMoveCommand",l,c,a))f.execute(b);else{b=JSG.copyItems(a.getSelection());var h=this.getSnapRect(a),k=this.getSnapAndGridOffset(a,
c,h);a=new JSG.graph.command.PasteItemsCommand(b,a,l,k);f.execute(a)}return}}for(var n=[],q=[],m=[],p=[],s=a.getSelection(),u=!1,t=0;t<s.length;t++){var w=s[t],v=w.getModel();this._isMoveable(w,a)&&(v instanceof JSG.graph.model.LineConnection?(u=!0,k=this.adjustOffset(b,v,a,c),this._moveConnectionCmd(n,k,w,e(v,this.feedback),l,c,a)):(q.push(w),p.push(e(v,this.feedback))));m.push(v)}this._subfeedbacks.isEmpty()||h||d(this._subfeedbacks.elements());for(t=0;t<q.length;t++)k=this.adjustOffset(b,s[t].getModel(),
a,c),this._moveItemCmd(n,k,q[t],p[t],l,c,a);void 0!=g&&(g.before?n.push(new JSG.graph.command.ChangeItemOrderCommand(s[0],g.index)):n.push(new JSG.graph.command.ChangeItemOrderCommand(s[0],g.index+1)));g=this._createCommand(n,u);g instanceof JSG.graph.command.CompoundCommand&&g.disableRefresh(!0);f.execute(g);var f=a.getSelectionProvider(),A=a.getRootController().getContent(),s=[];m.forEach(function(a){a=A.getControllerByModelId(a.getId());void 0!=a&&s.push(a)});f.selectAll(s);a.onSelectionChanged()}}};
JSG.graph.interaction.MoveInteraction.prototype.adjustOffset=function(a,b,c,d){a=a.copy();this.isMoveHVEvent(d)&&(Math.abs(this.currentLocation.x-this.startLocation.x)>Math.abs(this.currentLocation.y-this.startLocation.y)?a.y=0:a.x=0);d=b.getItemAttributes().getMoveable().getValue();(d&JSG.graph.attr.consts.Direction.BOTH)==JSG.graph.attr.consts.Direction.BOTH?a:d&JSG.graph.attr.consts.Direction.VERTICAL?a.x=0:d&JSG.graph.attr.consts.Direction.HORIZONTAL&&(a.y=0);if(d&JSG.graph.attr.consts.Moveable.LIMITTOCONTAINER){var e=
b.getTranslatedBoundingBox(c.getGraph()),f=b.getParent().getTranslatedBoundingBox(c.getGraph());b=f.getPoints();c=e.getPoints();e=f.getCenter().add(f.getTopLeft());for(f=0;4>f;f++)c[f].translate(a.x,a.y);for(f=0;4>f;f++){var g=this.getLinePolylineOffset(c[f],e,b,!1);if(void 0!=g){for(var l=0;4>l;l++)c[l].translate(-Math.round(g.x),-Math.round(g.y));d&JSG.graph.attr.consts.Direction.HORIZONTAL&&(a.x-=Math.round(g.x));d&JSG.graph.attr.consts.Direction.VERTICAL&&(a.y-=Math.round(g.y))}}}return a};
JSG.graph.interaction.MoveInteraction.prototype.getLinePolylineOffset=function(a,b,c,d){for(var e=new JSG.geometry.Point(0,0),f=0,g=c.length;f<g;f++)if(f==g-1){if(JSG.geometry.Utils.getIntersectionOfLines(c[f],c[0],a,b,e,d))return JSG.geometry.Utils.getLinePointOffset(c[f],c[0],a)}else if(JSG.geometry.Utils.getIntersectionOfLines(c[f],c[f+1],a,b,e,d))return JSG.geometry.Utils.getLinePointOffset(c[f],c[f+1],a)};
JSG.graph.interaction.MoveInteraction.prototype._moveItemCmd=function(a,b,c,d,e,f,g){function l(a){a.translateFromParent(m);h-=a.getAngle()}if(void 0!=d){b=c.getModel();f=d.getFeedbackItem();var h=d.getAngle(),m=f.getPinPoint();d=g.rootController.getView();g=void 0!=e?e.getView():c.getView().getParent();JSG.graph.Utils.traverseDown(d,g,l);void 0!=e&&c.getParent()!=e&&(a.push(new JSG.graph.command.ChangeParentCommand(b,e.getModel())),(c=h-b.getAngle().getValue())&&a.push(new JSG.graph.command.RotateItemCommand(b,
c)));a.push(new JSG.graph.command.MoveItemCommand(b,m))}};JSG.graph.interaction.MoveInteraction.prototype._moveConnectionCmd=function(a,b,c,d,e,f,g){var l=c.getModel();c.isAttached()&&(void 0!=l.sourceNode&&(this.isMoved(l.sourceNode,g)||a.push(new JSG.graph.command.DetachCommand(l,l.getSourcePort()))),void 0!=l.targetNode&&(this.isMoved(l.targetNode,g)||a.push(new JSG.graph.command.DetachCommand(l,l.getTargetPort()))));this._moveItemCmd(a,b,c,d,e,f,g)};
JSG.graph.interaction.MoveInteraction.prototype.isMoved=function(a,b){for(var c=!1;void 0!=a&&!(c=b.isSelected(a));)a=a.getParent();return c};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.RotateInteraction=function(){JSG.graph.interaction.RotateInteraction._super.constructor.apply(this,arguments);this._selectionpin=void 0;this._rotation=this._lastRotationAngle=0};JSG.extend(JSG.graph.interaction.RotateInteraction,JSG.graph.interaction.AbstractInteraction);
JSG.graph.interaction.RotateInteraction.prototype._ROTATION_STEP=5;JSG.graph.interaction.RotateInteraction.prototype.deactivate=function(a){this._selectionpin=void 0;this._lastRotationAngle=0;a.getSelectionView().setVisible(!0);JSG.graph.interaction.RotateInteraction._super.deactivate.call(this,a)};JSG.graph.interaction.RotateInteraction.prototype.onRotateStart=function(a,b){this.onMouseDown(a,b)};JSG.graph.interaction.RotateInteraction.prototype.onRotateEnd=function(a,b){this.onMouseUp(a,b)};
JSG.graph.interaction.RotateInteraction.prototype.onMouseDown=function(a,b){var c=b.getSelectionView();this._selectionpin=c.getPinPoint();c.setVisible(!1);JSG.graph.interaction.RotateInteraction._super.onMouseDown.call(this,a,b)};JSG.graph.interaction.RotateInteraction.prototype.createActionFeedback=function(a,b){var c=new JSG.graph.view.SelectionFeedbackView(8),d=b.getSelectionView();c.setBoundingBox(d.getBoundingBox());return c};
JSG.graph.interaction.RotateInteraction.prototype.updateActionFeedback=function(a,b){this.actionFeedback&&(this._rotation&&this.feedback.length)&&this.actionFeedback._box.rotateAroundPoint(this._selectionpin,this._rotation)};
JSG.graph.interaction.RotateInteraction.prototype.updateFeedback=function(a,b,c){c=0;c=a.type==JSG.ui.events.GestureEventType.ROTATE?JSG.geometry.Utils.toRadians(a.gesture.rotation):JSG.geometry.Utils.getAngleBetweenLines(this.startLocation,this.currentLocation,this._selectionpin);var d=c-this._lastRotationAngle;b.getGraphSettings().getSnapToGrid()&&!a.event.altKey&&(c=Math.floor(JSG.geometry.Utils.toDegrees(c)),c=Math.floor(c/this._ROTATION_STEP)*this._ROTATION_STEP,c=JSG.geometry.Utils.toRadians(c),
d=c-this._lastRotationAngle);a=0;for(b=this.feedback.length;a<b;a++)this.feedback[a].isRotatable()&&d&&(this.feedback[a].rotate(d,this._selectionpin),JSG.debug.log("item rotate: "+d));this._rotation=d;this._lastRotationAngle=c};
JSG.graph.interaction.RotateInteraction.prototype.willFinish=function(a,b,c){a=this._lastRotationAngle;if(c=this.getInteractionHandler()){for(var d=b.getSelection(),e=b.getSelectionView(),f=e.isSingleSelection()?void 0:this._selectionpin,g=[],l=[],h=0;h<d.length;h++)d[h].getModel().isRotatable()&&(d[h]instanceof JSG.graph.controller.ConnectionController?g.push(this._rotateConnectionCmd(d[h],a,f,b)):l.push(d[h]));for(h=0;h<l.length;h++)g.push(this._rotateItemCmd(l[h],a,f,b));b=this._createCommand(g);
b._rotangle=e.getRotationAngle()+a;c.execute(b,this.executed)}};JSG.graph.interaction.RotateInteraction.prototype._rotateItemCmd=function(a,b,c,d){a=a.getModel();c=this._translatePin(c,a);return new JSG.graph.command.RotateItemCommand(a,b,c)};JSG.graph.interaction.RotateInteraction.prototype._rotateConnectionCmd=function(a,b,c,d){d=a.getModel();a.isAttached();c=this._translatePin(c,d);return new JSG.graph.command.RotateItemCommand(d,b,c)};
JSG.graph.interaction.RotateInteraction.prototype._translatePin=function(a,b){void 0!=a&&(a=a.copy(),JSG.graph.Utils.traverseItemDown(b.getGraph(),b.getParent(),function(b){b.translateFromParent(a)}));return a};JSG.graph.interaction.RotateInteraction.prototype.executed=function(a,b){var c=b.getSelectionView(),d=c.getViews();c.removeAllViews();c.setRotationAngle(a._rotangle);for(var e=0;e<d.length;e++)c.addView(d[e])};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.ReshapeInteraction=function(a){JSG.graph.interaction.ReshapeInteraction._super.constructor.apply(this,arguments);this._activeHandle=a};JSG.extend(JSG.graph.interaction.ReshapeInteraction,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.ReshapeInteraction.prototype.deactivate=function(a){var b=a.getSelectionView();b.refresh();b.setVisible(!0);this._activeHandle=void 0;JSG.graph.interaction.ReshapeInteraction._super.deactivate.call(this,a)};
JSG.graph.interaction.ReshapeInteraction.prototype.onMouseDown=function(a,b){b.getSelectionView().setVisible(!1);JSG.graph.interaction.ReshapeInteraction._super.onMouseDown.call(this,a,b)};
JSG.graph.interaction.ReshapeInteraction.prototype.createActionFeedback=function(a,b){var c=this._activeHandle;if(c){var d=new JSG.graph.view.SelectionFeedbackView(9),e=b.getSelectionView();d.setBoundingBox(e.getBoundingBox());c=c.getPointIndex();if(0<=c){b.getSelection()[0].getModel();var f=new JSG.geometry.Point(0,0);e._selectionHandler._reshapeMarkers[c]._coordinate.toPoint(f);d.setPoint(f)}return d}};
JSG.graph.interaction.ReshapeInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback){var c=this._activeHandle.getPointIndex();if(0<=c){var d=b.getSelectionView(),e=b.getSelection()[0].getModel(),f=d._selectionHandler._reshapeMarkers[c]._coordinate,g=new JSG.graph.expr.Reference(this,JSG.graph.properties.GraphItemProperties.WIDTH,e),l=new JSG.graph.expr.Reference(this,JSG.graph.properties.GraphItemProperties.HEIGHT,e),h,m,k=new JSG.geometry.Point(0,0);k.setTo(this.currentLocation);
k.subtract(this.startLocation);e=this.getReshapeValues(k,e);k=JSG.graph.expr.Term;h=e.x;m=e.y;switch(f.getType()){case JSG.graph.ReshapeType.XRELATIVETOWIDTH:f=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(g.copy()),k.fromNumber(h)));l=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(l.copy()),k.fromNumber(m)));break;case JSG.graph.ReshapeType.XRELATIVETOWIDTHFROMRIGHT:f=new k.Mul(k.fromReference(g.copy()),k.fromNumber(h));f=new JSG.graph.expr.Expression(0,void 0,
new k.Sub(k.fromReference(g.copy()),f));l=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(l.copy()),k.fromNumber(m)));break;case JSG.graph.ReshapeType.XRELATIVETOHEIGHT:f=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(l.copy()),k.fromNumber(h)));l=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(l.copy()),k.fromNumber(m)));break;case JSG.graph.ReshapeType.XRELATIVETOHEIGHTFROMRIGHT:f=new k.Mul(k.fromReference(l.copy()),k.fromNumber(h));f=new JSG.graph.expr.Expression(0,
void 0,new k.Sub(k.fromReference(g.copy()),f));l=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(l.copy()),k.fromNumber(m)));break;case JSG.graph.ReshapeType.YRELATIVETOHEIGHT:f=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(g.copy()),k.fromNumber(h)));l=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(l.copy()),k.fromNumber(m)));break;case JSG.graph.ReshapeType.YRELATIVETOHEIGHTFROMBOTTOM:f=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(g.copy()),
k.fromNumber(h)));g=new k.Mul(k.fromReference(l.copy()),k.fromNumber(m));l=new JSG.graph.expr.Expression(0,void 0,new k.Sub(k.fromReference(l.copy()),g));break;case JSG.graph.ReshapeType.YRELATIVETOWIDTH:f=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(g.copy()),k.fromNumber(h)));l=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(g.copy()),k.fromNumber(m)));break;case JSG.graph.ReshapeType.YRELATIVETOWIDTHFROMBOTTOM:f=new JSG.graph.expr.Expression(0,void 0,new k.Mul(k.fromReference(g.copy()),
k.fromNumber(h)));g=new k.Mul(k.fromReference(g.copy()),k.fromNumber(m));l=new JSG.graph.expr.Expression(0,void 0,new k.Sub(k.fromReference(l.copy()),g));break;default:f=new JSG.graph.expr.NumberExpression(h),l=new JSG.graph.expr.NumberExpression(m)}d._selectionHandler._reshapeMarkers[c]._coordinate.set(f,l);d._selectionHandler._reshapeMarkers[c]._coordinate.toPoint(e);this.actionFeedback.setPoint(e)}}};
JSG.graph.interaction.ReshapeInteraction.prototype.updateFeedback=function(a,b,c){a=this._activeHandle.getPointIndex();0<=a&&(b=b.getSelection()[0].getModel(),c=b.getReshapeCoordinateAt(a),c.getX().getValue(),c.getY().getValue(),c=new JSG.geometry.Point(0,0),c.setTo(this.currentLocation),c.subtract(this.startLocation),b=this.getReshapeValues(c,b),void 0!=this.feedback[0]&&this.feedback[0].updateReshapePoint(a,b))};
JSG.graph.interaction.ReshapeInteraction.prototype.createCommand=function(a,b){var c=b.getModel(),d=this.getReshapeValues(a,c),e=this._activeHandle;return 0>e.getPointIndex()?void 0:new JSG.graph.command.ReshapeItemCommand(c,e.getPointIndex(),d)};
JSG.graph.interaction.ReshapeInteraction.prototype.getReshapeValues=function(a,b){var c=new JSG.geometry.Point(0,0),d=this._activeHandle;if(0>d.getPointIndex())return c.set(0,0),c;var e=b.getBoundingBox(JSG.boxCache.get()),d=b.getReshapeCoordinateAt(d.getPointIndex());c.set(d.getX().getValue(),d.getY().getValue());d.getType()==JSG.graph.ReshapeType.XRELATIVETOWIDTH?c.x+=0!=e.getWidth()?a.x/e.getWidth():0:d.getType()==JSG.graph.ReshapeType.XRELATIVETOWIDTHFROMRIGHT?c.x-=0!=e.getWidth()?a.x/e.getWidth():
0:d.getType()==JSG.graph.ReshapeType.XRELATIVETOHEIGHT?c.x+=0!=e.getHeight()?a.x/e.getHeight():0:d.getType()==JSG.graph.ReshapeType.XRELATIVETOHEIGHTFROMRIGHT?c.x-=0!=e.getHeight()?a.x/e.getHeight():0:c.x+=a.x;c.x=Math.min(d.getXMax(),c.x);c.x=Math.max(d.getXMin(),c.x);d.getType()==JSG.graph.ReshapeType.YRELATIVETOHEIGHT?c.y+=0!=e.getHeight()?a.y/e.getHeight():0:d.getType()==JSG.graph.ReshapeType.YRELATIVETOHEIGHTFROMBOTTOM?c.y-=0!=e.getHeight()?a.y/e.getHeight():0:d.getType()==JSG.graph.ReshapeType.YRELATIVETOWIDTH?
c.y+=0!=e.getWidth()?a.y/e.getWidth():0:d.getType()==JSG.graph.ReshapeType.YRELATIVETOWIDTHFROMBOTTOM?c.y-=0!=e.getHeight()?a.y/e.getHeight():0:c.y+=a.y;c.y=Math.min(d.getYMax(),c.y);c.y=Math.max(d.getYMin(),c.y);JSG.boxCache.release(e);return c};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.ResizeInteraction=function(a){JSG.graph.interaction.ResizeInteraction._super.constructor.apply(this,arguments);this._activeHandle=a;this._selectionbox=this._fbStructures=void 0};
JSG.extend(JSG.graph.interaction.ResizeInteraction,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.ResizeInteraction.prototype.deactivate=function(a){a.getSelectionView().setVisible(!0);this._activeHandle=this._fbStructures=this._selectionbox=void 0;JSG.graph.interaction.ResizeInteraction._super.deactivate.call(this,a)};
JSG.graph.interaction.ResizeInteraction.prototype.onMouseDown=function(a,b){this._fbStructures=new JSG.commons.Map;this._selectionbox=new JSG.geometry.BoundingBox(0,0);b.getSelectionView().getBoundingBox(this._selectionbox);b.getSelectionView().setVisible(!1);JSG.graph.interaction.ResizeInteraction._super.onMouseDown.call(this,a,b)};
JSG.graph.interaction.ResizeInteraction.prototype.createActionFeedback=function(a,b){var c=this._activeHandle;if(c)return c=new JSG.graph.view.SelectionFeedbackView(c.getPointIndex()),c.setBoundingBox(this._selectionbox),c};JSG.graph.interaction.ResizeInteraction.prototype.updateActionFeedback=function(a,b){this.actionFeedback&&this._selectionbox&&this.actionFeedback.setBoundingBox(this._selectionbox)};
JSG.graph.interaction.ResizeInteraction.prototype._createSelectionFeedback=function(a,b){var c=JSG.graph.interaction.ResizeInteraction._super._createSelectionFeedback.call(this,a,b);c.initResize(this._selectionbox);c.getFeedbackItem()instanceof JSG.graph.model.TextNode&&c.getFeedbackItem().getItemAttributes().setSizeMode(JSG.graph.attr.TextNodeAttributes.SizeMode.WIDTH);var d=a.getView();this._fbStructures.put(d.getId(),new JSG.graph.interaction.ResizeInteraction.FeedbackStructure(c,this._selectionbox));
return c};
JSG.graph.interaction.ResizeInteraction.prototype.updateFeedback=function(a,b,c){function d(c,d,f){var m=new JSG.geometry.Point(0,0),k=e.alignToGrid(e.currentLocation,b,a.event.altKey,new JSG.geometry.Point(0,0));c.setTo(k);c.subtract(f.getTopLeft(m));f.rotateLocalPointInverse(c);m=f.getSize(m);k=f.getTopLeft(new JSG.geometry.Point(0,0));switch(d){case 0:k.add(c);f.rotatePoint(k);f.setTopLeftTo(k);c.multiply(-1);c.add(m);break;case 1:k.set(k.x,k.y+c.y);f.rotatePoint(k);f.setTopLeftTo(k);c.set(m.x,
m.y-c.y);break;case 2:k.set(k.x,k.y+c.y);f.rotatePoint(k);f.setTopLeftTo(k);c.set(c.x,m.y-c.y);break;case 3:c.y=m.y;break;case 5:c.x=m.x;break;case 6:k.set(k.x+c.x,k.y);f.rotatePoint(k);f.setTopLeftTo(k);c.set(m.x-c.x,c.y);break;case 7:k.set(k.x+c.x,k.y),f.rotatePoint(k),f.setTopLeftTo(k),c.set(m.x-c.x,m.y)}e._selectionbox.setSizeTo(c)}var e=this,f=this._activeHandle;0<=f.getPointIndex()&&(d(c,f.getPointIndex(),this._selectionbox),this._fbStructures.iterate(function(a,b){b.update(e._selectionbox)}))};
JSG.graph.interaction.ResizeInteraction.prototype.createCommand=function(a,b){function c(a,b){var c=a.getView(),d=a.getModel(),e=b.getPoints();e.forEach(function(a){JSG.graph.Utils.traverseDown(c.getGraphView(),c.getParent(),function(b){b.translateFromParent(a);return!0})});return new JSG.graph.command.SetLineShapePointsCommand(d,e)}var d=b.getView(),e=this._fbStructures.get(d.getId());if(void 0!=e){if(e.feedback instanceof JSG.graph.feedback.EdgeFeedback)return c(b,e.feedback);var e=e.feedback.getBoundingBox(JSG.boxCache.get()),
f=d.getParent(),g=e.getTopLeft(),l=b.getViewer().rootController.getView();JSG.graph.Utils.traverseDown(l,f,function(a){a.translateFromParent(g);return!0});e.setTopLeftTo(g);e.setAngle(d.getAngle());d=new JSG.graph.command.ResizeItemCommand(d._item,e);JSG.boxCache.release(e);return d}};
JSG.graph.interaction.ResizeInteraction.FeedbackStructure=function(a,b){function c(a){a.subtract(f);b.rotateLocalPointInverse(a);a.set(a.x/e.x,a.y/e.y);return a}this.feedback=a;var d=a.getBoundingBox(),e=b.getSize(),f=b.getTopLeft();this._bbox=d.copy();this._topleftfactor=c(d.getTopLeft());this._bottomrightfactor=c(d.getBottomRight())};
JSG.graph.interaction.ResizeInteraction.FeedbackStructure.prototype.update=function(a){function b(b,e){e.set(b.x*c.x,b.y*c.y);a.rotateLocalPoint(e);e.add(d);return e}this.feedback.resize(a);var c=a.getSize(),d=a.getTopLeft(),e=this.feedback.getFeedbackItem(),f=b(this._topleftfactor,new JSG.geometry.Point(0,0)),g=b(this._bottomrightfactor,new JSG.geometry.Point(0,0));this.feedback.getItemAttributes().getSizeable().getValue()&&(this._bbox.setTopLeftTo(f),this._bbox.setBottomRightTo(g),e.setBoundingBoxTo(this._bbox),
e.refresh())};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.ResizeEdgeInteraction=function(a){JSG.graph.interaction.ResizeEdgeInteraction._super.constructor.apply(this,arguments);this._activeHandle=a;this._dragIndex=-1;this._dragMaskIndex=0;this._target=this._portFeedback=void 0};JSG.extend(JSG.graph.interaction.ResizeEdgeInteraction,JSG.graph.interaction.AbstractInteraction);
JSG.graph.interaction.ResizeEdgeInteraction.prototype.deactivate=function(a){this._activeHandle=void 0;this._dragIndex=-1;this._dragMaskIndex=0;this._target=this._portFeedback=void 0;JSG.graph.interaction.ResizeEdgeInteraction._super.deactivate.call(this,a)};JSG.graph.interaction.ResizeEdgeInteraction.prototype.draggedSourceOrTarget=function(){return 1===this._dragMaskIndex||2===this._dragMaskIndex};JSG.graph.interaction.ResizeEdgeInteraction.prototype.draggedSource=function(){return 1===this._dragMaskIndex};
JSG.graph.interaction.ResizeEdgeInteraction.prototype.draggedTarget=function(){return 2===this._dragMaskIndex};JSG.graph.interaction.ResizeEdgeInteraction.prototype.createActionFeedback=function(a,b){var c=new JSG.graph.view.PositionFeedbackView,d=a.location.copy();b.translateFromParent(d);c.setPosition(d);return c};JSG.graph.interaction.ResizeEdgeInteraction.prototype.updateActionFeedback=function(a,b){if(this.actionFeedback){var c=a.location.copy();b.translateFromParent(c);this.actionFeedback.setPosition(c)}};
JSG.graph.interaction.ResizeEdgeInteraction.prototype._createSelectionFeedback=function(a,b){this._dragIndex=this._activeHandle.getPointIndex();var c=a.getModel().getPointsCount();this._dragMaskIndex=0===this._dragIndex?1:this._dragIndex===c-1?2:0;return JSG.graph.interaction.ResizeEdgeInteraction._super._createSelectionFeedback.call(this,a,b)};
JSG.graph.interaction.ResizeEdgeInteraction.prototype.updateFeedback=function(a,b,c){c=this.alignToGrid(this.currentLocation,b,a.event.altKey);this.feedback[0].setPointAt(this._dragIndex,c);this.showPossiblePortAt(a,b)};
JSG.graph.interaction.ResizeEdgeInteraction.prototype.showPossiblePortAt=function(a,b){this._portFeedback=void 0;if(this.draggedSourceOrTarget()){b.clearLayer(JSG.graph.view.LayerId.PORTS);var c=JSG.graph.interaction.InteractionUtils.getPortsController(a,b);void 0!=c&&(c=JSG.graph.interaction.InteractionUtils.getPortsFor(c,this,a.event.altKey),b.getLayer(JSG.graph.view.LayerId.PORTS).addAll(c),1===c.length&&(this._portFeedback=c[0]))}return this._portFeedback};
JSG.graph.interaction.ResizeEdgeInteraction.prototype.createCommand=function(a,b,c,d){return void 0!==this._portFeedback?(this._target={},this._target.node=this._portFeedback._model,this._target.port=this._portFeedback._model.getPortAtLocation(this._portFeedback._location),this._target.location=this._portFeedback._location.copy(),this._target.port||(this._target.port=new JSG.graph.model.Port,this._target.isNew=!0),this.createAttachCommand(b,this._target.port,c)):this.draggedSourceOrTarget()&&(a=b.getModel(),
a=this.draggedSource()?a.getSourcePort():a.getTargetPort(),void 0!==a)?this.createDetachCommand(b,a,c):this.createResizeCommand(b,this.currentLocation,c)};
JSG.graph.interaction.ResizeEdgeInteraction.prototype.createAttachCommand=function(a,b,c){function d(a,b){var c=a.getAngle().getValue();JSG.graph.Utils.traverseItemUp(a.getParent(),b,function(a){c+=a.getAngle().getValue()});return c-a.getAngle().getValue()}var e=a.getModel(),f=e.getGraph(),g=new JSG.graph.command.CompoundCommand,l=this.draggedSource()?e.getSourcePort():e.getTargetPort();void 0!==l&&g.add(new JSG.graph.command.DetachCommand(e,l));this._target&&this._target.isNew&&g.add(new JSG.graph.command.AddPortCommand(this._target.port,
this._target.location,this._target.node));l=this._target.location.copy();JSG.graph.Utils.translatePointUp(l,this._target.node,f);g.add(this.createResizeCommand(a,l,c));a=JSG.graph.Utils.findCommonParent(e.getParent(),this._target.node.getParent(),f);a=void 0!=a?a:f;a!=e.getParent()&&(g.add(new JSG.graph.command.ChangeParentCommand(e,a)),(f=d(e,a))&&g.add(new JSG.graph.command.RotateItemCommand(e,f)));g.add(new JSG.graph.command.AttachCommand(e,b,this.draggedSource()));return g};
JSG.graph.interaction.ResizeEdgeInteraction.prototype.createDetachCommand=function(a,b,c){var d=new JSG.graph.command.CompoundCommand;b=new JSG.graph.command.DetachCommand(a.getModel(),b);a=this.createResizeCommand(a,this.currentLocation,c);d.add(b);d.add(a);return d};
JSG.graph.interaction.ResizeEdgeInteraction.prototype.createResizeCommand=function(a,b,c){var d=a.getViewer(),e=a.getView().getParent(),f=d.rootController.getView(),g=this.alignToGrid(b,d,c.event.altKey);JSG.graph.Utils.traverseDown(f,e,function(a){a.translateFromParent(g)});return new JSG.graph.command.SetLinePointAtCommand(a.getModel(),this._dragIndex,g)};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.ResizeOrthoEdgeInteraction=function(a){JSG.graph.interaction.ResizeOrthoEdgeInteraction._super.constructor.apply(this,arguments);this._delegate=void 0};JSG.extend(JSG.graph.interaction.ResizeOrthoEdgeInteraction,JSG.graph.interaction.ResizeEdgeInteraction);
JSG.graph.interaction.ResizeOrthoEdgeInteraction.prototype._createSelectionFeedback=function(a,b){var c=JSG.graph.interaction.ResizeOrthoEdgeInteraction._super._createSelectionFeedback.call(this,a,b),d=this._activeHandle.getPointIndex(),e=this.currentLocation.copy();-1<d?(this._delegate=new JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate(this),this._delegate.initWith(c,d,e)):(this._delegate=new JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate(this),this._delegate.initWith(c,
this._activeHandle._segmentIndex,e));return c};JSG.graph.interaction.ResizeOrthoEdgeInteraction.prototype.updateFeedback=function(a,b,c){c=this.alignToGrid(this.currentLocation.copy(),b,a.event.altKey);this.showPossiblePortAt(a,b);this._delegate.update(this.feedback[0],c)};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.prototype.showPossiblePortAt=function(a,b){var c=JSG.graph.interaction.ResizeOrthoEdgeInteraction._super.showPossiblePortAt.call(this,a,b);void 0!==c?(this._delegate.hidePortFeedback(this.feedback[0]),this._delegate.showedPortFeedback(c,this.feedback[0],this.currentLocation)):this._delegate.hidePortFeedback(this.feedback[0])};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.prototype.createResizeCommand=function(a,b,c){c=this.alignToGrid(b.copy(),a.getViewer(),c.event.altKey);this._delegate.update(this.feedback[0],c);return this._delegate.createCommandFrom(this.feedback[0],a,b,this._portFeedback)};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.prototype.willFinish=function(a,b,c){void 0!=this._delegate&&this._delegate.createCommand(this.feedback[0])&&JSG.graph.interaction.ResizeOrthoEdgeInteraction._super.willFinish.call(this,a,b,c)};JSG.graph.interaction.ResizeOrthoEdgeInteraction.prototype.didFinish=function(a,b){JSG.graph.interaction.ResizeOrthoEdgeInteraction._super.didFinish.call(this,a,b);void 0!=this._delegate&&(this._delegate.deactivate(),this._delegate=void 0)};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate=function(a){this.dragIndex=-1;this.snaplinepoints=[];this._interaction=a};JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.SNAP_THRESHOLD=250;
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.initWith=function(a,b,c){function d(a,b){if(0<=a&&a<=f){var c=e.getPointAt(a);c.index=a;b.push(c)}}var e=a.getFeedbackItem(),f=e.getPointsCount()-1;this.dragIndex=b;this._draggedSource=0===b;this._draggedTarget=b===f;0===b?(d(b+1,this.snaplinepoints),d(b+2,this.snaplinepoints)):b===f?(d(b-1,this.snaplinepoints),d(b-2,this.snaplinepoints)):(d(b,this.snaplinepoints),d(b-1,this.snaplinepoints),d(b,this.snaplinepoints),d(b+1,this.snaplinepoints),
0<=b-2&&(d(b-1,this.snaplinepoints),d(b-2,this.snaplinepoints)),b+2<=f&&(d(b+1,this.snaplinepoints),d(b+2,this.snaplinepoints)),e.getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.MANUAL));a.detachFromSource=function(){};a.detachFromTarget=function(){}};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.update=function(a,b){var c=a.getFeedbackItem(),d=c.getPointsCount()-1,e=this._draggedSource?0:this._draggedTarget?d:this.dragIndex;if(0===e&&c.hasSourceAttached())c.refresh();else if(e===d&&c.hasTargetAttached())c.refresh();else{a.setPointAt(e,b.copy());for(var c=new JSG.geometry.Point(0,0),f=new JSG.geometry.Point(0,0),g=0,l=this.snaplinepoints.length-1;g<l;g+=2){var h=this.snaplinepoints[g],m=this.snaplinepoints[g+1],k=e,
n=!1;c.setTo(b);f.setTo(b);c=JSG.geometry.Utils.getOrthogonalProjectionOfPoint(c,h,m);f.subtract(c);(0===k||k===d)&&f.length()<JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.SNAP_THRESHOLD?(n=!0,f.setTo(c),a.setPointAt(k,f)):(c.subtract(m),c.length()<JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.SNAP_THRESHOLD&&(n=!0,f.add(m),a.setPointAt(k,f)));n&&b.setTo(f)}}};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.showedPortFeedback=function(a,b){function c(c,d){if(!e.hasSourceAttached()){e._ptsCount=e.getPointsCount();e.hasSourceAttached=function(){return!0};e.getSourcePort=function(){return c};var f=e.translateFromParent(a._point.copy()),m=e.getShape().disableRefresh();e.setStartCoordinateTo(b.createCoordinateProxyAt(f,e.getStartCoordinate()));e.getShape().layoutFrom(c);!0===m&&e.getShape().enableRefresh()}}function d(c,d){if(!e.hasTargetAttached()){e._ptsCount=
e.getPointsCount();e.hasTargetAttached=function(){return!0};e.getTargetPort=function(){return c};var f=e.translateFromParent(a._point.copy()),m=e.getShape().disableRefresh();e.setEndCoordinateTo(b.createCoordinateProxyAt(f,e.getEndCoordinate()));e.getShape().layoutFrom(c);!0===m&&e.getShape().enableRefresh()}}var e=b.getFeedbackItem(),f=function(a,b){var c=b.copy();JSG.graph.Utils.translatePointDown(c,a.getGraph(),a);return{getParent:function(){return a},getConnectionPoint:function(a,d){return void 0!=
a?c:b}}}(a._model,a._point);this._interaction.draggedSource()?c(f,this):d(f,this)};JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.hidePortFeedback=function(a){a=a.getFeedbackItem();void 0==a._ptsCount&&(a._ptsCount=a.getPointsCount());this._interaction.draggedSource()?this.detachFromSourcePort(a):this._interaction.draggedTarget()&&this.detachFromTargetPort(a)};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.detachFromSourcePort=function(a){if(a.hasSourceAttached()){a.hasSourceAttached=function(){return!1};a.getSourcePort=function(){};var b=this._getCoordinate(a.getStartCoordinate());b.setTo(a.getCoordinateAt(1));a.setStartCoordinateTo(b);this._removeAddedPointsAt(1,a)}};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.detachFromTargetPort=function(a){a.hasTargetAttached()&&(a.hasTargetAttached=function(){return!1},a.getTargetPort=function(){},a.setEndCoordinateTo(this._getCoordinate(a.getEndCoordinate())),this._removeAddedPointsAt(a._ptsCount-1,a))};JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype._getCoordinate=function(a){return void 0!=a.getCoordinate?a.getCoordinate():a};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype._removeAddedPointsAt=function(a,b){var c=b.getShape(),d=b._ptsCount;if(0<d){var e=b.getPointsCount();d!=e&&c.removeCoordinatesAt(a,e-d);b._ptsCount=0}};JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.createCommand=function(a){return!0};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.createCommandFrom=function(a,b,c,d){c=new JSG.graph.command.CompoundCommand;!1===this._draggedSource&&!1===this._draggedTarget&&this._addDisableAutoLayoutCommand(c,b.getModel());var e=b.getModel();a=a.getFeedbackItem().getPoints();(function(a){for(var b=a.length-1,c=b;0<c;c--){var d;d=c-1;var e=c+1;d=0<=d&&e<=b?JSG.geometry.Utils.areLinesParallel(a[d],a[c],a[c],a[e]):!1;d&&a.splice(c,1)}})(a);(function(a){JSG.graph.Utils.traverseItemDown(e.getGraph(),
e.getParent(),function(b){for(var c=0;c<a.length;c++)b.translateFromParent(a[c])})})(a);c.add(new JSG.graph.command.SetLineShapePointsCommand(e,a));return c};JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype._addDisableAutoLayoutCommand=function(a,b){var c=JSG.graph.model.shapes.OrthoLineBehavior,d=b.getLayoutAttributes().getLineBehavior();d.getValue()===c.AUTO&&a.add(new JSG.graph.command.SetLayoutAttributeCommand(b,"setLineBehavior",d,c.MANUAL))};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.prototype.deactivate=function(){this._interaction=this.snaplinepoints=void 0};JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate=function(){JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate._super.constructor.apply(this,arguments);this.lineSegmentEnd=new JSG.geometry.Point(0,0);this.lineSegmentStart=new JSG.geometry.Point(0,0)};
JSG.extend(JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate,JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate);
JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate.prototype.initWith=function(a,b,c){JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate._super.initWith.call(this,a,b,c);var d=JSG.graph.model.shapes.OrthoLineShapeLayouter.MIN_DIST_TO_PORT,e=[];a.getFeedbackItem().getLayoutAttributes().setLineBehavior(JSG.graph.model.shapes.OrthoLineBehavior.MANUAL);a=a.getFeedbackItem();this.dragIndex=b+1;this._draggedTarget=this._draggedSource=!1;this.lineSegmentStart=a.getPointAt(b,
this.lineSegmentStart);this.lineSegmentEnd=a.getPointAt(b+1,this.lineSegmentEnd);c=JSG.geometry.Utils.getOrthogonalProjectionOfPoint(c.copy(),this.lineSegmentStart,this.lineSegmentEnd);if(0===b)if(!0===a.hasSourceAttached()){var f=c.copy().subtract(this.lineSegmentStart);f.setLength(Math.max(f.length()/2,d));f.add(this.lineSegmentStart);this.lineSegmentStart.setTo(f);d=f;d.index=this.dragIndex;e.push(d);d=f=JSG.geometry.Utils.getOrthogonalPointTo(this.lineSegmentStart,f).add(f);d.index=this.dragIndex+
1;e.push(d);this.dragIndex+=2}else d=JSG.geometry.Utils.getOrthogonalPointTo(this.lineSegmentStart,c),d.add(this.lineSegmentStart),d.index=this.dragIndex,e.push(d),this.dragIndex+=1;else b===a.getPointsCount()-2&&!0===a.hasTargetAttached()&&(f=c.copy().subtract(this.lineSegmentEnd),f.setLength(Math.max(f.length()/2,d)),f.add(this.lineSegmentEnd),f=f.copy().subtract(this.lineSegmentEnd),f.setLength(d).add(this.lineSegmentEnd),this.lineSegmentEnd.setTo(f));d=c.copy();d.index=this.dragIndex;e.push(d);
c=c.copy();c.index=this.dragIndex+1;e.push(c);a.insertPointsAt(b+1,e)};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate.prototype.update=function(a,b){var c=b.copy(),d=new JSG.geometry.Point(0,0),c=JSG.geometry.Utils.getOrthogonalProjectionOfPoint(c,this.lineSegmentStart,this.lineSegmentEnd),e;e=c;var f=this.lineSegmentStart,g=this.lineSegmentEnd,g=f.copy().subtract(g);e=f.copy().subtract(e);e=0<-g.x*e.x-g.y*e.y;f=d.setTo(c).subtract(this.lineSegmentStart).length();g=d.setTo(this.lineSegmentEnd).subtract(this.lineSegmentStart).length();f>g&&!e?(c.subtract(this.lineSegmentEnd),
b.subtract(c)):(f=d.setTo(c).subtract(this.lineSegmentEnd).length(),g=d.setTo(this.lineSegmentStart).subtract(this.lineSegmentEnd).length()-JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.SNAP_THRESHOLD+10,f>g&&(d.setTo(this.lineSegmentEnd).subtract(this.lineSegmentStart).setLength(JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.SNAP_THRESHOLD+10),d.add(this.lineSegmentStart),b.subtract(c).add(d)));JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate._super.update.call(this,
a,b)};JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate.prototype.createCommand=function(a){a=a.getFeedbackItem();return a.getPointAt(this.dragIndex+1).subtract(a.getPointAt(this.dragIndex)).length()>=JSG.graph.interaction.ResizeOrthoEdgeInteraction.ResizeDelegate.SNAP_THRESHOLD};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate.prototype.createCommandFrom=function(a,b,c){var d=new JSG.graph.command.CompoundCommand;this._addDisableAutoLayoutCommand(d,b.getModel());d.add(JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate._super.createCommandFrom.call(this,a,b,c));return d};
JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate.prototype.deactivate=function(){JSG.graph.interaction.ResizeOrthoEdgeInteraction.AddPointsDelegate._super.deactivate.call(this);this.lineSegmentStart=this.lineSegmentEnd=void 0};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.EditTextInteraction=function(){JSG.graph.interaction.EditTextInteraction._super.constructor.apply(this,arguments);this.div=void 0;this._appliedText=!1;this._controller=void 0;this._notifyFlag=!0;this._zoom=1};JSG.extend(JSG.graph.interaction.EditTextInteraction,JSG.graph.interaction.AbstractInteraction);JSG.graph.interaction.EditTextInteraction.SCROLL_TEST=!0;
JSG.graph.interaction.EditTextInteraction.prototype.activate=function(a){a=JSG.graph.notifications.NotificationCenter.getInstance();a.register(this,JSG.ui.ScrollPanel.SCROLL_NOTIFICATION);a.register(this,JSG.ui.GraphEditor.ZOOM_NOTIFICATION);a.register(this,JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION)};
JSG.graph.interaction.EditTextInteraction.prototype.deactivate=function(a){if(void 0==this.div||!0!=this.div._rm){if(void 0!=this.div){this._item.setItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,!0);this.div._rm=!0;var b=a._graphicSystem.canvas;b.focus();b.parentNode.removeChild(this.div);this.div=void 0}this._controller=void 0;b=JSG.graph.notifications.NotificationCenter.getInstance();b.unregister(this,JSG.ui.ScrollPanel.SCROLL_NOTIFICATION);b.unregister(this,JSG.ui.GraphEditor.ZOOM_NOTIFICATION);
b.unregister(this,JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION);JSG.graph.interaction.EditTextInteraction._super.deactivate.call(this,a)}};JSG.graph.interaction.EditTextInteraction.prototype.onNotification=function(a){var b=!1;switch(a.name){case JSG.ui.GraphEditor.ZOOM_NOTIFICATION:case JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION:b=!0;break;case JSG.ui.ScrollPanel.SCROLL_NOTIFICATION:b=this._notifyFlag}!0===b&&this.finishInteraction(void 0,this.getViewer())};
JSG.graph.interaction.EditTextInteraction.prototype.onMouseMove=function(a,b){this.isInside(this._controller,a.location)||this.setCursor(JSG.ui.Cursor.Style.AUTO)};JSG.graph.interaction.EditTextInteraction.prototype.onMouseDown=function(a,b){this.isInside(this._controller,a.location)?(this.startEdit(this._controller,a,b),a.event.doPreventDefault=!0):this.finishInteraction(a,b)};JSG.graph.interaction.EditTextInteraction.prototype.isInside=function(a,b){if(void 0!=a){var c=a.getModel();return c.getTranslatedBoundingBox(c.getGraph()).getBoundingRectangle().containsPoint(this.getViewer().translateFromParent(b.copy()))}return!1};
JSG.graph.interaction.EditTextInteraction.prototype.setController=function(a){this._controller=a};
JSG.graph.interaction.EditTextInteraction.prototype.assureVisibility=function(a,b,c,d){if(c){var e=d.getCoordinateSystem(),f=this.getDivOrigin(c,d),g=c.getModel().getTextSize(e);c=!1;var l=d.getScrollPanel(),h=l.getHorizontalScroll(),m=l.getVerticalScroll();this._notifyFlag=!1;1E3>f.x&&(h-=f.x-1500,c=!0);1E3>f.y&&(m-=f.y-1500,c=!0);a=e.deviceToLogX(a)-(f.x+e.deviceToLogX(g.x)*this._zoom);1E3>a&&(h+=a-1500,c=!0);b=e.deviceToLogX(b)-(f.y+e.deviceToLogX(g.y)*this._zoom);1E3>b&&(m+=b-1500,c=!0);c&&(l.setScrollPosition(h,
m),this.getInteractionHandler().repaint(),this.updateTextArea(d));this._notifyFlag=!0}};JSG.graph.interaction.EditTextInteraction.prototype.onResizeCanvas=function(a,b,c){this.assureVisibility(a,b,this._controller,c);return!0};
JSG.graph.interaction.EditTextInteraction.prototype.startEdit=function(a,b,c){function d(a){a=h.div.selectionStart;h.scrollToCursorAt(a+(h.div.selectionEnd-a)/2)}function e(a){return h.handleKeyUp(a,m)}function f(a){return h.handleKeyDown(a,m)}function g(a){return h.handleChange(a,m)}function l(a){return h.handleBlur(a,m)}JSG.debug.log("startEdit");if(void 0!=a&&void 0==this.div){b&&(b.isConsumed=!0);b=c._graphicSystem.canvas;this.assureVisibility(b.width,b.height,a,c);this._controller=a;this._item=
a.getModel();this._item.setItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,!1);this._cancel=!1;c._graphicSystem.paint();a.getView();a=c.getCoordinateSystem();var h=this;this.storeUndoText(this._item);var m=document.createElement("textarea");m.contentEditable="true";m.style.resize="none";m.tabIndex="5";m.style.background=this._item.getFormat().getFillStyle().getValue()==JSG.graph.attr.FormatAttributes.FillStyle.NONE?"none":this._item.getFormat().getFillColor().getValue();m.style.borderStyle="none";
8>this._item._getTextFormat().getFontSize().getValue()*a.getZoom()?(m.style.fontSize="8pt",this._zoom=8/(this._item._getTextFormat().getFontSize().getValue()*a.getZoom())):(m.style.fontSize=this._item._getTextFormat().getFontSize().getValue()*a.getZoom()+"pt",this._zoom=1);m.style.fontFamily=this._item._getTextFormat().getFontName().getValue();m.style.fontWeight=this._item._getTextFormat().getFontStyle().getValue()&JSG.graph.attr.TextFormatAttributes.FontStyle.BOLD?"bold":"normal";m.style.fontStyle=
this._item._getTextFormat().getFontStyle().getValue()&JSG.graph.attr.TextFormatAttributes.FontStyle.ITALIC?"italic":"normal";m.style.lineHeight=1.2;var k=this._item._getTextFormat().getFontColor().getValue();"#FFFFFF"!=k&&(m.style.color=k);m.style.textAlign=this._item.getTextAlign();m.style.position="absolute";m.style.overflow="hidden";m.style.display="inline";k=this._item.getItemAttributes();m.style.paddingLeft=a.logToDeviceX(k.getLeftMargin().getValue())+"px";m.style.paddingTop=a.logToDeviceX(k.getTopMargin().getValue())+
"px";m.style.paddingRight=a.logToDeviceX(k.getRightMargin().getValue())+"px";m.style.paddingBottom=a.logToDeviceX(k.getBottomMargin().getValue())+"px";m.value=this.getEditText(this._item);m.autofocus=!0;this.div=m;this.updateTextArea(c);b.parentNode.appendChild(m);m.focus();m.select();m.addEventListener("keyup",e,!1);m.addEventListener("keydown",f,!1);m.addEventListener("input",g,!1);m.addEventListener("onchange",g,!1);m.addEventListener("blur",l,!1);JSG.graph.interaction.EditTextInteraction.SCROLL_TEST&&
(m.addEventListener("select",d,!1),m.addEventListener("selectstart",d,!1),m.addEventListener("selectionchange",d,!1))}};JSG.graph.interaction.EditTextInteraction.prototype.handleKeyUp=function(a,b){if(18==a.keyCode||a.altKey)return a.preventDefault(),!1;JSG.graph.interaction.EditTextInteraction.SCROLL_TEST&&this.scrollToCursorAt(this.div.selectionStart)};
JSG.graph.interaction.EditTextInteraction.prototype.handleKeyDown=function(a,b){var c=this.getViewer(),d=c.getGraphicSystem().getCanvas();switch(a.keyCode){case 32:if(a.altKey)return a.preventDefault(),a.stopPropagation(),!1;break;case 27:d=JSG.ui.events.KeyEvent.fromEvent(d,a,JSG.ui.events.KeyEventType.DOWN);this.cancelInteraction(d,c);break;case 13:if(a.altKey||a.shiftKey){d=b.value;if("number"==typeof b.selectionStart&&"number"==typeof b.selectionEnd){var e=b.selectionStart;b.value=d.slice(0,e)+
"\n"+d.slice(b.selectionEnd);b.selectionStart=b.selectionEnd=e+1}else document.selection&&document.selection.createRange&&(b.focus(),d=document.selection.createRange(),d.text="\r\n",d.collapse(!1),d.select());this.updateTextArea(c);a.preventDefault();a.stopPropagation();return!1}d=JSG.ui.events.KeyEvent.fromEvent(d,a,JSG.ui.events.KeyEventType.DOWN);this.finishInteraction(d,c);break;default:this.updateTextArea(c)}};JSG.graph.interaction.EditTextInteraction.prototype.handleChange=function(a,b){this.updateTextArea(this.getViewer())};
JSG.graph.interaction.EditTextInteraction.prototype.handleBlur=function(a,b){this._appliedText||this.finishInteraction(void 0,this.getViewer())};JSG.graph.interaction.EditTextInteraction.prototype.storeUndoText=function(a){this._undoText=a.getText().copy()};JSG.graph.interaction.EditTextInteraction.prototype.getEditText=function(a){return a.getText().getValue()};
JSG.graph.interaction.EditTextInteraction.prototype.updateTextArea=function(a){if(this.div){var b=this.div.value,c=a.getCoordinateSystem(),d=a._graphicSystem.canvas;this._item.setText(b);this._item.updateSize();var b=this._item.getBoundingBox(JSG.boxCache.get()),e=this.getDivOrigin(this._controller,a);this.doWrapText()||b.expandBy(150,0);this.div.style.width=Math.max(2,c.logToDeviceX(b.getWidth())*this._zoom+1).toFixed()+"px";this.div.style.height=Math.max(2,c.logToDeviceX(b.getHeight())*this._zoom+
1).toFixed()+"px";this.div.style.top=(c.logToDeviceX(e.y)+d.offsetTop).toFixed()+"px";this.div.style.left=(c.logToDeviceX(e.x)+d.offsetLeft-1).toFixed()+"px";JSG.graph.interaction.EditTextInteraction.SCROLL_TEST&&this._scrollToCursor(this.div.selectionStart,d,e,b,a);JSG.boxCache.release(b);a.getGraph()._isDirty=!1;a.getSelectionView().refresh();this.getInteractionHandler().repaint()}};
JSG.graph.interaction.EditTextInteraction.prototype.scrollToCursorAt=function(a){var b=this.getViewer(),c=b._graphicSystem.canvas,d=this._item.getBoundingBox(JSG.boxCache.get()),e=this.getDivOrigin(this._controller,b);this._scrollToCursor(a,c,e,d,b);JSG.boxCache.release(d)};
JSG.graph.interaction.EditTextInteraction.prototype._scrollToCursor=function(a,b,c,d,e){d=e.getCoordinateSystem();var f=this._item.getTextSize(d);c=this.getDivOrigin(this._controller,e);a=this._cursorPos(a,f.x,f.y,JSG.ptCache.get());var f=!1,g=e.getScrollPanel(),l=g.getHorizontalScroll(),h=g.getVerticalScroll();c=c.x+d.deviceToLogX(a.x)*this._zoom;1E3>c?(console.log("SCROLL x is negative! \x3d\x3e "+c),l-=c-1500,f=!0):(c=d.deviceToLogX(b.width)-c,console.log("X: "+c.toString()),1E3>c&&(console.log("SCROLL x is to big!! \x3d\x3e "+
c),l+=c-1500,f=!0,console.log("Scroll: "+l.toString())));f&&(this._notifyFlag=!1,g.setScrollPosition(l,h),e.getSelectionView().refresh(),this.getInteractionHandler().repaint(),this.updateTextArea(e),this._notifyFlag=!0);JSG.ptCache.release(a)};JSG.graph.interaction.EditTextInteraction.prototype._cursorPos=function(a,b,c,d){d=d||new JSG.geometry.Point(0,0);var e=this._item.getText().getValue(),f=Math.max(1,this._item._lines.length);c/=f;for(d.set(b*f/e.length*a,0);d.x>b;)d.x-=b,d.y+=c;return d};
JSG.graph.interaction.EditTextInteraction.prototype.getDivOrigin=function(a,b){var c=a.getModel(),d=a.getView(),e=c.getBoundingBox(JSG.boxCache.get()),f=c.getOrigin(),g=e.getCenter(JSG.ptCache.get());g.add(f);c=c.getTranslatedBoundingBox(c.getGraph(),JSG.boxCache.get());this.doWrapText()||c.expandBy(150,0);JSG.graph.Utils.traverseUp(d.getParent(),b.getRootView(),function(a){var b=0,c=0;a instanceof JSG.graph.view.GraphView&&(b=a.getItem().getSettings().getPage(),c=b.getLeftMargin()+Math.floor(g.x/
b.getUsableWidth())*(b.getLeftMargin()+b.getRightMargin()+b.getHorizontalGap()),b=b.getTopMargin()+Math.floor(g.y/b.getUsableHeight())*(b.getTopMargin()+b.getBottomMargin()+b.getVerticalGap()),g.x+=c,g.y+=b);a.translateToParent(g);a instanceof JSG.graph.view.GraphView&&(g.x-=c,g.y-=b);return!0});f.x=g.x-c.getWidth()/2*this._zoom;f.y=g.y-c.getHeight()/2*this._zoom;JSG.ptCache.release(g);JSG.boxCache.release(c,e);return f};
JSG.graph.interaction.EditTextInteraction.prototype.doWrapText=function(){return this._item?this._item.getItemAttributes().getSizeMode().getValue()===JSG.graph.attr.TextNodeAttributes.SizeMode.WIDTH:!1};JSG.graph.interaction.EditTextInteraction.prototype.onMouseUp=function(a,b){this.isInside(this._controller,a.location)||this.finishInteraction(a,b)};JSG.graph.interaction.EditTextInteraction.prototype.updateFeedback=function(a,b,c){};
JSG.graph.interaction.EditTextInteraction.prototype.createCommand=function(a,b,c,d){};JSG.graph.interaction.EditTextInteraction.prototype.onMouseExit=function(a,b){return!1};
JSG.graph.interaction.EditTextInteraction.prototype.createSetTextCommand=function(a){var b=a.getText().getValue();if(void 0==this._undoText||this._undoText.getValue()!=b)return a instanceof JSG.graph.model.AttributedTextNode?(b=a.getAttributeExpression(),new JSG.graph.command.ChangeAttributeCommand(b.getAttributeOwner(),b.getAttribute().getPath(),a.getText().getValue(),this._undoText)):new JSG.graph.command.SetTextCommand(a,this._undoText,a.getText().getValue())};
JSG.graph.interaction.EditTextInteraction.prototype.willFinish=function(a,b){this._applyText(b)||this.cancelInteraction(a,b)};JSG.graph.interaction.EditTextInteraction.prototype._applyText=function(a){a=this.createSetTextCommand(this._item);var b=this.getInteractionHandler();return void 0!=b&&void 0!=a?(a.delayExecution||(this._appliedText=!0,b.execute(a)),!0):!1};
JSG.graph.interaction.EditTextInteraction.prototype.didFinish=function(a,b){JSG.graph.interaction.EditTextInteraction._super.didFinish.call(this,a,b);this._item.setItemAttribute(JSG.graph.attr.ItemAttributes.VISIBLE,!0);this.getInteractionHandler().repaint()};JSG.graph.interaction.EditTextInteraction.prototype.cancelInteraction=function(a,b){this._resetText();JSG.graph.interaction.EditTextInteraction._super.cancelInteraction.call(this,a,b)};
JSG.graph.interaction.EditTextInteraction.prototype._resetText=function(){this._item.setText(this._undoText);this._item.updateSize()};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.PinchInteraction=function(){JSG.graph.interaction.PinchInteraction._super.constructor.apply(this,arguments);this._startZoom=void 0};JSG.extend(JSG.graph.interaction.PinchInteraction,JSG.graph.interaction.Interaction);JSG.graph.interaction.PinchInteraction.prototype.activate=function(a){this._startZoom=void 0};
JSG.graph.interaction.PinchInteraction.prototype.onPinchStart=function(a,b){this._startZoom=b.getZoom()};JSG.graph.interaction.PinchInteraction.prototype.onPinch=function(a,b){void 0!=this._startZoom&&b.setZoom(this._startZoom*a.gesture.scale)};JSG.graph.interaction.PinchInteraction.prototype.onPinchEnd=function(a,b){this._startZoom=void 0};JSG.graph.interaction.PinchInteraction.Activator=function(){JSG.graph.interaction.PinchInteraction.Activator._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.interaction.PinchInteraction.Activator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.PinchInteraction.Activator.KEY="pinch.activator";JSG.graph.interaction.PinchInteraction.Activator.prototype.getKey=function(){return JSG.graph.interaction.PinchInteraction.Activator.KEY};
JSG.graph.interaction.PinchInteraction.Activator.prototype.onPinchStart=function(a,b,c){!1===this.isDisposed&&(this.activateInteraction(new JSG.graph.interaction.PinchInteraction,c).onPinchStart(a,b),a.hasActivated=!0)};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.PanInteraction=function(){JSG.graph.interaction.PanInteraction._super.constructor.apply(this,arguments);this._startScroll=void 0};JSG.extend(JSG.graph.interaction.PanInteraction,JSG.graph.interaction.Interaction);
JSG.graph.interaction.PanInteraction.prototype.activate=function(a){this._startScroll=void 0};JSG.graph.interaction.PanInteraction.prototype.onPanStart=function(a,b){var c=b.getScrollPanel();this._startScroll=new JSG.geometry.Point(c.getHorizontalScroll(),c.getVerticalScroll())};
JSG.graph.interaction.PanInteraction.prototype.onPan=function(a,b){if(void 0!=this._startScroll){var c=b.getScrollPanel(),d=b.getCoordinateSystem();c.setScrollPosition(this._startScroll.x+d.deviceToLogX(a.gesture.deltaX),this._startScroll.y+d.deviceToLogY(a.gesture.deltaY))}};JSG.graph.interaction.PanInteraction.prototype.onPanEnd=function(a,b){this._startScroll=void 0};
JSG.graph.interaction.PanInteraction.Activator=function(){JSG.graph.interaction.PanInteraction.Activator._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.PanInteraction.Activator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.PanInteraction.Activator.KEY="pan.activator";JSG.graph.interaction.PanInteraction.Activator.prototype.getKey=function(){return JSG.graph.interaction.PanInteraction.Activator.KEY};
JSG.graph.interaction.PanInteraction.Activator.prototype.onPanStart=function(a,b,c){!1===this.isDisposed&&(this.activateInteraction(new JSG.graph.interaction.PanInteraction,c).onPanStart(a,b),a.hasActivated=!0)};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.DefaultKeyHandler=function(){JSG.graph.interaction.DefaultKeyHandler._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.DefaultKeyHandler,JSG.graph.interaction.InteractionActivator);
JSG.graph.interaction.DefaultKeyHandler.prototype.onKeyUp=function(a,b,c){};
JSG.graph.interaction.DefaultKeyHandler.prototype.onKeyDown=function(a,b,c){switch(a.event.keyCode){case 9:var d=b.getRootController().getContent();if(b.hasSelection()){var e=b.getSelection(),f=e[e.length-1],g=!1,l=!1;d.traverse(function(a){if(l)return!1;if(g){if(!a.getModel().isAnyParentCollapsed()&&a.isSelectable())return b.clearSelection(!1),b.select(a),l=!0,!1}else a&&a!==d&&a==f&&(g=!0);return a.getModel().isAnyParentCollapsed()?!1:!0});l||b.clearSelection()}else d.children.length&&b.select(d.children[0]);
a.doRepaint=!0;a.consume();return;case 107:a.event.ctrlKey&&(b.setZoom(b.getZoom()+0.1),a.doRepaint=!0,a.consume());return;case 109:a.event.ctrlKey&&(b.setZoom(b.getZoom()-0.1),a.doRepaint=!0,a.consume());return;case 90:a.event.ctrlKey&&(c.getInteractionHandler().undo(),a.consume());return;case 89:a.event.ctrlKey&&(c.getInteractionHandler().redo(),a.consume());return;case 86:a.event.ctrlKey&&(a.event.shiftKey?c.getInteractionHandler().pasteFormat():c.getInteractionHandler().paste(),a.consume());return;
case 65:a.event.ctrlKey&&(b.clearSelection(),d=b.getRootController().getContent(),b.setSelection(d.children),a.doRepaint=!0,a.consume());return}if(b.hasSelection())switch(e=b.getSelection(),a.event.keyCode){case 27:b.clearSelection();a.doRepaint=!0;a.consume();break;case 46:c.getInteractionHandler().deleteSelection();a.consume();break;case 68:a.event.ctrlKey&&(e=JSG.copyItems(b.getSelection()),cmd=new JSG.graph.command.PasteItemsCommand(e,b),c.getInteractionHandler().execute(cmd),a.consume());break;
case 81:if(a.event.ctrlKey){c=0;for(var h=e.length;c<h;c++)e[c].getModel()instanceof JSG.graph.model.Node&&e[c].getModel().clearPorts();a.consume()}break;case 88:a.event.ctrlKey&&(c.getInteractionHandler().cutSelection(),a.consume());break;case 67:a.event.ctrlKey&&(a.event.shiftKey?c.getInteractionHandler().copySelectionFormat():c.getInteractionHandler().copySelection(),a.consume())}else switch(e=b.getScrollPanel(),a.event.keyCode){case 37:e.getHorizontalScrollBar().scroll(-500,!0);a.doRepaint=!0;
a.consume();break;case 38:e.getVerticalScrollBar().scroll(-500,!0);a.doRepaint=!0;a.consume();break;case 39:e.getHorizontalScrollBar().scroll(500,!0);a.doRepaint=!0;a.consume();break;case 40:e.getVerticalScrollBar().scroll(500,!0),a.doRepaint=!0,a.consume()}};
JSG.graph.interaction.DefaultKeyHandler.prototype.editTextItem=function(a,b,c){var d=a[0].getModel(),e=void 0;d instanceof JSG.graph.model.TextNode?e=a[0]:(e=d.getTextSubItem(),void 0==e&&d.isAddLabelAllowed()&&(dispatcher.interactionHandler.execute(new JSG.graph.command.AddLabelCommand(a[0].getModel(),"Label")),e=d.getTextSubItem()),e=a[0].getModelController(e));void 0!=e&&(this._setActiveInteraction(this.editTextInteraction,c),this.editTextInteraction.startEdit(e,b,c));b.doRepaint=!0};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.CreateEdgeActivator=function(a){JSG.graph.interaction.CreateEdgeActivator._super.constructor.apply(this,arguments);this._viewer=void 0};JSG.extend(JSG.graph.interaction.CreateEdgeActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.CreateEdgeActivator.KEY="edge.activator";JSG.graph.interaction.CreateEdgeActivator.prototype.getKey=function(){return JSG.graph.interaction.CreateEdgeActivator.KEY};
JSG.graph.interaction.CreateEdgeActivator.prototype.init=function(a){JSG.graph.interaction.CreateEdgeActivator._super.init.call(this,a);this._viewer=a;JSG.graph.notifications.NotificationCenter.getInstance().register(this,JSG.graph.view.SelectionProvider.SELECTION_CHANGED_NOTIFICATION)};
JSG.graph.interaction.CreateEdgeActivator.prototype.dispose=function(a){JSG.graph.interaction.CreateEdgeActivator._super.dispose.call(this,a);this._viewer=void 0;this._removePortsHighlights(a);JSG.graph.notifications.NotificationCenter.getInstance().unregister(this,JSG.graph.view.SelectionProvider.SELECTION_CHANGED_NOTIFICATION)};JSG.graph.interaction.CreateEdgeActivator.prototype.onNotification=function(a){a=a.object;void 0!=this._viewer&&a.hasSingleSelection()&&this._removePortsHighlights(this._viewer)};
JSG.graph.interaction.CreateEdgeActivator.prototype._removePortsHighlights=function(a){a=a.clearLayer(JSG.graph.view.LayerId.PORTS);return void 0!=a&&0<a.length};
JSG.graph.interaction.CreateEdgeActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed){var d=c.getActiveHandle();if(void 0==d||d.getType()==JSG.graph.view.selection.SelectionHandle.TYPE.MOVE)d=this._getActiveHighlight(b),void 0!=d&&(b.clearLayer(JSG.graph.view.LayerId.PORTS),c=this.activateInteraction(this._createEdgeInteraction(),c),c._portFeedback=d,c.onMouseDown(a,b),a.hasActivated=!0);this._removePortsHighlights(b)}};
JSG.graph.interaction.CreateEdgeActivator.prototype._getActiveHighlight=function(a){if(a.hasLayer(JSG.graph.view.LayerId.PORTS)&&(a=a.getLayer(JSG.graph.view.LayerId.PORTS),1===a.length&&!0===a[0]._active))return a[0]};
JSG.graph.interaction.CreateEdgeActivator.prototype._createEdgeInteraction=function(){var a;a=JSG.graphItemFactory.createItemFromString(JSG.defaultEdgeType);a.getShape().getType()===JSG.graph.model.shapes.OrthoLineShape.TYPE?(a=new JSG.graph.interaction.CreateOrthoEdgeInteraction(a),a.useCreationMode(JSG.graph.interaction.CreateOrthoEdgeInteraction.CREATION_MODE.CLICK)):a=new JSG.graph.interaction.CreateEdgeInteraction(a);return a};
JSG.graph.interaction.CreateEdgeActivator.prototype.onMouseMove=function(a,b,c){if(!1===this.isDisposed){var d=this._removePortsHighlights(b);if(a.isConsumed)a.doRepaint=d||a.doRepaint;else{var e=this._getPortsToHighlight(c,a,b);e.length?(b.getLayer(JSG.graph.view.LayerId.PORTS).addAll(e),a.doRepaint=!0):a.doRepaint=d||a.doRepaint}}this._getActiveHighlight(b)?c.setCursor(JSG.ui.Cursor.Style.CROSS):-1<c.getCursor().indexOf("crosshair")&&c.setCursor(JSG.ui.Cursor.Style.AUTO)};
JSG.graph.interaction.CreateEdgeActivator.prototype._getPortsToHighlight=function(a,b,c){c=JSG.graph.interaction.InteractionUtils.getPortsController(b,c);return void 0==c||c.isSelected()?[]:JSG.graph.interaction.InteractionUtils.getPortsFor(c,a,b.event.altKey)};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.CreateFriendActivator=function(){JSG.graph.interaction.CreateFriendActivator._super.constructor.apply(this,arguments);this._viewer=void 0;this._pendingAdd=!1};
JSG.extend(JSG.graph.interaction.CreateFriendActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.CreateFriendActivator.KEY="friend.activator";JSG.graph.interaction.CreateFriendActivator.prototype.getKey=function(){return JSG.graph.interaction.CreateFriendActivator.KEY};
JSG.graph.interaction.CreateFriendActivator.prototype.init=function(a){JSG.graph.interaction.CreateFriendActivator._super.init.call(this,a);this._viewer=a;this._pendingAdd=!1;a=JSG.graph.notifications.NotificationCenter.getInstance();a.register(this,JSG.ui.GraphEditor.ZOOM_NOTIFICATION);a.register(this,JSG.graph.view.SelectionProvider.SELECTION_CHANGED_NOTIFICATION)};
JSG.graph.interaction.CreateFriendActivator.prototype.dispose=function(a){JSG.graph.interaction.CreateFriendActivator._super.dispose.call(this,a);this._viewer=void 0;this._removeFriendViews(a);a=JSG.graph.notifications.NotificationCenter.getInstance();a.unregister(this,JSG.ui.GraphEditor.ZOOM_NOTIFICATION);a.unregister(this,JSG.ui.GraphEditor.SELECTION_CHANGED_NOTIFICATION)};
JSG.graph.interaction.CreateFriendActivator.prototype.onNotification=function(a){void 0!=this._viewer&&this._viewer.hasLayer(JSG.graph.view.LayerId.FRIENDS)&&this._updateFriendViews(this._viewer)};JSG.graph.interaction.CreateFriendActivator.prototype._updateFriendViews=function(a,b){var c=a.getSelectionProvider(),d=this._removeFriendViews(a);c.hasSingleSelection()&&!this._pendingAdd&&(d=this._addFriendViews(c.getFirstSelection().getModel(),a));return d};
JSG.graph.interaction.CreateFriendActivator.prototype._removeFriendViews=function(a){a=a.clearLayer(JSG.graph.view.LayerId.FRIENDS);return void 0!=a&&0<a.length};JSG.graph.interaction.CreateFriendActivator.prototype.onKeyDown=function(a,b,c){a.doRepaint=this._removeFriendViews(b)||a.doRepaint};
JSG.graph.interaction.CreateFriendActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed){this._pendingAdd=!0;var d=this._getSelectedFriendAt(c.currentLocation,b);if(void 0!=d){var e=b.getSelection();0<e.length&&(e=e[0].getModel(),d=this._createFriendInteraction(d,e),void 0!=d&&(this.activateInteraction(d,c),d.onMouseDown(a,b),a.hasActivated=!0));this._removeFriendViews(b)}}};
JSG.graph.interaction.CreateFriendActivator.prototype._getSelectedFriendAt=function(a,b){var c=b.getLayer(JSG.graph.view.LayerId.FRIENDS);if(void 0!=c)for(var d=0;d<c.length;d++)if(c[d].containsPoint(a))return c[d].namedImg};JSG.graph.interaction.CreateFriendActivator.prototype._createFriendInteraction=function(a,b){var c=JSG.graphItemFactory.createShape(a.name);if(void 0!=c&&0<c.length)return new JSG.graph.interaction.CreateFriendInteraction(c,item)};
JSG.graph.interaction.CreateFriendActivator.prototype.onMouseMove=function(a,b,c){b=b.getLayer(JSG.graph.view.LayerId.FRIENDS);if(void 0!=b)for(var d=0;d<b.length;d++)b[d].containsPoint(c.currentLocation)?(b[d]._bgColor="#DDDDDD",c.setCursor(JSG.ui.Cursor.Style.AUTO),a.doRepaint=!0,a.isConsumed=!0):b[d]._bgColor="#F5F0F0"};JSG.graph.interaction.CreateFriendActivator.prototype.onMouseUp=function(a,b,c){this._pendingAdd=!1};
JSG.graph.interaction.CreateFriendActivator.prototype._addFriendViews=function(a,b){var c=a.getFriends();if(c.length){var d=b.getCoordinateSystem().metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.FRIEND_UNIT),e=5*d,f=3.5*d,g=b.getGraphView(),l=a.getBoundingBox().getBoundingRectangle(),h=new JSG.geometry.Point(l.getRight(),l.getBottom()),h=new JSG.geometry.Point(h.x-0.25*l.width,h.y+200),m=b.getGraph().getPageRectForLocation(h),k=g.getPageOffset(h),g=h.x+d;m.x>g&&(g=m.x);m.x+m.width<g+e*
Math.min(c.length,4)&&(g=m.x+m.width-e*Math.min(c.length,4));l=h.y+d;m.y>l&&(l=m.y);m.y+m.height<l+f*Math.ceil(c.length/4)&&(l=h.y-d-f*Math.ceil(c.length/4));for(var m=b.getScrollPanel().getHorizontalScrollBar().getRange().getModel().pos,n=b.getScrollPanel().getVerticalScrollBar().getRange().getModel().pos,g=Math.max(m-k.x,g),l=Math.max(n-k.y,l),h=b.getScrollPanel().getViewPort().getBounds(JSG.rectCache.get()),g=Math.min(m+h.width-e*Math.min(c.length,4)-k.x,g),l=Math.min(n+h.height-f*Math.ceil(c.length/
4)-d-k.y,l),d=b.getLayer(JSG.graph.view.LayerId.FRIENDS),k=0,m=c.length;k<m;k++)n=new JSG.graph.view.MarqueeFeedbackView,n._bgColor="#F5F0F0",n._fgColor="#F5F0F0",n._image=c[k].image,n.namedImg=c[k],n.setBounds(g+e*(k%4),l+f*Math.floor(k/4),e+10,f+10),d.push(n);JSG.rectCache.release(h);return!0}return!1};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.ResizeActivator=function(a){JSG.graph.interaction.ResizeActivator._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.interaction.ResizeActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.ResizeActivator.KEY="resize.activator";JSG.graph.interaction.ResizeActivator.prototype.getKey=function(){return JSG.graph.interaction.ResizeActivator.KEY};
JSG.graph.interaction.ResizeActivator.prototype.onMouseDown=function(a,b,c){function d(a){var d=b.getSelectionProvider();if(d.hasSelection()){if(d.hasSingleSelection()&&(d=d.getFirstSelection(),d.getModel()instanceof JSG.graph.model.Edge)){var g;a:{var k=c.currentLocation;g=void 0!=d?d.getView():void 0;if(g instanceof JSG.graph.view.EdgeView){var n=g.getItem(),q=n.getFormat(),k=JSG.graph.Utils.translatePointDown(k.copy(),g.getGraphView(),g),p=void 0;q.getLineArrowEnd().getValue()!==JSG.graph.attr.FormatAttributes.ArrowStyle.NONE&&
g.hitsLineArrowEnd(k)?p=e(n.getPointsCount()-1):q.getLineArrowStart().getValue()!=JSG.graph.attr.FormatAttributes.ArrowStyle.NONE&&g.hitsLineArrowStart(k)&&(p=e(0));if(void 0!=p){p._segmentIndex=g.getLineSegmentAtPoint(k,250);g=f.createEdgeResizeInteraction(n,p);break a}}g=void 0}void 0==g&&void 0!=a&&(g=f.createEdgeResizeInteraction(d.getModel(),a));return g}return void 0!=a?new JSG.graph.interaction.ResizeInteraction(a):void 0}}function e(a){var b=new JSG.graph.view.selection.SelectionHandle;b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE);
b.setCursor(JSG.ui.Cursor.Style.AUTO);b.setPointIndex(a);return b}if(!1===this.isDisposed){var f=this,g=c.getActiveHandle();if(void 0==g||g.getType()===JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE)g=d(g),void 0!=g&&(g=f.activateInteraction(g,c),g.onMouseDown(a,b),a.hasActivated=!0)}};
JSG.graph.interaction.ResizeActivator.prototype.createEdgeResizeInteraction=function(a,b){return new (a.getShape().getType()===JSG.graph.model.shapes.OrthoLineShape.TYPE?JSG.graph.interaction.ResizeOrthoEdgeInteraction:JSG.graph.interaction.ResizeEdgeInteraction)(b)};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.CommandButtonActivator=function(a){JSG.graph.interaction.CommandButtonActivator._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.interaction.CommandButtonActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.CommandButtonActivator.KEY="commandbutton.activator";JSG.graph.interaction.CommandButtonActivator.prototype.getKey=function(){return JSG.graph.interaction.CommandButtonActivator.KEY};JSG.graph.interaction.CommandButtonActivator.prototype.onMouseDoubleClick=function(a,b,c){a.isConsumed||(b=c.getActiveHandle(),b=void 0!=b?b.getType():void 0,a.isConsumed=b===JSG.graph.view.selection.SelectionHandle.TYPE.COMMAND)};
JSG.graph.interaction.CommandButtonActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed&&(c=c.getActiveHandle(),(void 0!=c?c.getType():void 0)===JSG.graph.view.selection.SelectionHandle.TYPE.COMMAND)){var d=b.getSelectionProvider();d.hasSelection()&&d.hasSingleSelection()&&(b=b.getSelectionView(),a.isConsumed=!0,a.hasActivated=!0,this._command=b.getCommandButtonAt(c.getPointIndex()))}};
JSG.graph.interaction.CommandButtonActivator.prototype.onMouseUp=function(a,b,c){if(this._command){a.isConsumed=!0;a.hasActivated=!0;var d=b.getSelectionProvider().getFirstSelection().getModel();a=d.getParent();switch(this._command._type){case JSG.graph.view.selection.CommandButton.Type.ADDCHILD:b=new JSG.graph.command.CompoundCommand;var e=JSG.graphItemFactory.createShape(this._command._command)[0];if(e){b.add(new JSG.graph.command.AddItemCommand(e,a));var f=new JSG.graph.model.Port,g=new JSG.graph.model.Port;
b.add(new JSG.graph.command.AddPortCommand(f,new JSG.geometry.Point(0.5,1),d,!0));b.add(new JSG.graph.command.AddPortCommand(g,new JSG.geometry.Point(0.5,0),e,!0));var l=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape);l.getFormat().setLineCorner(100);l.getFormat().setFillColor("#AAAAAA");b.add(new JSG.graph.command.AttachCommand(l,f,!0));b.add(new JSG.graph.command.AttachCommand(l,g,!1));b.add(new JSG.graph.command.AddItemCommand(l,a));c.getInteractionHandler().execute(b)}break;
case JSG.graph.view.selection.CommandButton.Type.ADDSIBLINGBEFORE:case JSG.graph.view.selection.CommandButton.Type.ADDSIBLINGAFTER:b=new JSG.graph.command.CompoundCommand;e=d.getAttachedEdges();for(f=0;f<e.length;f++)if(e[f].getTargetPort().getParent()==d){l=e[f].getSourcePort().getParent();break}if(e=JSG.graphItemFactory.createShape(this._command._command)[0])d=d.getIndex(),this._command._type==JSG.graph.view.selection.CommandButton.Type.ADDSIBLINGBEFORE?b.add(new JSG.graph.command.AddItemCommand(e,
a,d)):b.add(new JSG.graph.command.AddItemCommand(e,a,d+1));l&&(f=new JSG.graph.model.Port,g=new JSG.graph.model.Port,b.add(new JSG.graph.command.AddPortCommand(f,new JSG.geometry.Point(0.5,1),l,!0)),b.add(new JSG.graph.command.AddPortCommand(g,new JSG.geometry.Point(0.5,0),e,!0)),l=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),l.getFormat().setLineCorner(100),l.getFormat().setFillColor("#AAAAAA"),b.add(new JSG.graph.command.AttachCommand(l,f,!0)),b.add(new JSG.graph.command.AttachCommand(l,
g,!1)),b.add(new JSG.graph.command.AddItemCommand(l,a)));c.getInteractionHandler().execute(b);break;case JSG.graph.view.selection.CommandButton.Type.ADDPARENT:if(b=new JSG.graph.command.CompoundCommand,e=JSG.graphItemFactory.createShape(this._command._command)[0])b.add(new JSG.graph.command.AddItemCommand(e,a)),f=new JSG.graph.model.Port,g=new JSG.graph.model.Port,b.add(new JSG.graph.command.AddPortCommand(f,new JSG.geometry.Point(0.5,1),e,!0)),b.add(new JSG.graph.command.AddPortCommand(g,new JSG.geometry.Point(0.5,
0),d,!0)),l=new JSG.graph.model.Edge(new JSG.graph.model.shapes.OrthoLineShape),l.getFormat().setLineCorner(100),l.getFormat().setFillColor("#AAAAAA"),b.add(new JSG.graph.command.AttachCommand(l,f,!0)),b.add(new JSG.graph.command.AttachCommand(l,g,!1)),b.add(new JSG.graph.command.AddItemCommand(l,a)),c.getInteractionHandler().execute(b)}this._command=void 0}};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.ReshapeActivator=function(a){JSG.graph.interaction.ReshapeActivator._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.ReshapeActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.ReshapeActivator.KEY="reshape.activator";JSG.graph.interaction.ReshapeActivator.prototype.getKey=function(){return JSG.graph.interaction.ReshapeActivator.KEY};
JSG.graph.interaction.ReshapeActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed){var d=c.getActiveHandle();void 0!=d&&d.getType()===JSG.graph.view.selection.SelectionHandle.TYPE.RESHAPE&&(this.activateInteraction(new JSG.graph.interaction.ReshapeInteraction(d),c).onMouseDown(a,b),a.hasActivated=!0)}};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.RotateActivator=function(){JSG.graph.interaction.RotateActivator._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.interaction.RotateActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.RotateActivator.KEY="rotate.activator";JSG.graph.interaction.RotateActivator.prototype.getKey=function(){return JSG.graph.interaction.RotateActivator.KEY};JSG.graph.interaction.RotateActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed){var d=c.getActiveHandle();void 0!=d&&d.getType()===JSG.graph.view.selection.SelectionHandle.TYPE.ROTATE&&this._activate(a,b,c)}};
JSG.graph.interaction.RotateActivator.prototype.onRotateStart=function(a,b,c){!1===this.isDisposed&&this._activate(a,b,c)};JSG.graph.interaction.RotateActivator.prototype._activate=function(a,b,c){this.activateInteraction(new JSG.graph.interaction.RotateInteraction,c).onRotateStart(a,b);a.hasActivated=!0};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.MoveActivator=function(){JSG.graph.interaction.MoveActivator._super.constructor.apply(this,arguments);this._possibleDragMove=!1};
JSG.extend(JSG.graph.interaction.MoveActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.MoveActivator.KEY="move.activator";JSG.graph.interaction.MoveActivator.prototype.getKey=function(){return JSG.graph.interaction.MoveActivator.KEY};JSG.graph.interaction.MoveActivator.prototype.dispose=function(a){JSG.graph.interaction.MoveActivator._super.dispose.call(this,a);this._possibleDragMove=!1};
JSG.graph.interaction.MoveActivator.prototype.onKeyDown=function(a,b,c){switch(a.event.keyCode){case 37:case 38:case 39:case 40:if(!b.hasSelection())break;this.activateInteraction(new JSG.graph.interaction.MoveInteraction,c).onKeyDown(a,b);a.hasActivated=!0;a.doRepaint=!0}};
JSG.graph.interaction.MoveActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed){var d=c.getActiveHandle();void 0!=d&&d.getType()===JSG.graph.view.selection.SelectionHandle.TYPE.MOVE?(this.activateInteraction(new JSG.graph.interaction.MoveInteraction,c).onMouseDown(a,b),a.hasActivated=!0):(a=c.getControllerAt(a.location),void 0==a||a instanceof JSG.graph.controller.GraphController||(this._possibleDragMove=!0))}};
JSG.graph.interaction.MoveActivator.prototype.onMouseDrag=function(a,b,c){!1===this.isDisposed&&!0===this._possibleDragMove&&(c=this.activateInteraction(new JSG.graph.interaction.MoveInteraction,c),c.onMouseDown(a,b),c.onMouseDrag(a,b),a.hasActivated=!0)};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.MarqueeActivator=function(a){JSG.graph.interaction.MarqueeActivator._super.constructor.apply(this,arguments);this._newSelected=!1};JSG.extend(JSG.graph.interaction.MarqueeActivator,JSG.graph.interaction.InteractionActivator);
JSG.graph.interaction.MarqueeActivator.KEY="marquee.activator";JSG.graph.interaction.MarqueeActivator.prototype.getKey=function(){return JSG.graph.interaction.MarqueeActivator.KEY};JSG.graph.interaction.MarqueeActivator.prototype.dispose=function(a){JSG.graph.interaction.MarqueeActivator._super.dispose.call(this,a);this._newSelected=!1};
JSG.graph.interaction.MarqueeActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed&&void 0==c.getActiveHandle()){var d=this.getController(a,b,c);this._newSelected=this._isNewSelection(d,b);d instanceof JSG.graph.controller.GraphController?(b.clearSelection(),this.activateInteraction(new JSG.graph.interaction.MarqueeInteraction,c).onMouseDown(a,b),a.hasActivated=!0):void 0!=d&&this._setSelection(d,a,b)}};
JSG.graph.interaction.MarqueeActivator.prototype._isNewSelection=function(a,b){var c=b.getSelection();return void 0!=c&&1===c.length?c[0]!=a:!0};JSG.graph.interaction.MarqueeActivator.prototype._setSelection=function(a,b,c){c.getSelectionProvider().hasSelection()?(b.isPressed(JSG.ui.events.KeyType.CTRL)||b.isPressed(JSG.ui.events.KeyType.SHIFT))&&c.hasSelection()?this._setMultiSelection(a,c):this._setSingleSelection(a,c):this._setSingleSelection(a,c)};
JSG.graph.interaction.MarqueeActivator.prototype._setSingleSelection=function(a,b){a=this._checkSelectedController(a,b);if(!a.isSelected()){b.clearSelection(!1);var c=b.getSelectionView(),d=0,e=a.getModel();JSG.graph.Utils.traverseItemUp(e,e.getGraph(),function(a){d+=a.getAngle().getValue()});c.setRotationAngle(d);b.select(a)}};
JSG.graph.interaction.MarqueeActivator.prototype._checkSelectedController=function(a,b){var c=a.getModel();if(c instanceof JSG.graph.model.TextNode){var d=c.getParent(),e=a.getParent(),f=d.getBoundingBox(JSG.boxCache.get()),c=c.getTranslatedBoundingBox(d.getParent(),JSG.boxCache.get());f.doesIntersectWith(c)&&!e.isSelected()&&(a=e)}return a};
JSG.graph.interaction.MarqueeActivator.prototype._setMultiSelection=function(a,b){a=this._checkSelectedController(a,b);if(!this._hasSelectedParent(a)){for(var c=b.getSelectionProvider(),d=[],e=c.getSelection(),f=0;f<e.length;f++)this._hasSelectedParent(e[f],a)||d.push(e[f]);d.push(a);c.setSelection(d)}};JSG.graph.interaction.MarqueeActivator.prototype._hasSelectedParent=function(a,b){var c=a.getParent();return void 0==c?!1:c.isSelected()||c===b?!0:this._hasSelectedParent(c)};
JSG.graph.interaction.MarqueeActivator.prototype.onMouseUp=function(a,b,c){if(!1===this.isDisposed&&a.isInCanvas()){var d=c.getControllerAt(a.location),e=b.getSelectionProvider();e.hasSingleSelection()&&(e.getFirstSelection(),d=this.getController(a,b,c));!d||(d.isSelected()||d instanceof JSG.graph.controller.GraphController)||this._setSelection(d,a,b)}};
JSG.graph.interaction.MarqueeActivator.prototype.getController=function(a,b,c){if(a instanceof JSG.ui.events.MouseEvent){if(a.type==JSG.ui.events.MouseEventType.DOWN)return a=c.getControllerAt(a.location,JSG.graph.controller.FindFlags.AREA,this._condition),this._checkParent(a);if(a.type==JSG.ui.events.MouseEventType.UP)return this.findController(c.currentLocation.copy(),a,b)}return c.getControllerAt(a.location)};
JSG.graph.interaction.MarqueeActivator.prototype._condition=function(a,b){return a.isSelectable()&&a.containsPoint(b,JSG.graph.controller.FindFlags.AUTOMATIC)};JSG.graph.interaction.MarqueeActivator.prototype._checkParent=function(a){if(a&&!(a instanceof JSG.graph.controller.GraphController)){var b=a.getParent(),c=b.getModel().getType().getValue();if(!b.isSelected()&&("bpmnpool"==c||"bpmnlane"==c))return b}return a};
JSG.graph.interaction.MarqueeActivator.prototype.findController=function(a,b,c){function d(a){if(a instanceof JSG.graph.controller.GraphController||!b.event.altKey&&!a.isSelectable())return!1;if(a===l)return void 0!=e;e=a;return!1}var e=void 0,f=c.getSelection(),g=c.getSelectionView(),l=void 0!=f&&1===f.length?f[0]:void 0;return!1===this._newSelected&&void 0!=l&&g.containsPoint(a)?(c.findControllerAt(b.location,JSG.graph.controller.FindFlags.AUTOMATIC,d),void 0!=e?e:l):l};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.EditTextActivator=function(){JSG.graph.interaction.EditTextActivator._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.EditTextActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.EditTextActivator.KEY="edittext.activator";JSG.graph.interaction.EditTextActivator.prototype.getKey=function(){return JSG.graph.interaction.EditTextActivator.KEY};JSG.graph.interaction.EditTextActivator.prototype.onResizeCanvas=function(a,b,c,d){return!1};
JSG.graph.interaction.EditTextActivator.prototype.onMouseDown=function(a,b,c){if(!1===this.isDisposed){var d=c.getActiveHandle();(void 0!=d?d.getType():void 0)==JSG.graph.interaction.LinkHandle.TYPE.EDIT&&this._startEditTextInteraction(a,b,c,d.getController())}};
JSG.graph.interaction.EditTextActivator.prototype.onMouseDoubleClick=function(a,b,c){if(!1===this.isDisposed&&!a.isConsumed){var d=c.getControllerAt(a.location,void 0,this._dblclickCondition),d=this._getTextNodeController(c,d);void 0!=d&&(b.clearSelection(!1),b.select(d.getParent()),this._startEditTextInteraction(a,b,c,d))}};JSG.graph.interaction.EditTextActivator.prototype._dblclickCondition=function(a){return a instanceof JSG.graph.controller.GraphController?!1:a.isSelectable()};
JSG.graph.interaction.EditTextActivator.prototype.onKeyDown=function(a,b,c){if(113===a.event.keyCode){var d=b.getSelection();void 0!=d&&1==d.length&&(d=this._getTextNodeController(c,d[0]),void 0!=d&&this._startEditTextInteraction(a,b,c,d))}};
JSG.graph.interaction.EditTextActivator.prototype._getTextNodeController=function(a,b){if(void 0!=b){var c=b.getModel();if(!(c instanceof JSG.graph.model.TextNode)){var d=c.getTextSubItem();void 0==d&&c.isAddLabelAllowed()&&(a.getInteractionHandler().execute(new JSG.graph.command.AddLabelCommand(c,"Label")),d=c.getTextSubItem());b=void 0!=d?b.getModelController(d):void 0}}return b};
JSG.graph.interaction.EditTextActivator.prototype._startEditTextInteraction=function(a,b,c,d){this._isEditable(d)&&(c=this.activateInteraction(new JSG.graph.interaction.EditTextInteraction,c),c.setController(d),c.startEdit(d,a,b),a.hasActivated=!0)};JSG.graph.interaction.EditTextActivator.prototype._isEditable=function(a){a=void 0!=a?a.getModel().getItemAttributes():void 0;return void 0!=a?!a.hasEditMask(JSG.graph.attr.consts.EditMask.LABEL):!1};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.DragDropActivator=function(){JSG.graph.interaction.DragDropActivator._super.constructor.apply(this,arguments);this._controller=void 0};JSG.extend(JSG.graph.interaction.DragDropActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.DragDropActivator.prototype.getTargetEditor=function(){};
JSG.graph.interaction.DragDropActivator.prototype.dispose=function(a){JSG.graph.interaction.DragDropActivator._super.dispose.call(this,a);JSG.keepFocus=!1;this._controller=void 0};JSG.graph.interaction.DragDropActivator.prototype.onMouseDown=function(a,b,c){!1===this.isDisposed&&(JSG.keepFocus=!0,a=c.getControllerAt(a.location),void 0==a||a instanceof JSG.graph.controller.GraphController||((c=this.getTargetEditor())&&(c=c.getGraphViewer())&&c.clearSelection(),b.clearSelection(),this._controller=a))};
JSG.graph.interaction.DragDropActivator.prototype.onMouseUp=function(a,b,c){!1===this.isDisposed&&(JSG.keepFocus=!1)};JSG.graph.interaction.DragDropActivator.prototype.onMouseDrag=function(a,b,c){if(!1===this.isDisposed){var d=void 0!=this._controller?this._controller.getModel():void 0,e=this.getTargetEditor();if(void 0!=d&&void 0!=e){var f=e.getGraphViewer();c=this.activateInteraction(this.createInteraction(b,f),c);c.setDraggedItem(d);c.registerTargetEditor(e);c.onMouseDown(a,b)}}};
JSG.graph.interaction.DragDropActivator.prototype.createInteraction=function(a,b){return new JSG.graph.interaction.DragDropInteraction(a,b)};JSG.namespace("JSG.graph.interaction");JSG.graph.interaction.LinkActivator=function(){this._link=void 0;JSG.graph.interaction.LinkActivator._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.LinkActivator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.LinkActivator.KEY="link.activator";
JSG.graph.interaction.LinkActivator.prototype.getKey=function(){return JSG.graph.interaction.LinkActivator.KEY};JSG.graph.interaction.LinkActivator.prototype.dispose=function(a){JSG.graph.interaction.LinkActivator._super.dispose.call(this,a)};JSG.graph.interaction.LinkActivator.prototype.onKeyDown=function(a,b,c){this.onMouseMove(a,b,c)};
JSG.graph.interaction.LinkActivator.prototype.onMouseMove=function(a,b,c){this._reference=this._link=void 0;this.isExecuteEvent(a)&&(b=this._getControllerAt(a.location,c),void 0!=b&&(b=b.getModel().getLink().getValue())&&b.length&&(this._link=b,c.setCursor(JSG.ui.Cursor.Style.EXECUTE),a.isConsumed=!0,a.hasActivated=!0))};
JSG.graph.interaction.LinkActivator.prototype._getControllerAt=function(a,b){var c=b.getControllerAt(a);if(void 0!=c&&!(c instanceof JSG.graph.controller.GraphController))return c.getModel()instanceof JSG.graph.model.TextNode&&(c=c.getParent()),c};
JSG.graph.interaction.LinkActivator.prototype.onMouseUp=function(a,b,c){this._link&&(a.isConsumed=!0,a.hasActivated=!0,-1!=this._link.search("file:")||-1!=this._link.search("code:")?(a=this._getControllerAt(a.location,c),c.getInteractionHandler().executeLink(a)):-1==this._link.search("http://")?window.open("http://"+this._link,"_blank"):window.open(this._link,"_blank"))};JSG.graph.interaction.LinkActivator.prototype.isExecuteEvent=function(a){return a&&!a.isPressed(JSG.ui.events.KeyType.CTRL)};JSG.namespace("JSG.graph.layout");
JSG.graph.layout.LayoutManager=function(){};JSG.graph.layout.LayoutManager.prototype.createLayoutFromString=function(a){};JSG.graph.layout.LayoutManager.prototype.createConstraintsForLayout=function(a){};JSG.graph.layout.LayoutManager.prototype.getLayoutStrings=function(){};JSG.graph.layout.LayoutManager.prototype.getLayoutModel=function(a){};JSG.graph.layout.LayoutManager.prototype.getLayoutIndex=function(a,b,c,d,e,f){};JSG.graph.layout.LayoutManager.prototype.applyLayoutResult=function(a,b){};
JSG.graph.layout.LayoutManager.prototype.isLayoutDesired=function(a,b){return!0};JSG.graph.layout.LayoutManager.prototype.isSortDesired=function(a,b){return!0};JSG.touchDevice=!!("ontouchstart"in window)||!!("msmaxtouchpoints"in window.navigator);JSG.isFF="undefined"!==typeof InstallTrigger;
JSG.browserVersion=function(){var a=navigator.userAgent,b,c=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(c[1]))return b=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],"IE "+(b[1]||"");c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(b=a.match(/version\/([\.\d]+)/i))&&(c[2]=b[1]);return c}();JSG.canvasSupported=!!window.HTMLCanvasElement;JSG.bkColorHeader="#F3F3F3";JSG.bkColorScroll="#F3F3F3";JSG.bkColorGraph="#DDDDDD";
JSG.bkColorButton="#CCCCCC";JSG.bkColorNavigator="#F3F3F3";JSG.bkColorShapeLibrary="#FFFFFF";JSG.fontColorShapeLibrary="#000000";JSG.bkColorShapeLibraryTitle="#DDDDDD";JSG.fontColorShapeLibraryTitle="#000000";JSG.findRadius=JSG.touchDevice?600:300;JSG.portFindRadius=JSG.touchDevice?400:200;JSG.snapRadius=300;JSG.keepFocus=!1;JSG.canvasCache=!0;JSG.colors="FFFFFF 000000 222222 444444 666666 888888 AAAAAA CCCCCC EEEEEE 660000 663300 996633 003300 003333 003399 000066 330066 660066 990000 993300 CC9900 006600 336666 0033FF 000099 660099 990066 CC0000 CC3300 FFCC00 009900 006666 0066FF 0000CC 663399 CC0099 FF0000 FF3300 FFFF00 00CC00 009999 0099FF 0000FF 9900CC FF0099 CC3333 FF6600 FFFF33 00FF00 00CCCC 00CCFF 3366FF 9933FF FF00FF FF6666 FF6633 FFFF66 66FF66 66CCCC 00FFFF 3399FF 9966FF FF66FF FF9999 FF9966 FFFF99 99FF99 66FFCC 99FFFF 66CCFF 9999FF FF99FF FFCCCC FFCC99 FFFFCC CCFFCC 99FFCC CCFFFF 99CCFF CCCCFF FFCCFF".split(" ");
JSG.MIN_WIDTH_HEIGHT=50;JSG.imagePool=new JSG.commons.ImagePool;JSG.fontMetricsCache=new JSG.commons.Map;JSG.clipXML=void 0;JSG.clipOffset=new JSG.geometry.Point(200,200);JSG.clipFormat=void 0;JSG.clipTextFormat=void 0;JSG.connectionRestorer=void 0;JSG.graphItemFactory=new JSG.graph.model.GraphItemFactory;JSG.layoutFactory=new JSG.graph.layout.LayoutManager;JSG.defaultEdgeType="edge";
JSG.getDpi=function(){var a=document.createElement("div");a.setAttribute("id","TestDiv");a.setAttribute("style","height: 1in; left: -100%; position: absolute; top: -100%; width: 1in;");document.body.appendChild(a);var b=new JSG.geometry.Point(a.offsetWidth,a.offsetHeight);document.body.removeChild(a);return b};JSG.dpi=JSG.getDpi();JSG.graphics=new JSG.ui.graphics.ScalableGraphics(document.createElement("canvas"),new JSG.ui.graphics.MetricCoordinateSystem);JSG.drawingDisabled=!1;
JSG.propertyEventsDisabled=!1;JSG.DRAW_DISABLED_NOTIFICATION="jsg.draw.disabled.notification";JSG.setDrawingDisabled=function(a){a!==JSG.drawingDisabled&&(JSG.drawingDisabled=a,JSG.graph.notifications.NotificationCenter.getInstance().send(new JSG.graph.notifications.Notification(JSG.DRAW_DISABLED_NOTIFICATION,this)))};JSG.setPropertyEventsDisabled=function(a){JSG.propertyEventsDisabled=a};
JSG.copyItems=function(a){var b=new JSG.commons.XMLWriter("UTF-8","1.0");b.writeStartDocument();b.writeStartElement("clip");if(void 0==a.length)a.getModel().resolveParentReferences(!0),a.getModel().saveXML(b,!0);else for(var c=0,d=a.length;c<d;c++)a[c].getModel().resolveParentReferences(!0),a[c].getModel().saveXML(b,!0);b.writeEndElement();b.writeEndDocument();this.debug.log(b.flush());return b.flush()};
JSG.url=function(a){a=document.getElementsByTagName("script");a=a[a.length-1];a=void 0!==a.getAttribute.length?a.src:a.getAttribute("src",-1);return a.substring(0,a.lastIndexOf("/"))}();
JSG.init=function(a){JSG.imagePool.add(a+"/res/images/"+JSG.commons.ImagePool.IMG_NOTAVAIL+".png",JSG.commons.ImagePool.IMG_NOTAVAIL);JSG.imagePool.add(a+"/res/images/"+JSG.commons.ImagePool.IMG_EXPANDED+".png",JSG.commons.ImagePool.IMG_EXPANDED);JSG.imagePool.add(a+"/res/images/"+JSG.commons.ImagePool.IMG_COLLAPSED+".png",JSG.commons.ImagePool.IMG_COLLAPSED);JSG.ui.Cursor.Style.CROSS="url("+a+"/res/cross.cur), crosshair";JSG.ui.Cursor.Style.ROTATE="url("+a+"/res/rotate.cur), move"};
JSG.throwException=function(a,b){throw{name:a,message:b,toString:function(){return this.name+": "+this.message}};};JSG.debug={};JSG.debug._isActive=!1;JSG.debug.SHOW_BBOX_POINTS=JSG.debug._isActive&&!1;JSG.debug.SHOW_LINE_BBOX=JSG.debug._isActive&&!1;JSG.debug.SHOW_LINE_ORIGIN=!1;JSG.debug.DUMP_ITEM_ID=!1;JSG.debug.DRAW_ITEM_PORTS=JSG.debug._isActive&&!1;JSG.debug.DRAW_ITEM_CENTER=JSG.debug._isActive&&!1;JSG.debug.DUMP_LAYOUT_MODEL=JSG.debug._isActive&&!1;JSG.debug.DEBUG_ORTHO=!1;
JSG.debug.DUMP_CACHE_COUNTS=!1;JSG.debug.DUMP_CACHE_SIZE=!1;JSG.debug.USE_DOC_DISPATCHER=!0;JSG.debug.SCROLLVIEW_TEST=!1;JSG.debug.USE_NEW_FORMULA_PARSER=!1;JSG.ptCnt=0;JSG.rectCnt=0;JSG.bboxCnt=0;JSG.debug.log=function(a,b){"undefined"!=typeof console&&(void 0!=b?!0===b&&console.log(a):JSG.debug._isActive&&console.log(a))};JSG.debug.info=function(a){JSG.debug._isActive&&"undefined"!=typeof console&&(console.info?console.info(a):console.log&&console.log(a))};
JSG.debug.logPoint=function(a,b,c){a=JSG.ptCache.get(a.x,a.y);JSG.graph.Utils.translatePointUp(a,b,b.getGraph());JSG.debug.log((void 0!=c?c:"")+a.toString(),!0);JSG.ptCache.release(a)};JSG.debug.performance=function(a,b,c){for(var d=(new Date).getTime(),e=0;e<b;e++)a();a=(new Date).getTime()-d;void 0!=c&&JSG.debug.log(c+": "+a+"ms");return a};JSG.tests={};
JSG.tests.runSuite=function(){var a=JSG.debug._isActive;JSG.debug._isActive=!0;var b=JSG.debug;b.log("run runTestSuite...");JSG.tests.runAttributeTests(b);JSG.debug._isActive=a;alert("Tests finished! Look at console output...")};
JSG.tests.runAttributeTests=function(a){function b(b,c){var d=c.getAttributeAtPath(b);void 0!=d?(a.log("attribute: "+d.getName()),a.log("\tpath: "+d.getPath()),a.log("\tvalue: "+d.getValue().getValue())):a.log("attribute with path '"+b+"' not found!!")}function c(b,d){a.log(d+"attribute name: "+b.getName());var e=b.getValue();if(b instanceof JSG.graph.model.attributes.AttributeList)for(var e=e.getValue(),f=0;f<e.length;f++)c(e[f],d+"\t");else a.log(d+"attribute value: "+e.getValue())}function d(a){var b=
new JSG.graph.expr.MapExpression;b.putElement("de","Deutsch");b.putElement("en","English");b.getValue=function(){return b.getElement(JSG.tests.currentLang)};return new JSG.graph.model.attributes.Attribute(a,b)}function e(){JSG.tests.currentLang="en"===JSG.tests.currentLang?"de":"en"}var f=new JSG.graph.model.Node,g=JSG.graph.expr.NumberExpression;f.addAttribute(new JSG.graph.model.attributes.Attribute("attr1",new g(42)));var l=f.addAttribute(new JSG.graph.model.attributes.AttributeList("BIC")),h=
l.addAttribute(new JSG.graph.model.attributes.Attribute("attr2",new g(23))),g=f.addAttributeAtPath(l.getPath(),new JSG.graph.model.attributes.Attribute("attr3",new g(17)));a.log("ATTRIBUTE TESTs:");a.log("simple add/remove tests:");b("BIC",f);b("attr1",f);b("BIC:attr2",f);b(g.getPath(),f);a.log("add language dependent attribute to BIC");JSG.tests.currentLang="de";g=f.addAttributeAtPath("BIC",d("LANGATTR"));c(g,"\t");a.log("switch language to en");e();c(g,"\t");c(f.getAttributeAtPath("attributes"),
"");a.log("remove BIC:attr2...");f.removeAttributeAtPath(h.getPath());c(f.getAttributeAtPath("attributes"),"\t");a.log("remove BIC...");f.removeAttributeAtPath("BIC");c(f.getAttributeAtPath("attributes"),"\t");a.log("remove attr1...");f.removeAttributeAtPath("attr1");c(f.getAttributeAtPath("attributes"),"\t");a.log("- done simple-");a.log("formula reference tests:");l=f.addAttribute(new JSG.graph.model.attributes.AttributeList("BIC"));g=f.addAttributeAtPath("BIC",d("LANGATTR"));h=new JSG.graph.model.Graph;
h.addItem(f);l="Item."+f.getId()+"!bic:langattr";l=JSG.graph.expr.FormulaParser.parse(l,h);a.log("reference value: "+l.getValue());a.log("attribute value: "+g.getValue().getValue());a.log("switch language...");e();a.log("reference value: "+l.getValue());a.log("attribute value: "+g.getValue().getValue());h=h.addItem(new JSG.graph.model.Node);g=h.addAttribute(new JSG.graph.model.attributes.AttributeList("BIC"));l="Item."+f.getId()+"!format:fillstyle";l=new JSG.graph.expr.Expression(0,l);g=g.addAttribute(new JSG.graph.model.attributes.Attribute("bicfillstyle",
l));f=f.getAttributeAtPath("format:fillstyle");g.evaluate(h);a.log("bic fillstyle attr: "+g.getValue().getValue());a.log("node fillstyle attr: "+f.getValue().getValue());a.log("change target fillstyle...");f.setExpressionOrValue(JSG.graph.attr.FormatAttributes.FillStyle.PATTERN);a.log("\x3d\x3e node fillstyle attr: "+f.getValue().getValue());a.log("and \x3d\x3e bic fillstyle attr: "+g.getValue().getValue());a.log("- DONE -")};
JSG.tests.testIsString=function(a){var b=new String("hallo"),c=[];a.log("typeof str1: "+typeof b);a.log("typeof str2: string");a.log("typeof str3: "+typeof c);a.log("typeof str4: number");a.log("typeof str4: boolean");a.log("instanceof str1: "+(b instanceof String));a.log("instanceof str2: false");a.log("instanceof str3: "+(c instanceof String));a.log("instanceof str4: false");a.log("instanceof str5: false");a.log("isString str1: "+String.isString(b));a.log("isString str2: "+String.isString("hallo"));
a.log("isString str3: "+String.isString(c));a.log("isString str4: "+String.isString(1234));a.log("isString str5: "+String.isString(!1));a.log("isString undefined: "+String.isString(void 0));var c=JSG.debug.performance(function(){return void 0!=b&&"[object String]"==Object.prototype.toString.call(b)},1E6),d=JSG.debug.performance(function(){return"string"===typeof b||b instanceof String},1E6),e=JSG.debug.performance(function(){return void 0!=b&&isNaN(b)},1E6);a.log("checked String.isString: t1: "+c+
"ms  -\x3e  t2: "+d+"ms  -\x3e  t3: "+e+"ms")};
JSG.tests.runFormulaParserTests=function(a){function b(b,d,g){b=c(b);d=c(d);a.log(b==d?"OK":"ERROR: "+g)}function c(a){a=a.replace(/\s+/g,"");a=a.replace(/\(+/g,"");a.replace(/\)+/g,"")}a.log("RUN FormularParser TESTs....");var d=[];d.push("Y / 2 + Y / 2 * -0.97 * (1 - X * 2)");d.push("Y / 2 + Y / 2 * -0.97");d.push("Y / 2 * -0.97");d.push("2 * -0.97");d.push("(x-1)*-2");d.push("(1 - DEPTH * 2)");(function(c){var d=JSG.graph.expr.FormulaParser;c.forEach(function(c){var e=d.parse(c);a.log("parsed: "+
c);b(c,e.toString(),"parsing failed")})})(d);d=[];d.push('"http://linktome.de"');d.push('"http://localhost/jsg/JSG/js-src/jsgDemo/index.html"');d.push('"http://msdn.microsoft.com/en-us/library/ie/gg699341.aspx"');d.push('"http://blabla.de/?utm_source\x3dfeedburner\x26utm_campaign\x3dFeed%3A+blub%2FdqXM+%28\x26utm_content"');(function(c){var d=JSG.graph.expr.FormulaParser;c.forEach(function(c){var e=d.parse(c);a.log("parsed: "+c);b(c,e.toString(),"parsing failed")})})(d);a.log("FormularParser TESTs - DONE")};
JSG.tests.runNumberEqualTests=function(a){var b=JSG.debug.performance(function(){return!1},1E6),c=JSG.debug.performance(function(){return!1},1E6),d=JSG.debug.performance(function(){return(1000.12).isEqual(1000.2,0.1)},1E6);a.log("checked isEqual \x3d\x3e old: "+b+"ms  -\x3e  old2: "+c+"ms  -\x3e  new: "+d+"ms")};
JSG.tests.runToPointTests=function(a){var b=JSG.graph.Coordinate.fromXY(10,10),c=JSG.debug.performance(function(){b.toPoint()},1E6),d=JSG.debug.performance(function(){10===b.getX().getValue()&&b.getY().getValue()},1E6),e=JSG.debug.performance(function(){10===b.getX().getValue()&&b.getY().getValue()},1E6);a.log("checked toPoint \x3d\x3e t1: "+c+"ms  -\x3e  t2: "+d+"ms  -\x3e  t3: "+e+"ms")};
JSG.tests.runForLoopTests=function(a){for(var b=[],c=0;1E6>c;c++)b.push(c);var c=JSG.debug.performance(function(){for(var a=0;a<b.length;a++);},1),d=JSG.debug.performance(function(){for(var a=0,c=b.length;a<c;a++);},1),e=JSG.debug.performance(function(){for(var a=0;a<b.length;a++);},1),f=JSG.debug.performance(function(){for(var a=0;a<b.length;a++);},1),g=JSG.debug.performance(function(){b.forEach(function(a){})},1),l=JSG.debug.performance(function(){b.forEach(function(a){})},1);a.log("traversal \x3d\x3e t1: "+
c+"ms  -\x3e  t2: "+d+"ms  -\x3e  t3: "+e+"ms  -\x3e  t4: "+f+"ms");a.log("traversal for each \x3d\x3e t5: "+g+"ms  -\x3e  t6: "+l+"ms")};
JSG.tests.runArrayKeepTests=function(a){for(var b=[],c=[],d=0;2E3>d;d++)b.push(JSG.geometry.Point.Factory());for(d=0;500>d;d++)c.push(JSG.geometry.Point.Factory());var d=JSG.debug.performance(function(){[].keep(1E3,JSG.geometry.Point.Factory)},1E3),e=JSG.debug.performance(function(){b.keep(1E3,JSG.geometry.Point.Factory)},1E3),f=JSG.debug.performance(function(){c.keep(1E3,JSG.geometry.Point.Factory)},1E3),g=JSG.debug.performance(function(){for(var a=[],b=0;2E3>b;b++)a.push(JSG.geometry.Point.Factory())},
1E3);a.log("keep \x3d\x3e empty: "+d+"ms  -\x3e  bigger: "+e+"ms  -\x3e  smaller: "+f+"ms  -\x3e  simple: "+g+"ms")};JSG.tests.runStringNumberCompareTests=function(a){var b=JSG.debug.performance(function(){for(var a=0;1E6>a;a++);},1),c=JSG.debug.performance(function(){for(var a=0;1E6>a;a++);},2);a.log("compare \x3d\x3e string: "+b+"ms  -\x3e  number: "+c+"ms")};
JSG.tests.runExpressionCopyTests=function(a){var b=new JSG.graph.expr.Expression,c=new JSG.graph.expr.NumberExpression(256,"2 * 150");c.evaluate();var d=JSG.debug.performance(function(){c.copy()},1E6),e=JSG.debug.performance(function(){(new JSG.graph.expr.NumberExpression(256,"2 * 150")).setTo(c)},1E6),f=JSG.debug.performance(function(){c.getValue()},1E6),g=JSG.debug.performance(function(){c.getValue();c.getFormula()},1E6),l=JSG.debug.performance(function(){b.setValue(c.getValue());b.setFormula(c.getFormula())},
1E6);a.log("nr expr \x3d\x3e copy: "+d+"ms  -\x3e  create: "+e+"ms  -\x3e  getValue: "+f+"ms  -\x3e  createEventObj: "+g+"ms -\x3e  setGlobalExpr: "+l+"ms")};
JSG.tests.runArrayCopyTests=function(a){function b(b,c,d,l,h){a.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");a.log("src: "+b.toString());a.log("dest: "+d.toString());a.log("\x3d\x3e arraycopy(src, "+c+", dest, "+l+", "+h+")");JSG.arraycopy(b,c,d,l,h);a.log("dest: "+d.toString())}var c=[],d=[],c="ABCDEF".split("");b(c,0,d,0,6);d=[0,1,2,3,4,5];b(c,0,d,4,6);d=[0,1,2,3,4,5];b(c,0,d,6,6);d=[0,1,2,3,4,5];b(c,6,d,6,6);d=[0,1,2,3,4,5];b(c,1,d,6,6)};JSG.namespace("JSG.graph.properties");
JSG.graph.properties.Property=function(a,b,c){this.id=a;this.getter=b;this.setter=c;this.value="";this.numeration=void 0};JSG.graph.properties.Property.prototype.copy=function(){var a=new JSG.graph.properties.Property(this.id,this.getter,this.setter);a.value=this.value;return a};JSG.graph.properties.Property.prototype.getValue=function(){if(this.getter){var a=Array.prototype.slice.call(arguments),b=a.shift();return this._callFunction(this.getter,a,b)}return this.value};
JSG.graph.properties.Property.prototype.setValue=function(a,b){this.setter?(b=Array.prototype.slice.call(arguments),a=b.shift(),this._callFunction(this.setter,b,a)):this.value=b};JSG.graph.properties.Property.prototype._callFunction=function(a,b,c){if(void 0!=a)return(String.isString(a)?c[a]:a).apply(c,b)};JSG.graph.properties.Property.prototype.setCategory=function(a){this.category=a};JSG.graph.properties.Property.prototype.getCategory=function(){return this.category};
JSG.graph.properties.IndexProperty=function(a,b,c,d){JSG.graph.properties.IndexProperty._super.constructor.call(this,a,b,c);this.index=d};JSG.extend(JSG.graph.properties.IndexProperty,JSG.graph.properties.Property);JSG.graph.properties.IndexProperty.prototype.copy=function(){var a=new JSG.graph.properties.IndexProperty(this.id,this.getter,this.setter,this.index);a.value=this.value;return a};
JSG.graph.properties.IndexProperty.prototype._callFunction=function(a,b,c){b.unshift(this.index);return JSG.graph.properties.IndexProperty._super._callFunction.call(this,a,b,c)};JSG.graph.properties.AttributeProperty=function(a){JSG.graph.properties.AttributeProperty._super.constructor.call(this,a);this.path=a};JSG.extend(JSG.graph.properties.AttributeProperty,JSG.graph.properties.Property);
JSG.graph.properties.AttributeProperty.copy=function(){var a=new JSG.graph.properties.AttributeProperty(this.path);a.value=this.value;return a};JSG.graph.properties.AttributeProperty.prototype.getValue=function(){var a=Array.prototype.slice.call(arguments).shift().getAttributeAtPath(this.path);return void 0!=a?a.getExpression():this.value};
JSG.graph.properties.AttributeProperty.prototype.setValue=function(a,b){b=Array.prototype.slice.call(arguments);a=b.shift();var c=b.shift();a.setAttributeAtPath(this.path,c);this.value=c};JSG.namespace("JSG.graph.properties");JSG.graph.properties.Properties=function(){this._properties=new JSG.commons.Map};JSG.graph.properties.Properties.prototype.addProperty=function(a,b,c,d){a=new JSG.graph.properties.Property(a,b,c,d);this._properties.put(a.id,a);return a};
JSG.graph.properties.Properties.prototype.addIndexProperty=function(a,b,c,d){a=new JSG.graph.properties.IndexProperty(a,b,c,d);this._properties.put(a.id,a);return a};JSG.graph.properties.Properties.prototype.getProperty=function(a){return this._properties.get(a)};JSG.graph.properties.Properties.prototype.getPropertiesMap=function(){return this._properties};JSG.graph.properties.Properties.prototype.size=function(){return this._properties.size()};JSG.graph.properties.Properties.prototype.clear=function(){return this._properties.clear()};
JSG.graph.properties.Properties.prototype.getAllProperties=function(a){return this._properties.elements()};JSG.graph.properties.Properties.prototype.copy=function(){var a=new JSG.graph.properties.Properties;this._properties.iterate(function(b,c){a._properties.put(b,c.copy())});return a};JSG.namespace("JSG.graph.properties");
JSG.graph.properties.GraphItemProperties=function(){JSG.graph.properties.GraphItemProperties._super.constructor.apply(this,arguments);var a=JSG.graph.properties.GraphItemProperties;a.ID=this.addProperty("ID","getId");a.LAYER=this.addProperty("LAYER","getLayer","setLayer");a.TYPE=this.addProperty("TYPE","getType","setType");a.LINK=this.addProperty("LINK","getLink","setLink");a.ANGLE=this.addProperty("ANGLE","getAngle","setAngle");a.WIDTH=this.addProperty("WIDTH","getWidth","setWidth");a.HEIGHT=this.addProperty("HEIGHT",
"getHeight","setHeight");a.ORIGIN=this.addProperty("ORIGIN","getOrigin","setOriginTo");a.ORIGIN_X=this.addProperty("ORIGIN_X",a.getOriginX,a.setOriginX);a.ORIGIN_Y=this.addProperty("ORIGIN_Y",a.getOriginY,a.setOriginY);a.PIN_X=this.addProperty("PIN_X",a.getPinX,a.setPinX);a.PIN_Y=this.addProperty("PIN_Y",a.getPinY,a.setPinY);a.LOCALPIN_X=this.addProperty("LOCALPIN_X",a.getLocalPinX,a.setLocalPinX);a.LOCALPIN_Y=this.addProperty("LOCALPIN_Y",a.getLocalPinY,a.setLocalPinY)};
JSG.extend(JSG.graph.properties.GraphItemProperties,JSG.graph.properties.Properties);JSG.graph.properties.GraphItemProperties.getPinX=function(){return this._pin.getX()};JSG.graph.properties.GraphItemProperties.getPinY=function(){return this._pin.getY()};JSG.graph.properties.GraphItemProperties.setPinX=function(a){this._pin.setX(a)};JSG.graph.properties.GraphItemProperties.setPinY=function(a){this._pin.setY(a)};JSG.graph.properties.GraphItemProperties.getLocalPinX=function(){return this._pin.getLocalX()};
JSG.graph.properties.GraphItemProperties.getLocalPinY=function(){return this._pin.getLocalY()};JSG.graph.properties.GraphItemProperties.setLocalPinX=function(a){this._pin.setLocalX(a)};JSG.graph.properties.GraphItemProperties.setLocalPinY=function(a){this._pin.setLocalY(a)};JSG.graph.properties.GraphItemProperties.getOriginX=function(){return this.getOrigin().x};JSG.graph.properties.GraphItemProperties.getOriginY=function(){return this.getOrigin().y};
JSG.graph.properties.GraphItemProperties.setOriginX=function(a){var b=this.getOrigin();b.x=a;this.setOriginTo(b)};JSG.graph.properties.GraphItemProperties.setOriginY=function(a){var b=this.getOrigin();b.y=a;this.setOriginTo(b)};JSG.graph.properties.GraphItemProperties.getReshapePointX=function(a){a=void 0!=a?a:0;if(a<this._reshapeCoordinates.length)return this._reshapeCoordinates[a].getX()};JSG.graph.properties.GraphItemProperties.getReshapePointY=function(a){a=void 0!=a?a:0;if(a<this._reshapeCoordinates.length)return this._reshapeCoordinates[a].getY()};
JSG.graph.properties.GraphItemProperties.setReshapePointX=function(a,b){a=void 0!=a?a:0;a<this._reshapeCoordinates.length&&this.setReshapeCoordinateAt(a,b,void 0)};JSG.graph.properties.GraphItemProperties.setReshapePointY=function(a,b){a=void 0!=a?a:0;a<this._reshapeCoordinates.length&&this.setReshapeCoordinateAt(a,void 0,b)};JSG.namespace("JSG.graph.properties");
JSG.graph.properties.AttributeProperties=function(){JSG.graph.properties.AttributeProperties._super.constructor.apply(this,arguments);var a=JSG.graph.properties.AttributeProperties;a.CLIPCHILDREN=this.addProperty("CLIPCHILDREN","getClipChildren","setClipChildren");a.CLOSED=this.addProperty("CLOSED","getClosed","setClosed");a.COLLAPSABLE=this.addProperty("COLLAPSABLE","getCollapsable","setCollapsable");a.COLLAPSED=this.addProperty("COLLAPSED","getCollapsed","setCollapsed");a.COLLAPSEDBUTTON=this.addProperty("COLLAPSEDBUTTON",
"getCollapsedButton","setCollapsedButton");a.COMBINED=this.addProperty("COMBINED","getCombined","setCombined");a.CONTAINER=this.addProperty("CONTAINER","getContainer","setContainer");a.DELETEABLE=this.addProperty("DELETEABLE","getDeleteable","setDeleteable");a.LEFTMARGIN=this.addProperty("LEFTMARGIN","getLeftMargin","setLeftMargin");a.RIGHTMARGIN=this.addProperty("RIGHTMARGIN","getRightMargin","setRightMargin");a.TOPMARGIN=this.addProperty("TOPMARGIN","getTopMargin","setTopMargin");a.BOTTOMMARGIN=
this.addProperty("BOTTOMMARGIN","getBottomMargin","setBottomMargin");a.MOVEABLE=this.addProperty("MOVEABLE","getMoveable","setMoveable");a.PORTMODE=this.addProperty("PORTMODE","getPortMode","setPortMode");a.ROTATABLE=this.addProperty("ROTATABLE","getRotatable","setRotatable");a.SELECTIONMODE=this.addProperty("SELECTIONMODE","getSelectionMode","setSelectionMode");a.SNAPTO=this.addProperty("SNAPTO","getSnapTo","setSnapTo");a.SIZEABLE=this.addProperty("SIZEABLE","getSizeable","setSizeable");a.VISIBLE=
this.addProperty("VISIBLE","getVisible","setVisible")};JSG.extend(JSG.graph.properties.AttributeProperties,JSG.graph.properties.Properties);JSG.namespace("JSG.graph.properties");
JSG.graph.properties.ItemAttributesProperties=function(){JSG.graph.properties.ItemAttributesProperties._super.constructor.apply(this,arguments);var a=JSG.graph.attr.ItemAttributes,b=JSG.graph.properties.ItemAttributesProperties;b.CLIPCHILDREN=this.addProperty(a.CLIPCHILDREN);b.CLOSED=this.addProperty(a.CLOSED);b.COLLAPSABLE=this.addProperty(a.COLLAPSABLE);b.COLLAPSED=this.addProperty(a.COLLAPSED);b.COLLAPSEDBUTTON=this.addProperty(a.COLLAPSEDBUTTON);b.COMBINED=this.addProperty(a.COMBINED);b.CONTAINER=
this.addProperty(a.CONTAINER);b.DELETEABLE=this.addProperty(a.DELETEABLE);b.MARGINLEFT=this.addProperty(a.MARGINLEFT);b.MARGINRIGHT=this.addProperty(a.MARGINRIGHT);b.MARGINTOP=this.addProperty(a.MARGINTOP);b.MARGINBOTTOM=this.addProperty(a.MARGINBOTTOM);b.MOVEABLE=this.addProperty(a.MOVEABLE);b.PORTMODE=this.addProperty(a.PORTMODE);b.ROTATABLE=this.addProperty(a.ROTATABLE);b.SELECTIONMODE=this.addProperty(a.SELECTIONMODE);b.SNAPTO=this.addProperty(a.SNAPTO);b.SIZEABLE=this.addProperty(a.SIZEABLE);
b.VISIBLE=this.addProperty(a.VISIBLE)};JSG.extend(JSG.graph.properties.ItemAttributesProperties,JSG.graph.properties.Properties);JSG.graph.properties.ItemAttributesProperties.prototype.addProperty=function(a){a=new JSG.graph.properties.AttributeProperty(JSG.graph.attr.AttributeUtils.createPath(JSG.graph.attr.ItemAttributes.NAME,a));this._properties.put(a.id,a);return a};JSG.namespace("JSG.graph.properties");
JSG.graph.properties.LayoutAttributeProperties=function(){JSG.graph.properties.LayoutAttributeProperties._super.constructor.apply(this,arguments);var a=JSG.graph.properties.LayoutAttributeProperties;a.LAYOUT=this.addProperty("LAYOUT","getLayout","setLayout");a.AUTOLAYOUT=this.addProperty("AUTOLAYOUT","getAutoLayout","setAutoLayout");a.AUTORESIZE=this.addProperty("AUTORESIZE","getAutoResize","setAutoResize");a.AUTORESIZELEVEL=this.addProperty("AUTORESIZELEVEL","getAutoResizeLevel","setAutoResizeLevel");
a.LAYOUTABLE=this.addProperty("LAYOUTABLE","getLayoutable","setLayoutable");a.LAYOUTSIZE=this.addProperty("LAYOUTSIZE","getLayoutSize","setLayoutSize")};JSG.extend(JSG.graph.properties.LayoutAttributeProperties,JSG.graph.properties.Properties);JSG.namespace("JSG.graph.properties");
JSG.graph.properties.FormatProperties=function(){JSG.graph.properties.FormatProperties._super.constructor.apply(this,arguments);var a=JSG.graph.properties.FormatProperties;a.FILLCOLOR=this.addProperty("FILLCOLOR","getFillColor","setFillColor");a.FILLSTYLE=this.addProperty("FILLSTYLE","getFillStyle","setFillStyle");a.TRANSPARENCY=this.addProperty("TRANSPARENCY","getTransparency","setTransparency");a.BRIGHTNESS=this.addProperty("BRIGHTNESS","getBrightness","setBrightness");a.GRADIENTCOLOR=this.addProperty("GRADIENTCOLOR",
"getGradientColor","setGradientColor");a.GRADIENTANGLE=this.addProperty("GRADIENTANGLE","getGradientAngle","setGradientAngle");a.GRADIENTTYPE=this.addProperty("GRADIENTTYPE","getGradientType","setGradientType");a.GRADIENTOFFSETX=this.addProperty("GRADIENTOFFSETX","getGradientOffsetX","setGradientOffsetX");a.GRADIENTOFFSETY=this.addProperty("GRADIENTOFFSETY","getGradientOffsetY","setGradientOffsetY");a.PATTERN=this.addProperty("PATTERN","getPattern","setPattern");a.PATTERNSTYLE=this.addProperty("PATTERNSTYLE",
"getPatternStyle","setPatternStyle");a.LINECOLOR=this.addProperty("LINECOLOR","getLineColor","setLineColor");a.LINEWIDTH=this.addProperty("LINEWIDTH","getLineWidth","setLineWidth");a.LINESTYLE=this.addProperty("LINESTYLE","getLineStyle","setLineStyle");a.LINECORNER=this.addProperty("LINECORNER","getLineCorner","setLineCorner");a.LINEARROWSTART=this.addProperty("LINEARROWSTART","getLineArrowStart","setLineArrowStart");a.LINEARROWEND=this.addProperty("LINEARROWEND","getLineArrowEnd","setLineArrowEnd");
a.SHADOWCOLOR=this.addProperty("SHADOWCOLOR","getShadowColor","setShadowColor");a.SHADOWOFFSETX=this.addProperty("SHADOWOFFSETX","getShadowOffsetX","setShadowOffsetX");a.SHADOWOFFSETY=this.addProperty("SHADOWOFFSETY","getShadowOffsetY","setShadowOffsetY");a.SHADOWBLUR=this.addProperty("SHADOWBLUR","getShadowBlur","setShadowBlur");a.SHADOWDIRECTION=this.addProperty("SHADOWDIRECTION","getShadowDirection","setShadowDirection")};JSG.extend(JSG.graph.properties.FormatProperties,JSG.graph.properties.Properties);
JSG.namespace("JSG.graph.properties");
JSG.graph.properties.TextFormatProperties=function(){JSG.graph.properties.TextFormatProperties._super.constructor.apply(this,arguments);var a=JSG.graph.properties.TextFormatProperties;a.FONTCOLOR=this.addProperty("FONTCOLOR","getFontColor","setFontColor");a.FONTNAME=this.addProperty("FONTNAME","getFontName","setFontName");a.FONTSIZE=this.addProperty("FONTSIZE","getFontSize","setFontSize");a.FONTSTYLE=this.addProperty("FONTSTYLE","getFontStyle","setFontStyle");a.HORIZONTALALIGNMENT=this.addProperty("HORIZONTALALIGNMENT",
"getHorizontalAlignment","setHorizontalAlignment");a.ROTATION=this.addProperty("ROTATION","getRotation","setRotation");a.HORIZONTALPOSITION=this.addProperty("HORIZONTALPOSITION","getHorizontalPosition","setHorizontalPosition");a.VERTICALPOSITION=this.addProperty("VERTICALPOSITION","getVerticalPosition","setVerticalPosition")};JSG.extend(JSG.graph.properties.TextFormatProperties,JSG.graph.properties.Properties);JSG.namespace("JSG.graph.properties");
JSG.graph.properties.NodeProperties=function(){JSG.graph.properties.NodeProperties._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.properties.NodeProperties,JSG.graph.properties.GraphItemProperties);JSG.namespace("JSG.graph.properties");
JSG.graph.properties.EdgeProperties=function(){JSG.graph.properties.EdgeProperties._super.constructor.apply(this,arguments);var a=JSG.graph.properties.EdgeProperties;a.START_X=this.addProperty("START_X",a.getStartX,a.setStartX);a.START_Y=this.addProperty("START_Y",a.getStartY,a.setStartY);a.END_X=this.addProperty("END_X",a.getEndX,a.setEndX);a.END_Y=this.addProperty("END_Y",a.getEndY,a.setEndY);a.POINTSCOUNT=this.addProperty("POINTSCOUNT","getPointsCount");a.LAYOUTER=this.addProperty("LAYOUTER",JSG.graph.properties.EdgeProperties.getLayouter);
a.LINE_BEHAVIOR=this.addProperty("LINEBEHAVIOR",JSG.graph.properties.EdgeProperties.getLineBehavior,JSG.graph.properties.EdgeProperties.setLineBehavior);var b=JSG.graph.model.shapes.OrthoLineBehavior;a.LINE_BEHAVIOR.numeration=[b.AUTO,b.HORIZONTAL,b.VERTICAL,b.MANUAL]};JSG.extend(JSG.graph.properties.EdgeProperties,JSG.graph.properties.GraphItemProperties);JSG.graph.properties.EdgeProperties.getLayouter=function(){return this.getLayoutAttributes().getType()};
JSG.graph.properties.EdgeProperties.getLineBehavior=function(){var a=this.getLayoutAttributes();return void 0!=a.getLineBehavior?a.getLineBehavior().getValue():void 0};JSG.graph.properties.EdgeProperties.setLineBehavior=function(a){this.getLayoutAttributes().setLineBehavior(a)};JSG.graph.properties.EdgeProperties.getStartX=function(){return this.getStartPoint().x};JSG.graph.properties.EdgeProperties.setStartX=function(a){var b=this.getStartPoint();b.x=a;this.setStartPointTo(b)};
JSG.graph.properties.EdgeProperties.getStartY=function(){return this.getStartPoint().y};JSG.graph.properties.EdgeProperties.setStartY=function(a){var b=this.getStartPoint();b.y=a;this.setStartPointTo(b)};JSG.graph.properties.EdgeProperties.getEndX=function(){return this.getEndPoint().x};JSG.graph.properties.EdgeProperties.setEndX=function(a){var b=this.getEndPoint();b.x=a;this.setEndPointTo(b)};JSG.graph.properties.EdgeProperties.getEndY=function(){return this.getEndPoint().y};
JSG.graph.properties.EdgeProperties.setEndY=function(a){var b=this.getEndPoint();b.y=a;this.setEndPointTo(b)};JSG.namespace("JSG.graph.properties");
JSG.graph.properties.GraphProperties=function(){JSG.graph.properties.GraphProperties._super.constructor.apply(this,arguments);var a=JSG.graph.attr.ItemAttributes,b=JSG.graph.properties.GraphProperties;b.GRAPHID=this.addProperty("GRAPHID","getGraphId","setGraphId");b.GRIDVISIBLE=this.addProperty("GRIDVISIBLE",b.getGridVisible,b.setGridVisible);b.PORTSVISIBLE=this.addProperty("PORTSVISIBLE",b.getPortsVisible,b.setPortsVisible);b.SCALE=this.addProperty("SCALE",b.getScaleVisible,b.setScaleVisible);b.SNAPTOGRID=
this.addProperty("SNAPTOGRID",b.getSnapToGrid,b.setSnapToGrid);b.SNAPSTEP=this.addProperty("SNAPSTEP",b.getSnapStep,b.setSnapStep);b.PORTMODE=this.addItemAttributeProperty(a.PORTMODE);b.SNAPTOSHAPES=this.addProperty("SNAPTOSHAPES",b.getSnapToShapes,b.setSnapToShapes);b.PAGEFORMAT=this.addProperty("PAGEFORMAT",b.getFormat,b.setFormat);b.PAGEORIENTATION=this.addProperty("PAGEORIENTATION",b.getOrientation,b.setOrientation);b.PAGEWIDTH=this.addProperty("PAGEWIDTH",b.getWidth,b.setWidth);b.PAGEHEIGHT=
this.addProperty("PAGEHEIGHT",b.getHeight,b.setHeight);b.MARGINLEFT=this.addItemAttributeProperty(a.MARGINLEFT);b.MARGINRIGHT=this.addItemAttributeProperty(a.MARGINRIGHT);b.MARGINTOP=this.addItemAttributeProperty(a.MARGINTOP);b.MARGINBOTTOM=this.addItemAttributeProperty(a.MARGINBOTTOM);b.HEADERMARGIN=this.addProperty("HEADERMARGIN",b.getHeaderMargin,b.setHeaderMargin);b.HEADERLEFT=this.addProperty("HEADERLEFT",b.getHeaderLeft,b.setHeaderLeft);b.HEADERCENTER=this.addProperty("HEADERCENTER",b.getHeaderCenter,
b.setHeaderCenter);b.HEADERRIGHT=this.addProperty("HEADERRIGHT",b.getHeaderRight,b.setHeaderRight);b.FOOTERMARGIN=this.addProperty("FOOTERMARGIN",b.getFooterMargin,b.setFooterMargin);b.FOOTERLEFT=this.addProperty("FOOTERLEFT",b.getFooterLeft,b.setFooterLeft);b.FOOTERCENTER=this.addProperty("FOOTERCENTER",b.getFooterCenter,b.setFooterCenter);b.FOOTERRIGHT=this.addProperty("FOOTERRIGHT",b.getFooterRight,b.setFooterRight);b.SCALETOPAGETYPE=this.addProperty("SCALETOPAGETYPE",b.getScaleToPageType,b.setScaleToPageType);
b.SCALETOPAGECOUNT=this.addProperty("SCALETOPAGECOUNT",b.getScaleToPageCount,b.setScaleToPageCount)};JSG.extend(JSG.graph.properties.GraphProperties,JSG.graph.properties.GraphItemProperties);JSG.graph.properties.GraphProperties.prototype.addItemAttributeProperty=function(a){a=new JSG.graph.properties.AttributeProperty(JSG.graph.attr.AttributeUtils.createPath(JSG.graph.attr.ItemAttributes.NAME,a));this._properties.put(a.id,a);return a};JSG.graph.properties.GraphProperties.getFormat=function(){return this._settings.getPage().getFormat()};
JSG.graph.properties.GraphProperties.setFormat=function(a){this._settings.getPage().setFormat(a)};JSG.graph.properties.GraphProperties.getOrientation=function(){return this._settings.getPage().getOrientation()};JSG.graph.properties.GraphProperties.setOrientation=function(a){this._settings.getPage().setOrientation(a)};JSG.graph.properties.GraphProperties.getHeight=function(){return this._settings.getPage().getHeight()};JSG.graph.properties.GraphProperties.setHeight=function(a){this._settings.getPage().setHeight(a)};
JSG.graph.properties.GraphProperties.getWidth=function(){return this._settings.getPage().getWidth()};JSG.graph.properties.GraphProperties.setWidth=function(a){this._settings.getPage().setWidth(a)};JSG.graph.properties.GraphProperties.getLeftMargin=function(){return this._settings.getPage().getLeftMargin()};JSG.graph.properties.GraphProperties.setLeftMargin=function(a){this._settings.getPage().setLeftMargin(a)};JSG.graph.properties.GraphProperties.getRightMargin=function(){return this._settings.getPage().getRightMargin()};
JSG.graph.properties.GraphProperties.setRightMargin=function(a){this._settings.getPage().setRightMargin(a)};JSG.graph.properties.GraphProperties.getTopMargin=function(){return this._settings.getPage().getTopMargin()};JSG.graph.properties.GraphProperties.setTopMargin=function(a){this._settings.getPage().setTopMargin(a)};JSG.graph.properties.GraphProperties.getBottomMargin=function(){return this._settings.getPage().getBottomMargin()};JSG.graph.properties.GraphProperties.setBottomMargin=function(a){this._settings.getPage().setBottomMargin(a)};
JSG.graph.properties.GraphProperties.getHeaderMargin=function(){return this._settings.getPage().getHeaderMargin()};JSG.graph.properties.GraphProperties.setHeaderMargin=function(a){this._settings.getPage().setHeaderMargin(a)};JSG.graph.properties.GraphProperties.getHeaderLeft=function(){return this._settings.getPage().getHeaderLeft()};JSG.graph.properties.GraphProperties.setHeaderLeft=function(a){this._settings.getPage().setHeaderLeft(a)};JSG.graph.properties.GraphProperties.getHeaderCenter=function(){return this._settings.getPage().getHeaderCenter()};
JSG.graph.properties.GraphProperties.setHeaderCenter=function(a){this._settings.getPage().setHeaderCenter(a)};JSG.graph.properties.GraphProperties.getHeaderRight=function(){return this._settings.getPage().getHeaderRight()};JSG.graph.properties.GraphProperties.setHeaderRight=function(a){this._settings.getPage().setHeaderRight(a)};JSG.graph.properties.GraphProperties.getFooterMargin=function(){return this._settings.getPage().getFooterMargin()};JSG.graph.properties.GraphProperties.setFooterMargin=function(a){this._settings.getPage().setFooterMargin(a)};
JSG.graph.properties.GraphProperties.getFooterLeft=function(){return this._settings.getPage().getFooterLeft()};JSG.graph.properties.GraphProperties.setFooterLeft=function(a){this._settings.getPage().setFooterLeft(a)};JSG.graph.properties.GraphProperties.getFooterCenter=function(){return this._settings.getPage().getFooterCenter()};JSG.graph.properties.GraphProperties.setFooterCenter=function(a){this._settings.getPage().setFooterCenter(a)};JSG.graph.properties.GraphProperties.getFooterRight=function(){return this._settings.getPage().getFooterRight()};
JSG.graph.properties.GraphProperties.setFooterRight=function(a){this._settings.getPage().setFooterRight(a)};JSG.graph.properties.GraphProperties.getScaleToPageCount=function(){return this._settings.getPage().getScaleToPageCount()};JSG.graph.properties.GraphProperties.setScaleToPageCount=function(a){this._settings.getPage().setScaleToPageCount(a)};JSG.graph.properties.GraphProperties.getScaleToPageType=function(){return this._settings.getPage().getScaleToPageType()};
JSG.graph.properties.GraphProperties.setScaleToPageType=function(a){this._settings.getPage().setScaleToPageType(a)};JSG.graph.properties.GraphProperties.getGridVisible=function(){return this._settings.getGridVisible()};JSG.graph.properties.GraphProperties.setGridVisible=function(a){return this._settings.setGridVisible(a)};JSG.graph.properties.GraphProperties.getPortsVisible=function(){return this._settings.getPortsVisible()};JSG.graph.properties.GraphProperties.setPortsVisible=function(a){return this._settings.setPortsVisible(a)};
JSG.graph.properties.GraphProperties.getScaleVisible=function(){return this._settings.getScaleVisible()};JSG.graph.properties.GraphProperties.setScaleVisible=function(a){return this._settings.setScaleVisible(a)};JSG.graph.properties.GraphProperties.getSnapToGrid=function(){return this._settings.getSnapToGrid()};JSG.graph.properties.GraphProperties.setSnapToGrid=function(a){return this._settings.setSnapToGrid(a)};JSG.graph.properties.GraphProperties.getSnapStep=function(){return this._settings.getSnapStep()};
JSG.graph.properties.GraphProperties.setSnapStep=function(a){return this._settings.setSnapStep(a)};JSG.graph.properties.GraphProperties.getSnapToPort=function(){return this._settings.getSnapToPort()};JSG.graph.properties.GraphProperties.setSnapToPort=function(a){return this._settings.setSnapToPort(a)};JSG.graph.properties.GraphProperties.getSnapToShapes=function(){return this._settings.getSnapToShapes()};JSG.graph.properties.GraphProperties.setSnapToShapes=function(a){return this._settings.setSnapToShapes(a)};
JSG.namespace("JSG.graph.properties");JSG.graph.properties.TextNodeProperties=function(){JSG.graph.properties.TextNodeProperties._super.constructor.apply(this,arguments);var a=JSG.graph.properties.TextNodeProperties;a.TEXT=this.addProperty("TEXT","getText",a.setText)};JSG.extend(JSG.graph.properties.TextNodeProperties,JSG.graph.properties.NodeProperties);JSG.graph.properties.TextNodeProperties.setText=function(a){this.setText(a);this.getGraph().markDirty()};JSG.namespace("JSG.graph.properties");
JSG.graph.properties.PropertiesProvider=function(){function a(a){if(a instanceof JSG.graph.model.TextNode)return d;if(a instanceof JSG.graph.model.Node)return c;if(a instanceof JSG.graph.model.Edge)return e;if(a instanceof JSG.graph.model.Graph)return f;if(a instanceof JSG.graph.model.GraphItem)return g}var b=JSG.graph.properties,c=new b.NodeProperties,d=new b.TextNodeProperties,e=new b.EdgeProperties,f=new b.GraphProperties,g=new b.GraphItemProperties,l=new b.FormatProperties,h=new b.TextFormatProperties,
m=new b.ItemAttributesProperties,k=new b.LayoutAttributeProperties;return{getProperties:function(b){return a(b)},getFormatProperties:function(){return l},getTextFormatProperties:function(){return h},getItemAttributesProperties:function(){return m},getLayoutAttributeProperties:function(){return k},getReshapeProperties:function(a){return a.getReshapeProperties()},addProperty:function(b,c){var d=a(b);void 0!=d&&d._addProperty(c)}}}();JSG.namespace("JSG.graph.notifications");
JSG.graph.notifications.Notification=function(a,b){this.name=a;this.object=b;this.event=void 0};JSG.namespace("JSG.graph.notifications");
JSG.graph.notifications.NotificationCenter=function(){function a(){return{register:function(a,c,d){a&&c&&(c=b(c),c.contains(a)||c.push({observer:a,func:d}))},unregister:function(a,c){if(a&&c){var d=b(c),e;e=b(c);for(var m=void 0,k=0;k<e.length;k++)if(e[k].observer===a){m=e[k];break}e=m;void 0!=e&&d.remove(e)}},send:function(a){for(var c=b(a.name),d=0;d<c.length;d++){var h=c[d];h.observer[h.func?h.func:e].call(h.observer,a)}}}}function b(a){var b=d.get(a);b||(b=[],d.put(a,b));return b}var c=void 0,
d=new JSG.commons.Map,e="onNotification";return{getInstance:function(){c||(c=a());return c}}}();JSG.namespace("JSG.graph.view");JSG.graph.view.GraphItemView=function(a){JSG.graph.view.GraphItemView._super.constructor.apply(this,arguments);this._item=a;this._collapseBtn=new CollapseButton(a);this._shapeRenderer=JSG.graph.view.shapes.ShapeRenderer.fromShape(a._shape)};JSG.extend(JSG.graph.view.GraphItemView,JSG.ui.View);JSG.graph.view.GraphItemView.prototype.getId=function(){return this._item.getId()};
JSG.graph.view.GraphItemView.prototype.getItem=function(){return this._item};JSG.graph.view.GraphItemView.prototype.getGraphView=function(){return void 0!=this._parent?this._parent.getGraphView():void 0};JSG.graph.view.GraphItemView.prototype.getAngle=function(){return this._item.getAngle().getValue()};JSG.graph.view.GraphItemView.prototype.getPointList=function(){return this._item._shape.getPointList()};JSG.graph.view.GraphItemView.prototype.getBoundingBox=function(a){return this._item.getBoundingBox(a)};
JSG.graph.view.GraphItemView.prototype.getOrigin=function(a){return this._item.getOrigin(a)};JSG.graph.view.GraphItemView.prototype.setOriginTo=function(a){this._item.setOriginTo(a)};JSG.graph.view.GraphItemView.prototype.getPin=function(a){return this._item.getPin()};JSG.graph.view.GraphItemView.prototype.containsPoint=function(a,b){return this._item.containsPoint(a,b)};JSG.graph.view.GraphItemView.prototype.translateFromParent=function(a){return this._item.translateFromParent(a)};
JSG.graph.view.GraphItemView.prototype.translateToParent=function(a){return this._item.translateToParent(a)};JSG.graph.view.GraphItemView.prototype.getTranslatedShapePoints=function(a,b){return this._item.getTranslatedShapePoints(a.getItem(),b)};JSG.graph.view.GraphItemView.prototype.getTranslatedBoundingBox=function(a,b){return this._item.getTranslatedBoundingBox(a.getItem(),b)};
JSG.graph.view.GraphItemView.prototype.draw=function(a){if(this._item.isVisible()){this._item.updateLabelPositions();a.save();a.startGroup();var b=this._item.getFormat(),c=this._item.getSize().toRectangle(JSG.rectCache.get());if(this._item.getItemAttributes().getAlwaysVisible().getValue()!=JSG.graph.attr.consts.Direction.NONE){var d=this._item.getOrigin(JSG.ptCache.get());JSG.graph.Utils.traverseUp(this.getParent(),void 0,function(a){a.translateToParent(d);a instanceof JSG.graph.view.GraphView&&a._item.getSettings().getScaleVisible()&&
(d.x-=750,d.y-=750);return!0});JSG.ptCache.release(d)}this.translateGraphics(a);this.drawFill(a,b,c);this._item.isClipChildren()?(this.hasSubviews()&&this.drawSubViews(a),this.drawBorder(a,b,c)):(this.drawBorder(a,b,c),this.hasSubviews()&&this.drawSubViews(a));this.drawDecorations(a,c);a.endGroup();a.restore();JSG.rectCache.release(c)}};
JSG.graph.view.GraphItemView.prototype.translateGraphics=function(a){var b=JSG.ptCache.get(),c=this._item.getOrigin(b);a.translate(c.x,c.y);a.rotate(this._item.getAngle().getValue());JSG.ptCache.release(b)};JSG.graph.view.GraphItemView.prototype.drawFill=function(a,b,c){b.hasFill()&&(b.applyFillToGraphics(a,c),b.applyShadowToGraphics(a,c),this.applyFillConditionsToGraphics(a),this._shapeRenderer.drawShapeFill(this._item._shape,this._item.isClosed(),a),b.removeShadowFromGraphics(a))};
JSG.graph.view.GraphItemView.prototype.applyFillConditionsToGraphics=function(a){for(var b=this._item.getConditions(),c=0;c<b.length;c++){var d=b[c],e=d.getExpression().getValue();if("undefined"!=e){switch(d.getAttributeId()){case "fillcolor":a.setFillColor(e)}if(d.getFinal())break}}};JSG.graph.view.GraphItemView.prototype.applyLineConditionsToGraphics=function(a){for(var b=this._item.getConditions(),c=0;c<b.length;c++){var d=b[c],e=d.getExpression().getValue();if("undefined"!=e){switch(d.getAttributeId()){case "linecolor":a.setLineColor(e)}if(d.getFinal())break}}};
JSG.graph.view.GraphItemView.prototype.drawSubViews=function(a){this._item.isClipChildren()&&(a.save(),this._shapeRenderer.setClipArea(this._item._shape,a));if(this._item.isCollapsed()){var b=this._item.getTitle?this._item.getTitle():void 0;if(b)for(var c=0,d=this._subviews.length;c<d;c++){var e=this._subviews[c];e.getItem()==b&&e.draw(a)}}else for(c=0,d=this._subviews.length;c<d;c++)e=this._subviews[c],!0==e.isVisible()&&e.draw(a);this._item.isClipChildren()&&a.restore()};
JSG.graph.view.GraphItemView.prototype.drawBorder=function(a,b,c){if(b.hasBorder()){b.applyLineToGraphics(a);this.applyLineConditionsToGraphics(a);if(b.getLineArrowStart().getValue()!=JSG.graph.model.attributes.ArrowStyle.NONE||b.getLineArrowEnd().getValue()!=JSG.graph.model.attributes.ArrowStyle.NONE)b.applyFillToGraphics(a,c),this.applyFillConditionsToGraphics(a);this._shapeRenderer.drawShapeBorder(this._item._shape,this._item.isClosed(),a);b.removeLineFromGraphics(a)}};
JSG.graph.view.GraphItemView.prototype.drawDecorations=function(a,b){this._collapseBtn.draw(a);var c=this._item.getGraph();c&&c.getSettings().getNamesVisible()&&(a.setFillColor("#AAAAAA"),a.setTextBaseline("top"),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT),a.setFontName("Arial"),a.setFontSize(8/a.getCoordinateSystem().getZoom()),a.setFont(),a.fillText(this._item.getName().getValue(),0,b.getBottom()))};JSG.graph.view.GraphItemView.prototype.doHandleEventAt=function(a,b){return this.hitCollapseButton(a)};
JSG.graph.view.GraphItemView.prototype.onMouseDown=function(a,b,c){c=this._item;return c.isCollapsable()&&this.hitCollapseButton(a)&&(a=this._getInteractionHandler(b))?a.collapse(c):!1};JSG.graph.view.GraphItemView.prototype._getInteractionHandler=function(a){return(a=a.getDefaultInteraction())?a.getInteractionHandler():void 0};JSG.graph.view.GraphItemView.prototype.hitCollapseButton=function(a){return this._collapseBtn.containsPoint(a)};JSG.graph.view.GraphItemView.prototype.getShape=function(){return this._item._shape};
JSG.graph.view.GraphItemView.prototype.getAttributes=function(){return this._item.getAttributes()};JSG.graph.view.GraphItemView.prototype.getItemAttributes=function(){return this._item.getItemAttributes()};JSG.graph.view.GraphItemView.prototype.setShapeRenderer=function(a){a&&(this._shapeRenderer=a)};JSG.graph.view.GraphItemView.prototype.setBoundingBoxTo=function(a){this._item.setBoundingBoxTo(a)};JSG.graph.view.GraphItemView.prototype.getPreferredBounds=function(a,b){};
function CollapseButton(a){CollapseButton._super.constructor.apply(this,arguments);this._item=a;this._bounds=new JSG.geometry.Rectangle(0,0,300,300);this._imgExpanded=JSG.imagePool.get(JSG.commons.ImagePool.IMG_EXPANDED);this._imgCollapsed=JSG.imagePool.get(JSG.commons.ImagePool.IMG_COLLAPSED)}JSG.extend(CollapseButton,JSG.ui.View);CollapseButton.prototype.containsPoint=function(a){return this._item.isCollapsable()?this._bounds.containsPoint(a):!1};
CollapseButton.prototype.draw=function(a){if(this._item.isCollapsable()){var b=this._item.isCollapsed()?this._imgExpanded:this._imgCollapsed;this._updateBounds(a.getCoordinateSystem().deviceToLogXNoZoom(16));a.drawImage(b,this._bounds.x,this._bounds.y,this._bounds.width,this._bounds.height)}};
CollapseButton.prototype._updateBounds=function(a){this._bounds.setSize(a,a);a=this._item.getSize().getWidth().getValue();var b=this._item.getSize().getHeight().getValue();switch(this._item.getItemAttributes().getCollapsedButton().getValue()){case JSG.graph.attr.consts.ButtonPosition.TOPLEFT:this._bounds.x=0;this._bounds.y=0;break;case JSG.graph.attr.consts.ButtonPosition.TOPRIGHT:this._bounds.x=a-this._bounds.width;this._bounds.y=0;break;case JSG.graph.attr.consts.ButtonPosition.TOPCENTER:this._bounds.x=
(a-this._bounds.width)/2;this._bounds.y=0;break;case JSG.graph.attr.consts.ButtonPosition.BOTTOMCENTER:this._bounds.x=(a-this._bounds.width)/2,this._bounds.y=b-this._bounds.height}};JSG.namespace("JSG.graph.view");JSG.graph.view.EdgeView=function(a){JSG.graph.view.EdgeView._super.constructor.apply(this,arguments);this._arrowEndBox=new JSG.geometry.BoundingBox;this._arrowStartBox=new JSG.geometry.BoundingBox};JSG.extend(JSG.graph.view.EdgeView,JSG.graph.view.GraphItemView);
JSG.graph.view.EdgeView.prototype.containsPoint=function(a,b,c){return this._item.containsPoint(a,b,c)};JSG.graph.view.EdgeView.prototype.getLineSegmentAtPoint=function(a,b){return this._item.getLineSegmentAtPoint(a,b)};JSG.graph.view.EdgeView.prototype.hitsLineArrowEnd=function(a,b){return this._hitsLineArrow(a,b,this._arrowEndBox)};JSG.graph.view.EdgeView.prototype.hitsLineArrowStart=function(a,b){return this._hitsLineArrow(a,b,this._arrowStartBox)};
JSG.graph.view.EdgeView.prototype._hitsLineArrow=function(a,b,c){return void 0!=c?(c.expandBy(void 0!=b?b:250),c.containsPoint(a)):!1};JSG.graph.view.EdgeView.prototype.drawFill=function(a,b,c){JSG.graph.view.EdgeView._super.drawBorder.call(this,a,b,c)};JSG.graph.view.EdgeView.prototype.drawBorder=function(a,b,c){};
JSG.graph.view.EdgeView.prototype.drawDecorations=function(a){var b=this._shapeRenderer.getContext();this._setArrowBox(this._arrowEndBox,void 0!=b?b.endArrow:void 0);this._setArrowBox(this._arrowStartBox,void 0!=b?b.startArrow:void 0);if(JSG.debug.SHOW_LINE_BBOX){a.save();var c=this._item.getBoundingBox(JSG.boxCache.get());a.rotate(-c.getAngle());var b=this._item.getOrigin(JSG.ptCache.get()),d=JSG.ptCache.get();c.setTopLeftTo(c.getTopLeft(d).subtract(b));a.setLineColor("#FF0000");a.drawPolyline(c.getPointsUnrotated(),
!0);a.setLineColor("#00FF00");a.drawPolyline(c.getPoints(),!0);a.restore();JSG.boxCache.release(c);JSG.ptCache.release(b,d)}JSG.debug.SHOW_LINE_ORIGIN&&(b=this._item.getOrigin(JSG.ptCache.get()),d=this._item,c=b,a.setLineColor("#ff0000"),d=d.getPinPoint(JSG.ptCache.get()),d=void 0!=c?d.subtract(c):d,c=JSG.rectCache.get(),c.x=d.x-200,c.y=d.y-200,c.width=400,c.height=400,a.drawEllipse(c),JSG.ptCache.release(d),JSG.rectCache.release(c),JSG.ptCache.release(b))};
JSG.graph.view.EdgeView.prototype._setArrowBox=function(a,b){void 0!=b?a.setTo(b):a.setSize(-1,-1)};JSG.graph.view.EdgeView.prototype.evaluate=function(){this._item.evaluate()};JSG.namespace("JSG.graph.view");JSG.graph.view.NodeView=function(a){JSG.graph.view.NodeView._super.constructor.apply(this,arguments);this._portViews=[]};JSG.extend(JSG.graph.view.NodeView,JSG.graph.view.GraphItemView);JSG.graph.view.NodeView.prototype.addPortView=function(a){this._portViews.push(a);a._parent=this};
JSG.graph.view.NodeView.prototype.removePortView=function(a){var b=this._portViews.remove(a);b&&(a._parent=void 0);return b};
JSG.graph.view.NodeView.prototype.drawDecorations=function(a,b){JSG.graph.view.NodeView._super.drawDecorations.call(this,a,b);var c=this._item.getGraph();if(c&&(c=c.getSettings(),c.getPortsVisible()&&this._portViews.forEach(function(b){b.draw(a)}),c.getAvailablePortsVisible()&&(c=this._item.getShape().getValidPortLocations(this._item.isClosed(),!1)))){var d=JSG.rectCache.get();a.setLineColor("#00FF00");a.setLineWidth(1);var e=a.getCoordinateSystem().metricToLogXNoZoom(400);c.forEach(function(b){d.set(b.x-
e/2,b.y-e/2,e,e);a.drawRect(d)});JSG.rectCache.release(d)}};
JSG.graph.view.NodeView.prototype._drawTestLines=function(a){var b=this._item,c=function(){var a=b.getPorts();return 0<a.length?a[0]:void 0}(),d=function(a){if(void 0!=a)return a=a.getEdges(),0<a.length?a[0]:void 0}(c);if(void 0!=d){var e=c.getOrigin(JSG.ptCache.get()),c=c.getCenter(JSG.ptCache.get()).add(e),f=b.getAngle().getValue(),g=(new JSG.geometry.Point(0,-1)).setLength(2E3);g.x+=c.x;a.setLineColor("#ff0000");a.drawLine(c,g);d=d.getAngle().getValue();g=[];g.push(new JSG.geometry.Point(0,-1));
g.push(new JSG.geometry.Point(1,0));g.push(new JSG.geometry.Point(0,1));g.push(new JSG.geometry.Point(-1,0));var l=[];l.push("#00ff00");l.push("#0000ff");l.push("#00ffff");l.push("#dddddd");for(var h=0;h<g.length;h++){var m=g[h].copy().setLength(1E3).rotate(-f).rotate(d);m.add(c);a.setLineColor(l[h]);a.drawLine(c,m)}JSG.ptCache.release(e,c)}};JSG.namespace("JSG.graph.view");
JSG.graph.view.GraphView=function(a){JSG.graph.view.GraphView._super.constructor.apply(this,arguments);this.cursor;this._feedbackViews=[];this._layerViews=new JSG.commons.StableMap;this._layerOrder=[JSG.graph.view.LayerId.PORTS,JSG.graph.view.LayerId.SELECTION,JSG.graph.view.LayerId.FRIENDS];this._canvasCache=[];this._item.getFormat().setFillColor("#FFFFFF");this._item.getFormat().setLineColor("#777777")};JSG.extend(JSG.graph.view.GraphView,JSG.graph.view.GraphItemView);
JSG.graph.view.REFRESHED_MODEL_NOTIFICATION="JSG.graph.view.refreshedmodelnotification";JSG.graph.view.GraphView.prototype.getGraphView=function(){return this};JSG.graph.view.GraphView.prototype.getSettings=function(){return this._item.getSettings()};JSG.graph.view.GraphView.prototype.layout=function(){JSG.graph.view.GraphView._super.layout.call(this)};JSG.graph.view.GraphView.prototype.setCursor=function(a){this.cursor=a};
JSG.graph.view.GraphView.prototype.clearCache=function(){for(var a=0,b=this._canvasCache.length;a<b;a++)void 0!=this._canvasCache[a]&&(this._canvasCache[a].redraw=!0)};JSG.graph.view.GraphView.prototype.draw=function(a){this._item.refresh();a.save();this.drawClientArea(a);a.restore()};
JSG.graph.view.GraphView.prototype.drawClientArea=function(a){function b(a,b,c){var d=e.getScreenRect(b,JSG.rectCache.get()),f=b.intersection(d);if(f){Math.ceil(b.width/n);for(var g=Math.ceil(b.height/n),h=Math.floor((f.x-b.x)/n),l=Math.floor((f.y-b.y)/n),k=Math.ceil((f.getRight()-b.x)/n),f=Math.ceil((f.getBottom()-b.y)/n),m=JSG.ptCache.get(),p=JSG.rectCache.get(),q=h;q<k;q++)for(var s=l;s<f;s++)if(e._canvasCache[q*g+s].canvas){c||(a.save(),a.setClip(b),a.drawImage(e._canvasCache[q*g+s].canvas,q*
n+b.x,s*n+b.y),a.restore());var t=a._cs.logToDeviceX(q*n+b.x),r=a._cs.logToDeviceY(q*n+b.y),u=a.transformPoint(t,r,m);u.x-=0.5;u.y-=0.5;a.m[4]=u.x-t;a.m[5]=u.y-r;a.save();var t=q*n+b.x,r=s*n+b.y,v=u=n;q==h&&(t-=5E4,u+=5E4);s==l&&(r-=5E4,v+=5E4);q==k-1&&(u+=5E4);s==f-1&&(v+=5E4);p.set(t,r,u,v);a.setImageClip(p);e._drawFeedback(a);e._drawLayers(a);e._drawOverlay(a);a.restore()}JSG.ptCache.release(m);JSG.rectCache.release(d,p)}else JSG.rectCache.release(d)}function c(a,b){!0===q.getGridVisible()&&e._drawGrid(a,
b);0<e._subviews.length&&e.drawSubViews(a,b)}function d(a){var b=JSG.rectCache.get(),c=e._getLogScreenRect(b);a=void 0!=c?c.intersect(a):!0;JSG.rectCache.release(b);return a}var e=this,f=JSG.boxCache.get(),g=this._item.getBoundingBox(f).toRectangle(JSG.rectCache.get()),l=this._item.getFormat(),h=a.getCoordinateSystem(),m=Math.ceil(h.logToDeviceX(Math.max(g.width,g.height))),k=0.1>h.getZoom()?256:Math.min(m,JSG.touchDevice?1E3:1500),n=h.deviceToLogX(k),m=this.getItem(),q=m.getSettings(),p=q.getPage(),
s=q.getDisplayMode();JSG.boxCache.release(f);a._context2D.imageSmoothingEnabled=!1;m.setZoom(h.getZoom());if(JSG.canvasCache){for(var f=0,u=JSG.rectCache.get().set(g.x,g.y,n,n);u.x<g.getRight();){for(;u.y<g.getBottom();){if(d(u)){if(void 0==this._canvasCache[f]){var t=document.createElement("canvas");this._canvasCache[f]=new JSG.graph.view.GraphView.Cache(t)}this._canvasCache[f].redraw&&(t=this._canvasCache[f].canvas,t.width=k,t.height=k,t=new JSG.ui.graphics.ScalableGraphics(t,h),t.translate(-u.x,
-u.y),c(t,u),this._canvasCache[f].redraw=!1)}u.y+=n;f++}u.y=g.y;u.x+=n}JSG.rectCache.release(u)}if(s==JSG.ui.graphics.DisplayMode.ENDLESS)l.applyFillToGraphics(a,g),l.applyLineToGraphics(a),a.fillRect(g),this._canvasCache&&JSG.canvasCache?b(a,g,!1):(a.save(),a.setClip(g),c(a,g),a.restore(),this._drawFeedback(a),this._drawLayers(a),this._drawOverlay(a));else{h=JSG.rectCache.get();k=JSG.rectCache.get();s=g.x/p.getUsableWidth()*(p.getHorizontalGap()+p.getLeftMargin()+p.getRightMargin());f=g.y/p.getUsableHeight()*
(p.getVerticalGap()+p.getTopMargin()+p.getBottomMargin());u=-1;for(t=m.getHorizontalPages()+1;u<t;u++)for(var w=-1,v=m.getVerticalPages()+1;w<v;w++)if(k.set(p.getUsableWidth()*u+g.x,p.getUsableHeight()*w+g.y,p.getUsableWidth(),p.getUsableHeight()),d(k)){a.save();h.set((p.getWidth()+p.getHorizontalGap())*u+g.x+s,(p.getHeight()+p.getVerticalGap())*w+g.y+f,p.getWidth(),p.getHeight());var A=0>u||0>w||u==t-1||w==v-1;A?(a.setFillColor("#E0E0E0"),a.fillRect(h),a.setLineColor("#CCCCCC"),a.drawRect(h)):(l.applyLineToGraphics(a),
l.applyFillToGraphics(a,h),a.fillRect(h),a.drawRect(h),this.drawHeaderAndFooter(a,h,p,u*(v-1)+w));h.set((p.getWidth()+p.getHorizontalGap())*u+p.getLeftMargin()+g.x+s,(p.getHeight()+p.getVerticalGap())*w+p.getTopMargin()+g.y+f,p.getUsableWidth(),p.getUsableHeight());A&&a.drawRect(h);a.setClip(h);a.translate((p.getHorizontalGap()+p.getLeftMargin()+p.getRightMargin())*u+p.getLeftMargin()+s,(p.getVerticalGap()+p.getTopMargin()+p.getBottomMargin())*w+p.getTopMargin()+f);this._canvasCache&&JSG.canvasCache?
b(a,g,A):(A||c(a,k),this._drawFeedback(a),this._drawLayers(a),this._drawOverlay(a));a.restore()}JSG.rectCache.release(h,k)}JSG.rectCache.release(g)};JSG.graph.view.GraphView.prototype.getScreenRect=function(a,b){var c=this._getLogScreenRect(b);if(void 0!=c)return c;b=b||new JSG.geometry.Rectangle;b.setTo(a);return b};JSG.graph.view.GraphView.prototype.getVisibleGraphRect=function(a){a=a||new JSG.geometry.Rectangle;return this._getLogScreenRect(a)};
JSG.graph.view.GraphView.prototype._getLogScreenRect=function(a){var b=this,c;for(a=a||new JSG.geometry.Rectangle;b&&!b._hScrollbar;)b=b.getParent(),b instanceof JSG.ui.ScrollPanel&&(c=a.setTo(b._bounds));if(b&&c)return a=this.getItem().getSettings().getDisplayMode(),b=JSG.ptCache.get(b._hScrollbar._range._model.pos,b._vScrollbar._range._model.pos),a!=JSG.ui.graphics.DisplayMode.ENDLESS&&(a=this.getPageOffset(b),b.subtract(a)),c.translate(b.x,b.y),JSG.ptCache.release(b),c};
JSG.graph.view.GraphView.prototype.drawHeaderAndFooter=function(a,b,c,d){function e(a,b){return a=a.replace("[#p]",b)}d++;a.setFontName("Arial");a.setFontSize(8);a.setFillColor("#000000");a.setTextBaseline("top");var f=c.getHeaderLeft();f&&f.length&&(f=e(f,d),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT),a.setFont(),a.fillText(f,b.x+c.getLeftMargin(),b.y+c.getHeaderMargin()));(f=c.getHeaderCenter())&&f.length&&(f=e(f,d),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER),
a.setFont(),a.fillText(f,b.x+b.width/2,b.y+c.getHeaderMargin()));(f=c.getHeaderRight())&&f.length&&(f=e(f,d),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.RIGHT),a.setFont(),a.fillText(f,b.x+b.width-c.getRightMargin(),b.y+c.getHeaderMargin()));a.setTextBaseline("bottom");(f=c.getFooterLeft())&&f.length&&(f=e(f,d),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT),a.setFont(),a.fillText(f,b.x+c.getLeftMargin(),b.y+b.height-c.getFooterMargin()));(f=c.getFooterCenter())&&
f.length&&(f=e(f,d),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER),a.setFont(),a.fillText(f,b.x+b.width/2,b.y+b.height-c.getFooterMargin()));(f=c.getFooterRight())&&f.length&&(f=e(f,d),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.RIGHT),a.setFont(),a.fillText(f,b.x+b.width-c.getRightMargin(),b.y+b.height-c.getFooterMargin()))};
JSG.graph.view.GraphView.prototype.drawSubViews=function(a,b){this._item.isClipChildren()&&(a.save(),this._shapeRenderer.setClipArea(this._item._shape,a));for(var c=JSG.boxCache.get(),d=0,e=this._subviews.length;d<e;d++){var f=this._subviews[d];if(!0==f.isVisible()){var g=f.getItem(),l=g.getBoundingBox(c).getBoundingRectangle(),g=g.getTotalBoundingRect();l.union(g);(void 0==b||b.intersect(l))&&f.draw(a)}}JSG.boxCache.release(c);this._item.isClipChildren()&&a.restore()};
JSG.graph.view.GraphView.prototype._drawTitles=function(a){};JSG.graph.view.GraphView.prototype._drawOverlay=function(a){this._overlayView&&this._overlayView.draw(a)};
JSG.graph.view.GraphView.prototype._drawGrid=function(a,b){var c=this._item.getBoundingBox(JSG.boxCache.get()),d=c.toRectangle(JSG.rectCache.get()),e=a.getCoordinateSystem().getMajorUnit(),f=a.getCoordinateSystem().getMinorUnit();a.setLineWidth(JSG.graph.model.attributes.LineStyle.HAIRLINE);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.setLineColor("#CCCCCC");var g=b.x,g=g-g%e-e;for(a.beginPath();g<b.getRight();){a.moveTo(g,b.y);a.lineTo(g,b.getBottom());for(var l=0;l<e;)l+=f,a.moveTo(g+
l,b.y),a.lineTo(g+l,b.getBottom());g+=e}g=b.y;for(g-=g%e;g<b.getBottom();){a.moveTo(b.x,g);a.lineTo(b.getRight(),g);for(l=0;l<e;)l+=f,a.moveTo(b.x,g+l),a.lineTo(b.getRight(),g+l);g+=e}a.stroke();JSG.boxCache.release(c);JSG.rectCache.release(d)};JSG.graph.view.GraphView.prototype._drawFeedback=function(a){for(var b=0,c=this._feedbackViews.length;b<c;b++)this._feedbackViews[b].draw(a)};JSG.graph.view.GraphView.prototype._drawLayers=function(a){this._layerViews.iterate(function(b,c){for(var d=0;d<c.length;d++)c[d].draw(a)})};
JSG.graph.view.GraphView.prototype.translateFromParent=function(a){if(this.getSettings().getDisplayMode()==JSG.ui.graphics.DisplayMode.PAGE){var b=this.getPageOffset(a,JSG.ptCache.get());a.subtract(b);JSG.ptCache.release(b)}return a};JSG.graph.view.GraphView.prototype.translateToParent=function(a){if(this.getSettings().getDisplayMode()==JSG.ui.graphics.DisplayMode.PAGE){var b=this.getPageOffset(a,JSG.ptCache.get());a.add(b);JSG.ptCache.release(b)}return a};
JSG.graph.view.GraphView.prototype.getPageOffset=function(a,b){var c=this.getItem().getSettings().getPage(),d=Math.floor((a.x+c.getHorizontalGap()/2)/(c.getWidth()+c.getHorizontalGap())),e=Math.floor((a.y+c.getVerticalGap()/2)/(c.getHeight()+c.getVerticalGap())),f=d*(c.getLeftMargin()+c.getRightMargin()+c.getHorizontalGap())+c.getLeftMargin(),g=d*(c.getWidth()+c.getHorizontalGap())+c.getLeftMargin();a.x<g?f-=g-a.x:(d=d*(c.getWidth()+c.getHorizontalGap())+c.getWidth()-c.getRightMargin(),a.x>d&&(f-=
d-a.x-1));d=e*(c.getTopMargin()+c.getBottomMargin()+c.getVerticalGap())+c.getTopMargin();g=e*(c.getHeight()+c.getVerticalGap())+c.getTopMargin();a.y<g?d-=g-a.y:(c=e*(c.getHeight()+c.getVerticalGap())+c.getHeight()-c.getBottomMargin(),a.y>c&&(d-=c-a.y-1));c=void 0!=b?b:new JSG.geometry.Point(0,0);c.set(f,d);return c};JSG.graph.view.GraphView.prototype.setLayerOrder=function(a){this._layerOrder=a};
JSG.graph.view.GraphView.prototype.getLayer=function(a){function b(a,b){var d=c._layerOrder.indexOf(a),l=c._layerOrder.indexOf(b);return d-l}var c=this,d=this._layerViews.get(a);void 0==d&&(d=[],this._layerViews.put(a,d),void 0!=this._layerOrder&&this._layerViews.sort(b));return d};JSG.graph.view.GraphView.prototype.hasLayer=function(a){a=this._layerViews.get(a);return void 0!=a&&0<a.length};JSG.graph.view.GraphView.prototype.clearLayer=function(a){return this._layerViews.remove(a)};
JSG.graph.view.GraphView.prototype.clearAllLayer=function(){this._layerViews.clear()};JSG.graph.view.GraphView.prototype.addFeedback=function(a){this._feedbackViews.push(a)};JSG.graph.view.GraphView.prototype.hasFeedback=function(){return!this._feedbackViews.isEmpty()};JSG.graph.view.GraphView.prototype.removeFeedback=function(a){this._feedbackViews.remove(a)};JSG.graph.view.GraphView.prototype.clearFeedback=function(){this._feedbackViews=[]};JSG.graph.view.GraphView.prototype.setSelectionView=function(a){this.getLayer(JSG.graph.view.LayerId.SELECTION).push(a)};
JSG.graph.view.GraphView.prototype.removeSelectionView=function(){this.clearLayer(JSG.graph.view.LayerId.SELECTION)};JSG.graph.view.GraphView.prototype.setOverlayView=function(a){this.clearFeedback();this.removeSelectionView();this._overlayView=a};JSG.graph.view.GraphView.prototype.removeOverlayView=function(){this._overlayView=void 0};JSG.graph.view.GraphView.prototype.getPreferredBounds=function(a,b){return this.getItem().getTotalBoundingRect(void 0,b)};
JSG.graph.view.GraphView.Cache=function(a){this.canvas=a;this.redraw=!0};JSG.namespace("JSG.graph.view");JSG.graph.view.TextView=function(a){JSG.graph.view.TextView._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.view.TextView,JSG.graph.view.NodeView);JSG.graph.view.TextView.prototype.drawFill=function(a,b,c){JSG.graph.view.TextView._super.drawFill.call(this,a,b,c);this.drawText(a,b,c)};
JSG.graph.view.TextView.prototype.drawText=function(a,b,c){var d=this._item._lines||[],e=this._item.getFontMetrics(),f=this._item._getTextFormat(),g=this._item.getItemAttributes();f.applyToGraphics(a,e.height);a.setLineColor(f.getFontColor().getValue());a.setLineWidth(JSG.graph.model.attributes.LineStyle.HAIRLINE);var l=g.getTopMargin().getValue()+e.height/2;this.setLinkTextFormat(a,b);this.applyFontConditionsToGraphics(a);a.setFont();b=0;for(var h=d.length;b<h;b++){var m=d[b].replace(/&nbsp;/g," ");
switch(f.getHorizontalAlignment().getValue()){case JSG.graph.attr.TextFormatAttributes.TextAlignment.LEFT:a.fillText(m,g.getLeftMargin().getValue(),l);break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER:a.fillText(m,c.width/2,l);break;case JSG.graph.attr.TextFormatAttributes.TextAlignment.RIGHT:a.fillText(m,c.width-g.getRightMargin().getValue(),l)}l+=e.height}f.removeFromGraphics(a)};
JSG.graph.view.TextView.prototype.applyFontConditionsToGraphics=function(a){for(var b=this._item.getConditions(),c=0;c<b.length;c++){var d=b[c],e=d.getExpression().getValue();if("undefined"!=e){switch(d.getAttributeId()){case "fontstyle":a.setFontStyle(e);break;case "fontsize":a.setFontSize(e);break;case "fontname":a.setFontName(e);break;case "fontcolor":a.setFillColor(e)}if(d.getFinal())break}}};JSG.graph.view.TextView.prototype.setLinkTextFormat=function(a,b){};JSG.namespace("JSG.graph.view");
JSG.graph.view.SelectionFeedbackView=function(a){JSG.graph.view.SelectionFeedbackView._super.constructor.apply(this,arguments);this._box=new JSG.geometry.BoundingBox(0,0);this._point=new JSG.geometry.Point(0,0);this._activeMarker=a;this.feedbackInfoVisible=!0};JSG.extend(JSG.graph.view.SelectionFeedbackView,JSG.ui.View);JSG.graph.view.SelectionFeedbackView.prototype.setBoundingBox=function(a){this._box.setTo(a)};JSG.graph.view.SelectionFeedbackView.prototype.setPoint=function(a){this._point.setTo(a)};
JSG.graph.view.SelectionFeedbackView.prototype.draw=function(a){var b=JSG.boxCache.get().setTo(this._box),c=b.getTopLeft(JSG.ptCache.get()),d=a.getCoordinateSystem();a.save();a.translate(c.x,c.y);a.rotate(b.getAngle());b.translate(-c.x,-c.y);var e=b.getPointsUnrotated(),f=JSG.rectCache.get();f.set(0,0,d.metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.MARKER_SIZE),d.metricToLogYNoZoom(JSG.graph.view.selection.SelectionView.MARKER_SIZE));JSG.boxCache.release(b);12!=this._activeMarker&&(a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID),
a.setFillColor("#FFFFFF"),a.setTransparency(80),a.fillPolyline(e));a.setTransparency(100);a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR);a.setLineColor(JSG.graph.view.selection.SelectionView.MARKER_BORDER_COLOR);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);switch(this._activeMarker){case 9:a.setFillColor(JSG.graph.view.selection.NodeSelectionHandler.RESHAPEMARKER_FILL_COLOR);f.x=this._point.x-f.width/2;f.y=this._point.y-f.height/2;a.drawMarker(f,!0);break;case 8:var b=
JSG.ptCache.get(),g=JSG.ptCache.get();g.set((e[1].x+e[0].x)/2,(e[1].y+e[0].y)/2-d.metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.ROTATE_MARKER_DISTANCE));b.set((e[2].x+e[0].x)/2,(e[2].y+e[0].y)/2);a.setLineColor(JSG.graph.view.selection.SelectionView.LINE_COLOR);a.setLineStyle(JSG.graph.model.attributes.LineStyle.DASH);a.drawLine(g,b);JSG.ptCache.release(b,g);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);f.x=(e[1].x+e[0].x)/2-f.width/2;f.y=(e[1].y+e[0].y)/2-f.height/2-d.metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.ROTATE_MARKER_DISTANCE);
a.drawMarker(f,!0);f.x=(e[2].x+e[0].x)/2-f.width/2;f.y=(e[2].y+e[0].y)/2-f.height/2;a.drawMarker(f,!1);break;case 10:case 11:case 12:break;default:switch(this._activeMarker){case 0:f.x=e[0].x-f.width/2;f.y=e[0].y-f.height/2;break;case 1:f.x=(e[1].x+e[0].x)/2-f.width/2;f.y=(e[1].y+e[0].y)/2-f.height/2;break;case 2:f.x=e[1].x-f.width/2;f.y=e[1].y-f.height/2;break;case 3:f.x=(e[2].x+e[1].x)/2-f.width/2;f.y=(e[2].y+e[1].y)/2-f.height/2;break;case 4:f.x=e[2].x-f.width/2;f.y=e[2].y-f.height/2;break;case 5:f.x=
(e[3].x+e[2].x)/2-f.width/2;f.y=(e[3].y+e[2].y)/2-f.height/2;break;case 6:f.x=e[3].x-f.width/2;f.y=e[3].y-f.height/2;break;case 7:f.x=(e[3].x+e[0].x)/2-f.width/2,f.y=(e[3].y+e[0].y)/2-f.height/2}a.drawMarker(f,!0)}12!=this._activeMarker&&(a.setLineWidth(JSG.graph.model.attributes.LineStyle.HAIRLINE),a.setLineColor(JSG.graph.view.selection.SelectionView.LINE_COLOR),a.setLineStyle(JSG.graph.model.attributes.LineStyle.DASH),a.drawPolyline(e,!0));a.restore();var l;switch(this._activeMarker){case 9:break;
case 12:l="Position: "+Number(this._point.x/100).format(2,".",",","")+" x "+Number(this._point.y/100).format(2,".",",","")+" mm";break;case 10:l="Position: "+Number(this._box.getTopLeft(c).x/100).format(2,".",",","")+" x "+Number(this._box.getTopLeft(c).y/100).format(2,".",",","")+" mm";break;case 8:l="Angle: "+Number(180*this._box.getAngle()/Math.PI).format(2,".",",","")+" degrees";break;default:l="Size: "+Number(this._box.getWidth()/100).format(2,".",",","")+" x "+Number(this._box.getHeight()/100).format(2,
".",",","")+" mm"}l&&this.feedbackInfoVisible&&(a.setLineWidth(JSG.graph.model.attributes.LineStyle.HAIRLINE),a.setLineColor("#FFFFFF"),a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID),a.setFillColor(JSG.bkColorButton),a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID),a.setLineCorner(100),e=600/d.getZoom(),f=this._box.getBoundingRectangle(f),f.height=e,f.y=f.y-e-100,a.setFontSize(8/d.getZoom()),a.setTextAlign(JSG.graph.attr.TextFormatAttributes.TextAlignment.CENTER),a.setFont(),
a.setTextBaseline("middle"),d=d.deviceToLogX(a.measureText(l).width)+200,f.x=f.getCenterX()-d/2,f.width=d,d=f.getPoints(),a.fillPolyline(d),a.drawPolyline(d,!0),a.setFillColor("#FFFFFF"),a.fillText(l,f.getCenterX(),f.getCenterY()));JSG.rectCache.release(f);JSG.ptCache.release(c)};JSG.namespace("JSG.graph.view");
JSG.graph.view.PositionFeedbackView=function(){JSG.graph.view.PositionFeedbackView._super.constructor.apply(this,arguments);this._point=new JSG.geometry.Point(0,0);this._fillColor=JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR;this._lineColor=JSG.graph.view.selection.SelectionView.MARKER_BORDER_COLOR;this._active=!0};JSG.extend(JSG.graph.view.PositionFeedbackView,JSG.ui.View);JSG.graph.view.PositionFeedbackView.prototype.setPosition=function(a){this._point.setTo(a)};
JSG.graph.view.PositionFeedbackView.prototype.getPosition=function(a){return(a||new JSG.geometry.Point).setTo(this._point)};JSG.graph.view.PositionFeedbackView.prototype.setFillColor=function(a){this._fillColor=a};JSG.graph.view.PositionFeedbackView.prototype.setActive=function(a){this._active=a};
JSG.graph.view.PositionFeedbackView.prototype.draw=function(a){var b=JSG.rectCache.get();b.set(0,0,a.getCoordinateSystem().metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.MARKER_SIZE),a.getCoordinateSystem().metricToLogYNoZoom(JSG.graph.view.selection.SelectionView.MARKER_SIZE));b.x=this._point.x-b.width/2;b.y=this._point.y-b.height/2;a.setFillColor(this._fillColor);a.setLineColor(this._lineColor);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.drawMarker(b,this._active);JSG.rectCache.release(b)};
JSG.namespace("JSG.graph.view");JSG.graph.view.MarqueeFeedbackView=function(){JSG.graph.view.MarqueeFeedbackView._super.constructor.apply(this,arguments);this._bgColor="rgba(0,0,0,0.2)";this._fgColor="#000000";this._image=void 0;this._lineWidth=JSG.graph.model.attributes.LineStyle.HAIRLINE;this._bounds=new JSG.geometry.Rectangle(0,0,0,0)};JSG.extend(JSG.graph.view.MarqueeFeedbackView,JSG.ui.View);JSG.graph.view.MarqueeFeedbackView.prototype.containsPoint=function(a){return this._bounds.containsPoint(a)};
JSG.graph.view.MarqueeFeedbackView.prototype.getBounds=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);a.setTo(this._bounds);return a};JSG.graph.view.MarqueeFeedbackView.prototype.setBounds=function(a,b,c,d){this._bounds.set(a,b,c,d)};JSG.graph.view.MarqueeFeedbackView.prototype.getOrigin=function(a){a=a?a:new JSG.geometry.Point(0,0);a.set(this._bounds.x,this._bounds.y);return a};JSG.graph.view.MarqueeFeedbackView.prototype.getCenter=function(a){return this._bounds.getCenter(a)};
JSG.graph.view.MarqueeFeedbackView.prototype.draw=function(a){a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID);a.setFillColor(this._bgColor);a.setLineColor(this._fgColor);a.setLineWidth(this._lineWidth);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);this._image&&a.setShadow("#AAAAAA",a.getCoordinateSystem().metricToDeviceX(100),a.getCoordinateSystem().metricToDeviceY(100),5);a.fillRect(this._bounds);if(this._image){a.setShadow("#AAAAAA",0,0,0);var b=JSG.imagePool.add(this._image);
b&&a.drawImage(b,this._bounds.x+this._bounds.height/6,this._bounds.y+this._bounds.height/6,this._bounds.width-this._bounds.height/3,this._bounds.height-this._bounds.height/3)}a.drawRect(this._bounds)};JSG.namespace("JSG.graph.view");
JSG.graph.view.SnapFeedbackView=function(){JSG.graph.view.SnapFeedbackView._super.constructor.apply(this,arguments);this._lineColor="rgba(255,0,0,0.5)";this._lineWidth=JSG.graph.model.attributes.LineStyle.HAIRLINE;this._origin=new JSG.geometry.Point(0,0);this._target=new JSG.geometry.Point(0,0)};JSG.extend(JSG.graph.view.SnapFeedbackView,JSG.ui.View);JSG.graph.view.SnapFeedbackView.prototype.setOriginTo=function(a){this.setOrigin(a.x,a.y)};
JSG.graph.view.SnapFeedbackView.prototype.setOrigin=function(a,b){this._origin.set(a,b)};JSG.graph.view.SnapFeedbackView.prototype.getOrigin=function(a){a=a||new JSG.geometry.Point(0,0);a.setTo(this._origin);return a};JSG.graph.view.SnapFeedbackView.prototype.setTargetTo=function(a){this.setTarget(a.x,a.y)};JSG.graph.view.SnapFeedbackView.prototype.setTarget=function(a,b){this._target.set(a,b)};
JSG.graph.view.SnapFeedbackView.prototype.draw=function(a){a.setLineColor(this._lineColor);a.setLineWidth(this._lineWidth);a.setLineStyle(JSG.graph.model.attributes.LineStyle.DASH);a.drawLine(this._origin,this._target)};JSG.namespace("JSG.graph.view");JSG.graph.view.LayerId={PORTS:"layer.ports",FRIENDS:"layer.friends",SELECTION:"layer.selection",SNAPLINES:"layer.snaplines",LAYOUTMARKER:"layer.layoutmarker",TARGETCONTAINER:"layer.targetcontainer"};JSG.namespace("JSG.graph.view.selection");
JSG.graph.view.selection.SelectionHandle=function(a,b,c){JSG.graph.view.selection.SelectionHandle._super.constructor.apply(this,arguments);this._pointIndex=void 0!=c?c:-1};JSG.extend(JSG.graph.view.selection.SelectionHandle,JSG.graph.interaction.ActionHandle);JSG.graph.view.selection.SelectionHandle.TYPE={MOVE:"move",EXECUTE:"execute",COMMAND:"command",RESIZE:"resize",RESHAPE:"reshape",ROTATE:"rotate",EDITTEXT:"edittext"};
JSG.graph.view.selection.SelectionHandle.INDEX={NW:0,N:1,NE:2,E:3,SE:4,S:5,SW:6,W:7};JSG.graph.view.selection.SelectionHandle.prototype.reset=function(){JSG.graph.view.selection.SelectionHandle._super.reset.call(this);this._pointIndex=-1};JSG.graph.view.selection.SelectionHandle.prototype.getPointIndex=function(){return this._pointIndex};JSG.graph.view.selection.SelectionHandle.prototype.setPointIndex=function(a){this._pointIndex=a};JSG.namespace("JSG.graph.view.selection");
JSG.graph.view.selection.CommandButton=function(a,b,c,d){this._type=a;this._bounds=new JSG.geometry.Rectangle(0,0,JSG.graph.view.selection.SelectionView.COMMAND_BUTTON_SIZE,JSG.graph.view.selection.SelectionView.COMMAND_BUTTON_SIZE);this._position=b;this._image=c;this._command=d};JSG.graph.view.selection.CommandButton.Type={ADD:0,CALLBACK:1,ADDPARENT:2,ADDCHILD:3,ADDSIBLINGBEFORE:4,ADDSIBLINGAFTER:5};JSG.graph.view.selection.CommandButton.Position={LEFT:1,CENTER:2,RIGHT:4,TOP:8,MIDDLE:16,BOTTOM:32};
JSG.graph.view.selection.CommandButton.prototype.getType=function(){return this._type};JSG.graph.view.selection.CommandButton.prototype.getPosition=function(){return this._position};JSG.graph.view.selection.CommandButton.prototype.getImage=function(){return this._iamge};JSG.graph.view.selection.CommandButton.prototype.getBounds=function(){return this._bounds};JSG.graph.view.selection.CommandButton.prototype.setSize=function(a){this._bounds.width=this._bounds.height=a};
JSG.graph.view.selection.CommandButton.prototype.draw=function(a){a.setFillStyle(JSG.graph.model.attributes.FillStyle.PATTERN);a.setPattern(this._bounds,this._image,JSG.graph.model.attributes.PatternStyle.CENTER);var b=this._bounds.getPoints();a.fillPolyline(b);a.drawPolyline(b,!0)};JSG.graph.view.selection.CommandButton.prototype.containsPoint=function(a){return this._bounds.containsPoint(a)};JSG.namespace("JSG.graph.view.selection");
JSG.graph.view.selection.Marker=function(a,b,c){this._index=a;this._bounds=new JSG.geometry.Rectangle(0,0,0,0);this._coordinate=void 0!=b?b:JSG.graph.Coordinate.fromXY(0,0);this._cursor=JSG.ui.Cursor.Style.AUTO;this._disabled=c;this._tolerance=JSG.findRadius;this._active=!1};JSG.graph.view.selection.Marker.prototype.setSize=function(a){this._bounds.width=this._bounds.height=a};
JSG.graph.view.selection.Marker.prototype.draw=function(a){var b=JSG.ptCache.get(),c=this._bounds.width/2;this._tolerance=a.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);this._coordinate.toPoint(b);this._bounds.x=b.x-c;this._bounds.y=b.y-c;this.drawMarker(a,this._bounds,this._active);JSG.ptCache.release(b)};JSG.graph.view.selection.Marker.prototype.drawMarker=function(a,b,c){a.drawMarker(b,c)};
JSG.graph.view.selection.Marker.prototype.containsPoint=function(a){var b=this._bounds.getCenter(JSG.ptCache.get());a=a.x>=b.x-this._tolerance&&a.x<=b.x+this._tolerance&&a.y>=b.y-this._tolerance&&a.y<=b.y+this._tolerance;JSG.ptCache.release(b);return a};JSG.namespace("JSG.graph.view.selection");JSG.graph.view.selection.RotationMarker=function(a,b){JSG.graph.view.selection.RotationMarker._super.constructor.apply(this,arguments);this._pinbounds=new JSG.geometry.Rectangle(0,0,0,0)};
JSG.extend(JSG.graph.view.selection.RotationMarker,JSG.graph.view.selection.Marker);JSG.graph.view.selection.RotationMarker.prototype.setSize=function(a){JSG.graph.view.selection.RotationMarker._super.setSize.call(this,a);this._pinbounds.width=this._pinbounds.height=a};JSG.graph.view.selection.RotationMarker.prototype.getPinLocation=function(a){a=a?a:new JSG.geometry.Point(0,0);return this._pinbounds.getCenter(a)};
JSG.graph.view.selection.RotationMarker.prototype.setPinLocation=function(a){this._pinbounds.x=a.x;this._pinbounds.y=a.y;this._coordinate.setX(a.x)};
JSG.graph.view.selection.RotationMarker.prototype.draw=function(a){var b=JSG.ptCache.get(),c=JSG.ptCache.get(),d=JSG.ptCache.get(),e=this._bounds.width/2;this._tolerance=a.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);this._coordinate.setY(-a.getCoordinateSystem().metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.ROTATE_MARKER_DISTANCE));this._coordinate.toPoint(d);this._bounds.x=d.x;this._bounds.y=d.y;c.set(this._bounds.x,this._bounds.y);b.set(this._pinbounds.x,0);a.setLineColor(JSG.graph.view.selection.SelectionView.LINE_COLOR);
a.setLineStyle(JSG.graph.model.attributes.LineStyle.DASH);a.drawLine(c,b);JSG.ptCache.release(b,c,d);this._bounds.x-=e;this._bounds.y-=e;this._pinbounds.x-=e;this._pinbounds.y-=e;a.setLineColor(JSG.graph.view.selection.SelectionView.MARKER_BORDER_COLOR);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);this.drawMarker(a,this._bounds)};JSG.namespace("JSG.graph.view.selection");
JSG.graph.view.selection.BBoxSelectionHandler=function(a,b){function c(a,b){return new JSG.graph.expr.Term.Mul(JSG.graph.expr.Term.fromReference(a.copy()),JSG.graph.expr.Term.fromNumber(b))}function d(a,b){return new JSG.graph.Coordinate(new JSG.graph.expr.NumberExpression(0,void 0,a),new JSG.graph.expr.NumberExpression(0,void 0,b))}this._rootView=b;this._markers=[];this._bbox=new JSG.geometry.BoundingBox(0,0);this._tolerance=JSG.findRadius;var e=new JSG.graph.expr.Reference(this,JSG.graph.properties.GraphItemProperties.WIDTH,
this),f=new JSG.graph.expr.Reference(this,JSG.graph.properties.GraphItemProperties.HEIGHT,this);this._sizeable=a?a.getItem().isSizeable():!0;this._rotatable=a?a.getItem().isRotatable():!0;this._moveable=a?a.getItem().isMoveable():!0;this._markers.push(new JSG.graph.view.selection.Marker(0,d(),!this._sizeable));this._markers.push(new JSG.graph.view.selection.Marker(1,d(c(e,0.5)),!this._sizeable));this._markers.push(new JSG.graph.view.selection.Marker(2,d(c(e,1)),!this._sizeable));this._markers.push(new JSG.graph.view.selection.Marker(3,
d(c(e,1),c(f,0.5)),!this._sizeable));this._markers.push(new JSG.graph.view.selection.Marker(4,d(c(e,1),c(f,1)),!this._sizeable));this._markers.push(new JSG.graph.view.selection.Marker(5,d(c(e,0.5),c(f,1)),!this._sizeable));this._markers.push(new JSG.graph.view.selection.Marker(6,d(void 0,c(f,1)),!this._sizeable));this._markers.push(new JSG.graph.view.selection.Marker(7,d(void 0,c(f,0.5)),!this._sizeable));this._markers.push(new JSG.graph.view.selection.RotationMarker(8,d(),!this._rotatable))};
JSG.graph.view.selection.BBoxSelectionHandler.prototype.getPropertyValue=function(){var a=Array.prototype.shift.call(arguments);if(void 0!=a.getter)return(String.isString(a.getter)?this[a.getter]:a.getter).apply(this,arguments)};JSG.graph.view.selection.BBoxSelectionHandler.prototype.getWidth=function(){return this._bbox.getWidth()};JSG.graph.view.selection.BBoxSelectionHandler.prototype.getHeight=function(){return this._bbox.getHeight()};
JSG.graph.view.selection.BBoxSelectionHandler.prototype.getBoundingBox=function(a){a=void 0!=a?a:new JSG.geometry.BoundingBox(0,0);a.setTo(this._bbox);return a};JSG.graph.view.selection.BBoxSelectionHandler.prototype.containsPoint=function(a){return this._bbox.containsPoint(a)};
JSG.graph.view.selection.BBoxSelectionHandler.prototype.getPinPoint=function(a){a=this._markers[8].getPinLocation(a);this._bbox.rotateLocalPoint(a);var b=this._bbox.getTopLeft(JSG.ptCache.get());a.add(b);JSG.ptCache.release(b);return a};JSG.graph.view.selection.BBoxSelectionHandler.prototype.getRotationMarker=function(){return this._markers[8]};
JSG.graph.view.selection.BBoxSelectionHandler.prototype.refresh=function(a,b){var c=JSG.ptCache.get();a[0].getTranslatedBoundingBox(this._rootView,this._bbox);if(1<a.length){var d=this._bbox,e=this._rootView.getItem();d.setSize(0,0);d.setAngle(b);for(var f=0;f<a.length;f++){var g=a[f].getItem().getTranslatedShapePoints(e);d.enclosePoints(g)}c.set(d.getWidth()/2,d.getHeight()/2)}else a[0].getPin().getLocalPoint(c);this._markers[8].setPinLocation(c);JSG.ptCache.release(c)};
JSG.graph.view.selection.BBoxSelectionHandler.prototype.drawMarkers=function(a,b){var c=JSG.boxCache.get().setTo(this._bbox),d=c.getTopLeft(JSG.ptCache.get());this._tolerance=a.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);a.save();a.translate(d.x,d.y);a.rotate(c.getAngle());c.translate(-d.x,-d.y);a.setLineWidth(JSG.graph.model.attributes.LineStyle.HAIRLINE);a.setLineColor(JSG.graph.view.selection.SelectionView.LINE_COLOR);a.setLineStyle(JSG.graph.model.attributes.LineStyle.DASH);a.drawPolyline(c.getPointsUnrotated(),
!0);a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID);a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR);a.setLineColor(JSG.graph.view.selection.SelectionView.MARKER_BORDER_COLOR);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);this._markers.forEach(function(c){c.setSize(b);c._disabled?a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR_DISABLED):a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR);c.draw(a)});this._drawAdditionalMarkers(a,
b);a.restore();JSG.ptCache.release(d);JSG.boxCache.release(c)};JSG.graph.view.selection.BBoxSelectionHandler.prototype._drawAdditionalMarkers=function(a,b){};
JSG.graph.view.selection.BBoxSelectionHandler.prototype.getHandleAt=function(a,b,c,d){b=void 0!=d?d:new JSG.graph.view.selection.SelectionHandle;d=JSG.boxCache.get().setTo(this._bbox);var e=JSG.ptCache.get().setTo(a);b.reset();this._bbox.transformPoint(e);d.expandBy(c);if(d.containsPoint(a)){if(this._moveable&&(this._bbox.getHeight()<3*this._tolerance||this._bbox.getWidth()<3*this._tolerance)&&this._bbox.containsPoint(a))return b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.MOVE),b.setCursor(JSG.ui.Cursor.Style.MOVE),
JSG.ptCache.release(e),JSG.boxCache.release(d),b;if(this._sizeable){var f=this._getMarkerAt(e);if(f&&!f._disabled)return this._fillHandle(b,f),JSG.ptCache.release(e),JSG.boxCache.release(d),b}}d.reduceBy(c);if(d.containsPoint(a)&&this._moveable)return b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.MOVE),b.setCursor(JSG.ui.Cursor.Style.MOVE),JSG.ptCache.release(e),JSG.boxCache.release(d),b;this._rotatable&&(!this._markers[8]._disabled&&this._markers[8].containsPoint(e)?(b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.ROTATE),
b.setCursor(JSG.ui.Cursor.Style.ROTATE)):b=void 0);JSG.ptCache.release(e);JSG.boxCache.release(d);return b};JSG.graph.view.selection.BBoxSelectionHandler.prototype._getMarkerAt=function(a){for(var b=this._markers,c=0;c<b.length;c++)if(b[c].containsPoint(a))return b[c]};
JSG.graph.view.selection.BBoxSelectionHandler.prototype._fillHandle=function(a,b){a.setType(JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE);a.setCursor(function(a){switch(a){case 0:return JSG.ui.Cursor.Style.RESIZE_NW;case 1:return JSG.ui.Cursor.Style.RESIZE_N;case 2:return JSG.ui.Cursor.Style.RESIZE_NE;case 3:return JSG.ui.Cursor.Style.RESIZE_E;case 4:return JSG.ui.Cursor.Style.RESIZE_SE;case 5:return JSG.ui.Cursor.Style.RESIZE_S;case 6:return JSG.ui.Cursor.Style.RESIZE_SW;case 7:return JSG.ui.Cursor.Style.RESIZE_W}}(b._index));
a.setPointIndex(b._index)};JSG.namespace("JSG.graph.view.selection");JSG.graph.view.selection.NodeSelectionHandler=function(a,b){JSG.graph.view.selection.NodeSelectionHandler._super.constructor.apply(this,arguments);this._reshapeMarkers;this._addReshapeMarkers(a)};JSG.extend(JSG.graph.view.selection.NodeSelectionHandler,JSG.graph.view.selection.BBoxSelectionHandler);JSG.graph.view.selection.NodeSelectionHandler.RESHAPEMARKER_FILL_COLOR="#00C00D";
JSG.graph.view.selection.NodeSelectionHandler.prototype._addReshapeMarkers=function(a){this._reshapeMarkers=[];a=a.getItem().getReshapeCoordinates();for(var b=new JSG.graph.expr.Reference(this,JSG.graph.properties.GraphItemProperties.WIDTH,this),c=new JSG.graph.expr.Reference(this,JSG.graph.properties.GraphItemProperties.HEIGHT,this),d,e,f=JSG.graph.expr.Term,g=0,l=a.length;g<l;g++){var h=a[g];d=h.getX().getValue();e=h.getY().getValue();switch(h.getType()){case JSG.graph.ReshapeType.XRELATIVETOWIDTH:d=
new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(b.copy()),f.fromNumber(d)));e=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(c.copy()),f.fromNumber(e)));break;case JSG.graph.ReshapeType.XRELATIVETOWIDTHFROMRIGHT:d=new f.Mul(f.fromReference(b.copy()),f.fromNumber(d));d=new JSG.graph.expr.Expression(0,void 0,new f.Sub(f.fromReference(b.copy()),d));e=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(c.copy()),f.fromNumber(e)));break;case JSG.graph.ReshapeType.XRELATIVETOHEIGHT:d=
new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(c.copy()),f.fromNumber(d)));e=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(c.copy()),f.fromNumber(e)));break;case JSG.graph.ReshapeType.XRELATIVETOHEIGHTFROMRIGHT:d=new f.Mul(f.fromReference(c.copy()),f.fromNumber(d));d=new JSG.graph.expr.Expression(0,void 0,new f.Sub(f.fromReference(b.copy()),d));e=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(c.copy()),f.fromNumber(e)));break;case JSG.graph.ReshapeType.YRELATIVETOHEIGHT:d=
new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(b.copy()),f.fromNumber(d)));e=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(c.copy()),f.fromNumber(e)));break;case JSG.graph.ReshapeType.YRELATIVETOHEIGHTFROMBOTTOM:d=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(b.copy()),f.fromNumber(d)));e=new f.Mul(f.fromReference(c.copy()),f.fromNumber(e));e=new JSG.graph.expr.Expression(0,void 0,new f.Sub(f.fromReference(c.copy()),e));break;case JSG.graph.ReshapeType.YRELATIVETOWIDTH:d=
new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(b.copy()),f.fromNumber(d)));e=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(b.copy()),f.fromNumber(e)));break;case JSG.graph.ReshapeType.YRELATIVETOWIDTHFROMBOTTOM:d=new JSG.graph.expr.Expression(0,void 0,new f.Mul(f.fromReference(b.copy()),f.fromNumber(d)));e=new f.Mul(f.fromReference(b.copy()),f.fromNumber(e));e=new JSG.graph.expr.Expression(0,void 0,new f.Sub(f.fromReference(c.copy()),e));break;default:d=new JSG.graph.expr.NumberExpression(d),
e=new JSG.graph.expr.NumberExpression(e)}h=new JSG.graph.ReshapeCoordinate(d,e,h._xMin,h._xMax,h._yMin,h._yMax,h._name,h._type,h._vertical);h=new JSG.graph.view.selection.Marker(g,h,!1);h._type=JSG.graph.view.selection.SelectionHandle.TYPE.RESHAPE;this._reshapeMarkers.push(h)}};JSG.graph.view.selection.NodeSelectionHandler.prototype.refresh=function(a,b){this._addReshapeMarkers(a[0]);JSG.graph.view.selection.NodeSelectionHandler._super.refresh.call(this,a,b)};
JSG.graph.view.selection.NodeSelectionHandler.prototype._drawAdditionalMarkers=function(a,b){a.setFillColor(JSG.graph.view.selection.NodeSelectionHandler.RESHAPEMARKER_FILL_COLOR);this._reshapeMarkers.forEach(function(c){c.setSize(b);c.draw(a)})};JSG.graph.view.selection.NodeSelectionHandler.prototype._getMarkerAt=function(a){for(var b=this._reshapeMarkers,c=0;c<b.length;c++)if(b[c].containsPoint(a))return b[c];return JSG.graph.view.selection.NodeSelectionHandler._super._getMarkerAt.call(this,a)};
JSG.graph.view.selection.NodeSelectionHandler.prototype._fillHandle=function(a,b){void 0!=b._type?(a.setType(b._type),a.setCursor(JSG.ui.Cursor.Style.CROSS),a.setPointIndex(b._index)):JSG.graph.view.selection.NodeSelectionHandler._super._fillHandle.call(this,a,b)};JSG.namespace("JSG.graph.view.selection");JSG.graph.view.selection.TextSelectionHandler=function(a,b){this._view=a;JSG.graph.view.selection.TextSelectionHandler._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.view.selection.TextSelectionHandler,JSG.graph.view.selection.BBoxSelectionHandler);
JSG.graph.view.selection.TextSelectionHandler.prototype.getHandleAt=function(a,b,c,d){d=void 0!=d?d:new JSG.graph.view.selection.SelectionHandle;var e=JSG.boxCache.get().setTo(this._bbox);d.reset();e.reduceBy(c);e.containsPoint(a)&&(""!=this._view.getItem().getLink().getValue()&&b.event.ctrlKey)&&(d.setCursor(JSG.ui.Cursor.Style.EXECUTE),d.setType(JSG.graph.view.selection.SelectionHandle.TYPE.EXECUTE));JSG.boxCache.release(e);return void 0!=d.getType()?d:JSG.graph.view.selection.TextSelectionHandler._super.getHandleAt.call(this,
a,b,c,d)};JSG.namespace("JSG.graph.view.selection");JSG.graph.view.selection.LineSelectionHandler=function(a,b){this._lineview=a;this._rootView=b;this._bbox=new JSG.geometry.BoundingBox(0,0);this._linepoints=[];this._linemarkers=[];this._markerFactory=function(){return new JSG.graph.view.selection.Marker(0,JSG.graph.Coordinate.fromXY(0,0))}};JSG.graph.view.selection.LineSelectionHandler.prototype.getBoundingBox=function(a){a=void 0!=a?a:new JSG.geometry.BoundingBox(0,0);a.setTo(this._bbox);return a};
JSG.graph.view.selection.LineSelectionHandler.prototype.containsPoint=function(a){return this._lineview.getItem().containsPoint(a)};JSG.graph.view.selection.LineSelectionHandler.prototype.getPinPoint=function(a){return void 0!=a?a:new JSG.geometry.Point(0,0)};JSG.graph.view.selection.LineSelectionHandler.prototype.getRotationMarker=function(){};JSG.graph.view.selection.LineSelectionHandler.prototype.refresh=function(a,b){this._lineview=a[0];this._lineview.getTranslatedBoundingBox(this._rootView,this._bbox)};
JSG.graph.view.selection.LineSelectionHandler.prototype.drawMarkers=function(a,b){var c=this._lineview.getItem(),d=c.getPoints(this._linepoints);this._linemarkers.keep(d.length,this._markerFactory);a.save();a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID);a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.setLineColor(JSG.graph.view.selection.SelectionView.MARKER_BORDER_COLOR);if(JSG.debug.SHOW_LINE_ORIGIN){a.setFillColor("#FF0000");var e=c.getPinPoint(),f=this._linemarkers[0];
f._coordinate.set(e.x,e.y);f.setSize(b);f.draw(a)}c.isSizeable()?a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR):a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR_DISABLED);this._drawMarkerPoints(d,b,a);a.restore()};JSG.graph.view.selection.LineSelectionHandler.prototype._drawMarkerPoints=function(a,b,c){for(var d=0;d<a.length;d++)this._drawMarkerAt(d,a[d],this._linemarkers[d],b,c)};
JSG.graph.view.selection.LineSelectionHandler.prototype._drawMarkerAt=function(a,b,c,d,e){this._translatePointUp(b,this._lineview.getItem().getParent());c._coordinate.set(b.x,b.y);c.setSize(d);c.draw(e)};JSG.graph.view.selection.LineSelectionHandler.prototype._translatePointUp=function(a,b){JSG.graph.Utils.traverseUp(b,this._rootView,function(b){b.translateToParent(a);return!0})};
JSG.graph.view.selection.LineSelectionHandler.prototype.getHandleAt=function(a,b,c,d){b=void 0!=d?d:new JSG.graph.view.selection.SelectionHandle;b.reset();var e=!1,f=this._lineview._item;d=JSG.ptCache.get().setTo(a);var g=f.getGraph();d=JSG.graph.Utils.translatePointDown(d,this._rootView.getItem(),this._lineview.getParent().getItem());for(var l=0,h=f.getItemCount();l<h;l++)if(label=f.getItemAt(l),label.getTranslatedBoundingBox(g).containsPoint(d)){e=!0;break}e||((c=this._getMarkerAt(a,c))?this._lineview._item.isSizeable()&&
(b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE),b.setCursor(c._cursor),b.setPointIndex(c._index)):this._lineview._item.isMoveable()&&(JSG.graph.Utils.traverseDown(this._rootView,this._lineview.getParent(),function(b){b.translateFromParent(a)}),c=JSG.findRadius/g.getZoom(),this._lineview.containsPoint(a,0,c)&&(b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.MOVE),b.setCursor(JSG.ui.Cursor.Style.MOVE))));JSG.ptCache.release(d);return b};
JSG.graph.view.selection.LineSelectionHandler.prototype._getMarkerAt=function(a,b){for(var c=void 0,d=0;d<this._linemarkers.length;d++)if(this._linemarkers[d].containsPoint(a)){this._linemarkers[d]._index=d;this._linemarkers[d]._isCenter=!1;var c=this._linemarkers[d],e;e=0==d?JSG.ui.Cursor.Style.RESIZE_NW:d==this._linemarkers.length-1?JSG.ui.Cursor.Style.RESIZE_SE:JSG.ui.Cursor.Style.RESIZE_NE;c._cursor=e;c=this._linemarkers[d];break}return c};JSG.namespace("JSG.graph.view.selection");
JSG.graph.view.selection.OrthoLineSelectionHandler=function(a,b){JSG.graph.view.selection.OrthoLineSelectionHandler._super.constructor.call(this,a,b);this._centermarkers=[];this._centerMarkerFactory=function(){return new JSG.graph.view.selection.Marker(0,JSG.graph.Coordinate.fromXY(0,0))}};JSG.extend(JSG.graph.view.selection.OrthoLineSelectionHandler,JSG.graph.view.selection.LineSelectionHandler);
JSG.graph.view.selection.OrthoLineSelectionHandler.prototype.drawMarkers=function(a,b){this._drawinfo={};this._drawinfo.center=new JSG.geometry.Point(0,0);this._drawinfo.prevPoint=new JSG.geometry.Point(0,0);this._drawinfo.centersize=3*b/4;JSG.graph.view.selection.OrthoLineSelectionHandler._super.drawMarkers.call(this,a,b);delete this._drawinfo};
JSG.graph.view.selection.OrthoLineSelectionHandler.prototype._drawMarkerPoints=function(a,b,c){this._centermarkers.keep(a.length-1,this._centerMarkerFactory);this._drawinfo.lastpoint=a.length-1;this._drawinfo.prevPoint.setTo(a[0]);JSG.graph.view.selection.OrthoLineSelectionHandler._super._drawMarkerPoints.call(this,a,b,c)};
JSG.graph.view.selection.OrthoLineSelectionHandler.prototype._drawMarkerAt=function(a,b,c,d,e){if(0<a){var f=this._drawinfo,g;g=this._drawinfo.prevPoint;var l=this._drawinfo.center,l=void 0!=l?l:new JSG.geometry.Point(0,0);l.x=(b.x-g.x)/2;l.y=(b.y-g.y)/2;g=l.add(g);f.center=g;this._drawinfo.prevPoint.setTo(b);JSG.graph.view.selection.OrthoLineSelectionHandler._super._drawMarkerAt.call(this,a,this._drawinfo.center,this._centermarkers[a-1],this._drawinfo.centersize,e);a<this._drawinfo.lastpoint&&(d=
this._drawinfo.centersize)}JSG.graph.view.selection.OrthoLineSelectionHandler._super._drawMarkerAt.call(this,a,b,c,d,e)};
JSG.graph.view.selection.OrthoLineSelectionHandler.prototype.getHandleAt=function(a,b,c,d){b=void 0!=d?d:new JSG.graph.view.selection.SelectionHandle;b.reset();var e=!1,f=this._lineview._item;d=JSG.ptCache.get().setTo(a);d=JSG.graph.Utils.translatePointDown(d,this._rootView.getItem(),this._lineview.getParent().getItem());for(var g=0,l=f.getItemCount();g<l;g++)if(label=f.getItemAt(g),label.getTranslatedBoundingBox(f.getGraph()).containsPoint(d)){e=!0;break}e||((a=this._getMarkerAt(a,c))?a._isCenter?
this._lineview._item.isMoveable()&&(b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.MOVE),b.setCursor(a._cursor),b.setPointIndex(a._index)):this._lineview._item.isSizeable()&&(b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE),b.setCursor(a._cursor),b.setPointIndex(a._index)):this._lineview._item.isSizeable()&&(c=this._lineview.getLineSegmentAtPoint(d,c/2),-1!=c&&(b.setType(JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE),b.setCursor(JSG.ui.Cursor.Style.CROSS),b._segmentIndex=
c)));JSG.ptCache.release(d);return b};
JSG.graph.view.selection.OrthoLineSelectionHandler.prototype._getMarkerAt=function(a,b){var c=JSG.graph.view.selection.OrthoLineSelectionHandler._super._getMarkerAt.call(this,a,b);if(void 0==c&&this._lineview._item.isMoveable())for(var d=0;d<this._centermarkers.length;d++)if(this._centermarkers[d].containsPoint(a)){this._centermarkers[d]._index=d;this._centermarkers[d]._isCenter=!0;this._centermarkers[d]._cursor=JSG.ui.Cursor.Style.MOVE;c=this._centermarkers[d];break}return c};JSG.namespace("JSG.graph.view.selection");
JSG.graph.view.selection.SelectionView=function(a){JSG.graph.view.selection.SelectionView._super.constructor.apply(this,arguments);this._rootView=a;this._views=[];this._commandButtons=void 0;this._rotationAngle=0;this._selectionHandler=void 0;this._selectionHandle=new JSG.graph.view.selection.SelectionHandle};JSG.extend(JSG.graph.view.selection.SelectionView,JSG.ui.View);JSG.graph.view.selection.SelectionView.LINE_COLOR="#777777";JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR="#90B5EE";
JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR_DISABLED="#CCCCCC";JSG.graph.view.selection.SelectionView.MARKER_BORDER_COLOR="#AAAAAA";JSG.graph.view.selection.SelectionView.MARKER_SIZE=JSG.touchDevice?450:200;JSG.graph.view.selection.SelectionView.FRIEND_UNIT=200;JSG.graph.view.selection.SelectionView.ROTATE_MARKER_DISTANCE=JSG.touchDevice?1200:800;JSG.graph.view.selection.SelectionView.COMMAND_BUTTON_SIZE=800;JSG.graph.view.selection.SelectionView.prototype.addView=function(a){this._views.push(a)};
JSG.graph.view.selection.SelectionView.prototype.getCommandButtonAt=function(a){return this._commandButtons[a]};JSG.graph.view.selection.SelectionView.prototype.getViews=function(){return this._views};JSG.graph.view.selection.SelectionView.prototype.removeView=function(a){this._views.remove(a);this._reshapeHandles=[]};JSG.graph.view.selection.SelectionView.prototype.removeAllViews=function(){this._views=[];this._reshapeHandles=[]};
JSG.graph.view.selection.SelectionView.prototype.updateSelectionDelegate=function(){switch(this._views.length){case 0:this._commandButtons=this._selectionHandler=void 0;break;case 1:var a=this._views[0];this._selectionHandler=a._item instanceof JSG.graph.model.LineConnection?a._item._shape instanceof JSG.graph.model.shapes.OrthoLineShape?new JSG.graph.view.selection.OrthoLineSelectionHandler(a,this._rootView):new JSG.graph.view.selection.LineSelectionHandler(a,this._rootView):a._item instanceof JSG.graph.model.TextNode?
new JSG.graph.view.selection.TextSelectionHandler(a,this._rootView):new JSG.graph.view.selection.NodeSelectionHandler(a,this._rootView);this._commandButtons=JSG.graphItemFactory.getCommandButtons(a.getItem());break;default:this._selectionHandler=new JSG.graph.view.selection.BBoxSelectionHandler(void 0,this._rootView),this._commandButtons=void 0}};JSG.graph.view.selection.SelectionView.prototype.refresh=function(){void 0!=this._selectionHandler&&this._selectionHandler.refresh(this._views,this._rotationAngle)};
JSG.graph.view.selection.SelectionView.prototype.isVisible=function(){return!this._views.isEmpty()&&this._isVisible};JSG.graph.view.selection.SelectionView.prototype.isSingleSelection=function(){return 1==this._views.length};JSG.graph.view.selection.SelectionView.prototype.getRotationAngle=function(){return this._rotationAngle};JSG.graph.view.selection.SelectionView.prototype.setRotationAngle=function(a){this._rotationAngle=a};
JSG.graph.view.selection.SelectionView.prototype.getBoundingBox=function(a){a=void 0!=a?a:new JSG.geometry.BoundingBox(0,0);void 0!=this._selectionHandler?a=this._selectionHandler.getBoundingBox(a):a.reset();return a};JSG.graph.view.selection.SelectionView.prototype.containsPoint=function(a){return void 0!=this._selectionHandler?this._selectionHandler.containsPoint(a):!1};
JSG.graph.view.selection.SelectionView.prototype.getPinPoint=function(a){a=void 0!=a?a:new JSG.geometry.Point(0,0);void 0!=this._selectionHandler?a=this._selectionHandler.getPinPoint(a):a.set(0,0);return a};
JSG.graph.view.selection.SelectionView.prototype.getHandleAt=function(a,b){var c=void 0;if(void 0!=this._selectionHandler){var c=b.cs.metricToLogXNoZoom(JSG.findRadius),d=JSG.graph.view.selection.SelectionHandle.TYPE,c=this._selectionHandler.getHandleAt(a,b,c,this._selectionHandle);if((void 0==c||c._type===d.MOVE||c._type===d.RESIZE)&&1===this._views.length){var d=this._views[0],e=d.getItem(),f=JSG.ptCache.get().setTo(a);JSG.graph.Utils.translatePointDown(f,e.getGraph(),e);d.hitCollapseButton(f)&&
(c=new JSG.graph.view.selection.SelectionHandle,c.setCursor(JSG.ui.Cursor.Style.AUTO));JSG.ptCache.release(f)}if(void 0!=c&&void 0!=c._type)return c}c=void 0;d=JSG.ptCache.get().setTo(a);if(this._commandButtons)for(e=0;e<this._commandButtons.length;e++)if(f=this._commandButtons[e],void 0!=f._image&&f._bounds.containsPoint(d)){c=new JSG.graph.view.selection.SelectionHandle;c.setCursor(JSG.ui.Cursor.Style.EXECUTE);c.setPointIndex(e);c.setType(JSG.graph.view.selection.SelectionHandle.TYPE.COMMAND);break}JSG.ptCache.release(d);
return c};
JSG.graph.view.selection.SelectionView.prototype.draw=function(a){var b=a.getCoordinateSystem(),c=a.getCoordinateSystem().deviceToLogXNoZoom(16);if(this.isVisible()&&void 0!=this._selectionHandler&&(b=b.metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.MARKER_SIZE),this._selectionHandler.refresh(this._views,this._rotationAngle),this._selectionHandler.drawMarkers(a,b),this._commandButtons&&this._commandButtons.length&&this.isSingleSelection())){var b=this.getBoundingBox(JSG.boxCache.get()),d=
b.getBoundingRectangle(JSG.rectCache.get());this._views[0].getItem();a.setLineColor("#FFFFFF");a.setLineWidth(10);for(var e=0;e<this._commandButtons.length;e++){var f=this._commandButtons[e],g=0;y=0;f.getPosition()&JSG.graph.view.selection.CommandButton.Position.LEFT?g=d.x-c-500:f.getPosition()&JSG.graph.view.selection.CommandButton.Position.CENTER?g=d.getCenterX()-c/2:f.getPosition()&JSG.graph.view.selection.CommandButton.Position.RIGHT&&(g=d.getRight()+500);f.getPosition()&JSG.graph.view.selection.CommandButton.Position.TOP?
y=d.y-c-1E3:f.getPosition()&JSG.graph.view.selection.CommandButton.Position.MIDDLE?y=d.getCenterY()-c/2:f.getPosition()&JSG.graph.view.selection.CommandButton.Position.BOTTOM&&(y=d.getBottom()+500);f._bounds.set(g,y,c,c);f.draw(a)}JSG.boxCache.release(b);JSG.rectCache.release(d)}};JSG.graph.view.selection.SelectionView.prototype.getRotationMarker=function(){return this._selectionHandler.getRotationMarker()};JSG.namespace("JSG.graph.view");
JSG.graph.view.SelectionProvider=function(){this.listeners=[];this._selection=new JSG.commons.StableMap;this._selcontext=void 0};JSG.graph.view.SelectionProvider.SELECTION_CHANGED_NOTIFICATION="selectionprovider.selection.changed.notification";JSG.graph.view.SelectionProvider.prototype.addSelectionChangedListener=function(a){this.listeners.push(a)};JSG.graph.view.SelectionProvider.prototype.removeSelectionChangedListener=function(a){this.listeners.remove(a)};
JSG.graph.view.SelectionProvider.prototype._notifySelectionChanged=function(){this.listeners.forEach(function(a,b,c){a.onSelectionChanged()});JSG.graph.notifications.NotificationCenter.getInstance().send(new JSG.graph.notifications.Notification(JSG.graph.view.SelectionProvider.SELECTION_CHANGED_NOTIFICATION,this))};JSG.graph.view.SelectionProvider.prototype.getSelectionContext=function(){return this._selcontext};
JSG.graph.view.SelectionProvider.prototype.select=function(a,b){this._selcontext=b;this._doSelect(a)&&(JSG.debug.log("SELECT: "+a.getModel().getId(),JSG.debug.DUMP_ITEM_ID),this._notifySelectionChanged())};JSG.graph.view.SelectionProvider.prototype._doSelect=function(a){var b=a.getModel().getId();return this._selection.contains(b)?!1:(this._selection.put(b,a),a.setSelected(!0,!0),!0)};
JSG.graph.view.SelectionProvider.prototype.selectAll=function(a,b){var c=!1;JSG.setDrawingDisabled(!0);this._selcontext=b;for(var d=0,e=a.length;d<e;d++){var f=a[d];!f.isSelected()&&this._doSelect(f)&&(c=!0)}JSG.setDrawingDisabled(!1);!0==c&&this._notifySelectionChanged()};JSG.graph.view.SelectionProvider.prototype.setSelection=function(a,b){this._deselectAll(this._selection.elements());this._selection.clear();this.selectAll(a,b)};
JSG.graph.view.SelectionProvider.prototype.deselect=function(a){var b=a.getModel().getId();this._selection.remove(b)&&(a.setSelected(!1),this._notifySelectionChanged())};JSG.graph.view.SelectionProvider.prototype._deselectAll=function(a){for(var b=a.length-1;0<=b;b--)a[b].setSelected(!1,!0)};JSG.graph.view.SelectionProvider.prototype.hasSelection=function(){return!this._selection.isEmpty()};JSG.graph.view.SelectionProvider.prototype.hasSingleSelection=function(){return 1===this._selection.size()};
JSG.graph.view.SelectionProvider.prototype.isSelected=function(a){return this._selection.contains(a.getId())};JSG.graph.view.SelectionProvider.prototype.getSelection=function(){return this._selection.elements()};JSG.graph.view.SelectionProvider.prototype.getFirstSelection=function(){return this._selection.getFirst()};
JSG.graph.view.SelectionProvider.prototype.clearSelection=function(a){this._selcontext=void 0;this._selection.isEmpty()||(this._deselectAll(this._selection.elements()),this._selection.clear(),void 0!==a&&!0!==a||this._notifySelectionChanged())};JSG.namespace("JSG.graph.view");JSG.graph.view.PortView=function(a){JSG.graph.view.PortView._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.view.PortView,JSG.graph.view.GraphItemView);JSG.graph.view.PortView.prototype.drawFill=function(a,b,c){};
JSG.graph.view.PortView.prototype.drawBorder=function(a,b,c){a.setLineColor("#0000FF");a.setLineWidth(JSG.graph.model.attributes.LineStyle.HAIRLINE);this._shapeRenderer.drawShapeBorder(this._item._shape,this._item.isClosed(),a)};JSG.namespace("JSG.graph.view");
JSG.graph.view.EditShapeView=function(a){JSG.graph.view.EditShapeView._super.constructor.apply(this,arguments);this._markers=void 0;this._isClosed=!0;this._origin=new JSG.geometry.Point(0,0);this._rotmatrix=new JSG.geometry.Matrix;this._markersize=a.metricToLogXNoZoom(JSG.graph.view.EditShapeView.MARKER_SIZE);this._tolerance=a.metricToLogXNoZoom(JSG.findRadius)};JSG.extend(JSG.graph.view.EditShapeView,JSG.ui.View);JSG.graph.view.EditShapeView.MARKER_SIZE=JSG.graph.view.selection.SelectionView.MARKER_SIZE;
JSG.graph.view.EditShapeView.prototype._tmpmarker=void 0;JSG.graph.view.EditShapeView.prototype._getTmpMarker=function(){this._tmpmarker||(this._tmpmarker=new JSG.graph.view.EditShapeView.Marker(-1,new JSG.geometry.Point(0,0),this._markersize),this._tmpmarker.isTemporary=!0);return this._tmpmarker};
JSG.graph.view.EditShapeView.prototype.setPointList=function(a,b,c){var d=this,e=this._markersize/2;this._origin.setTo(b);this._rotmatrix.setAngle(c);this._markers=[];a.forEach(function(a,b){var c=a.copy();c.x-=e;c.y-=e;d._markers.push(new JSG.graph.view.EditShapeView.Marker(b,c,d._markersize))})};JSG.graph.view.EditShapeView.prototype.setIsClosed=function(a){this._isClosed=a};
JSG.graph.view.EditShapeView.prototype.translatePoint=function(a){a.subtract(this._origin);this._rotmatrix.rotatePointInverse(a);return a};
JSG.graph.view.EditShapeView.prototype.draw=function(a){function b(b,c){a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.drawLine(b,c)}a.save();a.translate(this._origin.x,this._origin.y);a.rotate(this._rotmatrix.getAngle());a.setLineColor("#000000");a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);var c=void 0,d=void 0;this._markers.forEach(function(a){d||(d=a.center);c&&b(c,a.center);c=a.center});this._isClosed&&b(c,d);this._markers.forEach(function(b){b.draw(a)});a.restore()};
JSG.graph.view.EditShapeView.prototype.getMarker=function(a){return this._markers[a]};JSG.graph.view.EditShapeView.prototype.insertMarker=function(a){-1==a.index&&(a=new JSG.graph.view.EditShapeView.Marker(a._insertIndex,new JSG.geometry.Point(0,0),this._markersize),this._markers.insert(a,a.index));return a};JSG.graph.view.EditShapeView.prototype.deleteMarker=function(a){this._markers.remove(a)};
JSG.graph.view.EditShapeView.prototype.getMarkerPoints=function(){var a=[];this._markers.forEach(function(b){b=b.center.copy();a.push(b)});return a};JSG.graph.view.EditShapeView.prototype.getMarkerCount=function(){return this._markers.length};
JSG.graph.view.EditShapeView.prototype.getMarkerAt=function(a){function b(b,c){var g=Math.min(b.x,c.x)-f,k=Math.max(b.x,c.x)+f,n=Math.min(b.y,c.y)-f,q=Math.max(b.y,c.y)+f;if(g<a.x&&a.x<k&&n<a.y&&a.y<q)return JSG.geometry.Utils.getLinePointDistance(b,c,a)<=d._tolerance?e:void 0}var c=void 0,d=this;this._markers.every(function(b){return b.contains(a)?(c=b,!1):!0});if(!c){var e=this._getTmpMarker(),f=this._markersize/2,g=this._markers.length-1;for(i=0;i<g;i++)if(c=b(this._markers[i].center,this._markers[i+
1].center)){c._insertIndex=i+1;break}!c&&(c=b(this._markers[0].center,this._markers[g].center))&&(c._insertIndex=g+1)}return c};JSG.graph.view.EditShapeView.Marker=function(a,b,c){this.index=a;this._origin=b;this._insertIndex=-1;this._bounds=new JSG.geometry.Rectangle(b.x,b.y,c,c);this.center=new JSG.geometry.Point(0,0);this._bounds.getCenter(this.center);this.isTemporary=!1;this._tolerance=JSG.findRadius};
JSG.graph.view.EditShapeView.Marker.prototype.draw=function(a){this._tolerance=a.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR);a.drawMarker(this._bounds,!1)};JSG.graph.view.EditShapeView.Marker.prototype.contains=function(a){var b=this._bounds.getCenter(JSG.ptCache.get());a=a.x>=b.x-this._tolerance&&a.x<=b.x+this._tolerance&&a.y>=b.y-this._tolerance&&a.y<=b.y+this._tolerance;JSG.ptCache.release(b);return a};
JSG.graph.view.EditShapeView.Marker.prototype.getLocation=function(a){a=void 0!=a?a:new JSG.geometry.Point(0,0);a.set(this._bounds.x,this._bounds.y);return a};JSG.graph.view.EditShapeView.Marker.prototype.setLocationTo=function(a){a&&this.setLocation(a.x,a.y)};JSG.graph.view.EditShapeView.Marker.prototype.setLocation=function(a,b){this._bounds.x=a;this._bounds.y=b;this._bounds.getCenter(this.center)};JSG.namespace("JSG.graph.view");
JSG.graph.view.EditLineShapeView=function(a){JSG.graph.view.EditLineShapeView._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.view.EditLineShapeView,JSG.graph.view.EditShapeView);JSG.graph.view.EditLineShapeView.prototype.setPointList=function(a,b,c){JSG.graph.view.EditLineShapeView._super.setPointList.call(this,a,b,c)};
JSG.graph.view.EditLineShapeView.prototype.getMarkerPoints=function(){var a=[],b=this;this._markers.forEach(function(c){c=c.center.copy();b._rotmatrix.rotatePoint(c);c.add(b._origin);a.push(c)});return a};JSG.namespace("JSG.graph.view");JSG.graph.view.EditBezierShapeView=function(a){JSG.graph.view.EditBezierShapeView._super.constructor.apply(this,arguments);this._cpMarkersize=a.metricToLogXNoZoom(JSG.graph.view.EditBezierShapeView.MARKER_SIZE)};JSG.extend(JSG.graph.view.EditBezierShapeView,JSG.graph.view.EditShapeView);
JSG.graph.view.EditBezierShapeView.MARKER_SIZE=100;JSG.graph.view.EditBezierShapeView.prototype.setCpToPointList=function(a,b,c){var d=this,e=this._cpMarkersize/2;this._origin.setTo(b);this._rotmatrix.setAngle(c);this._cpToMarkers=[];a.forEach(function(a,b){var c=a.copy();c.x-=e;c.y-=e;d._cpToMarkers.push(new JSG.graph.view.EditBezierShapeView.Marker(b,c,d._cpMarkersize))})};
JSG.graph.view.EditBezierShapeView.prototype.setCpFromPointList=function(a,b,c){var d=this,e=this._cpMarkersize/2;this._origin.setTo(b);this._rotmatrix.setAngle(c);this._cpFromMarkers=[];a.forEach(function(a,b){var c=a.copy();c.x-=e;c.y-=e;d._cpFromMarkers.push(new JSG.graph.view.EditBezierShapeView.Marker(b,c,d._cpMarkersize))})};
JSG.graph.view.EditBezierShapeView.prototype.draw=function(a){a.save();a.translate(this._origin.x,this._origin.y);a.rotate(this._rotmatrix.getAngle());a.setLineColor("#000000");a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.beginPath();a.moveTo(this._markers[0].center.x,this._markers[0].center.y);for(var b=1,c=this._markers.length;b<c;b++)a.bezierCurveTo(this._cpToMarkers[b-1].center.x,this._cpToMarkers[b-1].center.y,this._cpFromMarkers[b].center.x,this._cpFromMarkers[b].center.y,this._markers[b].center.x,
this._markers[b].center.y);this._isClosed&&(a.bezierCurveTo(this._cpToMarkers[this._markers.length-1].center.x,this._cpToMarkers[this._markers.length-1].center.y,this._cpFromMarkers[0].center.x,this._cpFromMarkers[0].center.y,this._markers[0].center.x,this._markers[0].center.y),a.closePath());a.stroke();this._markers.forEach(function(b){b.draw(a)});a.setLineColor("#AAAAAA");a.setFillColor("#FFFFFF");b=0;for(c=this._markers.length;b<c;b++)(b<c-1||this._isClosed)&&a.drawLine(this._markers[b].center,
this._cpToMarkers[b].center),(b||this._isClosed)&&a.drawLine(this._markers[b].center,this._cpFromMarkers[b].center);a.setLineColor("#000000");b=this._isClosed?0:1;b;for(c=this._cpFromMarkers.length;b<c;b++)this._cpFromMarkers[b].draw(a);c=this._isClosed?this._cpToMarkers.length:this._cpToMarkers.length-1;for(b=0;b<c;b++)this._cpToMarkers[b].draw(a);a.restore()};
JSG.graph.view.EditBezierShapeView.prototype.insertMarker=function(a){if(-1==a.index){var b=new JSG.graph.view.EditShapeView.Marker(a._insertIndex,new JSG.geometry.Point(0,0),this._markersize);this._markers.insert(b,b.index);var c=new JSG.graph.view.EditBezierShapeView.Marker(a._insertIndex,new JSG.geometry.Point(0,0),this._cpMarkersize);this._cpFromMarkers.insert(c,b.index);a=new JSG.graph.view.EditBezierShapeView.Marker(a._insertIndex,new JSG.geometry.Point(0,0),this._cpMarkersize);this._cpToMarkers.insert(a,
b.index);return b}return a};JSG.graph.view.EditBezierShapeView.prototype.deleteMarker=function(a){this._markers.remove(a)};JSG.graph.view.EditBezierShapeView.prototype.deleteCpToMarker=function(a){this._cpToMarkers.remove(a)};JSG.graph.view.EditBezierShapeView.prototype.deleteCpFromMarker=function(a){this._cpFromMarkers.remove(a)};JSG.graph.view.EditBezierShapeView.prototype.getMarkerPoints=function(a){return this._getMarkerPoints(a,this._markers)};
JSG.graph.view.EditBezierShapeView.prototype.getCpFromMarkerPoints=function(a){return this._getMarkerPoints(a,this._cpFromMarkers)};JSG.graph.view.EditBezierShapeView.prototype.getCpToMarkerPoints=function(a){return this._getMarkerPoints(a,this._cpToMarkers)};JSG.graph.view.EditBezierShapeView.prototype._getMarkerPoints=function(a,b){var c=[],d=this;b.forEach(function(b){b=b.center.copy();!0==a&&(d._rotmatrix.rotatePoint(b),b.add(d._origin));c.push(b)});return c};
JSG.graph.view.EditShapeView.prototype.getCpFromMarker=function(a){return this._cpFromMarkers[a]};JSG.graph.view.EditShapeView.prototype.getCpToMarker=function(a){return this._cpToMarkers[a]};JSG.graph.view.EditBezierShapeView.prototype.getMarkerCount=function(){return this._markers.length};JSG.graph.view.EditBezierShapeView.prototype.getMarkerIndexOf=function(a){return this._markers.indexOf(a)};
JSG.graph.view.EditBezierShapeView.prototype.getMarkerAt=function(a){function b(b,c,f,m){function k(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e}for(var n=new JSG.geometry.PointList,q=0;1>q;q+=0.1){var p=k(q,b.x,f.x,m.x,c.x),s=k(q,b.y,f.y,m.y,c.y);n.addPoint(new JSG.geometry.Point(p,s))}return n.distance(a)<d._tolerance?e:void 0}var c=this._getMarkerAt(a,this._markers),d=this;if(!c){var e=this._getTmpMarker(),f=this._markers.length-1;for(i=0;i<f;i++)if(c=b(this._markers[i].center,
this._markers[i+1].center,this._cpToMarkers[i].center,this._cpFromMarkers[i+1].center)){c._insertIndex=i+1;break}!c&&(c=b(this._markers[f].center,this._markers[0].center,this._cpToMarkers[f].center,this._cpFromMarkers[0].center))&&(c._insertIndex=f+1)}return c};JSG.graph.view.EditBezierShapeView.prototype.getCpFromMarkerAt=function(a){return this._getMarkerAt(a,this._cpFromMarkers)};JSG.graph.view.EditBezierShapeView.prototype.getCpToMarkerAt=function(a){return this._getMarkerAt(a,this._cpToMarkers)};
JSG.graph.view.EditBezierShapeView.prototype._getMarkerAt=function(a,b){var c=void 0;b.every(function(b){return b.contains(a)?(c=b,!1):!0});return c};JSG.graph.view.EditBezierShapeView.Marker=function(a,b,c,d){JSG.graph.view.EditBezierShapeView.Marker._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.view.EditBezierShapeView.Marker,JSG.graph.view.EditShapeView.Marker);
JSG.graph.view.EditBezierShapeView.Marker.prototype.draw=function(a){this._tolerance=a.getCoordinateSystem().metricToLogXNoZoom(JSG.findRadius);a.setFillColor(JSG.graph.view.selection.SelectionView.MARKER_FILL_COLOR);a.drawMarker(this._bounds,!1)};JSG.namespace("JSG.graph.view");JSG.graph.view.BBoxView=function(){JSG.graph.view.BBoxView._super.constructor.apply(this,arguments);this._bbox=new JSG.geometry.BoundingBox(0,0);this._format=new JSG.graph.attr.FormatAttributes};
JSG.extend(JSG.graph.view.BBoxView,JSG.ui.View);JSG.graph.view.BBoxView.prototype.getPoints=function(){return this._bbox.getPoints()};JSG.graph.view.BBoxView.prototype.containsPoint=function(a){return this._bbox.containsPoint(a)};JSG.graph.view.BBoxView.prototype.getAngle=function(){return this._bbox.getAngle()};JSG.graph.view.BBoxView.prototype.getBoundingBox=function(){return this._bbox};JSG.graph.view.BBoxView.prototype.getLocation=function(){return this._bbox.getTopLeft()};
JSG.graph.view.BBoxView.prototype.getFormat=function(){return this._format};JSG.graph.view.BBoxView.prototype.getSize=function(){return new JSG.geometry.Point(this._bbox.getWidth(),this._bbox.getHeight())};JSG.graph.view.BBoxView.prototype.setAngle=function(a){this._bbox.setAngle(a)};JSG.graph.view.BBoxView.prototype.setSize=function(a,b){this._bbox.setWidth(a);this._bbox.setHeight(b)};JSG.graph.view.BBoxView.prototype.setLocation=function(a,b){this._bbox.setTopLeft(a,b)};
JSG.graph.view.BBoxView.prototype.draw=function(a){a.save();this.translateGraphics(a);this.drawBackground(a);this.drawSubViews(a);this.drawBorder(a);this.drawDecorations(a);a.restore()};JSG.graph.view.BBoxView.prototype.translateGraphics=function(a){};
JSG.graph.view.BBoxView.prototype.drawBackground=function(a){if(this._format.hasFill()){var b=this._bbox.toRectangle(JSG.rectCache.get());b.setLocation(0,0);this._format.applyFillToGraphics(a,b);this._format.applyShadowToGraphics(a,b);a.fillPolyline(this.getPoints());this._format.removeShadowFromGraphics(a);JSG.rectCache.release(b)}};
JSG.graph.view.BBoxView.prototype.drawSubViews=function(a){a.save();var b=this._bbox.getTopLeft(JSG.ptCache.get());a.translate(b.x,b.y);JSG.ptCache.release(b);for(var b=0,c=this._subviews.length;b<c;b++)this._subviews[b].draw(a);a.restore()};JSG.graph.view.BBoxView.prototype.drawBorder=function(a){this._format.hasBorder()&&(this._format.applyLineToGraphics(a),a.drawPolyline(this.getPoints(),!0),this._format.removeLineFromGraphics(a))};JSG.graph.view.BBoxView.prototype.drawDecorations=function(a){};
JSG.namespace("JSG.graph.view.shapes");JSG.graph.view.shapes.DefaultShapeRenderer=function(){};JSG.graph.view.shapes.DefaultShapeRenderer.prototype.drawShapeFill=function(a,b,c){this.fillShapePoints(a.getPoints(),b,c)};JSG.graph.view.shapes.DefaultShapeRenderer.prototype.drawShapeBorder=function(a,b,c){this.drawShapePoints(a.getPoints(),b,c)};JSG.graph.view.shapes.DefaultShapeRenderer.prototype.fillShapePoints=function(a,b,c){c.fillPolyline(a)};
JSG.graph.view.shapes.DefaultShapeRenderer.prototype.drawShapePoints=function(a,b,c){c.drawPolyline(a,!0)};JSG.graph.view.shapes.DefaultShapeRenderer.prototype.setClipArea=function(a,b){b.setClipArea(void 0,a.getPoints(),void 0)};JSG.namespace("JSG.graph.view.shapes");JSG.graph.view.shapes.BezierShapeRenderer=function(){JSG.graph.view.shapes.BezierShapeRenderer._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.view.shapes.BezierShapeRenderer,JSG.graph.view.shapes.DefaultShapeRenderer);
JSG.graph.view.shapes.BezierShapeRenderer.prototype.drawShapeFill=function(a,b,c){var d=a.getPoints();this.fillShapePoints(d,b,c,a.getCpToPoints(d),a.getCpFromPoints(d))};JSG.graph.view.shapes.BezierShapeRenderer.prototype.drawShapeBorder=function(a,b,c){var d=a.getPoints();this.drawShapePoints(d,b,c,a.getCpToPoints(d),a.getCpFromPoints(d))};JSG.graph.view.shapes.BezierShapeRenderer.prototype.fillShapePoints=function(a,b,c,d,e){!b||2>a.length||c.fillBezier(d,a,e)};
JSG.graph.view.shapes.BezierShapeRenderer.prototype.drawShapePoints=function(a,b,c,d,e){2>a.length||c.drawBezier(d,a,e,b)};JSG.graph.view.shapes.BezierShapeRenderer.prototype.setClipArea=function(a,b){var c=a.getPoints();b.setClipArea(a.getCpToPoints(c),c,a.getCpFromPoints(c))};JSG.namespace("JSG.graph.view.shapes");JSG.graph.view.shapes.EllipseShapeRenderer=function(){JSG.graph.view.shapes.EllipseShapeRenderer._super.constructor.apply(this,arguments)};
JSG.extend(JSG.graph.view.shapes.EllipseShapeRenderer,JSG.graph.view.shapes.BezierShapeRenderer);JSG.graph.view.shapes.EllipseShapeRenderer.prototype.drawShapePoints=function(a,b,c,d,e){2>a.length||(c.antialias=!0,c.drawBezier(d,a,e,b),c.antialias=!1)};JSG.namespace("JSG.graph.view.shapes");JSG.graph.view.shapes.LineShapeRenderer=function(){JSG.graph.view.shapes.LineShapeRenderer._super.constructor.apply(this,arguments);this._context={}};JSG.extend(JSG.graph.view.shapes.LineShapeRenderer,JSG.graph.view.shapes.DefaultShapeRenderer);
JSG.graph.view.shapes.LineShapeRenderer.prototype.drawShapeFill=function(a,b,c){};JSG.graph.view.shapes.LineShapeRenderer.prototype.drawShapeBorder=function(a,b,c){this.drawShapePoints(a.getVisiblePoints(),b,c)};JSG.graph.view.shapes.LineShapeRenderer.prototype.fillShapePoints=function(a,b,c){};JSG.graph.view.shapes.LineShapeRenderer.prototype.drawShapePoints=function(a,b,c){this._context.endArrow=void 0;this._context.startArrow=void 0;c.drawPolyline(a,!1,this._context)};
JSG.graph.view.shapes.LineShapeRenderer.prototype.getContext=function(){return this._context};JSG.namespace("JSG.graph.view.shapes");JSG.graph.view.shapes.PolygonShapeRenderer=function(){JSG.graph.view.shapes.PolygonShapeRenderer._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.view.shapes.PolygonShapeRenderer,JSG.graph.view.shapes.DefaultShapeRenderer);JSG.graph.view.shapes.PolygonShapeRenderer.prototype.drawShapeFill=function(a,b,c){this.fillShapePoints(a.getPoints(),b,c)};
JSG.graph.view.shapes.PolygonShapeRenderer.prototype.drawShapeBorder=function(a,b,c){this.drawShapePoints(a.getPoints(),b,c)};JSG.graph.view.shapes.PolygonShapeRenderer.prototype.fillShapePoints=function(a,b,c){b&&c.fillPolyline(a)};JSG.graph.view.shapes.PolygonShapeRenderer.prototype.drawShapePoints=function(a,b,c){c.drawPolyline(a,b)};JSG.namespace("JSG.graph.view.shapes");
JSG.graph.view.shapes.RectangleShapeRenderer=function(){JSG.graph.view.shapes.RectangleShapeRenderer._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.view.shapes.RectangleShapeRenderer,JSG.graph.view.shapes.DefaultShapeRenderer);JSG.namespace("JSG.graph.view.shapes");
JSG.graph.view.shapes.ShapeRenderer=function(){var a=new JSG.commons.Map;a.put(JSG.graph.model.shapes.BezierShape.TYPE,new JSG.graph.view.shapes.BezierShapeRenderer);a.put(JSG.graph.model.shapes.EllipseShape.TYPE,new JSG.graph.view.shapes.EllipseShapeRenderer);a.put(JSG.graph.model.shapes.LineShape.TYPE,new JSG.graph.view.shapes.LineShapeRenderer);a.put(JSG.graph.model.shapes.OrthoLineShape.TYPE,new JSG.graph.view.shapes.LineShapeRenderer);a.put(JSG.graph.model.shapes.PolygonShape.TYPE,new JSG.graph.view.shapes.PolygonShapeRenderer);
a.put(JSG.graph.model.shapes.RectangleShape.TYPE,new JSG.graph.view.shapes.RectangleShapeRenderer);return{fromShape:function(b){(b=a.get(b.getType()))||(b=new JSG.graph.view.shapes.DefaultShapeRenderer);return b}}}();JSG.namespace("JSG.ui.viewer");JSG.ui.viewer.ControllerViewer=function(){this.rootController;this.controllerFactory;this.setRootController(new JSG.graph.controller.RootController);this._defaultController=this._defaultInteraction=void 0};
JSG.ui.viewer.ControllerViewer.prototype.destroy=function(){this._defaultInteraction=this.controllerFactory=this.rootController=void 0};JSG.ui.viewer.ControllerViewer.prototype.setControllerFactory=function(a){this.controllerFactory=a};JSG.ui.viewer.ControllerViewer.prototype.getControllerFactory=function(){return this.controllerFactory};JSG.ui.viewer.ControllerViewer.prototype.getGraph=function(){var a=this.rootController.getContent();return a?a.getModel():void 0};
JSG.ui.viewer.ControllerViewer.prototype.setGraph=function(a){a=this.controllerFactory.createController(a);this.setContent(a);this.getRootView().invalidate()};JSG.ui.viewer.ControllerViewer.prototype.getDefaultController=function(){return this._defaultController};JSG.ui.viewer.ControllerViewer.prototype.setDefaultController=function(a){this._defaultController=a};JSG.ui.viewer.ControllerViewer.prototype.getDefaultInteraction=function(){return this._defaultInteraction};
JSG.ui.viewer.ControllerViewer.prototype.setDefaultInteraction=function(a){this._defaultInteraction=a};JSG.ui.viewer.ControllerViewer.prototype.setContent=function(a){void 0!=a&&this.rootController.setContent(a)};JSG.ui.viewer.ControllerViewer.prototype.setRootController=function(a){this._deactivate(a);this._activate(a)};JSG.ui.viewer.ControllerViewer.prototype._deactivate=function(a){void 0!=a&&(a.isActive&&a.deactivate(),a.setView(void 0))};
JSG.ui.viewer.ControllerViewer.prototype._activate=function(a){this.rootController=a;this.rootController.setViewer(this);this.rootController.activate()};JSG.ui.viewer.ControllerViewer.prototype.getRootView=function(){return this.rootController.getView()};JSG.ui.viewer.ControllerViewer.prototype.getRootController=function(){return this.rootController};JSG.ui.viewer.ControllerViewer.prototype.findControllerAt=function(a,b,c){return this.rootController.getControllerAt(a,b,c)};
JSG.ui.viewer.ControllerViewer.prototype.findControllerByConditionAndLocation=function(a,b){return this.rootController.findControllerByConditionAndLocation(a,b)};JSG.ui.viewer.ControllerViewer.prototype.findControllerByConditionAndBox=function(a,b){return this.rootController.findControllerByConditionAndBox(a,b)};JSG.ui.viewer.ControllerViewer.prototype.setCursor=function(a){this.rootController.hasContent()&&this.rootController.getContent().setCursor(a)};
JSG.ui.viewer.ControllerViewer.prototype.addInteractionFeedback=function(a){this.rootController.hasContent()&&this.rootController.getContent().addFeedback(a)};JSG.ui.viewer.ControllerViewer.prototype.removeInteractionFeedback=function(a){this.rootController.hasContent()&&this.rootController.getContent().removeFeedback(a)};JSG.ui.viewer.ControllerViewer.prototype.clearInteractionFeedback=function(){this.rootController.hasContent()&&this.rootController.getContent().clearFeedback()};
JSG.ui.viewer.ControllerViewer.prototype.getLayer=function(a){return this.rootController.hasContent()?this.rootController.getContent().getLayer(a):void 0};JSG.ui.viewer.ControllerViewer.prototype.hasLayer=function(a){return this.rootController.hasContent()?this.rootController.getContent().hasLayer(a):!1};JSG.ui.viewer.ControllerViewer.prototype.clearLayer=function(a){return this.rootController.hasContent()?this.rootController.getContent().clearLayer(a):void 0};
JSG.ui.viewer.ControllerViewer.prototype.clearAllLayer=function(){this.rootController.hasContent()&&this.rootController.getContent().clearAllLayer()};JSG.ui.viewer.ControllerViewer.prototype.translateFromParent=function(a){return this.rootController.getView().translateFromParent(a)};JSG.ui.viewer.ControllerViewer.prototype.translateToParent=function(a){return this.rootController.getView().translateToParent(a)};
JSG.ui.viewer.ControllerViewer.prototype.translateToRoot=function(a,b){for(var c=this.rootController.getView();b._parent&&b._parent!==c;)b._parent.translateToParent(a),b=b._parent;return a};JSG.ui.viewer.ControllerViewer.prototype.translateFromRoot=function(a,b){var c=this.rootController.getView();JSG.graph.Utils.traverseDown(c,b,function(b){b.translateFromParent(a)});return a};JSG.namespace("JSG.ui.viewer");
JSG.ui.viewer.GraphViewer=function(a){JSG.ui.viewer.GraphViewer._super.constructor.apply(this,arguments);this._rootView;this._graphicSystem=a;this.setSelectionProvider(new JSG.graph.view.SelectionProvider);this.setDefaultInteraction(new JSG.graph.interaction.GraphInteraction)};JSG.extend(JSG.ui.viewer.GraphViewer,JSG.ui.viewer.ControllerViewer);JSG.ui.viewer.GraphViewer.prototype.destroy=function(){this._selectionProvider=this._graphicSystem=this._rootView=void 0;JSG.ui.viewer.GraphViewer._super.destroy.call(this)};
JSG.ui.viewer.GraphViewer.prototype.setContent=function(a){JSG.ui.viewer.GraphViewer._super.setContent.call(this,a);this._rootView=void 0==a?void 0:a.getView()};JSG.ui.viewer.GraphViewer.prototype.getGraphicSystem=function(){return this._graphicSystem};JSG.ui.viewer.GraphViewer.prototype.getCoordinateSystem=function(){return this._graphicSystem.getGraphics().getCoordinateSystem()};JSG.ui.viewer.GraphViewer.prototype.getGraphView=function(){return this.rootController.getView()};
JSG.ui.viewer.GraphViewer.prototype.getGraphController=function(){return this.rootController.getContent()};JSG.ui.viewer.GraphViewer.prototype.getGraphSettings=function(){var a=this.getGraph();return void 0!=a?a.getSettings():void 0};JSG.ui.viewer.GraphViewer.prototype.getHandleAt=function(a,b){return this.getSelectionView().getHandleAt(a,b)};
JSG.ui.viewer.GraphViewer.prototype.getSelectionView=function(){var a=this._rootView.getLayer(JSG.graph.view.LayerId.SELECTION);0===a.length&&a.push(new JSG.graph.view.selection.SelectionView(this._rootView));return a[0]};JSG.ui.viewer.GraphViewer.prototype.getSelectionProvider=function(){return this._selectionProvider};
JSG.ui.viewer.GraphViewer.prototype.setSelectionProvider=function(a){this._selectionProvider&&this._selectionProvider.removeSelectionChangedListener(this);(this._selectionProvider=a)&&this._selectionProvider.addSelectionChangedListener(this)};JSG.ui.viewer.GraphViewer.prototype.onSelectionChanged=function(){var a=this.getSelectionView();a.removeAllViews();for(var b=this._selectionProvider.getSelection(),c=0,d=b.length;c<d;c++)a.addView(b[c].getView());a.updateSelectionDelegate()};
JSG.ui.viewer.GraphViewer.prototype.clearSelection=function(a){this._selectionProvider.clearSelection(a);this.getSelectionView().setRotationAngle(0)};JSG.ui.viewer.GraphViewer.prototype.select=function(a,b){this._selectionProvider.select(a,b)};JSG.ui.viewer.GraphViewer.prototype.deselect=function(a){this._selectionProvider.deselect(a)};JSG.ui.viewer.GraphViewer.prototype.hasSelection=function(){return this._selectionProvider.hasSelection()};JSG.ui.viewer.GraphViewer.prototype.isSelected=function(a){return this._selectionProvider.isSelected(a)};
JSG.ui.viewer.GraphViewer.prototype.getSelection=function(){return this._selectionProvider.getSelection()};JSG.ui.viewer.GraphViewer.prototype.setSelection=function(a,b){this._selectionProvider.selectAll(a,b)};JSG.ui.viewer.GraphViewer.prototype.setOverlayView=function(a){this._rootView instanceof JSG.graph.view.GraphView&&this._rootView.setOverlayView(a)};JSG.ui.viewer.GraphViewer.prototype.removeOverlayView=function(a){this._rootView instanceof JSG.graph.view.GraphView&&this._rootView.removeOverlayView()};
JSG.ui.viewer.GraphViewer.prototype.findControllerForItem=function(a){return this.rootController.content.findModelController(a)};JSG.namespace("JSG.ui.viewer");JSG.ui.viewer.ScrollableViewer=function(a,b){JSG.ui.viewer.ScrollableViewer._super.constructor.apply(this,arguments);this._scrollPanel=void 0!=b?b:new JSG.ui.ScrollPanel(this);this._scrollPanel.setViewPanel(new JSG.ui.GraphViewPanel(this));this._decorator=new JSG.ui.viewer.ScrollableViewerInteractionDecorator(this._scrollPanel);this._decorator.decorateInteraction(this.getDefaultInteraction())};
JSG.extend(JSG.ui.viewer.ScrollableViewer,JSG.ui.viewer.GraphViewer);JSG.ui.viewer.ScrollableViewer.prototype.destroy=function(){this._decorator.destroy();this._scrollPanel=this._decorator=void 0;JSG.ui.viewer.ScrollableViewer._super.destroy.call(this)};JSG.ui.viewer.ScrollableViewer.prototype.setDefaultInteraction=function(a){void 0!=this._decorator&&this._decorator.decorateInteraction(a);JSG.ui.viewer.ScrollableViewer._super.setDefaultInteraction.call(this,a)};
JSG.ui.viewer.ScrollableViewer.prototype.layout=function(a,b){this._scrollPanel.setBounds(0,0,a,b);this._scrollPanel.layout()};JSG.ui.viewer.ScrollableViewer.prototype.setContent=function(a){JSG.ui.viewer.ScrollableViewer._super.setContent.call(this,a);this._scrollPanel.getViewPanel().setView(JSG.ui.viewer.ScrollableViewer._super.getRootView.call(this))};JSG.ui.viewer.ScrollableViewer.prototype.getRootView=function(){return this._scrollPanel};
JSG.ui.viewer.ScrollableViewer.prototype.getScrollPanel=function(){return this._scrollPanel};JSG.ui.viewer.ScrollableViewer.prototype.isScrollBarEvent=function(a){return this._isInScrollBar(this._scrollPanel._hScrollbar,a.location)||this._isInScrollBar(this._scrollPanel._vScrollbar,a.location)};JSG.ui.viewer.ScrollableViewer.prototype._isInScrollBar=function(a,b){return a.isVisible()&&a.getBounds().containsPoint(b)};
JSG.ui.viewer.ScrollableViewer.prototype.findControllerAt=function(a,b,c){a=JSG.ptCache.get(a.x,a.y);this.translateFromParent(a);b=JSG.ui.viewer.ScrollableViewer._super.findControllerAt.call(this,a,b,c);JSG.ptCache.release(a);return b};
JSG.ui.viewer.ScrollableViewer.prototype.findControllerByConditionAndLocation=function(a,b){var c=JSG.ptCache.get(a.x,a.y);this.translateFromParent(c);var d=JSG.ui.viewer.ScrollableViewer._super.findControllerByConditionAndLocation.call(this,c,b);JSG.ptCache.release(c);return d};JSG.ui.viewer.ScrollableViewer.prototype.findControllerByConditionAndBox=function(a,b){return JSG.ui.viewer.ScrollableViewer._super.findControllerByConditionAndBox.call(this,a,b)};
JSG.ui.viewer.ScrollableViewer.prototype.translateFromParent=function(a){this._scrollPanel.translateFromViewPort(a);return this.rootController.getView().translateFromParent(a)};JSG.ui.viewer.ScrollableViewer.prototype.translateToParent=function(a){this._scrollPanel.translateToViewPort(a);return this.rootController.getView().translateToParent(a)};
JSG.ui.viewer.ScrollableViewer.prototype.setZoom=function(a){function b(a){var b=c._scrollPanel.getBounds(JSG.rectCache.get());b.width=f.logToDeviceX(b.width);b.height=f.logToDeviceY(b.height);a=Math.min(a,8);a=Math.max(a,0.2);f.setZoom(a);c.layout(f.deviceToLogX(b.width),f.deviceToLogY(b.height));JSG.rectCache.release(b)}var c=this,d=this.getGraph(),e=d.getSettings(),f=this.getCoordinateSystem();if(0>a){var g=e.getPage(),l=d.getTotalBoundingRect(),h=JSG.ptCache.get(l.x,l.y),l=JSG.ptCache.get(l.getRight(),
l.getBottom());e.getDisplayMode()==JSG.ui.graphics.DisplayMode.PAGE&&(h.x=Math.floor(h.x/g.getUsableWidth())*(g.getLeftMargin()+g.getRightMargin()+g.getHorizontalGap())+g.getLeftMargin()+h.x,h.y=Math.floor(h.y/g.getUsableHeight())*(g.getTopMargin()+g.getBottomMargin()+g.getVerticalGap())+g.getTopMargin()+h.y,l.x=Math.floor(l.x/g.getUsableWidth())*(g.getLeftMargin()+g.getRightMargin()+g.getHorizontalGap())+g.getLeftMargin()+l.x,l.y=Math.floor(l.y/g.getUsableHeight())*(g.getTopMargin()+g.getBottomMargin()+
g.getVerticalGap())+g.getTopMargin()+l.y);h.translate(-1E3,-1E3);l.translate(1E3,1E3);e=(f.deviceToLogXNoZoom(this._graphicSystem.getCanvas().width)-1250)/(l.x-h.x);g=(f.deviceToLogYNoZoom(this._graphicSystem.getCanvas().height)-1250)/(l.y-h.y);switch(a){case JSG.ui.GraphEditor.ZOOM_FIT:b(Math.min(e,g));break;case JSG.ui.GraphEditor.ZOOM_FITVERT:b(g);break;case JSG.ui.GraphEditor.ZOOM_FITHORZ:b(e)}this._scrollPanel.setScrollPosition(-h.x,-h.y);JSG.ptCache.release(h,l)}else b(a);d.markDirty();d.setChanged(!0);
JSG.graph.notifications.NotificationCenter.getInstance().send(new JSG.graph.notifications.Notification(JSG.ui.GraphEditor.ZOOM_NOTIFICATION,this))};JSG.ui.viewer.GraphViewer.prototype.getZoom=function(){return this.getCoordinateSystem().getZoom()};JSG.ui.viewer.ScrollableViewerInteractionDecorator=function(a){this._isSbEvent=!1;this._interaction=void 0;this._scrollPanel=a};
JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype.destroy=function(){this._undecorateInteraction(this._interaction);this._interaction=this._scrollPanel=void 0};
JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._undecorateInteraction=function(a){if(void 0!=a){var b=Object.getPrototypeOf(a);a.onMouseDown=b.onMouseDown;a.onMouseDoubleClick=b.onMouseDoubleClick;a.onMouseMove=b.onMouseMove;a.onMouseDrag=b.onMouseDrag;a.onMouseUp=b.onMouseUp;a.onMouseExit=b.onMouseExit;a.onMouseWheel=b.onMouseWheel;a.didFinish=b.didFinish;a.isScrollBarEvent=b.isScrollBarEvent}};
JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype.decorateInteraction=function(a){this._undecorateInteraction(this._interaction);this._interaction=a;void 0!=a&&(a.onMouseDown=this._decorate(a.onMouseDown,this._onMouseClick),a.onMouseDoubleClick=this._decorate(a.onMouseDoubleClick,this._onMouseClick),a.onMouseMove=this._decorate(a.onMouseMove,this._onMouseMove),a.onMouseDrag=this._decorate(a.onMouseDrag,this._onMouseDrag),a.onMouseUp=this._decorate(a.onMouseUp,this._onMouseUp),a.onMouseExit=
this._decorate(a.onMouseExit,this._onMouseExit),a.onMouseWheel=this._decorate(a.onMouseWheel,this._onMouseWheel),a.didFinish=this._decorate(a.didFinish,this._didFinish),a.isScrollBarEvent=this._decorate(a.isScrollBarEvent,this._isScrollBarEvent))};JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._decorate=function(a,b){var c=this;return function(){var d=b.apply(c,arguments);return d?d:a.apply(this,arguments)}};
JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._onMouseClick=function(a,b){this._setIsScrollBarEvent(b.isScrollBarEvent(a));this._isSbEvent&&this._handleScrollBarEvent(a,b);return this._isSbEvent};JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._onMouseMove=function(a,b){this._setIsScrollBarEvent(b.isScrollBarEvent(a));this._isSbEvent&&b.getGraphicSystem().setCursor(JSG.ui.Cursor.Style.AUTO);return this._isSbEvent};
JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._onMouseDrag=function(a,b){this._isSbEvent&&this._handleScrollBarEvent(a,b);return this._isSbEvent};JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._onMouseUp=function(a,b){var c=this._isSbEvent;c&&this._handleScrollBarEvent(a,b);this._setIsScrollBarEvent(!1);return c};JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._onMouseExit=function(a,b){this._setIsScrollBarEvent(!1);this._handleScrollBarEvent(a,b);return!1};
JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._onMouseWheel=function(a,b){this._handleScrollBarEvent(a,b);return!0};JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._didFinish=function(a,b){return this._isSbEvent};JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._isScrollBarEvent=function(){return this._isSbEvent};JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._handleScrollBarEvent=function(a,b){a.isConsumed||this._scrollPanel.handleMouseEvent(a)};
JSG.ui.viewer.ScrollableViewerInteractionDecorator.prototype._setIsScrollBarEvent=function(a){this._isSbEvent=a;JSG.keepFocus=this._isSbEvent};JSG.namespace("JSG.ui");
JSG.ui.GraphEditor=function(a){var b=new JSG.ui.graphics.MetricCoordinateSystem,c;"string"===typeof a||a instanceof String?(c=document.getElementById(a),this._canvasId=a):(c=a,this._canvasId=c.id);c._jsgEditor=this;this._settingsListener=new JSG.ui.GraphEditor.SettingsListener(this);this._graphicSystem=new JSG.ui.graphics.GraphicSystem(a,b);this._graphViewer=this.createViewer(this._graphicSystem);this._interactionHandler=new JSG.graph.interaction.InteractionHandler(this._graphViewer);this._graphicSystem.setContent(this._graphViewer.getRootView());
this._graphicSystem.setInteractionHandler(this._interactionHandler);JSG.imagePool.registerEditor(this)};JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION="grapheditor.viewmode.notification";JSG.ui.GraphEditor.ZOOM_NOTIFICATION="grapheditor.zoom.notification";JSG.ui.GraphEditor.ZOOM_FIT=-1;JSG.ui.GraphEditor.ZOOM_FITHORZ=-2;JSG.ui.GraphEditor.ZOOM_FITVERT=-3;
JSG.ui.GraphEditor.prototype.createViewer=function(a){a=new JSG.ui.viewer.ScrollableViewer(a);a.setControllerFactory(JSG.graph.controller.GraphControllerFactory.getInstance());return a};JSG.ui.GraphEditor.prototype.saveXML=function(){var a=new JSG.commons.XMLWriter("UTF-8","1.0");a.writeStartDocument();a.writeStartElement("document");a.writeAttributeString("version","1.0.0");a.writeAttributeNumber("zoom",this.getZoom(),3);a.writeEndElement();this.getGraph().saveXML(a);a.writeEndDocument();return a.flush()};
JSG.ui.GraphEditor.prototype.readXML=function(a){JSG.setDrawingDisabled(!0);var b=this.getGraph();if(void 0!=a){this.clear();this.jsgShape&&this.setViewMode(JSG.ui.graphics.DisplayMode.ENDLESS);var c=a.getElementsByTagName("document")[0];c&&(c=c.getAttribute("zoom"),void 0!=c&&this.setZoom(Number(c)));c=a.getElementsByTagName("graphitem")[0];void 0==c&&(c=a.getElementsByTagName("gi")[0]);void 0!=c&&c.hasChildNodes()&&"graph"==c.getAttribute("type")&&b.readXML(c);b._restoreConnections(b)}b.evaluate();
b.refresh();this.layout();JSG.setDrawingDisabled(!1);this._graphicSystem.paint()};
JSG.ui.GraphEditor.prototype.saveSVGPage=function(a,b,c){var d=this._graphViewer.getGraphView(),e=new JSG.commons.XMLWriter("UTF-8","1.0"),f=new JSG.ui.graphics.MetricCoordinateSystem,g=void 0==c?!1:!0;c=JSG.rectCache.get();var l=new JSG.ui.graphics.SVGraphics(e,f),h=this.getGraphSettings().getPage(),m=this.getGraph(),k=m.getPrintZoom();g&&h.getScaleToPageType()!=JSG.graph.model.settings.ScaleToPageType.NONE?(c=m.getUsedRect(c),c.expandBy(500)):(g=d._item.getBoundingBox(JSG.boxCache.get()),c=g.toRectangle(c),
JSG.boxCache.release(g));var g=JSG.rectCache.get().set(c.x+h.getUsableWidth()*a/k,c.y+h.getUsableHeight()*b/k,h.getUsableWidth()/k,h.getUsableHeight()/k),n=-c.x*k,q=-c.y*k,n=n-h.getUsableWidth()*a,q=q-h.getUsableHeight()*b,n=n+h.getLeftMargin(),q=q+h.getTopMargin();e.writeStartDocument(!1);e.writeStartElement("svg");e.writeAttributeString("width",h.getWidth()/100+"mm");e.writeAttributeString("height",h.getHeight()/100+"mm");e.writeAttributeString("viewBox","0 0 "+f.toSVGUnit(h.getWidth())+" "+f.toSVGUnit(h.getHeight()));
e.writeAttributeString("xmlns","http://www.w3.org/2000/svg");e.writeAttributeString("xmlns:xlink","http://www.w3.org/1999/xlink");e.writeEndElement();e.writeStartElement("defs");e.writeStartElement("clipPath");e.writeAttributeString("id","clipRect");e.writeStartElement("rect");e.writeAttributeString("id","rect");e.writeAttributeString("x",f.toSVGUnit(h.getLeftMargin()));e.writeAttributeString("y",f.toSVGUnit(h.getTopMargin()));e.writeAttributeString("width",f.toSVGUnit(h.getUsableWidth()));e.writeAttributeString("height",
f.toSVGUnit(h.getUsableHeight()));e.writeEndElement();e.writeEndElement();e.writeEndElement();var p=JSG.rectCache.get().set(0,0,h.getWidth(),h.getHeight());d.drawHeaderAndFooter(l,p,h,a*m.getVerticalPrintPages()+b);e.writeStartElement("g");e.writeAttributeString("clip-path","url(#clipRect)");l.startGroup();l.translate(n,q);f.setZoom(k);d.drawSubViews(l,g);l.endGroup();e.writeEndElement();e.writeEndDocument();JSG.rectCache.release(c,g,p);return e.flush()};
JSG.ui.GraphEditor.prototype.saveSVG=function(){var a=this._graphViewer.getGraphView(),b=new JSG.commons.XMLWriter("UTF-8","1.0"),c=new JSG.ui.graphics.MetricCoordinateSystem,d=a._item.getBoundingBox(JSG.boxCache.get()),e=d.toRectangle(JSG.rectCache.get()),f=new JSG.ui.graphics.SVGraphics(b,c);b.writeStartDocument(!1);b.writeStartElement("svg");b.writeAttributeString("width",e.width/100+"mm");b.writeAttributeString("height",e.height/100+"mm");b.writeAttributeString("viewBox","0 0 "+c.toSVGUnit(e.width)+
" "+c.toSVGUnit(e.height));b.writeAttributeString("xmlns","http://www.w3.org/2000/svg");b.writeAttributeString("xmlns:xlink","http://www.w3.org/1999/xlink");b.writeEndElement();b.writeStartElement("defs");b.writeStartElement("clipPath");b.writeAttributeString("id","clipRect");b.writeStartElement("rect");b.writeAttributeString("id","rect");b.writeAttributeString("x",c.toSVGUnit(e.x));b.writeAttributeString("y",c.toSVGUnit(e.y));b.writeAttributeString("width",c.toSVGUnit(e.width));b.writeAttributeString("height",
c.toSVGUnit(e.height));b.writeEndElement();b.writeEndElement();b.writeEndElement();b.writeStartElement("g");b.writeAttributeString("clip-path","url(#clipRect)");f.startGroup();a.drawSubViews(f,e);f.endGroup();b.writeEndElement();b.writeEndDocument();JSG.boxCache.release(d);JSG.rectCache.release(e);return b.flush()};JSG.ui.GraphEditor.prototype.clear=function(){for(var a=this.getGraph(),b=a._subItems.length-1;0<=b;b--)a.removeItem(a._subItems[b]);this._graphicSystem.paint()};
JSG.ui.GraphEditor.prototype.getCanvasId=function(){return this._canvasId};JSG.ui.GraphEditor.prototype.getGraphicSystem=function(){return this._graphicSystem};JSG.ui.GraphEditor.prototype.getDefaultInteraction=function(){return this._graphViewer.getDefaultInteraction()};JSG.ui.GraphEditor.prototype.setDefaultInteraction=function(a){void 0!=a&&(this._graphViewer.setDefaultInteraction(a),this._interactionHandler.setActiveInteraction(a))};JSG.ui.GraphEditor.prototype.getInteractionHandler=function(){return this._interactionHandler};
JSG.ui.GraphEditor.prototype.setInteractionHandler=function(a){a&&(this._interactionHandler=a,this._interactionHandler.viewer||(this._interactionHandler.viewer=this._graphViewer),this._interactionHandler.setActiveInteraction(this._graphViewer.getDefaultInteraction()),this._graphicSystem.setInteractionHandler(this._interactionHandler))};
JSG.ui.GraphEditor.prototype.resizeContent=function(a,b){var c=this._graphViewer.getCoordinateSystem();this._graphViewer.layout(c.deviceToLogX(a),c.deviceToLogX(b));this._graphicSystem.resize(a,b)};JSG.ui.GraphEditor.prototype.getGraphView=function(){return this._graphViewer.getGraphView()};JSG.ui.GraphEditor.prototype.getGraph=function(){return this._graphViewer.getGraph()};
JSG.ui.GraphEditor.prototype.setGraph=function(a){this._deregisterSettingsListener();this._graphViewer.setGraph(a);this._registerSettingsListener();this.setCoordinateSystem(this._graphViewer.getCoordinateSystem())};JSG.ui.GraphEditor.prototype._deregisterSettingsListener=function(){var a=this.getGraph();void 0!=a&&a.removeEventListener(JSG.graph.model.events.Event.GRAPHSETTINGS,this._settingsListener)};
JSG.ui.GraphEditor.prototype._registerSettingsListener=function(a){a=this.getGraph();void 0!=a&&a.addEventListener(JSG.graph.model.events.Event.GRAPHSETTINGS,this._settingsListener)};JSG.ui.GraphEditor.prototype.getGraphViewer=function(){return this._graphViewer};JSG.ui.GraphEditor.prototype.getCoordinateSystem=function(){return this._graphViewer.getCoordinateSystem()};JSG.ui.GraphEditor.prototype.setCoordinateSystem=function(a){this._graphicSystem.setCoordinateSystem(a);this.invalidate()};
JSG.ui.GraphEditor.prototype.setVerticalScrollRange=function(a,b){this.getGraphViewer().getScrollPanel().setVerticalRange(a,b)};JSG.ui.GraphEditor.prototype.setHorizontalScrollRange=function(a,b){this.getGraphViewer().getScrollPanel().setHorizontalRange(a,b)};JSG.ui.GraphEditor.prototype.setScrollPosition=function(a,b){this.getGraphViewer().getScrollPanel().setScrollPosition(a,b);this._graphicSystem.paint()};
JSG.ui.GraphEditor.prototype.setViewMode=function(a){var b=this.getGraphSettings();void 0!=b&&b.getDisplayMode()!=a&&(b.setDisplayMode(a),this.layout(),JSG.graph.notifications.NotificationCenter.getInstance().send(new JSG.graph.notifications.Notification(JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION,this)))};JSG.ui.GraphEditor.prototype.layout=function(){this.getGraphViewer().getScrollPanel().getViewPanel().layout();this._graphicSystem.paint()};
JSG.ui.GraphEditor.prototype.invalidate=function(){this.getGraph().markDirty();this._updateLayout();this._graphicSystem.paint()};JSG.ui.GraphEditor.prototype.repaint=function(){this._graphicSystem.paint()};JSG.ui.GraphEditor.prototype._updateLayout=function(){var a=this._graphViewer.getCoordinateSystem();this.getGraphViewer().layout(a.deviceToLogX(this._graphicSystem.getCanvas().width),a.deviceToLogY(this._graphicSystem.getCanvas().height))};JSG.ui.GraphEditor.prototype.getVisibleGraphRect=function(){return this.getGraphViewer().getScrollPanel().getVisibleGraphRect()};
JSG.ui.GraphEditor.prototype.getGraphSettings=function(){var a=this.getGraphViewer().getGraph();return void 0!=a?a.getSettings():void 0};JSG.ui.GraphEditor.prototype.getSelectionProvider=function(){return this.getGraphViewer().getSelectionProvider()};JSG.ui.GraphEditor.prototype.setZoom=function(a){this.getGraphViewer().setZoom(a);this.invalidate()};JSG.ui.GraphEditor.prototype.getZoom=function(){return this.getGraphViewer().getZoom()};JSG.ui.GraphEditor.prototype.showScale=function(a){this.getGraphViewer().getScrollPanel().showScale(a)};
JSG.ui.GraphEditor.prototype.destroy=function(){this._deregisterSettingsListener();this._settingsListener._editor=void 0;this._interactionHandler.dispose();this._graphicSystem.canvas._jsgEditor=void 0;this._graphicSystem.destroy();this._graphViewer.destroy();JSG.imagePool.unregisterEditor(this);this._interactionHandler=this._settingsListener=this._graphicSystem=this._graphViewer=void 0};JSG.ui.GraphEditor.SettingsListener=function(a){this._editor=a};
JSG.ui.GraphEditor.SettingsListener.prototype.handlePreEvent=function(a){};JSG.ui.GraphEditor.SettingsListener.prototype.handlePostEvent=function(a){var b=JSG.graph.model.settings.SettingID;switch(a.detailId){case b.SCALEVISIBLE:this._editor.showScale(a.value)}};JSG.namespace("JSG.ui");
JSG.ui.Widget=function(){JSG.ui.Widget._super.constructor.apply(this,arguments);this._format=new JSG.graph.attr.FormatAttributes;this._format.setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this._bounds=new JSG.geometry.Rectangle(0,0,0,0)};JSG.extend(JSG.ui.Widget,JSG.ui.View);JSG.ui.Widget.prototype.add=function(a){return JSG.ui.Widget._super.addView.call(this,a)};JSG.ui.Widget.prototype.remove=function(a){JSG.ui.Widget._super.removeView.call(this,a)};
JSG.ui.Widget.prototype.getBounds=function(a){a=a||new JSG.geometry.Rectangle(0,0,0,0);a.setTo(this._bounds);return a};JSG.ui.Widget.prototype.getClientArea=function(a){a=this.getBounds(a);a.set(0,0,a.width,a.height);return a};JSG.ui.Widget.prototype.getLocation=function(a){a=void 0!=a?a:new JSG.geometry.Point(0,0);a.set(this._bounds.x,this._bounds.y);return a};JSG.ui.Widget.prototype.getSize=function(a){return(void 0!=a?a:new JSG.geometry.Point(0,0)).set(this._bounds.width,this._bounds.height)};
JSG.ui.Widget.prototype.getFormat=function(){return this._format};JSG.ui.Widget.prototype.setBounds=function(a,b,c,d){this._setLocation(a,b);this._setSize(c,d)};JSG.ui.Widget.prototype.setBoundsTo=function(a){this.setBounds(a.x,a.y,a.width,a.height)};JSG.ui.Widget.prototype.setLocation=function(a,b){this._setLocation(a,b)};JSG.ui.Widget.prototype.setLocationTo=function(a){this._setLocation(a.x,a.y)};JSG.ui.Widget.prototype._setLocation=function(a,b){this._bounds.x=a;this._bounds.y=b};
JSG.ui.Widget.prototype.setSize=function(a,b){this._setSize(a,b)};JSG.ui.Widget.prototype.setSizeTo=function(a){this._setSize(a.x,a.y)};JSG.ui.Widget.prototype._setSize=function(a,b){this._bounds.width=a;this._bounds.height=b;this._fireOnResize()};JSG.ui.Widget.prototype.translateFromParent=function(a){a.translate(-this._bounds.x,-this._bounds.y);return a};JSG.ui.Widget.prototype.translateToParent=function(a){a.translate(this._bounds.x,this._bounds.y);return a};
JSG.ui.Widget.prototype.draw=function(a){this._isVisible&&(this._format.applyFillToGraphics(a,this._bounds),this._format.applyShadowToGraphics(a,this._bounds),this.drawBackground(a),this._format.removeShadowFromGraphics(a),a.save(),a.startGroup(),this.drawClientArea(a),a.endGroup(),a.restore(),this._format.applyLineToGraphics(a),this.drawBorder(a),this._format.removeLineFromGraphics(a))};JSG.ui.Widget.prototype.drawBackground=function(a){this._format.hasFill()&&a.fillRect(this._bounds)};
JSG.ui.Widget.prototype.drawClientArea=function(a){this.hasSubviews()&&(a.startGroup(),a.translate(this._bounds.x,this._bounds.y),this.drawSubViews(a),a.endGroup())};JSG.ui.Widget.prototype.drawBorder=function(a){this._format.hasBorder()&&a.drawRect(this._bounds)};JSG.namespace("JSG.ui");
JSG.ui.Scale=function(a,b){JSG.ui.Scale._super.constructor.apply(this,arguments);this._size=750;this._origin=500;this._isVertical=a;this._viewPanel=void 0;this._viewer=b;this.setVisible(!0);this.getFormat().setFillColor(JSG.bkColorHeader);this.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE)};JSG.extend(JSG.ui.Scale,JSG.ui.Widget);JSG.ui.Scale.prototype.isVisible=function(){var a=this._isVisible,b=this._viewer.getGraphSettings();void 0!=b&&(a=b.getScaleVisible());return a};
JSG.ui.Scale.prototype.setViewPanel=function(a){this._viewPanel=a};JSG.ui.Scale.prototype.getHeight=function(){return this._viewer.getCoordinateSystem().metricToLogYNoZoom(this._size)};JSG.ui.Scale.prototype.getWidth=function(){return this._viewer.getCoordinateSystem().metricToLogXNoZoom(this._size)};
JSG.ui.Scale.prototype.drawBackground=function(a){var b=this._viewer.getGraphSettings();if(void 0!=b&&void 0!=this._viewPanel){var c=this._viewer.getCoordinateSystem(),d=b.getPage(),e=b.getDisplayMode(),b=this.getHeight(),f=this.getWidth();c.getMajorUnit();var g=0,l=1,h=0,m=0,k=0,n=0,q;this._isVertical?(l=this._viewer.getGraph().getVerticalPages(),q=d.getUsableHeight(),e==JSG.ui.graphics.DisplayMode.PAGE?(g=d.getHeight(),h=d.getVerticalGap(),k=d.getTopMargin(),n=d.getBottomMargin()):q=g=l*d.getUsableHeight()):
(l=this._viewer.getGraph().getHorizontalPages(),q=d.getUsableWidth(),e==JSG.ui.graphics.DisplayMode.PAGE?(g=d.getWidth(),h=d.getHorizontalGap(),k=d.getLeftMargin(),n=d.getRightMargin()):q=g=l*q);if(0!=q){a.save();a.setClip(this._bounds);a.fillRect(this._bounds);a.getContext().textBaseline="middle";a.setLineColor("#555555");a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.getContext().textAlign="center";a.setFillColor("#FFFFFF");m=this._viewPanel.getBounds(JSG.rectCache.get());if(this._isVertical){a.translate(0,
this._bounds.y+this._origin);for(var p=JSG.rectCache.get(),s=0;s<l;s++)p.set(f/4,(g+h)*s+k+m.y,this._bounds.width/2,q),a.fillRect(p);g=e==JSG.ui.graphics.DisplayMode.PAGE?m.y/(g+h)*d.getUsableHeight():m.y}else{a.translate(this._bounds.x+this._origin,0);p=JSG.rectCache.get();for(s=0;s<l;s++)p.set((g+h)*s+k+m.x,b/4,q,this._bounds.height/2),a.fillRect(p);g=e==JSG.ui.graphics.DisplayMode.PAGE?m.x/(g+h)*d.getUsableWidth():m.x}JSG.rectCache.release(p);JSG.rectCache.release(m);d=g;c.metricToLogYNoZoom(50);
e=l*q+g;p=g-=c.getMajorUnit()+g%c.getMajorUnit();a.setFillColor("#777777");if(0.4<c.getZoom()){for(a.beginPath();g<e;)g+=c.getMinorUnit(),g>d&&g<e&&(m=Math.floor(g/q)*(k+n+h)+k+g,Math.floor(g/q)<l&&(this._isVertical?(a.moveTo(3*f/8,m),a.lineTo(5*f/8,m)):(a.moveTo(m,3*b/8-1),a.lineTo(m,5*b/8)))),g=0.3<c.getZoom()?g+c.getMinorUnit():g+2*c.getMinorUnit();a.stroke()}for(g=0.5<c.getZoom()?p:0.3<c.getZoom()?p+2*c.getMinorUnit():p+12*c.getMinorUnit();g<e;)m=Math.floor(g/q)*(k+n+h)+k+g,g>d&&(this._isVertical?
(a.translate(f/2,m),a.rotate(-Math.PI/2),a.fillText(c.getMajorUnitString(g),0,0),a.rotate(Math.PI/2),a.translate(-f/2,-m)):a.fillText(c.getMajorUnitString(g),m,b/2)),g=0.5<c.getZoom()?g+2*c.getMinorUnit():0.3<c.getZoom()?g+4*c.getMinorUnit():g+10*c.getMinorUnit();a.restore()}}};JSG.namespace("JSG.ui");JSG.ui.ViewPort=function(){JSG.ui.ViewPort._super.constructor.apply(this,arguments);this._origin=new JSG.geometry.Point(500,500);this._viewPanel=void 0;this.getFormat().setFillColor(JSG.bkColorGraph)};
JSG.extend(JSG.ui.ViewPort,JSG.ui.Widget);JSG.ui.ViewPort.BOUNDS_CHANGED_NOTIFICATION="viewport.bounds.changed.notification";JSG.ui.ViewPort.prototype.setViewPanel=function(a){void 0!=this._viewPanel&&(this._viewPanel.removeResizeListener(this),this.remove(this._viewPanel));this._viewPanel=a;this._viewPanel.addResizeListener(this);this.add(a)};JSG.ui.ViewPort.prototype.getVisibleViewRect=function(){var a=this.getClientArea();a.x=-this._origin.x;a.y=-this._origin.y;return a};
JSG.ui.ViewPort.prototype.onResize=function(a){this.getParent().layout()};JSG.ui.ViewPort.prototype.setBounds=function(a,b,c,d){JSG.ui.ViewPort._super.setBounds.call(this,a,b,c,d);JSG.graph.notifications.NotificationCenter.getInstance().send(new JSG.graph.notifications.Notification(JSG.ui.ViewPort.BOUNDS_CHANGED_NOTIFICATION,this))};JSG.ui.ViewPort.prototype.getOrigin=function(){return this._origin};JSG.ui.ViewPort.prototype.setOrigin=function(a,b){this._origin.x=a;this._origin.y=b};
JSG.ui.ViewPort.prototype.setVerticalOrigin=function(a){this._origin.y=a};JSG.ui.ViewPort.prototype.setHorizontalOrigin=function(a){this._origin.x=a};JSG.ui.ViewPort.prototype.setOriginTo=function(a){this.setOrigin(points.x,a.y)};JSG.ui.ViewPort.prototype.getViewPanel=function(){return this._viewPanel};
JSG.ui.ViewPort.prototype.drawClientArea=function(a){if(void 0!=this._viewPanel){var b=this.getBounds();a.setClip(b);a.startGroup();a.translate(b.x+this._origin.x,b.y+this._origin.y);this.drawSubViews(a);a.endGroup()}};JSG.ui.ViewPort.prototype.handleMouseEvent=function(a){void 0!=this._viewPanel&&(this.translateFromParent(a.location),this._viewPanel.handleMouseEvent(a))};
JSG.ui.ViewPort.prototype.handleDragEvent=function(a){return void 0!=this._viewPanel?(this.translateFromParent(a.location),this._viewPanel.handleDragEvent(a)):!1};JSG.ui.ViewPort.prototype.handleKeyEvent=function(a){void 0!=this._viewPanel&&this._viewPanel.handleKeyEvent(a)};JSG.ui.ViewPort.prototype.translateFromParent=function(a){JSG.ui.ViewPort._super.translateFromParent.call(this,a);a.translate(-this._origin.x,-this._origin.y);return a};
JSG.ui.ViewPort.prototype.translateToParent=function(a){JSG.ui.ViewPort._super.translateToParent.call(this,a);a.translate(this._origin.x,this._origin.y);return a};JSG.namespace("JSG.ui");JSG.ui.ViewPanel=function(){JSG.ui.ViewPanel._super.constructor.apply(this,arguments);this._view=void 0;this.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this.getFormat().setFillStyle(JSG.graph.model.attributes.FillStyle.NONE)};JSG.extend(JSG.ui.ViewPanel,JSG.ui.Widget);
JSG.ui.ViewPanel.prototype.getView=function(){return this._view};JSG.ui.ViewPanel.prototype.setView=function(a){void 0!=this._view&&(this._view.removeResizeListener(this),this.removeView(this._view));this._view=a;void 0!=a&&(this.addView(a),a.addResizeListener(this));this.layout()};JSG.ui.ViewPanel.prototype.invalidate=function(){this.setValid(!1)};
JSG.ui.ViewPanel.prototype.getPreferredBounds=function(a,b){var c=b||new JSG.geometry.Rectangle(0,0,0,0),d=this.getView();return void 0!=d?d.getPreferredBounds(void 0,c):c.reset()};JSG.ui.ViewPanel.prototype.translateToParent=function(a){return a};JSG.ui.ViewPanel.prototype.layout=function(a){if(void 0!=this._view){this._view.layout();a=this._view.getBoundingBox(JSG.boxCache.get());var b=a.toRectangle(JSG.rectCache.get());this.setBoundsTo(b);JSG.boxCache.release(a);JSG.rectCache.release(b)}};
JSG.ui.ViewPanel.prototype.drawClientArea=function(a){this.drawSubViews(a)};JSG.ui.ViewPanel.prototype._setSize=function(a,b){1>Math.abs(this._bounds.width-a)&&1>Math.abs(this._bounds.height-b)||(this._bounds.width=a,this._bounds.height=b,this._view&&this._view.layout(),this._fireOnResize())};JSG.ui.ViewPanel.prototype.onResize=function(a){this.layout()};JSG.ui.ViewPanel.prototype.handleMouseEvent=function(a){return!1};JSG.ui.ViewPanel.prototype.handleDragEvent=function(a){return!1};
JSG.ui.ViewPanel.prototype.handleKeyEvent=function(a){return!1};JSG.namespace("JSG.ui");JSG.ui.GraphViewPanel=function(a){JSG.ui.GraphViewPanel._super.constructor.call(this);this._viewer=a};JSG.extend(JSG.ui.GraphViewPanel,JSG.ui.ViewPanel);
JSG.ui.GraphViewPanel.prototype.layout=function(){if(void 0!=this._view){this._view.layout();var a=this._view.getBoundingBox(JSG.boxCache.get()),b=a.toRectangle(JSG.rectCache.get()),c=this._viewer.getGraphSettings(),d=this._viewer.getGraph();if(void 0!=c){var e=c.getPage();if(c.getDisplayMode()==JSG.ui.graphics.DisplayMode.PAGE){var c=b.x/e.getUsableWidth(),f=b.y/e.getUsableHeight();b.x=c*(e.getWidth()+e.getHorizontalGap());b.y=f*(e.getHeight()+e.getVerticalGap());b.width=(e.getWidth()+e.getHorizontalGap())*
d.getHorizontalPages()-e.getHorizontalGap();b.height=(e.getHeight()+e.getVerticalGap())*d.getVerticalPages()-e.getHorizontalGap()}}this.setBoundsTo(b);JSG.boxCache.release(a);JSG.rectCache.release(b)}};JSG.namespace("JSG.ui.scrollbar");JSG.ui.scrollbar.Arrow=function(a,b){JSG.ui.scrollbar.Arrow._super.constructor.apply(this,arguments);this._isVertical=a;this._isStart=b};JSG.extend(JSG.ui.scrollbar.Arrow,JSG.ui.Widget);JSG.ui.scrollbar.Arrow.prototype.getHeight=function(){return parent.getHeight()};
JSG.ui.scrollbar.Arrow.prototype.getWidth=function(){return parent.getWidth()};
JSG.ui.scrollbar.Arrow.prototype.handleMouseEvent=function(a){if(this.isVisible){var b=a.location.copy();this._parent.translateFromParent(a.location);switch(a.type){case JSG.ui.events.MouseEventType.DOWN:if(this._bounds.contains(a.location.x,a.location.y)){a.isConsumed=!0;var c=this._isVertical?this._parent._range.pageDeltaHeight()/10:this._parent._range.pageDeltaWidth()/10;this._isStart?this._parent._range._scroll(-c,!0):this._parent._range._scroll(c,!0)}}a.location=b.copy()}};
JSG.ui.scrollbar.Arrow.prototype.drawBackground=function(a){var b=[],c=this._bounds.width/3;a.setFillColor("#777777");this._isVertical?this._isStart?(b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+this._bounds.height-c)),b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+this._bounds.height-c)),b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width/2,this._bounds.y+c))):(b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+c)),b.push(new JSG.geometry.Point(this._bounds.x+
this._bounds.width-c,this._bounds.y+c)),b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width/2,this._bounds.y+this._bounds.height-c))):this._isStart?(b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+c)),b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+this._bounds.height-c)),b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+this._bounds.height/2))):(b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+
c)),b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+this._bounds.height-c)),b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+this._bounds.height/2)));b.push(new JSG.geometry.Point(b[0].x,b[0].y));a.fillPolyline(b)};JSG.namespace("JSG.ui.scrollbar");JSG.ui.scrollbar.Thumb=function(){JSG.ui.scrollbar.Thumb._super.constructor.apply(this,arguments);this._isSelected=!1;this._offset=new JSG.geometry.Point(0,0);this.getFormat().setFillColor("#CCCCCC");this.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE)};
JSG.extend(JSG.ui.scrollbar.Thumb,JSG.ui.Widget);JSG.ui.scrollbar.Thumb.prototype.setLocation=function(a,b){var c=JSG.rectCache.get().setTo(this._bounds);void 0!=this._parent&&this._parent.getClientArea(c);this._parent._isVertical?(b=Math.max(0,b),b=Math.min(b,c.y+c.height-this._bounds.height)):(a=Math.max(0,a),a=Math.min(a,c.x+c.width-this._bounds.width));if(this._parent)this._parent.onThumbDrag(a,b);JSG.ui.scrollbar.Thumb._super.setLocation.call(this,a,b);JSG.rectCache.release(c)};
JSG.ui.scrollbar.Thumb.prototype.onMouseDown=function(a){var b=JSG.ptCache.get();this._isSelected=this._containsLocation(a.location);b.setTo(a.location);this._parent.translateFromParent(b);this._offset.x=b.x-this._bounds.x;this._offset.y=b.y-this._bounds.y;JSG.ptCache.release(b)};JSG.ui.scrollbar.Thumb.prototype._containsLocation=function(a){var b=JSG.ptCache.get();b.setTo(a);this._parent.translateFromParent(b);a=this._bounds.contains(b.x,b.y);JSG.ptCache.release(b);return a};
JSG.ui.scrollbar.Thumb.prototype.onMouseMove=function(a){this._isSelected&&this._moveAbsolute(a.location)};JSG.ui.scrollbar.Thumb.prototype._moveAbsolute=function(a){a=a.copy();this._parent.translateFromParent(a);var b=this.getLocation(JSG.ptCache.get());this._parent._isVertical?this.setLocation(b.x,a.y-this._offset.y):this.setLocation(a.x-this._offset.x,b.y);JSG.ptCache.release(b)};JSG.ui.scrollbar.Thumb.prototype.onMouseUp=function(a){this.isSelected=!1};JSG.namespace("JSG.ui.scrollbar");
JSG.ui.scrollbar.Range=function(a){JSG.ui.scrollbar.Range._super.constructor.apply(this,arguments);this._model={factor:1,min:-500,max:0,pos:-500,range:20,thumbSize:20,toString:function(){return"min:"+this.min+", max:"+this.max+", pos:"+this.pos+", range:"+this.range+", thumbSize:"+this.thumbSize+", factor:"+this.factor.toFixed(2)}};this._isVertical=a;this._thumb=this.add(new JSG.ui.scrollbar.Thumb)};JSG.extend(JSG.ui.scrollbar.Range,JSG.ui.Widget);JSG.ui.scrollbar.Range.prototype.getModel=function(){return this._model};
JSG.ui.scrollbar.Range.prototype.handleMouseEvent=function(a){if(this.isVisible){var b=a.location.copy();this._parent.translateFromParent(a.location);switch(a.type){case JSG.ui.events.MouseEventType.DOWN:this._thumb.onMouseDown(a);this._bounds.contains(a.location.x,a.location.y)&&(a.isConsumed=!0,this._thumb.isSelected||this._handlePageInDecrement(a));break;case JSG.ui.events.MouseEventType.MOVE:this._thumb.onMouseMove(a);break;case JSG.ui.events.MouseEventType.UP:case JSG.ui.events.MouseEventType.EXIT:this._thumb.onMouseUp(a);
break;case JSG.ui.events.MouseEventType.WHEEL:this.onMouseWheel(a)}a.location=b.copy()}};JSG.ui.scrollbar.Range.prototype._handlePageInDecrement=function(a){a=a.location.copy();this.translateFromParent(a);var b=this._isVertical?this.pageDeltaHeight():this.pageDeltaWidth(),b=b*this._checkPageClick(a);this._scroll(b,!1)};
JSG.ui.scrollbar.Range.prototype._checkPageClick=function(a){if(this._isVertical){if(a.y<this._thumb._bounds.y)return-1;if(a.y>this._thumb._bounds.y+this._thumb._bounds.height)return 1}else{if(a.x<this._thumb._bounds.x)return-1;if(a.x>this._thumb._bounds.x+this._thumb._bounds.width)return 1}return 0};
JSG.ui.scrollbar.Range.prototype._scroll=function(a,b){this._isVertical?(b&&0>this._thumb._bounds.y+a?(this._model.min+=a,this._model.pos=this._model.min):b&&this._thumb._bounds.getBottom()+a>this._bounds.height?(this._model.max+=a,this._model.pos=this._model.max):this._model.pos+=a,this.layout(),this._parent._parent.setVerticalScroll(-this._model.pos)):(b&&0>this._thumb._bounds.x+a?(this._model.min+=a,this._model.pos=this._model.min):b&&this._thumb._bounds.getRight()+a>this._bounds.width?(this._model.max+=
a,this._model.pos=this._model.max):this._model.pos+=a,this.layout(),this._parent._parent.setHorizontalScroll(-this._model.pos))};JSG.ui.scrollbar.Range.prototype.pageDeltaWidth=function(){return 0.8*this._bounds.width};JSG.ui.scrollbar.Range.prototype.pageDeltaHeight=function(){return 0.8*this._bounds.height};
JSG.ui.scrollbar.Range.prototype.onMouseWheel=function(a){a=a.event;this._doHandleWheelEvent(a)&&(a=a.wheelDelta?a.wheelDelta/120:-a.detail,a=this._parent._getCoordinateSystem().deviceToLogX(10*a),this._scroll(-a,!0))};JSG.ui.scrollbar.Range.prototype._doHandleWheelEvent=function(a){a=a.wheelDeltaX?"x":a.axis&&a.axis==a.HORIZONTAL_AXIS?"x":"y";return this._isVertical?"y"==a:"x"==a};
JSG.ui.scrollbar.Range.prototype.setModelData=function(a){var b=this.getClientArea(JSG.rectCache.get()),c=this._parent.getBounds(JSG.rectCache.get());a=a.getBounds(JSG.rectCache.get());this._isVertical?0<a.height&&0<b.height&&(this._model.min=Math.min(this._model.min,a.y),this._model.max=Math.max(this._model.max,a.getBottom()),this._model.max=Math.max(this._model.max,b.height),this._model.range=Math.max(this._model.max-this._model.min,1),this._model.thumbSize=Math.max(b.height/this._model.range*b.height,
b.width/2),this._model.thumbSize=Math.min(this._model.thumbSize,b.height),this._model.factor=0<this._model.range-c.height&&0!=b.height-this._model.thumbSize?(b.height-this._model.thumbSize)/(this._model.range-c.height):1,this._model.pos=Math.min(this._model.pos,(b.getBottom()-this._model.thumbSize)/this._model.factor+this._model.min),this._model.pos=Math.max(this._model.pos,this._model.min)):0<a.width&&0<b.width&&(this._model.min=Math.min(this._model.min,a.x),this._model.max=Math.max(this._model.max,
a.getRight()),this._model.max=Math.max(this._model.max,b.width),this._model.range=Math.max(this._model.max-this._model.min,1),this._model.thumbSize=Math.max(b.width/this._model.range*b.width,b.height/2),this._model.thumbSize=Math.min(this._model.thumbSize,b.width),this._model.factor=0<this._model.range-c.width&&0!=b.width-this._model.thumbSize?(b.width-this._model.thumbSize)/(this._model.range-c.width):1,this._model.pos=Math.min(this._model.pos,(b.getRight()-this._model.thumbSize)/this._model.factor+
this._model.min),this._model.pos=Math.max(this._model.pos,this._model.min));JSG.rectCache.release(b,c,a)};
JSG.ui.scrollbar.Range.prototype.layout=function(){if(this.isVisible){this.setModelData(this._parent._viewPanel);var a=this.getClientArea(JSG.rectCache.get());this._isVertical?(this._thumb._bounds.y=(this._model.pos-this._model.min)*this._model.factor,this._thumb.setSize(a.width,this._model.thumbSize)):(this._thumb._bounds.x=(this._model.pos-this._model.min)*this._model.factor,this._thumb.setSize(this._model.thumbSize,a.height));JSG.rectCache.release(a)}};
JSG.ui.scrollbar.Range.prototype.onThumbDrag=function(a,b){void 0!=this._parent&&(this._isVertical?(this._model.pos=b/this._model.factor+this._model.min,this._parent._parent.setVerticalScroll(-this._model.pos)):(this._model.pos=a/this._model.factor+this._model.min,this._parent._parent.setHorizontalScroll(-this._model.pos)))};JSG.namespace("JSG.ui.scrollbar");
JSG.ui.scrollbar.ScrollBar=function(a,b){JSG.ui.scrollbar.ScrollBar._super.constructor.apply(this,arguments);this._isVertical=a;this._arrowStart=new JSG.ui.scrollbar.Arrow(a,!0);this._arrowStart.getFormat().setFillColor(JSG.bkColorScroll);this._arrowStart.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this.add(this._arrowStart);this._range=new JSG.ui.scrollbar.Range(a);this._range.getFormat().setFillColor(JSG.bkColorScroll);this._range.getFormat().setLineColor(JSG.bkColorScroll);
this._range.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this.add(this._range);this._arrowEnd=new JSG.ui.scrollbar.Arrow(a,!1);this._arrowEnd.getFormat().setFillColor(JSG.bkColorScroll);this._arrowEnd.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this.add(this._arrowEnd);this.setVisible(!0);this.getFormat().setFillColor("#eeeeee");this.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this._viewer=b};
JSG.extend(JSG.ui.scrollbar.ScrollBar,JSG.ui.Widget);JSG.ui.scrollbar.ScrollBar.SIZE=450;JSG.ui.scrollbar.ScrollBar.prototype._getCoordinateSystem=function(){return this._viewer.getCoordinateSystem()};JSG.ui.scrollbar.ScrollBar.prototype.setViewPanel=function(a){this._viewPanel=a};JSG.ui.scrollbar.ScrollBar.prototype.unionRange=function(a,b){this._range._model.min=Math.min(this._range._model.min,a);this._range._model.max=Math.max(this._range._model.max,b)};
JSG.ui.scrollbar.ScrollBar.prototype.setPosition=function(a){this._range._model.pos=a;this._range.layout();this._isVertical?this._parent.setVerticalScroll(-a):this._parent.setHorizontalScroll(-a)};JSG.ui.scrollbar.ScrollBar.prototype._getHeight=function(){return this._getCoordinateSystem().metricToLogYNoZoom(JSG.ui.scrollbar.ScrollBar.SIZE)};JSG.ui.scrollbar.ScrollBar.prototype._getWidth=function(){return this._getCoordinateSystem().metricToLogXNoZoom(JSG.ui.scrollbar.ScrollBar.SIZE)};
JSG.ui.scrollbar.ScrollBar.prototype.getRange=function(){return this._range};JSG.ui.scrollbar.ScrollBar.prototype.getVisible=function(){return this.isVisible};JSG.ui.scrollbar.ScrollBar.prototype.scroll=function(a,b){this._range._scroll(a,b)};
JSG.ui.scrollbar.ScrollBar.prototype.layout=function(){if(this.getVisible()){var a=this.getClientArea();this._isVertical?(this._arrowStart._bounds.set(0,0,a.width,a.width),this._range._bounds.set(0,a.width,a.width,a.height-2*a.width),this._arrowEnd._bounds.set(0,a.height-a.width,a.width,a.width)):(this._arrowStart._bounds.set(0,0,a.height,a.height),this._range._bounds.set(a.height,0,a.width-2*a.height,a.height),this._arrowEnd._bounds.set(a.width-a.height,0,a.height,a.height));this._range.layout()}};
JSG.ui.scrollbar.ScrollBar.prototype.handleMouseEvent=function(a){this.getVisible()&&(this._range.handleMouseEvent(a),a.isConsumed||this._arrowStart.handleMouseEvent(a),a.isConsumed||this._arrowEnd.handleMouseEvent(a),this._bounds.contains(a.location.x,a.location.y)&&(a.isConsumed=!0))};JSG.namespace("JSG.ui");
JSG.ui.ScrollPanel=function(a){JSG.ui.ScrollPanel._super.constructor.apply(this,arguments);this._viewer=a;this.getFormat().setFillColor(JSG.bkColorHeader);this._hScale=this.add(new JSG.ui.Scale(!1,a));this._vScale=this.add(new JSG.ui.Scale(!0,a));this._hScrollbar=this.add(new JSG.ui.scrollbar.ScrollBar(!1,a));this._vScrollbar=this.add(new JSG.ui.scrollbar.ScrollBar(!0,a));this._viewport=this.add(new JSG.ui.ViewPort)};JSG.extend(JSG.ui.ScrollPanel,JSG.ui.Widget);
JSG.ui.ScrollPanel.SCROLL_NOTIFICATION="scrollpanel.scroll.notification";JSG.ui.ScrollPanel.prototype.getViewPort=function(){return this._viewport};JSG.ui.ScrollPanel.prototype.setViewPanel=function(a){this._viewport.setViewPanel(a);this._hScrollbar.setViewPanel(a);this._vScrollbar.setViewPanel(a);this._hScale.setViewPanel(a);this._vScale.setViewPanel(a);this.invalidate()};JSG.ui.ScrollPanel.prototype.getViewPanel=function(){return this._viewport.getViewPanel()};
JSG.ui.ScrollPanel.prototype.getVisibleGraphRect=function(){return this._viewport.getVisibleViewRect()};JSG.ui.ScrollPanel.prototype.translateFromViewPort=function(a){this._viewport.translateFromParent(a)};JSG.ui.ScrollPanel.prototype.translateToViewPort=function(a){this._viewport.translateToParent(a)};
JSG.ui.ScrollPanel.prototype.layout=function(){var a=this.getClientArea(),b=JSG.rectCache.get();this._hScale.isVisible()&&(a.y+=this._hScale.getHeight());this._vScale.isVisible()&&(a.x+=this._vScale.getWidth());this._hScrollbar.isVisible()&&(a.height-=this._hScrollbar._getHeight());this._hScale.isVisible()&&(a.height-=this._hScale.getHeight());this._vScrollbar.isVisible()&&(a.width-=this._vScrollbar._getWidth());this._vScale.isVisible()&&(a.width-=this._vScale.getWidth());this._viewport.setBoundsTo(a);
this._hScrollbar.isVisible()&&(b.setTo(a),b.y=a.height,this._hScale.isVisible()&&(b.y+=this._hScale.getHeight()),b.height=this._hScrollbar._getHeight(),this._hScrollbar.setBoundsTo(b));this._vScrollbar.isVisible()&&(b.setTo(a),b.x=a.width,this._vScale.isVisible()&&(b.x+=this._vScale.getWidth()),b.width=this._vScrollbar._getWidth(),this._vScrollbar.setBoundsTo(b));this._hScale.isVisible()&&(b.setTo(a),b.y=0,b.height=this._hScale.getHeight(),b.width+=this._vScrollbar._getWidth(),this._hScale.setBoundsTo(b));
this._vScale.isVisible()&&(b.setTo(a),b.x=0,b.width=this._vScale.getWidth(),b.height+=this._hScrollbar._getHeight(),this._vScale.setBoundsTo(b));this._hScrollbar.layout();this._vScrollbar.layout();JSG.rectCache.release(b)};JSG.ui.ScrollPanel.prototype.setScrollPosition=function(a,b){this._hScrollbar.setPosition(-a);this._vScrollbar.setPosition(-b)};
JSG.ui.ScrollPanel.prototype.setHorizontalScroll=function(a){this._hScale._origin!=a&&(this._viewport.setHorizontalOrigin(a),this._hScale._origin=a,JSG.graph.notifications.NotificationCenter.getInstance().send(new JSG.graph.notifications.Notification(JSG.ui.ScrollPanel.SCROLL_NOTIFICATION,this)))};
JSG.ui.ScrollPanel.prototype.setVerticalScroll=function(a){this._vScale._origin!=a&&(this._viewport.setVerticalOrigin(a),this._vScale._origin=a,JSG.graph.notifications.NotificationCenter.getInstance().send(new JSG.graph.notifications.Notification(JSG.ui.ScrollPanel.SCROLL_NOTIFICATION,this)))};JSG.ui.ScrollPanel.prototype.getHorizontalScroll=function(){return this._viewport._origin.x};JSG.ui.ScrollPanel.prototype.getVerticalScroll=function(){return this._viewport._origin.y};
JSG.ui.ScrollPanel.prototype.setHorizontalRange=function(a,b){this._hScrollbar.unionRange(a,b)};JSG.ui.ScrollPanel.prototype.setVerticalRange=function(a,b){this._vScrollbar.unionRange(a,b)};JSG.ui.ScrollPanel.prototype.getHorizontalScrollBar=function(){return this._hScrollbar};JSG.ui.ScrollPanel.prototype.getVerticalScrollBar=function(){return this._vScrollbar};
JSG.ui.ScrollPanel.prototype.handleMouseEvent=function(a){this._bounds.contains(a.location.x,a.location.y)?this.translateFromParent(a.location):a.type==JSG.ui.events.MouseEventType.EXIT;this._hScrollbar.handleMouseEvent(a);this._vScrollbar.handleMouseEvent(a);this._viewport.handleMouseEvent(a)};JSG.ui.ScrollPanel.prototype.handleDragEvent=function(a){this._bounds.contains(a.location.x,a.location.y)&&this.translateFromParent(a.location);return JSG.ui.ScrollPanel._super.handleDragEvent.call(this,a)};
JSG.ui.ScrollPanel.prototype.showScale=function(a){this._hScale.setVisible(a);this._vScale.setVisible(a);this.layout()};JSG.namespace("JSG.ui.scrollview");JSG.ui.scrollview.ViewPort=function(){JSG.ui.scrollview.ViewPort._super.constructor.apply(this,arguments);this._vpOffset=new JSG.geometry.Point(0,0);this._viewpanel=new JSG.ui.ViewPanel;this.getFormat().setFillColor(JSG.bkColorGraph);this._hrangemodel=this._vrangemodel=void 0;this.setVerticalRangeModel(new JSG.ui.scrollview.RangeModel);this.setHorizontalRangeModel(new JSG.ui.scrollview.RangeModel)};
JSG.extend(JSG.ui.scrollview.ViewPort,JSG.ui.Widget);JSG.ui.scrollview.ViewPort.prototype.getViewPanel=function(){return this._viewpanel};JSG.ui.scrollview.ViewPort.prototype.setViewPanel=function(a){void 0!=this._viewpanel&&(this._viewpanel.removeResizeListener(this),this.remove(this._viewpanel));this._viewpanel=a;this._viewpanel.addResizeListener(this);this.add(this._viewpanel)};JSG.ui.scrollview.ViewPort.prototype.layout=function(a){this.relayout()};
JSG.ui.scrollview.ViewPort.prototype.relayout=function(){var a=this.getClientArea(),b=this.getViewPanelBounds(a);this._viewpanel.setBoundsTo(b);var c=this.getContentView();void 0!=c&&(c=c.getItem().getPinPoint(),this._hrangemodel.setAll(b.x,b.getRight(),a.width,-c.x),this._vrangemodel.setAll(b.y,b.getBottom(),a.height,-c.y))};JSG.ui.scrollview.ViewPort.prototype.getViewPanelBounds=function(a){return this._viewpanel.getPreferredBounds()};
JSG.ui.scrollview.ViewPort.prototype.getPreferredBounds=function(a,b){var c=this._viewpanel.getPreferredBounds(void 0,b);c.x+=this._vpOffset.x;c.y+=this._vpOffset.y;void 0!=a&&c.union(a);return c};JSG.ui.scrollview.ViewPort.prototype.invalidate=function(){this.setValid(!1)};JSG.ui.scrollview.ViewPort.prototype.getViewPanelOffset=function(){return this._vpOffset};
JSG.ui.scrollview.ViewPort.prototype.getVisibleViewRect=function(){var a=this.getClientArea();a.x=-this._vpOffset.x;a.y=-this._vpOffset.y;return a};JSG.ui.scrollview.ViewPort.prototype.getContentView=function(){return this._viewpanel.getView()};JSG.ui.scrollview.ViewPort.prototype.setContentView=function(a){this._viewpanel.setView(a)};JSG.ui.scrollview.ViewPort.prototype.onResize=function(a){a=a.getBounds();this._hrangemodel.setRange(a.x,a.getRight());this._vrangemodel.setRange(a.y,a.getBottom())};
JSG.ui.scrollview.ViewPort.prototype.drawClientArea=function(a){if(void 0!=this._viewpanel){var b=this.getBounds();a.setClip(b);a.startGroup();a.translate(b.x+this._vpOffset.x,b.y+this._vpOffset.y);this.drawSubViews(a);a.endGroup()}};JSG.ui.scrollview.ViewPort.prototype.handleMouseEvent=function(a){void 0!=this._viewpanel&&(this.translateFromParent(a.location),this._viewpanel.handleMouseEvent(a))};
JSG.ui.scrollview.ViewPort.prototype.handleDragEvent=function(a){return void 0!=this._viewpanel?(this.translateFromParent(a.location),this._viewpanel.handleDragEvent(a)):!1};JSG.ui.scrollview.ViewPort.prototype.handleKeyEvent=function(a){void 0!=this._viewpanel&&this._viewpanel.handleKeyEvent(a)};JSG.ui.scrollview.ViewPort.prototype.translateFromParent=function(a){JSG.ui.ViewPort._super.translateFromParent.call(this,a);a.translate(-this._vpOffset.x,-this._vpOffset.y);return a};
JSG.ui.scrollview.ViewPort.prototype.translateToParent=function(a){JSG.ui.ViewPort._super.translateToParent.call(this,a);a.translate(this._vpOffset.x,this._vpOffset.y);return a};JSG.ui.scrollview.ViewPort.prototype.getVerticalRangeModel=function(){return this._vrangemodel};JSG.ui.scrollview.ViewPort.prototype.getHorizontalRangeModel=function(){return this._hrangemodel};JSG.ui.scrollview.ViewPort.prototype.setVerticalRangeModel=function(a){this._vrangemodel=this._setRangeModel(this._vrangemodel,a)};
JSG.ui.scrollview.ViewPort.prototype.setHorizontalRangeModel=function(a){this._hrangemodel=this._setRangeModel(this._hrangemodel,a)};JSG.ui.scrollview.ViewPort.prototype._setRangeModel=function(a,b){b=void 0!=b?b:a;void 0!=a&&a.removeObserver(this);b.addObserver(this);return b};
JSG.ui.scrollview.ViewPort.prototype.onRangeChange=function(a,b){if(b===JSG.ui.scrollview.RangeModel.CHANGED_VALUE){this._vpOffset.set(-this._hrangemodel.getValue(),-this._vrangemodel.getValue());var c=this.getContentView();void 0!=c&&c.getItem().setPinPointTo(this._vpOffset)}};JSG.namespace("JSG.ui.scrollview");JSG.ui.scrollview.Arrow=function(a){JSG.ui.scrollview.Arrow._super.constructor.apply(this,arguments);this._listeners=[];this._direction=a};JSG.extend(JSG.ui.scrollview.Arrow,JSG.ui.Widget);
JSG.ui.scrollview.Arrow.NORTH=0;JSG.ui.scrollview.Arrow.EAST=1;JSG.ui.scrollview.Arrow.SOUTH=2;JSG.ui.scrollview.Arrow.WEST=4;JSG.ui.scrollview.Arrow.prototype.getDirection=function(){return this._direction};JSG.ui.scrollview.Arrow.prototype.addActionListener=function(a){this._listeners.contains(a)||this._listeners.push(a)};JSG.ui.scrollview.Arrow.prototype.removeActionListener=function(a){this._listeners.remove(a)};
JSG.ui.scrollview.Arrow.prototype._notifyMouseDown=function(a){for(var b=this._listeners,c=0;c<b.length;c++)b[c].onMouseDown(this,a)};JSG.ui.scrollview.Arrow.prototype._notifyMouseUp=function(a){for(var b=this._listeners,c=0;c<b.length;c++)b[c].onMouseUp(this,a)};
JSG.ui.scrollview.Arrow.prototype.handleMouseEvent=function(a){if(this.isVisible)switch(a.type){case JSG.ui.events.MouseEventType.DOWN:this._bounds.contains(a.location.x,a.location.y)&&(a.isConsumed=!0,this._notifyMouseDown(a));break;case JSG.ui.events.MouseEventType.UP:this._bounds.contains(a.location.x,a.location.y)&&(a.isConsumed=!0,this._notifyMouseUp(a))}};
JSG.ui.scrollview.Arrow.prototype.drawBackground=function(a){var b=[],c=this._bounds.width/3;a.setFillColor("#777777");var d=JSG.ui.scrollview.Arrow;switch(this._direction){case d.NORTH:b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+this._bounds.height-c));b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+this._bounds.height-c));b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width/2,this._bounds.y+c));b.push(new JSG.geometry.Point(b[0].x,b[0].y));
break;case d.SOUTH:b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+c));b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+c));b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width/2,this._bounds.y+this._bounds.height-c));b.push(new JSG.geometry.Point(b[0].x,b[0].y));break;case d.WEST:b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+c));b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+
this._bounds.height-c));b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+this._bounds.height/2));b.push(new JSG.geometry.Point(b[0].x,b[0].y));break;case d.EAST:b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+c)),b.push(new JSG.geometry.Point(this._bounds.x+c,this._bounds.y+this._bounds.height-c)),b.push(new JSG.geometry.Point(this._bounds.x+this._bounds.width-c,this._bounds.y+this._bounds.height/2)),b.push(new JSG.geometry.Point(b[0].x,b[0].y))}a.fillPolyline(b)};JSG.namespace("JSG.ui.scrollview");
JSG.ui.scrollview.Range=function(a,b){JSG.ui.scrollview.Range._super.constructor.apply(this,arguments);this._isVertical=b;this._thumb=this.add(new JSG.ui.scrollview.Thumb);this._observer=a};JSG.extend(JSG.ui.scrollview.Range,JSG.ui.Widget);JSG.ui.scrollview.Range.prototype.isDragThumbFinished=function(){return!1===this._thumb._isSelected};JSG.ui.scrollview.Range.prototype.isThumbSelected=function(){return this._thumb._isSelected};JSG.ui.scrollview.Range.prototype.getThumb=function(){return this._thumb};
JSG.ui.scrollview.Range.prototype.handleMouseEvent=function(a){if(!0===this._isVisible)if(a.type===JSG.ui.events.MouseEventType.WHEEL)this._handleMouseWheel(a);else{var b=a.location.copy();this.translateFromParent(a.location);this._thumb.handleMouseEvent(a);!1===a.isConsumed&&this._bounds.containsPoint(b)&&(a.isConsumed=!0,a.type===JSG.ui.events.MouseEventType.DOWN&&this._handlePageInDecrement(a.location));a.location=b}};
JSG.ui.scrollview.Range.prototype._handlePageInDecrement=function(a){if(!0===this._thumb._isVisible){a=a.copy();var b=this._thumb._bounds.copy();this._isVertical||(a.swap(),b.swap());a=a.y<b.y?!0:a.y>b.getBottom()?!1:void 0;if(void 0!=a)if(!0===a)this._observer.onPageUp(this);else this._observer.onPageDown(this)}};
JSG.ui.scrollview.Range.prototype._handleMouseWheel=function(a){a=a.event;this._isOurWheelEvent(a)&&(a=a.wheelDelta?a.wheelDelta/120:-a.detail,a=100*-a,a=this._isVertical?new JSG.geometry.Point(0,a):new JSG.geometry.Point(a,0),this._observer.onThumbDrag(this,a))};JSG.ui.scrollview.Range.prototype._isOurWheelEvent=function(a){a=a.wheelDeltaX?"x":a.axis&&a.axis==a.HORIZONTAL_AXIS?"x":"y";return this._isVertical?"y"==a:"x"==a};
JSG.ui.scrollview.Range.prototype.layout=function(a){function b(a){var b=e.getMax()-e.getMin(),c=b-e.getExtent();0!=b&&0!=c&&(b=Math.max(a.getMinimumSize(),d.height*e.getExtent()/b),c=(d.height-b)*(e.getValue()-e.getMin())/c,a._bounds.y=c,a.setSize(d.width,b),a._isVisible=d.height>b)}function c(a){var b=e.getMax()-e.getMin(),c=b-e.getExtent();0!=b&&0!=c&&(b=Math.max(a.getMinimumSize(),d.width*e.getExtent()/b),c=(d.width-b)*(e.getValue()-e.getMin())/c,a._bounds.x=c,a.setSize(b,d.height),a._isVisible=
d.width>b)}if(!0===a.isVisible()){var d=this.getClientArea(),e=a.getRangeModel();!0===a._isVertical?b(this._thumb):c(this._thumb)}};JSG.ui.scrollview.Range.prototype.onThumbDrag=function(a){this._observer.onThumbDrag(this,a)};JSG.namespace("JSG.ui.scrollview");JSG.ui.scrollview.RangeModel=function(){this._value=this._extent=this._max=this._min=0;this._observers=[]};JSG.ui.scrollview.RangeModel.CHANGED_MIN=1;JSG.ui.scrollview.RangeModel.CHANGED_MAX=2;JSG.ui.scrollview.RangeModel.CHANGED_RANGE=4;
JSG.ui.scrollview.RangeModel.CHANGED_EXTENT=8;JSG.ui.scrollview.RangeModel.CHANGED_VALUE=16;JSG.ui.scrollview.RangeModel.prototype.addObserver=function(a){this._observers.contains(a)||this._observers.push(a)};JSG.ui.scrollview.RangeModel.prototype.removeObserver=function(a){this._observers.remove(a)};JSG.ui.scrollview.RangeModel.prototype._notifyRangeChange=function(a){for(var b=0;b<this._observers.length;b++)this._observers[b].onRangeChange(this,a)};
JSG.ui.scrollview.RangeModel.prototype.setAll=function(a,b,c,d){this._min.isEqual(a)&&this._max.isEqual(b)&&this._extent.isEqual(c)||(this._min=a,this._max=b,this._extent=c,this._notifyRangeChange(JSG.ui.scrollview.RangeModel.CHANGED_RANGE));this.setValue(d)};JSG.ui.scrollview.RangeModel.prototype.setRange=function(a,b){this._min.isEqual(a)&&this._max.isEqual(b)||(this._min=a,this._max=b,this._notifyRangeChange(JSG.ui.scrollview.RangeModel.CHANGED_RANGE),this.setValue(this._value))};
JSG.ui.scrollview.RangeModel.prototype.getMin=function(){return this._min};JSG.ui.scrollview.RangeModel.prototype.setMin=function(a){this._min.isEqual(a)||(this._min=a,this._notifyRangeChange(JSG.ui.scrollview.RangeModel.CHANGED_MIN),this.setValue(this._value))};JSG.ui.scrollview.RangeModel.prototype.getMax=function(){return this._max};
JSG.ui.scrollview.RangeModel.prototype.setMax=function(a){this._max=a;this._max.isEqual(a)||(this._max=a,this._notifyRangeChange(JSG.ui.scrollview.RangeModel.CHANGED_MAX),this.setValue(this._value))};JSG.ui.scrollview.RangeModel.prototype.getExtent=function(){return this._extent};JSG.ui.scrollview.RangeModel.prototype.setExtent=function(a){this._extent.isEqual(a)||(this._extent=a,this._notifyRangeChange(JSG.ui.scrollview.RangeModel.CHANGED_EXTENT),this.setValue(this._value))};
JSG.ui.scrollview.RangeModel.prototype.getValue=function(){return this._value};JSG.ui.scrollview.RangeModel.prototype.setValue=function(a){a=Math.max(Math.min(a,this._max-this._extent),this._min);this._value.isEqual(a)||(this._value=a,this._notifyRangeChange(JSG.ui.scrollview.RangeModel.CHANGED_VALUE))};JSG.ui.scrollview.RangeModel.prototype.toString=function(){return"min:"+this._min+", max:"+this._max+", extent:"+this._extent+", value:"+this._value};JSG.namespace("JSG.ui.scrollview");
JSG.ui.scrollview.Thumb=function(){JSG.ui.scrollview.Thumb._super.constructor.apply(this,arguments);this._isSelected=!1;this._startLocation=new JSG.geometry.Point(0,0);this.getFormat().setFillColor("#CCCCCC");this.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE)};JSG.extend(JSG.ui.scrollview.Thumb,JSG.ui.Widget);JSG.ui.scrollview.Thumb.prototype.getMinimumSize=function(){return 500};
JSG.ui.scrollview.Thumb.prototype.handleMouseEvent=function(a){if(!0===this._isVisible){var b=JSG.ui.events.MouseEventType;a.type===b.MOVE&&!0===this._isSelected?(a.isConsumed=!0,this._dragTo(a.location)):this._bounds.containsPoint(a.location)?(a.isConsumed=!0,a.type===b.DOWN?(this._isSelected=!0,this._startLocation.setTo(a.location)):this._isSelected=!1):this._isSelected=!1}};
JSG.ui.scrollview.Thumb.prototype._dragTo=function(a){var b=a.copy().subtract(this._startLocation);this._parent.onThumbDrag(b);this._startLocation.setTo(a)};JSG.namespace("JSG.ui.scrollview");
JSG.ui.scrollview.ScrollBar=function(a){JSG.ui.scrollview.ScrollBar._super.constructor.apply(this,arguments);this._isVertical=a;var b=!0===a?JSG.ui.scrollview.Arrow.NORTH:JSG.ui.scrollview.Arrow.WEST;this._arrowStart=new JSG.ui.scrollview.Arrow(b);this._arrowStart.getFormat().setFillColor(JSG.bkColorScroll);this._arrowStart.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this._arrowStart.addActionListener(this);this.add(this._arrowStart);this._range=new JSG.ui.scrollview.Range(this,
a);this._range.getFormat().setFillColor(JSG.bkColorScroll);this._range.getFormat().setLineColor(JSG.bkColorScroll);this._range.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this.add(this._range);b=!0===a?JSG.ui.scrollview.Arrow.SOUTH:JSG.ui.scrollview.Arrow.EAST;this._arrowEnd=new JSG.ui.scrollview.Arrow(b);this._arrowEnd.getFormat().setFillColor(JSG.bkColorScroll);this._arrowEnd.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this._arrowEnd.addActionListener(this);
this.add(this._arrowEnd);this.setVisible(!0);this.getFormat().setFillColor("#eeeeee");this.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);this._rangemodel=void 0};JSG.extend(JSG.ui.scrollview.ScrollBar,JSG.ui.Widget);JSG.ui.scrollview.ScrollBar.SIZE=450;JSG.ui.scrollview.ScrollBar.prototype.getRangeModel=function(){return this._rangemodel};
JSG.ui.scrollview.ScrollBar.prototype.setRangeModel=function(a){void 0!=this._rangemodel&&this._rangemodel.removeObserver(this);this._rangemodel=a;this._rangemodel.addObserver(this)};JSG.ui.scrollview.ScrollBar.prototype.isDragThumbFinished=function(){return this._range.isDragThumbFinished()};
JSG.ui.scrollview.ScrollBar.prototype.layout=function(){if(!0===this.isVisible()){var a=this.getClientArea();this._isVertical?(this._arrowStart._bounds.set(0,0,a.width,a.width),this._range._bounds.set(0,a.width,a.width,a.height-2*a.width),this._arrowEnd._bounds.set(0,a.height-a.width,a.width,a.width)):(this._arrowStart._bounds.set(0,0,a.height,a.height),this._range._bounds.set(a.height,0,a.width-2*a.height,a.height),this._arrowEnd._bounds.set(a.width-a.height,0,a.height,a.height));this._range.layout(this)}};
JSG.ui.scrollview.ScrollBar.prototype.doHandleEvent=function(a){return this._range.isThumbSelected()&&(a.type===JSG.ui.events.MouseEventType.MOVE||a.type===JSG.ui.events.MouseEventType.UP)||this.isVisible()&&this.getBounds().contains(a.location.x,a.location.y)};
JSG.ui.scrollview.ScrollBar.prototype.handleMouseEvent=function(a){if(!0===this.isVisible()){var b=a.location.copy();this.translateFromParent(a.location);this._range.handleMouseEvent(a);this._arrowStart.handleMouseEvent(a);this._arrowEnd.handleMouseEvent(a);a.location=b;this._bounds.contains(a.location.x,a.location.y)&&(a.isConsumed=!0)}};JSG.ui.scrollview.ScrollBar.prototype.onMouseUp=function(a,b){};
JSG.ui.scrollview.ScrollBar.prototype.onMouseDown=function(a,b){var c=JSG.ui.scrollview.Arrow,d=a.getDirection();d===c.WEST||d===c.NORTH?this._stepUp():d!==c.EAST&&d!==c.SOUTH||this._stepDown()};JSG.ui.scrollview.ScrollBar.prototype._pageDelta=function(){return 0.8*this._rangemodel.getExtent()};JSG.ui.scrollview.ScrollBar.prototype._stepUp=function(){this._rangemodel.setValue(this._rangemodel.getValue()-this._pageDelta()/10)};
JSG.ui.scrollview.ScrollBar.prototype._stepDown=function(){this._rangemodel.setValue(this._rangemodel.getValue()+this._pageDelta()/10)};JSG.ui.scrollview.ScrollBar.prototype.onThumbDrag=function(a,b){var c=this._rangemodel,d=a.getClientArea(),e=a.getThumb().getBounds(),f=c.getMax()-c.getMin()-c.getExtent();if(!0===this._isVertical)var g=e.y+=b.y,g=g*f/(d.height-e.height)+c.getMin();else g=e.x+=b.x,g=g*f/(d.width-e.width)+c.getMin();c.setValue(g)};
JSG.ui.scrollview.ScrollBar.prototype.onPageUp=function(a,b){this._rangemodel.setValue(this._rangemodel.getValue()-this._pageDelta())};JSG.ui.scrollview.ScrollBar.prototype.onPageDown=function(a,b){this._rangemodel.setValue(this._rangemodel.getValue()+this._pageDelta())};JSG.ui.scrollview.ScrollBar.prototype.onRangeChange=function(a){this._range.layout(this)};JSG.namespace("JSG.ui.scrollview");
JSG.ui.scrollview.ScrollView=function(){JSG.ui.scrollview.ScrollView._super.constructor.apply(this,arguments);this.getFormat().setFillColor(JSG.bkColorGraph);this._hScrollbar=this.add(new JSG.ui.scrollview.ScrollBar(!1));this._vScrollbar=this.add(new JSG.ui.scrollview.ScrollBar(!0));this._viewport=this.add(new JSG.ui.scrollview.ViewPort);this.setViewPanel(this._viewport.getViewPanel());this._vScrollbar.setRangeModel(this._viewport.getVerticalRangeModel());this._hScrollbar.setRangeModel(this._viewport.getHorizontalRangeModel());
this._viewport.getVerticalRangeModel().addObserver(this);this._viewport.getHorizontalRangeModel().addObserver(this);this._listeners=[]};JSG.extend(JSG.ui.scrollview.ScrollView,JSG.ui.Widget);JSG.ui.scrollview.ScrollView.SCROLL_NOTIFICATION="scrollpanel.scroll.notification";JSG.ui.scrollview.ScrollView.prototype.addScrollListener=function(a){this._listeners.contains(a)||this._listeners.push(a)};JSG.ui.scrollview.ScrollView.prototype.removeScrollListener=function(a){this._listeners.remove(a)};
JSG.ui.scrollview.ScrollView.prototype.notifyScrolled=function(){for(var a=this._listeners,b=0;b<a.length;b++)a[b].onViewScrolled(this)};JSG.ui.scrollview.ScrollView.prototype.getViewPanel=function(){return this._viewport.getViewPanel()};JSG.ui.scrollview.ScrollView.prototype.setViewPanel=function(a){this._viewport.setViewPanel(a)};JSG.ui.scrollview.ScrollView.prototype.getViewPort=function(){return this._viewport};
JSG.ui.scrollview.ScrollView.prototype.layout=function(){var a=this.getClientArea(),b=a.copy();b.width-=JSG.ui.scrollview.ScrollBar.SIZE;b.height-=JSG.ui.scrollview.ScrollBar.SIZE;this._viewport.layout();var c=this._viewport.getPreferredBounds(b,JSG.rectCache.get()),d=c.width>a.width||c.x<a.x,e=c.height>a.height||c.y<a.y,d=d||e&&c.width>b.width,e=e||d&&c.height>b.height;this._hScrollbar.setVisible(d);this._vScrollbar.setVisible(e);b=JSG.rectCache.get();this._hScrollbar.isVisible()&&(a.height-=JSG.ui.scrollview.ScrollBar.SIZE);
this._vScrollbar.isVisible()&&(a.width-=JSG.ui.scrollview.ScrollBar.SIZE);this._viewport.setBoundsTo(a);this._viewport.layout();this._hScrollbar.isVisible()&&(b.setTo(a),b.y=a.height,b.height=JSG.ui.scrollview.ScrollBar.SIZE,this._hScrollbar.setBoundsTo(b),this._hScrollbar.layout());this._vScrollbar.isVisible()&&(b.setTo(a),b.x=a.width,b.width=JSG.ui.scrollview.ScrollBar.SIZE,this._vScrollbar.setBoundsTo(b),this._vScrollbar.layout());JSG.rectCache.release(c,b)};
JSG.ui.scrollview.ScrollView.prototype.isScrollBarEvent=function(a){a=a.location.copy();this.translateFromParent(a);return this.hitsScrollBar(a)};JSG.ui.scrollview.ScrollView.prototype.hitsScrollBar=function(a,b){function c(b){return b.isVisible()&&b.getBounds().contains(a.x,a.y)}return void 0!=b?c(!0===b?this._vScrollbar:this._hScrollbar):c(this._vScrollbar)||c(this._hScrollbar)};JSG.ui.scrollview.ScrollView.prototype.onViewPanelResized=function(a){this._hScrollbar.layout();this._vScrollbar.layout()};
JSG.ui.scrollview.ScrollView.prototype.handleMouseEvent=function(a){this._bounds.contains(a.location.x,a.location.y)?this.translateFromParent(a.location):a.type==JSG.ui.events.MouseEventType.EXIT;this._hScrollbar.handleMouseEvent(a);this._vScrollbar.handleMouseEvent(a);a.type!==JSG.ui.events.MouseEventType.UP&&a.type!==JSG.ui.events.MouseEventType.EXIT||!this._hScrollbar.isDragThumbFinished()&&!this._vScrollbar.isDragThumbFinished()||this._viewport.revalidate()};
JSG.ui.scrollview.ScrollView.prototype.handleDragEvent=function(a){this._bounds.contains(a.location.x,a.location.y)&&this.translateFromParent(a.location);return JSG.ui.scrollview.ScrollView._super.handleDragEvent.call(this,a)};JSG.ui.scrollview.ScrollView.prototype.onRangeChange=function(a,b){b===JSG.ui.scrollview.RangeModel.CHANGED_VALUE&&this.notifyScrolled()};JSG.ui.scrollview.ScrollView.prototype.invalidate=function(){this.setValid(!1)};
JSG.ui.scrollview.ScrollView.prototype.revalidate=function(){this.invalidate();this.validate()};JSG.ui.scrollview.ScrollView.prototype.validate=function(){JSG.ui.scrollview.ScrollView._super.validate.call(this);this.layout()};JSG.ui.scrollview.ScrollView.prototype.showScale=function(){JSG.debug.log("ScrollView called legacy function showScale...",JSG.debug.SCROLLVIEW_TEST)};
JSG.ui.scrollview.ScrollView.prototype.setScrollPosition=function(a,b){JSG.debug.log("ScrollView called legacy function setScrollPosition..."+a+","+b,JSG.debug.SCROLLVIEW_TEST)};JSG.ui.scrollview.ScrollView.prototype.translateFromViewPort=function(a){this._viewport.translateFromParent(a)};JSG.ui.scrollview.ScrollView.prototype.translateToViewPort=function(a){this._viewport.translateToParent(a)};JSG.namespace("JSG.graph.model");
JSG.graph.model.ContainerNode=function(a){JSG.graph.model.ContainerNode._super.constructor.apply(this,arguments);this.setShapeTo(void 0!==a?a:new JSG.graph.model.shapes.RectangleShape);this._pin.setLocalCoordinate(new JSG.graph.expr.NumberExpression(0,"WIDTH * 0.5"),new JSG.graph.expr.NumberExpression(0,"HEIGHT * 0.5"));this._contentPane=void 0;this.setContentPane(new JSG.graph.model.ContainerNode.ContentPane);this._changed=!1};JSG.extend(JSG.graph.model.ContainerNode,JSG.graph.model.Node);
JSG.graph.model.ContainerNode.prototype.newInstance=function(){return new JSG.graph.model.ContainerNode};JSG.graph.model.ContainerNode.prototype.saveXMLContent=function(a,b){JSG.graph.model.ContainerNode._super.saveXMLContent.call(this,a,b);a.writeAttributeString("type","containernode")};
JSG.graph.model.ContainerNode.prototype._saveSubItemsXML=function(a){(function(b){a.writeStartElement("scrollposition");a.writeAttributeString("x",b.x);a.writeAttributeString("y",b.y);a.writeEndElement()})(this._contentPane.getPinPoint());(function(b){for(var c=0;c<b.length;c++)b[c].saveXML(a)})(this._contentPane.getItems())};
JSG.graph.model.ContainerNode.prototype.readXML=function(a){JSG.graph.model.ContainerNode._super.readXML.call(this,a);this._contentPane.setPinPointTo(function(){var b=new JSG.geometry.Point(0,0),c=findElementByTagName(a,"scrollposition");if(void 0!=c){var d=c.getAttribute("x"),c=c.getAttribute("y"),d=void 0!=d?Number(d):0,c=void 0!=c?Number(c):0;b.set(d,c)}return b}());this._changed=!0};JSG.graph.model.ContainerNode.prototype.getContentPane=function(){return this._contentPane};
JSG.graph.model.ContainerNode.prototype.setContentPane=function(a){void 0!=this._contentPane&&(this.removeChild(this._contentPane),JSG.graph.model.ContainerNode._super.removeItem.call(this,this._contentPane));this._contentPane=a;void 0!=this._contentPane&&JSG.graph.model.ContainerNode._super.addItem.call(this,this._contentPane)};
JSG.graph.model.ContainerNode.prototype.addItem=function(a,b){var c=a.getOrigin();this._contentPane.translateFromParent(c);a.setOriginTo(c);return this._contentPane.addItem(a,b)};JSG.graph.model.ContainerNode.prototype.removeItem=function(a){this._contentPane.removeItem(a)};JSG.graph.model.ContainerNode.prototype._doRefresh=function(a){JSG.graph.model.ContainerNode._super._doRefresh.call(this,a);void 0!=this._contentPane&&this._contentPane.refresh(a);this._changed=!1};
JSG.graph.model.ContainerNode.prototype._update=function(){return JSG.graph.model.ContainerNode._super._update.call(this)||this._changed};JSG.graph.model.ContainerNode.prototype.evaluate=function(){JSG.graph.model.ContainerNode._super.evaluate.call(this);void 0!=this._contentPane&&this._contentPane.evaluate()};JSG.graph.model.ContainerNode.prototype.isAddLabelAllowed=function(){return!1};
JSG.graph.model.ContainerNode.prototype.getPortById=function(a){var b=JSG.graph.model.ContainerNode._super.getPortById.call(this,a);return void 0!=b?b:this._contentPane.getPortById(a)};JSG.graph.model.ContainerNode.prototype.getTotalBoundingRect=function(a,b){return this.getTranslatedBoundingBox(void 0!=a?a:this).getBoundingRectangle(b)};
JSG.graph.model.ContainerNode.ContentPane=function(){JSG.graph.model.ContainerNode.ContentPane._super.constructor.apply(this,arguments);this.setShapeTo(new JSG.graph.model.shapes.RectangleShape);this.setSize(0,0);var a=this.getPin(),b=JSG.graph.expr.NumberExpression;a.setCoordinate(new b(0),new b(0));a.setLocalCoordinate(new b(0),new b(0))};JSG.extend(JSG.graph.model.ContainerNode.ContentPane,JSG.graph.model.GraphItem);
JSG.graph.model.ContainerNode.ContentPane.prototype.setBoundingBoxTo=function(a){this.getBoundingBox().isEqualTo(a,1)||(this._bounds.width=a.getWidth(),this._bounds.height=a.getHeight())};JSG.graph.model.ContainerNode.ContentPane.prototype.layoutAll=function(a){};JSG.graph.model.ContainerNode.ContentPane.prototype.isAddLabelAllowed=function(){return!1};JSG.graph.model.ContainerNode.ContentPane.prototype.isSelectable=function(){return!1};
JSG.graph.model.ContainerNode.ContentPane.prototype.getPortById=function(a){for(var b=void 0,c=this._subItems.length-1;0<=c;c--){var d=this._subItems[c];if(d instanceof JSG.graph.model.Node&&(b=d.getPortById(a),void 0!=b))break}return b};JSG.namespace("JSG.graph.view");
JSG.graph.view.ContainerNodeView=function(a){JSG.graph.view.ContainerNodeView._super.constructor.call(this,a);this._scrollview=JSG.graph.view.ContainerNodeView._super.addView.call(this,new JSG.ui.scrollview.ScrollView);this._viewpanel=new JSG.graph.view.ContainerNodeViewPanel(this);this._scrollview.setViewPanel(this._viewpanel);this._scrollview.getViewPort().getViewPanelBounds=function(a){var c=this._viewpanel.getPreferredBounds();a=JSG.rectCache.get().set(a.x-this._vpOffset.x,a.y-this._vpOffset.y,
a.width,a.height);c.union(a);JSG.rectCache.release(a);return c}};JSG.extend(JSG.graph.view.ContainerNodeView,JSG.graph.view.NodeView);JSG.graph.view.ContainerNodeView.prototype.setViewPanel=function(a){this._viewpanel=a;this._scrollview.setViewPanel(a)};JSG.graph.view.ContainerNodeView.prototype.setContentPaneView=function(a){void 0!=a&&this._viewpanel.setView(a)};JSG.graph.view.ContainerNodeView.prototype.addView=function(a,b){this._viewpanel._addView(a,b);return a};
JSG.graph.view.ContainerNodeView.prototype.removeView=function(a){this._viewpanel._removeView(a);return a};JSG.graph.view.ContainerNodeView.prototype.removeAllViews=function(){this._viewpanel._removeAllViews()};JSG.graph.view.ContainerNodeView.prototype.invalidate=function(){};
JSG.graph.view.ContainerNodeView.prototype.layout=function(){var a=JSG.boxCache.get(),b=this.getBoundingBox(a).toRectangle(JSG.rectCache.get());JSG.boxCache.release(a);b.x=0;b.y=0;this._scrollview.setBoundsTo(b);this._scrollview.layout();JSG.rectCache.release(b)};JSG.graph.view.ContainerNodeView.prototype.doHandleEventAt=function(a,b){return this._scrollview.hitsScrollBar(a)};
JSG.graph.view.ContainerNodeView.prototype.handleMouseEvent=function(a){this._scrollview.handleMouseEvent(a);a.isConsumed&&this.getItem().getGraph().markDirty()};JSG.graph.view.ContainerNodeViewPanel=function(a){JSG.graph.view.ContainerNodeViewPanel._super.constructor.apply(this,arguments);this.getFormat().setFillColor(JSG.bkColorGraph);this.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.SOLID);this._containerView=a};JSG.extend(JSG.graph.view.ContainerNodeViewPanel,JSG.ui.ViewPanel);
JSG.graph.view.ContainerNodeViewPanel.prototype._addView=function(a,b){return this.getView().addView(a,b)};JSG.graph.view.ContainerNodeViewPanel.prototype._removeView=function(a){return this.getView().removeView(a)};JSG.graph.view.ContainerNodeViewPanel.prototype._removeAllViews=function(){this.getView().removeAllViews()};JSG.graph.view.ContainerNodeViewPanel.prototype.getGraphView=function(){return this._containerView.getGraphView()};
JSG.graph.view.ContainerNodeViewPanel.prototype._setSize=function(a,b){this._bounds.width=a;this._bounds.height=b};JSG.graph.view.ContainerNodeViewPanel.prototype.translateFromParent=function(a){return a};JSG.graph.view.ContainerNodeViewPanel.prototype.translateToParent=function(a){return a};
JSG.graph.view.ContentPaneView=function(a){JSG.graph.view.ContentPaneView._super.constructor.apply(this,arguments);a.getFormat().setLineStyle(JSG.graph.attr.FormatAttributes.LineStyle.NONE);a.getFormat().setFillStyle(JSG.graph.attr.FormatAttributes.FillStyle.NONE);this._bboxListener=new JSG.graph.view.ContentPaneView.BBoxListener(this)};JSG.extend(JSG.graph.view.ContentPaneView,JSG.graph.view.GraphItemView);
JSG.graph.view.ContentPaneView.prototype.addView=function(a,b){a=JSG.graph.view.ContentPaneView._super.addView.call(this,a,b);this._bboxListener.registerTo(a.getItem());this.revalidate();return a};JSG.graph.view.ContentPaneView.prototype.removeView=function(a){this._bboxListener.deregisterFrom(a.getItem());a=JSG.graph.view.ContentPaneView._super.removeView.call(this,a);!0==a&&this.revalidate();return a};
JSG.graph.view.ContentPaneView.prototype.removeAllViews=function(){for(var a=this._subviews,b=0;b<a.length;b++)this._bboxListener.deregisterFrom(a[b].getItem());JSG.graph.view.ContentPaneView._super.removeAllViews.call(this);this.revalidate()};JSG.graph.view.ContentPaneView.prototype.getGraphView=function(){return this.getParent().getGraphView()};
JSG.graph.view.ContentPaneView.prototype.getPreferredBounds=function(a,b){var c=b||new JSG.geometry.Rectangle(0,0,0,0);if(this.hasSubviews()){for(var d=JSG.rectCache.get(),e=this.getSubviews(),f=0;f<e.length;f++){var g=e[f];g.layout();c.union(g.getItem().getTotalBoundingRect(void 0,d))}JSG.rectCache.release(d)}return c};JSG.graph.view.ContentPaneView.prototype.translateToParent=function(a){return a};JSG.graph.view.ContentPaneView.prototype.translateFromParent=function(a){return a};
JSG.graph.view.ContentPaneView.prototype.translateGraphics=function(a){};JSG.graph.view.ContentPaneView.prototype.drawClientArea=function(a){this.drawSubViews(a)};JSG.graph.view.ContentPaneView.prototype.onResize=function(a){this.revalidate()};JSG.graph.view.ContentPaneView.BBoxListener=function(a){this._cpview=a};
JSG.graph.view.ContentPaneView.BBoxListener.prototype.registerTo=function(a){a.addEventListener(JSG.graph.model.events.Event.BBOX,this);a.addEventListener(JSG.graph.model.events.Event.ANGLE,this);a.addEventListener(JSG.graph.model.events.Event.PIN,this);a.addEventListener(JSG.graph.model.events.Event.SIZE,this);a.addEventListener(JSG.graph.model.events.Event.COLLAPSEDSIZE,this)};
JSG.graph.view.ContentPaneView.BBoxListener.prototype.deregisterFrom=function(a){a.removeEventListener(JSG.graph.model.events.Event.BBOX,this);a.removeEventListener(JSG.graph.model.events.Event.ANGLE,this);a.removeEventListener(JSG.graph.model.events.Event.PIN,this);a.removeEventListener(JSG.graph.model.events.Event.SIZE,this);a.removeEventListener(JSG.graph.model.events.Event.COLLAPSEDSIZE,this)};JSG.graph.view.ContentPaneView.BBoxListener.prototype.handlePreEvent=function(a){};
JSG.graph.view.ContentPaneView.BBoxListener.prototype.handlePostEvent=function(a){this._cpview.revalidate()};JSG.namespace("JSG.graph.controller");JSG.graph.controller.ContainerNodeController=function(a){JSG.graph.controller.ContainerNodeController._super.constructor.apply(this,arguments);this._contentPaneController=void 0};JSG.extend(JSG.graph.controller.ContainerNodeController,JSG.graph.controller.NodeController);JSG.graph.controller.ContainerNodeController.prototype.isSelectable=function(){return!0};
JSG.graph.controller.ContainerNodeController.prototype.createView=function(a){return new JSG.graph.view.ContainerNodeView(a)};JSG.graph.controller.ContainerNodeController.prototype.activate=function(){JSG.graph.controller.ContainerNodeController._super.activate.call(this);var a=this.getModel().getContentPane();this._setContentPaneController(new JSG.graph.controller.ContentPaneController(a));this.getView().layout()};
JSG.graph.controller.ContainerNodeController.prototype._setContentPaneController=function(a){void 0!=this._contentPaneController&&this.removeChild(this._contentPaneController);this._contentPaneController=a;this.addChild(this._contentPaneController)};JSG.graph.controller.ContainerNodeController.prototype.getContentPaneController=function(){return this._contentPaneController};JSG.graph.controller.ContainerNodeController.prototype.refresh=function(){void 0!=this._contentPaneController&&this._contentPaneController.refresh()};
JSG.graph.controller.ContainerNodeController.prototype.addChildView=function(a,b){this.getView().setContentPaneView(a.getView())};JSG.graph.controller.ContainerNodeController.prototype.onMouseDown=function(a,b,c){var d=this.getView();return d.doHandleEventAt(a,c)?!0:d.onMouseDown(a,b,c)};
JSG.graph.controller.ContainerNodeController.prototype.handlePostEvent=function(a){JSG.graph.controller.ContainerNodeController._super.handlePostEvent.call(this,a);var b=this.getView();if(b instanceof JSG.graph.view.ContainerNodeView){var c=JSG.graph.model.events.Event;switch(a.id){case c.ALL:case c.BBOX:case c.SIZE:b.layout()}}};
JSG.graph.controller.ContainerNodeController.prototype.getModelController=function(a){var b=JSG.graph.controller.ContainerNodeController._super.getModelController.call(this,a);void 0==b&&(b=void 0!=this._contentPaneController?this._contentPaneController.getModelController(a):void 0);return b};
JSG.graph.controller.ContainerNodeController.prototype.findControllerByConditionAndLocation=function(a,b){if(this._isVisible(a))return JSG.graph.controller.ContainerNodeController._super.findControllerByConditionAndLocation.call(this,a,b)};JSG.graph.controller.ContainerNodeController.prototype.findControllerByConditionAndBox=function(a,b){return JSG.graph.controller.ContainerNodeController._super.findControllerByConditionAndBox.call(this,a,b)};
JSG.graph.controller.ContainerNodeController.prototype.getControllerAt=function(a,b,c){if(this._isVisible(a))return JSG.graph.controller.ContainerNodeController._super.getControllerAt.call(this,a,b,c)};JSG.graph.controller.ContainerNodeController.prototype._getSubControllerAt=function(a,b,c){if(this._isVisible(a))return JSG.graph.controller.ContainerNodeController._super._getSubControllerAt.call(this,a,b,c)};JSG.graph.controller.ContainerNodeController.prototype._isVisible=function(a){return this.getView().containsPoint(a)};
JSG.graph.controller.ContainerNodeController.prototype._stopLookUp=function(a){a=a.copy();this.getView().translateFromParent(a);return this.getView().doHandleEventAt(a)};JSG.graph.controller.ContainerNodeController.prototype._isSelectableInParent=function(a){var b=JSG.graph.controller.ContainerNodeController._super._isSelectableInParent.call(this,a);if(!0===b){var c=this.getModel().getParent(),b=this.getModel().getBoundingBox();a=a.getModel().getTranslatedBoundingBox(c);return b.doesIntersectWith(a)}return b};
JSG.graph.controller.ContentPaneController=function(a){JSG.graph.controller.ContainerNodeController._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.controller.ContentPaneController,JSG.graph.controller.GraphItemController);JSG.graph.controller.ContentPaneController.prototype.createFeedback=function(){return this.getParent().createFeedback()};JSG.graph.controller.ContentPaneController.prototype.isSelectable=function(){return!1};
JSG.graph.controller.ContentPaneController.prototype.createView=function(a){return new JSG.graph.view.ContentPaneView(a)};JSG.graph.controller.ContentPaneController.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.BBOX:case b.SIZE:void 0!=this.getModel().getGraph()&&this.getModel().getGraph().markDirty();this.getView()._fireOnResize();break;default:JSG.graph.controller.ContentPaneController._super.handlePostEvent.call(this,a)}};JSG.namespace("JSG.graph.interaction");
JSG.graph.interaction.ViewInteraction=function(a){JSG.graph.interaction.ViewInteraction._super.constructor.apply(this,arguments);this._view=a};JSG.extend(JSG.graph.interaction.ViewInteraction,JSG.graph.interaction.Interaction);JSG.graph.interaction.ViewInteraction.prototype.deactivate=function(a){this._view=void 0;JSG.graph.interaction.ViewInteraction._super.deactivate.call(this,a)};
JSG.graph.interaction.ViewInteraction.prototype.setCurrentLocation=function(a){function b(b){b.translateFromParent(a)}this._view&&(JSG.graph.Utils.traverseDown(this._view.getGraphView(),this._view,b),JSG.graph.interaction.ViewInteraction._super.setCurrentLocation.call(this,a))};JSG.graph.interaction.ViewInteraction.prototype.onMouseDown=function(a,b){if(this._view&&void 0!=this._view.onMouseDown)this._view.onMouseDown(this.currentLocation,b,a);else this._notifyMouseEvent(a)};
JSG.graph.interaction.ViewInteraction.prototype.onMouseDrag=function(a,b){this._notifyMouseEvent(a)};JSG.graph.interaction.ViewInteraction.prototype.onMouseUp=function(a,b){this._notifyMouseEvent(a);this.finishInteraction(a,b)};JSG.graph.interaction.ViewInteraction.prototype.onMouseExit=function(a,b){a.doRepaint=!0;this.cancelInteraction(a,b)};JSG.graph.interaction.ViewInteraction.prototype.onMouseDoubleClick=function(a,b){this._notifyMouseEvent(a)};
JSG.graph.interaction.ViewInteraction.prototype.onMouseMove=function(a,b){this._notifyMouseEvent(a)};JSG.graph.interaction.ViewInteraction.prototype.onMouseWheel=function(a,b){this._notifyMouseEvent(a)};JSG.graph.interaction.ViewInteraction.prototype._notifyMouseEvent=function(a){this._view&&(a.location.setTo(this.currentLocation),this._view.handleMouseEvent(a))};JSG.graph.interaction.ViewInteraction.prototype.onDragEnter=function(a,b){this._notifyDragEvent(a)};
JSG.graph.interaction.ViewInteraction.prototype.onDragExit=function(a,b){this._notifyDragEvent(a)};JSG.graph.interaction.ViewInteraction.prototype.onDragLeave=function(a,b){this._notifyDragEvent(a)};JSG.graph.interaction.ViewInteraction.prototype.onDragOver=function(a,b){this._notifyDragEvent(a)};JSG.graph.interaction.ViewInteraction.prototype.onDrop=function(a,b){this._notifyDragEvent(a)};
JSG.graph.interaction.ViewInteraction.prototype._notifyDragEvent=function(a){this._view&&(a.location.setTo(this.currentLocation),this._view.handleDragEvent(a))};JSG.graph.interaction.ViewInteraction.prototype.onKeyDown=function(a,b){this._notifyKeyEvent(a)};JSG.graph.interaction.ViewInteraction.prototype.onKeyUp=function(a,b){this._notifyKeyEvent(a)};JSG.graph.interaction.ViewInteraction.prototype._notifyKeyEvent=function(a){this._view&&(a.location.setTo(this.currentLocation),this._view.handleKeyEvent(a))};
JSG.graph.interaction.ViewInteraction.Activator=function(){JSG.graph.interaction.ViewInteraction.Activator._super.constructor.apply(this,arguments)};JSG.extend(JSG.graph.interaction.ViewInteraction.Activator,JSG.graph.interaction.InteractionActivator);JSG.graph.interaction.ViewInteraction.Activator.KEY="view.activator";JSG.graph.interaction.ViewInteraction.Activator.prototype.getKey=function(){return JSG.graph.interaction.ViewInteraction.Activator.KEY};
JSG.graph.interaction.ViewInteraction.Activator.prototype.onMouseDown=function(a,b,c){var d=this._getController(a,b,c);void 0!=d&&(b.clearSelection(),d=d.getView(),c=this.activateInteraction(new JSG.graph.interaction.ViewInteraction(d),c),d instanceof JSG.graph.view.ContainerNodeView?c._notifyMouseEvent(a):(c.setCurrentLocation(b.translateFromParent(a.location.copy())),c.onMouseDown(a,b)),a.hasActivated=!0)};
JSG.graph.interaction.ViewInteraction.Activator.prototype.onMouseDoubleClick=function(a,b,c){a.isConsumed||(b=this._getController(a,b,c),a.isConsumed=void 0!=b)};JSG.graph.interaction.ViewInteraction.Activator.prototype._getController=function(a,b,c){var d=JSG.ptCache.get().setTo(a.location);c=c.getControllerAt(a.location);c=this._getControllerHandlingEvent(a,b.translateFromParent(d),c);JSG.ptCache.release(d);return c};
JSG.graph.interaction.ViewInteraction.Activator.prototype._getControllerHandlingEvent=function(a,b,c){var d=void 0;return void 0!=c&&(d=c.getParent(),d=d instanceof JSG.graph.controller.GraphController?void 0:this._getControllerHandlingEvent(a,b,d),void 0==d)?(d=c.getView(),d.translateFromParent(b),d.doHandleEventAt(b,a)?c:void 0):d};JSG.namespace("JSG.ui.shapelibrary");
JSG.ui.shapelibrary.ShapeLibrarySelectionView=function(a){JSG.ui.shapelibrary.ShapeLibrarySelectionView._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.shapelibrary.ShapeLibrarySelectionView,JSG.graph.view.selection.SelectionView);
JSG.ui.shapelibrary.ShapeLibrarySelectionView.prototype.draw=function(a){this.isVisible()&&void 0!=this._selectionHandler&&(a.getCoordinateSystem().metricToLogXNoZoom(JSG.graph.view.selection.SelectionView.MARKER_SIZE),this._selectionHandler.refresh(this._views,this._rotationAngle))};JSG.ui.shapelibrary.ShapeLibrarySelectionView.prototype.getHandleAt=function(a,b){};JSG.namespace("JSG.ui.shapelibrary");
JSG.ui.shapelibrary.ShapeLibraryViewer=function(a){JSG.ui.shapelibrary.ShapeLibraryViewer._super.constructor.call(this,a,new JSG.ui.scrollview.ScrollView)};JSG.extend(JSG.ui.shapelibrary.ShapeLibraryViewer,JSG.ui.viewer.ScrollableViewer);JSG.ui.shapelibrary.ShapeLibraryViewer.prototype.getSelectionView=function(){var a=this._rootView.getLayer(JSG.graph.view.LayerId.SELECTION);0===a.length&&a.push(new JSG.ui.shapelibrary.ShapeLibrarySelectionView(this._rootView));return a[0]};
JSG.ui.shapelibrary.ShapeLibraryViewer.prototype.addInteractionFeedback=function(a){a instanceof JSG.graph.view.SelectionFeedbackView&&(a.feedbackInfoVisible=!1);JSG.ui.shapelibrary.ShapeLibraryViewer._super.addInteractionFeedback.call(this,a)};JSG.namespace("JSG.ui.shapelibrary");JSG.ui.shapelibrary.ShapeLibraryDefaultInteraction=function(a){JSG.ui.shapelibrary.ShapeLibraryDefaultInteraction._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.shapelibrary.ShapeLibraryDefaultInteraction,JSG.graph.interaction.GraphInteraction);
JSG.ui.shapelibrary.ShapeLibraryDefaultInteraction.prototype.registerActivators=function(){this.addActivator(JSG.graph.interaction.DragDropActivator.KEY,new JSG.graph.interaction.DragDropActivator)};JSG.namespace("JSG.ui.shapelibrary");JSG.ui.shapelibrary.ShapeLibraryEditor=function(a){JSG.ui.shapelibrary.ShapeLibraryEditor._super.constructor.apply(this,arguments);this.setDefaultInteraction(new JSG.ui.shapelibrary.ShapeLibraryDefaultInteraction)};
JSG.extend(JSG.ui.shapelibrary.ShapeLibraryEditor,JSG.ui.GraphEditor);JSG.ui.shapelibrary.ShapeLibraryEditor.prototype.createViewer=function(a){a=new JSG.ui.shapelibrary.ShapeLibraryViewer(a);a.setControllerFactory(JSG.graph.controller.GraphControllerFactory.getInstance());return a};JSG.namespace("JSG.ui.shapelibrary");
JSG.ui.shapelibrary.ShapeLibrary=function(a,b,c){this._graphEditor=new JSG.ui.shapelibrary.ShapeLibraryEditor(a);this._graphEditor.setGraph(new JSG.graph.model.Graph);this._graphEditor.getGraphViewer().getScrollPanel().getViewPort().getFormat().setFillColor(JSG.bkColorShapeLibrary);this.shapeWidth=1400;this.shapeHeight=1E3;this.categoryHeight=600;this.margin=200;a=this._graphEditor.getGraph();a.getSettings().setScaleVisible(!1);a.getSettings().setSnapToPort(JSG.graph.attr.consts.PortMode.NONE);a.getSettings().setAutoScroll(!1);
a.getSettings().setGridVisible(!1);a.getSettings().setSnapToGrid(!1);a.getSettings().setSnapToShapes(!1);a.getSettings().setDisplayMode(JSG.ui.graphics.DisplayMode.ENDLESS);a.getFormat().setFillColor(JSG.bkColorShapeLibrary);this._graphEditor.setScrollPosition(0,0);this.resize(b,c);this._graphEditor.getGraphViewer().getScrollPanel().getViewPanel().layout=function(a){void 0!=this._view&&(this._view.layout(),a=this._view.getPreferredBounds(void 0,JSG.rectCache.get()),this.setBoundsTo(a),JSG.rectCache.release(a))}};
JSG.ui.shapelibrary.ShapeLibrary.prototype.setDefaultInteraction=function(a){void 0!=a&&this._graphEditor.setDefaultInteraction(a)};JSG.ui.shapelibrary.ShapeLibrary.prototype.getInteractionActivator=function(a){return this._graphEditor.getDefaultInteraction().getActivator(a)};
JSG.ui.shapelibrary.ShapeLibrary.prototype.addCategory=function(a){var b=this._graphEditor.getGraph(),c=new JSG.graph.model.Node(new JSG.graph.model.shapes.RectangleShape);b.addItem(c);c.setSize(this.shapeWidth,this.categoryHeight);c.getFormat().setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID);c.getFormat().setFillColor(JSG.bkColorShapeLibraryTitle);c.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);c.setItemAttribute(JSG.graph.attr.ItemAttributes.CONTAINER,!1);c.setItemAttribute(JSG.graph.attr.ItemAttributes.SELECTIONMODE,
JSG.graph.attr.consts.SelectionMode.NONE);c.setType("ShapeCategory");a=c.addLabel(a);a.getTextFormat().setFontSize(8);a.getTextFormat().setFontColor(JSG.fontColorShapeLibraryTitle);a.getTextFormat().setHorizontalPosition(JSG.graph.attr.TextFormatAttributes.HorizontalTextPosition.LEFT)};
JSG.ui.shapelibrary.ShapeLibrary.prototype.addShape=function(a,b,c,d){var e=this._graphEditor.getGraph();d=new JSG.graph.model.Node(new JSG.graph.model.shapes.RectangleShape);e.addItem(d);d.setSize(this.shapeWidth,this.shapeHeight);d.getFormat().setFillStyle(JSG.graph.model.attributes.FillStyle.PATTERN);d.getFormat().setLineStyle(JSG.graph.model.attributes.LineStyle.NONE);d.getFormat().setPattern(c);d.getFormat().setPatternStyle(JSG.graph.model.attributes.PatternStyle.CENTER);d.setItemAttribute(JSG.graph.attr.ItemAttributes.CONTAINER,
!1);d.setType(a);a=d.addLabel(b);a.getTextFormat().setVerticalPosition(JSG.graph.attr.TextFormatAttributes.VerticalTextPosition.BELOWBOTTOM);a.getTextFormat().setFontColor(JSG.fontColorShapeLibrary);a.getTextFormat().setFontSize(7);return d};JSG.ui.shapelibrary.ShapeLibrary.prototype.resize=function(a,b){this._graphEditor.resizeContent(a,b);this.layout(a,b)};
JSG.ui.shapelibrary.ShapeLibrary.prototype.layout=function(a,b){for(var c=this._graphEditor.getGraph(),d=JSG.ptCache.get(this.margin,this.margin),e=c.getItemCount(),f=0,g=this._graphEditor.getCoordinateSystem(),l=g.deviceToLogX(a),g=g.deviceToLogY(b);f<e;){var h=c.getItemAt(f);"ShapeCategory"==h.getType().getValue()?(d.x!=this.margin&&(d.y+=this.shapeHeight+600+2*this.margin),h.setPinPoint((l-JSG.ui.scrollbar.ScrollBar.SIZE)/2,d.y+this.categoryHeight/2),h.setSize(l-2*this.margin-JSG.ui.scrollbar.ScrollBar.SIZE,
this.categoryHeight),d.x=this.margin,d.y+=this.margin+this.categoryHeight):(h.setPinPoint(d.x+this.shapeWidth/2,d.y+this.shapeHeight/2),d.x+=this.shapeWidth+this.margin,d.x+this.shapeWidth+this.margin>l-JSG.ui.scrollbar.ScrollBar.SIZE&&(d.x=this.margin,d.y+=this.shapeHeight+800+this.margin));f++}JSG.ptCache.release(d);this._graphEditor.getGraphViewer().layout(l,g);this._graphEditor.repaint()};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.NavigatorGraphView=function(a){JSG.ui.navigator.NavigatorGraphView._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.navigator.NavigatorGraphView,JSG.graph.view.GraphView);JSG.ui.navigator.NavigatorGraphView.prototype._drawGrid=function(a,b){};JSG.ui.navigator.NavigatorGraphView.prototype._drawSelection=function(a){};JSG.ui.navigator.NavigatorGraphView.prototype._drawFeedback=function(a){};JSG.ui.navigator.NavigatorGraphView.prototype._drawOverlay=function(a){};
JSG.ui.navigator.NavigatorGraphView.prototype._refreshModel=function(){};JSG.ui.navigator.NavigatorGraphView.prototype.translateFromParent=function(a){return a};JSG.namespace("JSG.ui.navigator");JSG.ui.navigator.NavigatorItemView=function(a){JSG.ui.navigator.NavigatorItemView._super.constructor.apply(this,arguments);this._shapeRenderer=void 0};JSG.extend(JSG.ui.navigator.NavigatorItemView,JSG.graph.view.GraphItemView);JSG.ui.navigator.NavigatorItemView.FILL_COLOR="#ffffff";
JSG.ui.navigator.NavigatorItemView.LINE_COLOR="#000000";
JSG.ui.navigator.NavigatorItemView.prototype.draw=function(a){this._item.isVisible()&&(void 0==this._shapeRenderer&&(this._shapeRenderer=JSG.graph.view.shapes.ShapeRenderer.fromShape(this._item._shape)),a.save(),this.translateGraphics(a),a.setLineStyle(this.getLineStyle()),a.setFillStyle(JSG.graph.model.attributes.FillStyle.SOLID),a.setLineColor(JSG.ui.navigator.NavigatorItemView.LINE_COLOR),a.setFillColor(JSG.ui.navigator.NavigatorItemView.FILL_COLOR),a.setLineCorner(0),this._item.isCollapsed()?
this.drawCollapsed(a):this.drawOutline(a),a.restore())};JSG.ui.navigator.NavigatorItemView.prototype.getLineStyle=function(){var a=!0,b=this._item.getFormat().getLineStyle().getValue();b===JSG.graph.model.attributes.LineStyle.NONE&&(b=(a=(a=(a=this._item.getParent()&&!(this._item.getParent()instanceof JSG.graph.model.Graph))||this._item instanceof JSG.graph.model.TextNode)||this._item.hasReshapeCoordinates())?b:JSG.graph.model.attributes.LineStyle.SOLID);return b};
JSG.ui.navigator.NavigatorItemView.prototype.drawOutline=function(a){this._shapeRenderer.drawShapeFill(this._item._shape,this._item.isClosed(),a);this._shapeRenderer.drawShapeBorder(this._item._shape,this._item.isClosed(),a);this.hasSubviews()&&this.drawSubViews(a)};JSG.ui.navigator.NavigatorItemView.prototype.drawCollapsed=function(a){var b=this._item.getSize().toRectangle(JSG.rectCache.get());a.drawRect(b);JSG.rectCache.release(b)};
JSG.ui.navigator.NavigatorItemView.prototype.translateGraphics=function(a){var b=this._item.getOrigin(JSG.ptCache.get());a.translate(b.x,b.y);a.rotate(this._item.getAngle().getValue());JSG.ptCache.release(b)};JSG.namespace("JSG.ui.navigator");JSG.ui.navigator.NavigatorEdgeView=function(a){JSG.ui.navigator.NavigatorEdgeView._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.navigator.NavigatorEdgeView,JSG.graph.view.GraphItemView);
JSG.ui.navigator.NavigatorEdgeView.prototype.drawBorder=function(a,b,c){function d(a){a=a._item.getFormat().getLineStyle().getValue();return a===JSG.graph.model.attributes.LineStyle.NONE?a:JSG.graph.model.attributes.LineStyle.SOLID}b.hasBorder()&&(a.setLineStyle(d(this)),a.setLineColor(JSG.ui.navigator.NavigatorItemView.LINE_COLOR),a.setLineCorner(0),this._shapeRenderer.drawShapeBorder(this._item._shape,this._item.isClosed(),a))};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.NavigatorContainerView=function(a){JSG.ui.navigator.NavigatorContainerView._super.constructor.apply(this,arguments)};JSG.extend(JSG.ui.navigator.NavigatorContainerView,JSG.ui.navigator.NavigatorItemView);JSG.ui.navigator.NavigatorContainerView.prototype.drawSubViews=function(a){a.save();this._shapeRenderer.setClipArea(this._item._shape,a);for(var b=0,c=this._subviews.length;b<c;b++){var d=this._subviews[b];!0==d.isVisible()&&d.draw(a)}a.restore()};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.NavigatorItemController=function(a,b){JSG.ui.navigator.NavigatorItemController._super.constructor.apply(this,arguments);this._navigator=b};JSG.extend(JSG.ui.navigator.NavigatorItemController,JSG.graph.controller.GraphItemController);
JSG.ui.navigator.NavigatorItemController.prototype.createView=function(a){return a instanceof JSG.graph.model.LineConnection?new JSG.ui.navigator.NavigatorEdgeView(a):a instanceof JSG.graph.model.ContainerNode?new JSG.ui.navigator.NavigatorContainerView(a):new JSG.ui.navigator.NavigatorItemView(a)};JSG.ui.navigator.NavigatorItemController.prototype.doLayout=function(a){};
JSG.ui.navigator.NavigatorItemController.prototype.handlePostEvent=function(a){var b=JSG.graph.model.events.Event;switch(a.id){case b.PARENT:this._onParentChange(a.value);break;case b.ITEMADD:case b.ITEMREMOVE:this.refresh()}};JSG.ui.navigator.NavigatorItemController.prototype.sendNotification=function(a,b){};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.NavigatorControllerFactory=function(){function a(a){return{createController:function(b){return b instanceof JSG.graph.model.Graph?new JSG.ui.navigator.NavigatorGraphController(b,a):new JSG.ui.navigator.NavigatorItemController(b,a)}}}var b=void 0;return{getInstance:function(c){b||(b=a(c));return b}}}();JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.NavigatorGraphController=function(a,b){JSG.ui.navigator.NavigatorGraphController._super.constructor.apply(this,arguments);this.navigator=b};JSG.extend(JSG.ui.navigator.NavigatorGraphController,JSG.graph.controller.GraphController);JSG.ui.navigator.NavigatorGraphController.prototype.getGraphController=function(){return this};JSG.ui.navigator.NavigatorGraphController.prototype.createView=function(a){return new JSG.ui.navigator.NavigatorGraphView(a)};
JSG.ui.navigator.NavigatorGraphController.prototype.isSelectable=function(){return!1};JSG.ui.navigator.NavigatorGraphController.prototype.select=function(a){};JSG.ui.navigator.NavigatorGraphController.prototype.setSelection=function(a){};JSG.ui.navigator.NavigatorGraphController.prototype.handlePostEvent=function(a){JSG.ui.navigator.NavigatorGraphController._super.handlePostEvent.call(this,a);if(a.detailId===JSG.graph.model.Graph.AttributeID.REFRESH)this.navigator.onRefresh()};
JSG.ui.navigator.NavigatorGraphController.prototype.sendNotification=function(a,b){};JSG.namespace("JSG.ui.navigator");JSG.ui.navigator.NavigatorViewer=function(a){JSG.ui.navigator.NavigatorViewer._super.constructor.apply(this,arguments);this._selectionProvider=new JSG.graph.view.SelectionProvider};JSG.extend(JSG.ui.navigator.NavigatorViewer,JSG.ui.viewer.ControllerViewer);
JSG.ui.navigator.NavigatorViewer.prototype.setContent=function(a){JSG.ui.navigator.NavigatorViewer._super.setContent.call(this,a);this._rootView=void 0==a?void 0:a.getView()};JSG.ui.navigator.NavigatorViewer.prototype.getSelectionProvider=function(){return this._selectionProvider};JSG.ui.navigator.NavigatorViewer.prototype.getGraphSettings=function(){var a=this.getGraph();return void 0!=a?a.getSettings():void 0};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.Overlay=function(a){JSG.ui.navigator.Overlay._super.constructor.apply(this,arguments);this._cs=a;this._fgColor="#0000aa";this._bgColor="rgba(108,148,212,0.5)";this._bounds=new JSG.geometry.Rectangle(0,0,0,0);this._innerbounds=new JSG.geometry.Rectangle(0,0,0,0);this._innerbounds.right=0;this._innerbounds.bottom=0;this._outerbounds=new JSG.geometry.Rectangle(0,0,0,0);this._outerbounds.right=0;this._outerbounds.bottom=0;this._selectionHandle=new JSG.graph.view.selection.SelectionHandle};
JSG.extend(JSG.ui.navigator.Overlay,JSG.ui.View);JSG.ui.navigator.Overlay.HANDLE_THRESHOLD=4;
JSG.ui.navigator.Overlay.prototype.setBounds=function(a,b,c,d){var e=this._cs.deviceToLogX(JSG.ui.navigator.Overlay.HANDLE_THRESHOLD);this._bounds.set(a,b,c,d);this._innerbounds.setTo(this._bounds);this._outerbounds.setTo(this._bounds);0!=c&&0!=d&&(this._innerbounds.reduceBy(e),this._innerbounds.right=this._innerbounds.x+this._innerbounds.width,this._innerbounds.bottom=this._innerbounds.y+this._innerbounds.height,this._outerbounds.expandBy(e),this._outerbounds.right=this._outerbounds.x+this._outerbounds.width,
this._outerbounds.bottom=this._outerbounds.y+this._outerbounds.height)};JSG.ui.navigator.Overlay.prototype.move=function(a,b){this._bounds.x+=a;this._bounds.y+=b;this.setBounds(this._bounds.x,this._bounds.y,this._bounds.width,this._bounds.height)};
JSG.ui.navigator.Overlay.prototype.getHandleAt=function(a,b){var c=void 0,d=-1,e=JSG.ui.Cursor.Style.AUTO;this._outerbounds.containsPoint(a)&&(this._innerbounds.containsPoint(a)||JSG.touchDevice?(c=JSG.graph.view.selection.SelectionHandle.TYPE.MOVE,e=JSG.ui.Cursor.Style.MOVE):(c=JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE,this._outerbounds.y<a.y&&a.y<this._innerbounds.y?this._outerbounds.x<a.x&&a.x<this._innerbounds.x?(e=JSG.ui.Cursor.Style.RESIZE_NW,d=JSG.graph.view.selection.SelectionHandle.INDEX.NW):
this._innerbounds.right<a.x&&a.x<this._outerbounds.right?(e=JSG.ui.Cursor.Style.RESIZE_NE,d=JSG.graph.view.selection.SelectionHandle.INDEX.NE):(e=JSG.ui.Cursor.Style.RESIZE_N,d=JSG.graph.view.selection.SelectionHandle.INDEX.N):this._innerbounds.right<a.x&&a.x<this._outerbounds.right?this._innerbounds.bottom<a.y&&a.y<this._outerbounds.bottom?(e=JSG.ui.Cursor.Style.RESIZE_SE,d=JSG.graph.view.selection.SelectionHandle.INDEX.SE):(e=JSG.ui.Cursor.Style.RESIZE_E,d=JSG.graph.view.selection.SelectionHandle.INDEX.E):
this._innerbounds.bottom<a.y&&a.y<this._outerbounds.bottom?this._outerbounds.x<a.x&&a.x<this._innerbounds.x?(e=JSG.ui.Cursor.Style.RESIZE_SW,d=JSG.graph.view.selection.SelectionHandle.INDEX.SW):(e=JSG.ui.Cursor.Style.RESIZE_S,d=JSG.graph.view.selection.SelectionHandle.INDEX.S):this._outerbounds.x<a.x&&a.x<this._innerbounds.x&&(e=JSG.ui.Cursor.Style.RESIZE_W,d=JSG.graph.view.selection.SelectionHandle.INDEX.W)));this._selectionHandle.setType(c);this._selectionHandle.setCursor(e);this._selectionHandle.setPointIndex(d);
return this._selectionHandle};JSG.ui.navigator.Overlay.prototype.draw=function(a){this._isVisible&&(this.drawBackground(a),this.drawBorder(a))};JSG.ui.navigator.Overlay.prototype.drawBackground=function(a){a.setFillColor(this._bgColor);a.fillRect(this._bounds)};JSG.ui.navigator.Overlay.prototype.drawBorder=function(a){a.setLineStyle(JSG.graph.model.attributes.LineStyle.SOLID);a.setLineColor(this._fgColor);a.drawRect(this._bounds)};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.OverlayInteraction=function(a){JSG.ui.navigator.OverlayInteraction._super.constructor.apply(this,arguments);this._offset=new JSG.geometry.Point(0,0);this.lastLocation=new JSG.geometry.Point(0,0);this._activeHandle=void 0;this._navigator=a;this._overlay=a._overlay;this._newBounds=new JSG.geometry.Rectangle(0,0,0,0)};JSG.extend(JSG.ui.navigator.OverlayInteraction,JSG.graph.interaction.Interaction);JSG.ui.navigator.OverlayInteraction.prototype.onPinchStart=function(a,b){};
JSG.ui.navigator.OverlayInteraction.prototype.onPinch=function(a,b){this._navigator.zoomGraph(a.gesture.scale,!0)};JSG.ui.navigator.OverlayInteraction.prototype.onHoldDragStart=function(a,b){this.lastLocation.setTo(this.currentLocation);this._updateCursorAt(a.location,a);return!0};JSG.ui.navigator.OverlayInteraction.prototype.onHoldDrag=function(a,b){this._update(a);return!0};JSG.ui.navigator.OverlayInteraction.prototype.onHoldDragEnd=function(a,b){this._moveOverlay(this._offset,a);return!0};
JSG.ui.navigator.OverlayInteraction.prototype.onMouseDown=function(a,b){this.lastLocation.setTo(this.currentLocation);this._updateCursorAt(a.location,a)};JSG.ui.navigator.OverlayInteraction.prototype.onMouseDrag=function(a,b){this._update(a)};
JSG.ui.navigator.OverlayInteraction.prototype._update=function(a){if(this._activeHandle){var b=this._activeHandle.getType();b==JSG.graph.view.selection.SelectionHandle.TYPE.MOVE?(this._offset.setTo(this.currentLocation).subtract(this.lastLocation),this._moveOverlay(this._offset,a)):b==JSG.graph.view.selection.SelectionHandle.TYPE.RESIZE&&this._resizeOverlay(this.currentLocation,a);this.lastLocation.setTo(this.currentLocation)}};
JSG.ui.navigator.OverlayInteraction.prototype._moveOverlay=function(a,b){this._overlay.move(a.x,a.y);JSG.touchDevice&&b.type!=JSG.ui.events.MouseEventType.UP&&b.type!=JSG.ui.events.GestureEventType.HOLDDRAGEND||this._navigator.scrollGraph()};
JSG.ui.navigator.OverlayInteraction.prototype._resizeOverlay=function(a,b){function c(a){return 50<a.width&&50<a.height}function d(a,c){f._overlay.setBounds(a,c,f._overlay._bounds.width,f._overlay._bounds.height);JSG.touchDevice&&b.type!=JSG.ui.events.MouseEventType.UP||f._navigator.scrollGraph()}function e(a,c,d){void 0!=c&&(a=Math.max(a,c));f._overlay.setBounds(f._newBounds.x,f._newBounds.y,f._newBounds.width,f._newBounds.height);JSG.touchDevice&&b.type!=JSG.ui.events.MouseEventType.UP||f._navigator.zoomGraph(a,
d)}var f=this,g=this._overlay._bounds.copy();this._newBounds.setTo(g);switch(this._activeHandle.getPointIndex()){case JSG.graph.view.selection.SelectionHandle.INDEX.NW:this._newBounds.x=a.x;this._newBounds.y=a.y;this._newBounds.width=g.width+g.x-a.x;this._newBounds.height=g.height+g.y-a.y;c(this._newBounds)&&(e(g.width/this._newBounds.width,g.height/this._newBounds.height),d(this._newBounds.x+this._newBounds.width-this._overlay._bounds.width,this._newBounds.y+this._newBounds.height-this._overlay._bounds.height));
break;case JSG.graph.view.selection.SelectionHandle.INDEX.N:this._newBounds.y=a.y;this._newBounds.height=g.height+(g.y-a.y);c(this._newBounds)&&(e(g.height/this._newBounds.height),d(this._newBounds.x,this._newBounds.y+this._newBounds.height-this._overlay._bounds.height));break;case JSG.graph.view.selection.SelectionHandle.INDEX.NE:this._newBounds.y=a.y;this._newBounds.width=a.x-g.x;this._newBounds.height=g.height+(g.y-a.y);c(this._newBounds)&&(e(g.width/this._newBounds.width,g.height/this._newBounds.height),
d(this._newBounds.x,this._newBounds.y+this._newBounds.height-this._overlay._bounds.height));break;case JSG.graph.view.selection.SelectionHandle.INDEX.E:this._newBounds.width=a.x-g.x;c(this._newBounds)&&e(g.width/this._newBounds.width,void 0,!0);break;case JSG.graph.view.selection.SelectionHandle.INDEX.SE:this._newBounds.width=a.x-g.x;this._newBounds.height=a.y-g.y;c(this._newBounds)&&e(g.width/this._newBounds.width,g.height/this._newBounds.height,!0);break;case JSG.graph.view.selection.SelectionHandle.INDEX.S:this._newBounds.height=
a.y-g.y;c(this._newBounds)&&e(g.height/this._newBounds.height,void 0,!0);break;case JSG.graph.view.selection.SelectionHandle.INDEX.SW:this._newBounds.x=a.x;this._newBounds.width=g.width+(g.x-a.x);this._newBounds.height=a.y-g.y;c(this._newBounds)&&(e(g.width/this._newBounds.width,g.height/this._newBounds.height),d(this._newBounds.x+this._newBounds.width-this._overlay._bounds.width,this._newBounds.y));break;case JSG.graph.view.selection.SelectionHandle.INDEX.W:this._newBounds.x=a.x,this._newBounds.width=
g.width+(g.x-a.x),c(this._newBounds)&&(e(g.width/this._newBounds.width),d(this._newBounds.x+this._newBounds.width-this._overlay._bounds.width,this._newBounds.y))}};JSG.ui.navigator.OverlayInteraction.prototype.onMouseMove=function(a,b){this._updateCursorAt(a.location,a)};
JSG.ui.navigator.OverlayInteraction.prototype._updateCursorAt=function(a,b){this._activeHandle=this._overlay.getHandleAt(a,b);var c=void 0!=this._activeHandle?this._activeHandle.getCursor():"auto";JSG.ui.navigator.OverlayInteraction._super.setCursor.call(this,c)};JSG.ui.navigator.OverlayInteraction.prototype.onMouseUp=function(a,b){this._update(a);this._activeHandle=void 0;JSG.ui.navigator.OverlayInteraction._super.setCursor.call(this,"auto")};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.JSGNavigatorInteractionHandler=function(a){JSG.ui.navigator.JSGNavigatorInteractionHandler._super.constructor.apply(this,arguments);this.origin=new JSG.geometry.Point(0,0)};JSG.extend(JSG.ui.navigator.JSGNavigatorInteractionHandler,JSG.graph.interaction.InteractionHandler);
JSG.ui.navigator.JSGNavigatorInteractionHandler.prototype.handleMouseEvent=function(a){a.location.translate(-this.origin.x,-this.origin.y);JSG.ui.navigator.JSGNavigatorInteractionHandler._super.handleMouseEvent.call(this,a)};JSG.ui.navigator.JSGNavigatorInteractionHandler.prototype.handleGestureEvent=function(a){a.location.translate(-this.origin.x,-this.origin.y);JSG.ui.navigator.JSGNavigatorInteractionHandler._super.handleGestureEvent.call(this,a)};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.JSGNavigatorPanel=function(a){JSG.ui.navigator.JSGNavigatorPanel._super.constructor.apply(this,arguments);this._cs=a._cs;this._navViewer=new JSG.ui.navigator.NavigatorViewer(this);this._navViewer.setControllerFactory(JSG.ui.navigator.NavigatorControllerFactory.getInstance(a))};JSG.extend(JSG.ui.navigator.JSGNavigatorPanel,JSG.ui.GraphViewPanel);JSG.ui.navigator.JSGNavigatorPanel.prototype.getViewer=function(){return this._navViewer};
JSG.ui.navigator.JSGNavigatorPanel.prototype.setGraph=function(a){this._navViewer.setGraph(a);a=this._navViewer.getRootView();this.setView(a)};JSG.ui.navigator.JSGNavigatorPanel.prototype.getGraphView=function(){return this._navViewer.getRootView()};JSG.ui.navigator.JSGNavigatorPanel.prototype.clear=function(){this.setView(void 0)};JSG.ui.navigator.JSGNavigatorPanel.prototype.drawBackground=function(a){};
JSG.ui.navigator.JSGNavigatorPanel.prototype.drawClientArea=function(a){var b=this.getView();if(b){var c=this.getBounds(JSG.rectCache.get());a.save();a.translate(-c.x,-c.y);b.draw(a);a.restore();JSG.rectCache.release(c)}};JSG.namespace("JSG.ui.navigator");
JSG.ui.navigator.JSGNavigator=function(a,b,c){JSG.ui.navigator.JSGNavigator._super.constructor.apply(this,arguments);this._bgColor=JSG.bkColorNavigator;this._graphEditor=void 0;this._cs=new JSG.ui.graphics.MetricCoordinateSystem;this._graphicSystem=new JSG.ui.graphics.GraphicSystem(a,this._cs);this._graphicSystem.resize(b,c);this._forceRepaint=!0;this._requestRepaint=!1;this._navigatorPanel=new JSG.ui.navigator.JSGNavigatorPanel(this);this._overlay=new JSG.ui.navigator.Overlay(this._cs);this._navigatorPanel.getViewer().setDefaultInteraction(new JSG.ui.navigator.OverlayInteraction(this));
this._offsetToPanel=new JSG.geometry.Point(0,0);this._interactionHandler=new JSG.ui.navigator.JSGNavigatorInteractionHandler(this._navigatorPanel.getViewer());this._graphicSystem.setInteractionHandler(this._interactionHandler);this._graphicSystem.setContent(this);var d=JSG.graph.notifications.NotificationCenter.getInstance();d.register(this,JSG.DRAW_DISABLED_NOTIFICATION);d.register(this,JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION);d.register(this,JSG.ui.ScrollPanel.SCROLL_NOTIFICATION);d.register(this,
JSG.ui.ViewPort.BOUNDS_CHANGED_NOTIFICATION);d.register(this,JSG.graph.view.REFRESHED_MODEL_NOTIFICATION);d.register(this,JSG.graph.view.GRAPH_REPAINT_NOTIFICATION)};JSG.extend(JSG.ui.navigator.JSGNavigator,JSG.ui.View);JSG.ui.navigator.JSGNavigator.prototype._INSET=4;
JSG.ui.navigator.JSGNavigator.prototype.destroy=function(){this.clear();this._graphicSystem.destroy();var a=JSG.graph.notifications.NotificationCenter.getInstance();a.unregister(this,JSG.DRAW_DISABLED_NOTIFICATION);a.unregister(this,JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION);a.unregister(this,JSG.ui.ScrollPanel.SCROLL_NOTIFICATION);a.unregister(this,JSG.ui.ViewPort.BOUNDS_CHANGED_NOTIFICATION);a.unregister(this,JSG.graph.view.REFRESHED_MODEL_NOTIFICATION);a.unregister(this,JSG.graph.view.GRAPH_REPAINT_NOTIFICATION)};
JSG.ui.navigator.JSGNavigator.prototype.resize=function(a,b){this._graphicSystem.resize(a,b);this._handleResize();this._graphicSystem.paint(this._forceRepaint)};JSG.ui.navigator.JSGNavigator.prototype.onRefresh=function(){this._navigatorPanel.layout();this._handleResize();this._graphicSystem.paint(this._forceRepaint)};JSG.ui.navigator.JSGNavigator.prototype.onResize=function(a){this._handleResize();this._graphicSystem.paint(this._forceRepaint)};
JSG.ui.navigator.JSGNavigator.prototype._handleResize=function(){this._navigatorPanel.getGraphView()instanceof JSG.graph.view.GraphView&&this._navigatorPanel.getGraphView().clearCache();this._setZoom();this._adjustOffset();this._setOverlayBounds();this._setInteractionHandlerOrigin()};
JSG.ui.navigator.JSGNavigator.prototype._setZoom=function(){var a=this._graphicSystem.getSize(),b=this._navigatorPanel.getSize();if(0!=b.x&&0!=b.y){var c=this._cs.deviceToLogXNoZoom(a.x-2*this._INSET)/b.x,a=this._cs.deviceToLogYNoZoom(a.y-2*this._INSET)/b.y;this._cs.setZoom(Math.min(c,a))}else this._cs.setZoom(1)};
JSG.ui.navigator.JSGNavigator.prototype._adjustOffset=function(){var a=this._graphicSystem.getSize(),b=this._navigatorPanel.getBounds();0!=this._cs.getZoom()&&(a.x=this._cs.deviceToLogX(a.x),a.y=this._cs.deviceToLogY(a.y));this._offsetToPanel.x=(a.x-b.width)/2;this._offsetToPanel.y=(a.y-b.height)/2};
JSG.ui.navigator.JSGNavigator.prototype._setOverlayBounds=function(){if(void 0!=this._graphEditor){var a=this._graphEditor.getVisibleGraphRect(),b=this._navigatorPanel.getBounds();a.x=b.x-a.x;a.y=b.y-a.y;this._overlay.setBounds(-a.x,-a.y,a.width,a.height)}};JSG.ui.navigator.JSGNavigator.prototype._setInteractionHandlerOrigin=function(){this._interactionHandler.origin.setTo(this._offsetToPanel)};
JSG.ui.navigator.JSGNavigator.prototype.scrollGraph=function(){var a=this._overlay._bounds,b=this._navigatorPanel.getBounds();this._graphEditor.setHorizontalScrollRange(a.x,a.x+a.width);this._graphEditor.setVerticalScrollRange(a.y,a.y+a.height);this._graphEditor.setScrollPosition(-a.x-b.x,-a.y-b.y)};JSG.ui.navigator.JSGNavigator.prototype.zoomGraph=function(a,b){var c=this._graphEditor.getGraphViewer(),d=c.getZoom()*a;c.setZoom(d);!0===b&&this._graphEditor.repaint()};
JSG.ui.navigator.JSGNavigator.prototype.onNotification=function(a){switch(a.name){case JSG.DRAW_DISABLED_NOTIFICATION:case JSG.graph.view.REFRESHED_MODEL_NOTIFICATION:this._forceRepaint=!JSG.drawingDisabled;break;case JSG.ui.ScrollPanel.SCROLL_NOTIFICATION:case JSG.ui.ViewPort.BOUNDS_CHANGED_NOTIFICATION:this._setOverlayBounds();this._graphicSystem.paint(this._forceRepaint);break;case JSG.ui.GraphEditor.VIEW_MODE_NOTIFICATION:void 0!=this.getGraph()&&(this._navigatorPanel.getGraphView().clearCache(),
this._navigatorPanel.layout(),this._handleResize(),this._graphicSystem.paint(this._forceRepaint))}};JSG.ui.navigator.JSGNavigator.prototype.setGraphEditor=function(a){this._graphEditor=a;this._overlay.setVisible(!0);this._navigatorPanel.setGraph(a.getGraph());this._handleResize();this._graphicSystem.paint(this._forceRepaint)};JSG.ui.navigator.JSGNavigator.prototype.getGraph=function(){return void 0!=this._graphEditor?this._graphEditor.getGraph():void 0};
JSG.ui.navigator.JSGNavigator.prototype.getGraphSettings=function(){var a=this.getGraph();return void 0!=a?a.getSettings():void 0};JSG.ui.navigator.JSGNavigator.prototype.clear=function(){this._graphEditor=void 0;this._navigatorPanel.clear();this._overlay.setVisible(!1);this._overlay.setBounds(0,0,0,0);this._graphicSystem.paint(this._forceRepaint)};
JSG.ui.navigator.JSGNavigator.prototype.draw=function(a){void 0==this._drawing?(this._drawing=!0,this._requestRepaint=!1,this.clearCanvas(a),a.save(),a.translate(this._offsetToPanel.x,this._offsetToPanel.y),this._navigatorPanel.draw(a),this._overlay.draw(a),a.restore(),this._drawing=void 0):this._requestRepaint=!0};
JSG.ui.navigator.JSGNavigator.prototype.clearCanvas=function(a){a=a.getContext();a.fillStyle=this._bgColor;var b=this._graphicSystem.getSize(JSG.ptCache.get());a.fillRect(0,0,b.x,b.y);JSG.ptCache.release(b)};